# Siphon Treasury (scheme)
celestial_siphon_treasury_interaction = {
	icon = icon_imperial_treasury
	category = interaction_category_hostile
	send_name = START_SCHEME
	scheme = celestial_siphon_treasury
	desc = celestial_siphon_treasury_interaction_desc
	common_interaction = yes

	interface_priority = 60
	target_type = title
	target_filter = recipient_domain_titles

	filter_tags = { dynastic_cycle }

	can_be_picked_title = {
		scope:target ?= scope:recipient.primary_title
	}
	has_valid_target_showing_failures_only = {
		scope:target ?= scope:recipient.primary_title
	}
	is_shown = {
		scope:actor = {
			has_treasury = yes
		}
		scope:recipient = {
			has_treasury = yes
			OR = {
				is_landed = yes
				tgp_is_any_minister = yes
			}
			top_liege = scope:actor.top_liege
		}
	}

	is_valid_showing_failures_only = {
		# has to have some treasury to steal from
		scope:recipient = {
			treasury > 0
		}
		# Cannot be at war
		NOT = {
			scope:actor = { is_at_war_with = scope:recipient }
		}
		trigger_if = {
			limit = { scope:actor = { has_variable = no_scheming_allowed_var } }
			custom_tooltip = {
				text = no_scheming_allowed_var_tt
				scope:actor.var:no_scheming_allowed_var != scope:recipient
			}
		}
	}

	can_send = {
		scope:actor = {
			custom_description = {
				text = "character_interactions_hostile_actions_disabled_delay"
				NOT = { has_character_flag = flag_hostile_actions_disabled_delay }
			}
		}
	}

	cooldown_against_recipient = { years = 5 }

	# Scheme Starter Packages
	options_heading = schemes.t.agent_packages
	send_options_exclusive = yes
	## Balanced agents.
	send_option = {
		flag = agent_focus_balance
		current_description = celestial_siphon_treasury_interaction.tt.agent_focus_balance
	}
	## Focused on Success Chance.
	send_option = {
		flag = agent_focus_success
		current_description = celestial_siphon_treasury_interaction.tt.agent_focus_success
	}
	## Focused on Speed.
	send_option = {
		flag = agent_focus_speed
		current_description = celestial_siphon_treasury_interaction.tt.agent_focus_speed
	}
	## Focused on Secrecy.
	send_option = {
		flag = agent_focus_secrecy
		current_description = celestial_siphon_treasury_interaction.tt.agent_focus_secrecy
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = siphon_treasury_notification
				left_icon = scope:recipient
				right_icon = scope:target
				# Success.
				if = {
					limit = { scope:agent_focus_success ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_siphon_treasury
						TARGET_TYPE = target_title
						TARGET_SCOPE = scope:recipient.primary_title
						# Success.
						AGENT_1 = agent_scout
						AGENT_2 = agent_scout
						AGENT_3 = agent_muscle
						# Speed.
						AGENT_4 = agent_infiltrator
						# Secrecy.
						AGENT_5 = agent_lookout
					}
				}
				# Speed.
				else_if = {
					limit = { scope:agent_focus_speed ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_siphon_treasury
						TARGET_TYPE = target_title
						TARGET_SCOPE = scope:recipient.primary_title
						# Speed.
						AGENT_1 = agent_infiltrator
						AGENT_2 = agent_infiltrator
						AGENT_3 = agent_footpad
						# Success.
						AGENT_4 = agent_scout
						# Secrecy.
						AGENT_5 = agent_lookout
					}
				}
				# Secrecy.
				else_if = {
					limit = { scope:agent_focus_secrecy ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_siphon_treasury
						TARGET_TYPE = target_title
						TARGET_SCOPE = scope:recipient.primary_title
						# Secrecy.
						AGENT_1 = agent_lookout
						AGENT_2 = agent_lookout
						AGENT_3 = agent_alibi
						# Success.
						AGENT_4 = agent_scout
						# Speed.
						AGENT_5 = agent_infiltrator
					}
				}
				# Balanced.
				else = {
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_siphon_treasury
						TARGET_TYPE = target_title
						TARGET_SCOPE = scope:recipient.primary_title
						# Success.
						AGENT_1 = agent_scout
						AGENT_2 = agent_muscle
						# Speed.
						AGENT_3 = agent_infiltrator
						AGENT_4 = agent_footpad
						# Secrecy.
						AGENT_5 = agent_lookout
					}
				}
			}
			# Scheme progress bonus from education
			education_5_scheme_progress_effect = { SKILL = stewardship }
			# Scheme bonuses from being the emperor/dominant family/powerful family
			if = {
				limit = {
					scope:recipient != scope:actor
				}
				ep3_actor_scheme_modifier_effect = yes
			}
			if = {
				limit = {
					exists = scope:new_scheme
				}
				scope:new_scheme = {
					set_variable = {
						name = embezzlement_stake
						value = 0
					}
					set_variable = {
						name = embezzlement_stake_initial
						value = scope:recipient.treasury_siphoned_value
					}
				}
			}
			else = {
				save_scope_as = scheme_owner
				scope:recipient = {
					save_scope_as = scheme_target
				}
				save_scope_value_as = {
					name = embezzlement_stake_tooltip
					value = scope:recipient.treasury_siphoned_value
				}
			}
			if = {
				limit = {
					scope:recipient = scope:actor
				}
				custom_tooltip = celestial_siphon_treasury_gain_gold_tt
			}
			else = {
				custom_tooltip = celestial_siphon_treasury_gain_gold_or_treasury_tt
			}
			# show_as_tooltip = { #LotR
			# 	if = {
			# 		limit = {
			# 			scope:recipient = {
			# 				has_title = title:h_china
			# 				this != scope:actor
			# 			}
			# 		}
			# 		tgp_activate_catalyst_against_hegemon_effect = {
			# 			HEGEMON = scope:recipient
			# 			CATALYST = catalyst_governor_embezzlement
			# 		}
			# 	}
			# 	else_if = {
			# 		limit = {
			# 			scope:actor = {
			# 				has_title = title:h_china
			# 			}
			# 		}
			# 		scope:actor = {
			# 			add_legitimacy_effect = { LEGITIMACY = minor_legitimacy_loss }
			# 		}
			# 	}
			# }

			stress_impact = {
				content = medium_stress_impact_gain
			}
			if = {
				limit = {
					has_relation_nemesis = scope:recipient
				}
				stress_impact = { base = major_stress_impact_loss }
			}
			else_if = {
				limit = {
					has_relation_rival = scope:recipient
				}
				stress_impact = { base = medium_stress_impact_loss }
			}
		}
	}

	auto_accept = yes

	# AI
	ai_targets = {
		ai_recipients = liege
		ai_recipients = top_liege
		ai_recipients = peer_vassals
		ai_recipients = vassals
		max = 10
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 144
		duchy = 72
		kingdom = 144
		empire = 0
		hegemony = 0
	}

	ai_potential = {
		has_treasury = yes
		is_landed = yes
		#do it only when you are poor
		OR = {
			treasury < 0
			and = {
				ai_greed >= 100
				ai_honor < 0
			}
		}
		# Morally upright or generally content characters never embezzle.
		NOR = {
			any_scheme = {
				is_scheme_category = hostile
			}
			ai_honor >= 25
			has_trait = honest
			has_trait = generous
			has_trait = just
			has_trait = content
			has_trait = loyal
		}
	}

	ai_will_do = {
		# Embezzlement is serious, so you need actual reasons for it.
		base = -50

		# Additions.
		## Weight for opinion.
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = -1
		}
		## Weight for personality.
		ai_value_modifier = {
			ai_boldness = 0.25
			ai_greed = 1
			ai_honor = -0.5
		}
		## Debt is a great motivator for theft.
		### Is slightly in debt.
		modifier = {
			add = 10
			debt_level = 1
		}
		### Is one year in debt.
		modifier = {
			add = 20
			debt_level = 2
		}
		### Is two years in debt.
		modifier = {
			add = 40
			debt_level = 3
		}
		### Is three years in debt.
		modifier = {
			add = 60
			debt_level = 4
		}
		### Is four years in debt.
		modifier = {
			add = 80
			debt_level = 5
		}
		### Is over five years in debt.
		modifier = {
			add = 100
			debt_level >= 6
		}
		## Certain traits can affect likelihood directly.
		### +++ Greedy.
		modifier = {
			add = 30
			has_trait = greedy
		}
		### ++ Deceitful.
		modifier = {
			add = 20
			has_trait = deceitful
		}
		### + Arbitrary.
		modifier = {
			add = 10
			has_trait = arbitrary
		}
		# focus on peer vassals more than on characters in your own hierarchy
		modifier = {
			add = -20
			scope:actor = {
				OR = {
					is_vassal_or_below_of = scope:recipient
					is_liege_or_above_of = scope:recipient
				}
			}
		}
		# The Hegemon shouldn't be targeted that often, unless actor in the discontent movement
		modifier = {
			add = -100
			# scope:recipient = { #LotR
			# 	has_title = title:h_china
			# }
			situation:dynastic_cycle ?= {
				any_participant_group = {
					participant_group_type = conservative_movement
					NOT = {
						participant_group_has_character = scope:actor
					}
				}
			}
		}
		# Factors.
		## + Do pick on people we hate.
		modifier = {
			factor = 1.5
			should_prioritise_hostile_action_against_due_to_personal_relations_trigger = {
				ACTOR = scope:actor
				RECIPIENT = scope:recipient
			}
		}
		## Avoid doing it on fellow movement members
		modifier = {
			factor = {
				value = 0.25
				if = {
					limit = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
					multiply = 0.5
				}
			}
			is_in_same_movement_as = { TARGET = scope:recipient }
		}
		## x0 Don't pick on our friends or allies.
		modifier = {
			factor = 0
			should_avoid_hostile_action_against_due_to_personal_relations_trigger = {
				ACTOR = scope:actor
				RECIPIENT = scope:recipient
			}
		}
	}
}

# Requisition Treasury
celestial_demand_treasury_interaction = {
	icon = icon_imperial_treasury
	category = interaction_category_vassal
	send_name = celestial_demand_treasury_interaction_send_name
	desc = celestial_demand_treasury_interaction_desc
	notification_text = celestial_demand_treasury_interaction_recipient_desc
	common_interaction = no
	filter_tags = { celestial_ministry dynastic_cycle }

	interface_priority = 61

	cooldown = { years = 2 }
	cooldown_against_recipient = { years = 10 }

	is_shown = {
		scope:actor = {
			has_treasury = yes
		}
		scope:recipient = {
			has_treasury = yes
			this != scope:actor
			is_vassal_of = scope:actor
		}
	}

	is_valid = {
	}

	is_valid_showing_failures_only = {
		scope:recipient = {
			treasury > 100
			NOT = {
				is_at_war_with = scope:actor
			}
		}
	}

	cost = {
		influence = {
			add = {
				value = minor_influence_value
				desc = BASE
			}
			if = {
				limit = {
					scope:recipient.merit_level > 0
				}
				add = {
					value = miniscule_influence_value
					multiply = {
						value = scope:recipient.merit_level
					}
					desc = recipient_merit_level_desc
				}
			}
		}
	}

	is_highlighted = { # Highlight the interaction if they have A LOT in their treasury
		scope:recipient = {
			treasury > 1000
		}
	}

	highlighted_reason = HIGHLIGHTED_DEMAND_TREASURY

	on_accept = {
		# Save the recipients current treasury, to make sure it doesn't change
		save_scope_value_as = {
			name = recipient_treasury_amount
			value = { # We take half their treasury, up to a maximum based on tier
				value = scope:recipient.treasury
				multiply = 0.5
				max = {
					value = 400
					multiply = scope:recipient.primary_title.tier
				}
			}
		}
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_good
				title = celestial_demand_treasury_interaction
				right_icon = scope:recipient

				scope:recipient = {
					# Pay half the treasury to actor
					pay_short_term_treasury = {
						target = scope:actor
						treasury = scope:recipient_treasury_amount
					}
				}
			}
		}
	}

	on_decline = {
		scope:actor = {
			if = {
				limit = {
					is_ai = yes
				}
				add_opinion = {
					target = scope:recipient
					modifier = refusal_opinion
					opinion = -25
				}
			}
			send_interface_toast = {
				type = event_toast_effect_bad
				title = celestial_demand_treasury_interaction
				right_icon = scope:recipient
				custom_tooltip = celestial_demand_treasury_interaction_declined_desc
			}
		}
		scope:recipient = {
			# Declining will cost influence - Scaling on the difference in merit level
			change_influence = {
				value = medium_influence_loss
				if = {
					limit = {
						scope:recipient.merit_level < scope:actor.merit_level
					}
					add = {
						value = minor_influence_loss
						multiply = {
							value = scope:actor.merit_level
							subtract = scope:recipient.merit_level
						}
						desc = recipient_merit_level_desc
					}
				}
			}
		}
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 12
		kingdom = 12
		empire = 6
		hegemony = 6
	}

	ai_targets = {
		ai_recipients = vassals
	}

	ai_potential = {
		treasury < 100 # Don't bother unless your treasury is low
		is_adult = yes
	}

	ai_will_do = {
		base = 0

		# Opinion
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = -0.5
		}

		# Personality
		modifier = {
			add = 25
			has_trait = greedy
		}
		modifier = {
			add = 25
			has_trait = ambitious
		}
		modifier = {
			add = 15
			has_trait = impatient
		}
		modifier = {
			add = 10
			has_trait = brave
		}
		modifier = {
			add = 10
			has_trait = arbitrary
		}
		modifier = {
			add = -10
			has_trait = content
		}
		modifier = {
			add = -20
			has_trait = just
		}
		modifier = {
			add = -30
			has_trait = generous
		}

		# Don't do it towards elders or disciples
		modifier = {
			factor = 0
			OR = {
				has_relation_disciple = scope:recipient
				has_relation_elder = scope:recipient
			}
		}

		# Don't do it towards fellow movement members
		modifier = {
			factor = 0
			is_in_same_movement_as = { TARGET = scope:recipient }
		}

		# Only do this towards players if they are disliked
		modifier = {
			factor = 0
			scope:recipient = {
				is_ai = no
				reverse_opinion = {
					target = scope:actor
					value >= 0
				}
			}
		}
	}

	ai_accept = {
		base = 0

		# Opinion
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
		}

		# Traits
		modifier = {
			add = 100
			has_trait = loyal
			desc = INTERACTION_LOYAL
		}
		modifier = {
			add = 20
			has_trait = trusting
			desc = INTERACTION_TRUSTING
		}
		modifier = {
			add = 10
			has_trait = diligent
			desc = INTERACTION_DILIGENT
		}
		modifier = {
			add = 5
			has_trait = craven
			desc = INTERACTION_CRAVEN
		}
		modifier = {
			add = -10
			has_trait = paranoid
			desc = INTERACTION_PARANOID
		}
		modifier = {
			add = -10
			has_trait = just
			desc = INTERACTION_JUST
		}
		modifier = {
			add = -20
			has_trait = greedy
			desc = INTERACTION_GREEDY
		}
		modifier = {
			add = -50
			has_trait = disloyal
			desc = INTERACTION_DISLOYAL
		}

		# Relations to actor
		modifier = {
			scope:actor = {
				has_relation_friend = scope:recipient
			}
			add = 25
			desc = AI_YOUR_FRIEND
		}
		modifier = {
			scope:actor = {
				has_relation_rival = scope:recipient
				NOT = { has_relation_nemesis = scope:recipient }
			}
			add = -50
			desc = AI_YOUR_RIVAL
		}
		modifier = {
			scope:actor = {
				has_relation_nemesis = scope:recipient
			}
			add = -100
			desc = offer_vassalization_interaction_aibehavior_nemesis_tt
		}
		modifier = {
			has_relation_disciple = scope:actor
			add = 10
			desc = AI_YOUR_ELDER
		}
		modifier = {
			has_relation_elder = scope:actor
			add = 15
			desc = AI_YOUR_DISCIPLE
		}

		# You have high merit
		modifier = {
			scope:actor.merit_level > scope:recipient.merit_level
			#title:h_china ?= { holder != scope:actor } # Don't check the hegemon #LotR
			add = {
				value = 10
				multiply = {
					value = scope:actor.merit_level
					subtract = scope:recipient.merit_level
				}
			}
			desc = actor_higher_merit_level_desc
		}

		# Your merit level is lower
		modifier = {
			scope:actor.merit_level < scope:recipient.merit_level
			#title:h_china ?= { holder != scope:actor } # Don't check the hegemon #LotR
			add = {
				value = -10
				multiply = {
					value = scope:recipient.merit_level
					subtract = scope:actor.merit_level
				}
			}
			desc = recipient_higher_merit_level_desc
		}

		# Dread
		modifier = {
			has_dread_level_towards = {
				target = scope:actor
				level = 1
			}
			add = intimidated_reason_value
			desc = INTIMIDATED_REASON
		}
		modifier = {
			has_dread_level_towards = {
				target = scope:actor
				level = 2
			}
			add = cowed_reason_value
			desc = COWED_REASON
		}
	}
}

# Send Treasury
celestial_give_treasury_interaction = {
	icon = icon_imperial_treasury
	category = interaction_category_vassal
	send_name = celestial_give_treasury_interaction_send_name
	desc = celestial_give_treasury_interaction_desc
	#notification_text = celestial_give_treasury_interaction_recipient_desc
	common_interaction = no

	filter_tags = { dynastic_cycle }

	interface_priority = 62

	is_shown = {
		scope:actor = {
			has_treasury = yes
		}
		scope:recipient = {
			has_treasury = yes
			this != scope:actor
			top_liege = scope:actor.top_liege
		}
	}

	is_valid = {
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			treasury >= give_treasury_value
			NOT = { is_at_war_with = scope:recipient }
		}
	}

	is_highlighted = { # Highlight the interaction if they have a very small treasury
		scope:recipient = {
			treasury < 50
		}
	}

	highlighted_reason = HIGHLIGHTED_GIVE_TREASURY

	auto_accept = {
		custom_description = {
			text = auto_accept_interaction_ai
			object = scope:recipient
			scope:recipient = {
				is_ai = yes
			}
		}
	}

	on_auto_accept = {
		scope:recipient = {
			# When recipient is AI, let's figure out if they would be greatful - But we want to keep the overall chance fairly small
			random = {
				chance = {
					value = 0
					if = { # They REALLY need the extra treasury
						limit = {
							treasury < 0
						}
						add = 20
					}
					else_if = { # They need the extra treasury
						limit = {
							treasury < 50
						}
						add = 12
					}
					else_if = { # The contribution would still be nice
						limit = {
							treasury < 100
						}
						add = 5
					}
					if = {
						limit = {
							has_trait = humble
						}
						add = 8
					}
					if = {
						limit = {
							has_trait = just
						}
						add = 6
					}
					if = {
						limit = {
							has_trait = generous
						}
						add = 6
					}
					if = {
						limit = {
							has_trait = trusting
						}
						add = 5
					}
				}
				modifier = { # The top liege does not give gifts back
					factor = 0
					this = top_liege
				}

				# If true, provide actor with a reward
				scope:actor = {
					trigger_event = {
						id = tgp_interaction_event.0001
						days = { 30 60 }
					}
				}
			}
		}
	}

	on_accept = {
		scope:actor = {
			# Let the player know they won't get additional opinion
			if = {
				limit = {
					scope:recipient = {
						has_opinion_modifier = {
							target = scope:actor
							modifier = treasury_gift_opinion
						}
					}
				}
				custom_tooltip = ALREADY_SENT_TREASURY_WARNING
			}
			send_interface_toast = {
				type = event_toast_effect_good
				title = celestial_give_treasury_interaction
				right_icon = scope:recipient

				# Transfer treasury amount
				pay_short_term_treasury = {
					target = scope:recipient
					treasury = give_treasury_value
				}

				# Advancement movement members get merit when in the advancement phase
				if = {
					limit = {
						top_participant_group:dynastic_cycle ?= {
							has_participant_group_parameter = dynastic_cycle_send_treasury_for_merit
						}
					}
					change_merit = medium_merit_value
				}

				scope:recipient = {
					# They will like actor for it
					add_opinion = {
						target = scope:actor
						modifier = treasury_gift_opinion
						opinion = 20
					}
				}
			}
		}
	}

	on_decline = {
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 60
		kingdom = 60
		empire = 60
		hegemony = 60
	}

	ai_targets = {
		ai_recipients = vassals
	}
	ai_targets = {
		ai_recipients = situation_participant_group
		parameter = dynastic_cycle
		max = 20
	}

	ai_potential = {
		is_adult = yes
		treasury > 1000 # Let's make sure the AI don't spend their treasury needlessly
	}

	ai_will_do = {
		base = 0

		# Opinion
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = -0.25
		}

		# Personality
		modifier = {
			add = -30
			has_trait = greedy
		}
		modifier = {
			add = -20
			has_trait = ambitious
		}
		modifier = {
			add = 10
			has_trait = trusting
		}
		modifier = {
			add = 15
			has_trait = generous
		}

		# Support your fellow movement members
		modifier = {
			factor = {
				value = 1.5
				if = {
					limit = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
					multiply = 1.5
				}
			}
			is_in_same_movement_as = { TARGET = scope:recipient }
		}

		# Slight preference to do this towards players
		modifier = {
			factor = 1.5
			scope:recipient = {
				is_ai = no
			}
		}

		# Don't support bad relations
		modifier = {
			factor = 0
			OR = {
				has_relation_rival = scope:recipient
				has_relation_nemesis = scope:recipient
			}
		}

		# Don't support characters who doesn't need it
		modifier = {
			factor = 0
			scope:recipient = {
				treasury > 150
			}
		}

		# Avoid sending treasury multiple times
		modifier = {
			factor = 0
			scope:recipient = {
				has_opinion_modifier = {
					target = scope:actor
					modifier = treasury_gift_opinion
				}
			}
		}
	}

	ai_accept = {
		base = 100
	}
}

# Request Mentorship
request_mentoring_interaction = {
	icon = mentor
	interface_priority = 20
	category = interaction_category_friendly
	common_interaction = yes
	name = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:actor = scope:recipient
				}
				desc = request_mentoring_interaction_mentee
			}
			desc = request_mentoring_interaction
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:actor = scope:recipient
				}
				desc = request_mentoring_interaction_mentee_desc
			}
			desc = request_mentoring_interaction_desc
		}
	}

	filter_tags = { dynastic_cycle celestial_ministry }

	is_shown = {
		has_tgp_dlc_trigger = yes
		scope:actor = {
			government_has_flag = government_is_celestial
		}
		scope:recipient = {
			top_liege = scope:actor.top_liege
			OR = {
				is_ruler = yes
				is_courtier_of = scope:actor
			}
		}
	}

	is_valid_showing_failures_only = {
		# Cannot be at war
		scope:actor = {
			NOT = { is_at_war_with = scope:recipient }
			is_incapable = no
			is_imprisoned = no
		}
		scope:recipient = {
			is_incapable = no
			is_imprisoned = no
		}
	}

	# Set up recipient list, i.e. the character you want to teach
	populate_recipient_list = {
		scope:actor = {
			house ?= {
				every_house_member = {
					limit = {
						government_allows = administrative
						trigger_if = { # If actor is house head, do it for all house members in the realm
							limit = {
								prev.house_head ?= scope:actor
							}
							top_liege = scope:actor.top_liege
						}
						trigger_else = { # Otherwise, do it only for house members in actor's own court/immediate children
							OR = {
								liege = scope:actor
								AND = {
									top_liege = scope:actor.top_liege
									any_parent = { this = scope:actor }
								}
							}
						}
						OR = {
							this = scope:actor # You can always make yourself a mentee
							is_ai = yes # But not other players
						}
						this != scope:recipient
					}
					add_to_list = characters
				}
			}
			every_courtier = {
				limit = {
					government_allows = administrative
					top_liege = scope:actor.top_liege
					this != scope:recipient
					NOT = { is_in_list = characters }
				}
				add_to_list = characters
			}
		}
	}

	# Send options
	# Merit
	send_option = {
		flag = merit
		is_valid = {
			trigger_if = {
				limit = { exists = scope:secondary_recipient }
				custom_tooltip = {
					text = lower_merit_level_than_recipient
					exists = scope:secondary_recipient
					scope:secondary_recipient.merit_level < scope:recipient.merit_level
				}
			}
			trigger_else = {
				custom_tooltip = {
					text = no_target_selected_tt
					exists = scope:secondary_recipient
				}
			}
		}
		localization = MENTOR_SCHEME_MERIT
	}
	# Confucian Education
	send_option = {
		flag = confucian_education
		is_valid = {
			scope:recipient = {
				has_trait = confucian_education
			}
			trigger_if = {
				limit = {
					scope:secondary_recipient ?= { has_trait = confucian_education }
				}
				scope:secondary_recipient = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = confucian_education
							value < "scope:recipient.has_trait_xp(confucian_education)"
						}
					}
				}
			}
		}
		localization = MENTOR_SCHEME_CONFUCIAN
	}
	# Disabled Commander Trait Option - For when the target doesn't have any commander traits
	send_option = {
		flag = no_commander_traits
		is_shown = {
			scope:recipient = {
				number_of_commander_traits = 0
			}
		}
		is_valid = {
			custom_tooltip = {
				text = recipient_has_no_commander_traits
				always = no
			}
		}
		localization = MENTOR_SCHEME_NO_COMMANDER_TRAITS
	}
	# Commander Traits
	send_option = {
		flag = logistician
		is_shown = {
			scope:recipient = {
				has_trait = logistician
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = logistician }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = logistician
							value < "scope:recipient.has_trait_xp(logistician)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_LOGISTICIAN
	}
	send_option = {
		flag = military_engineer
		is_shown = {
			scope:recipient = {
				has_trait = military_engineer
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = military_engineer }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = military_engineer
							value < "scope:recipient.has_trait_xp(military_engineer)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_MILITARY_ENGINEER
	}
	send_option = {
		flag = aggressive_attacker
		is_shown = {
			scope:recipient = {
				has_trait = aggressive_attacker
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = aggressive_attacker }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = aggressive_attacker
							value < "scope:recipient.has_trait_xp(aggressive_attacker)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_AGGRESSIVE_ATTACKER
	}
	send_option = {
		flag = unyielding_defender
		is_shown = {
			scope:recipient = {
				has_trait = unyielding_defender
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = unyielding_defender }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = unyielding_defender
							value < "scope:recipient.has_trait_xp(unyielding_defender)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_UNYIELDING_DEFENDER
	}
	send_option = {
		flag = forder
		is_shown = {
			scope:recipient = {
				has_trait = forder
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = forder }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = forder
							value < "scope:recipient.has_trait_xp(forder)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_FORDER
	}
	send_option = {
		flag = flexible_leader
		is_shown = {
			scope:recipient = {
				has_trait = flexible_leader
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = flexible_leader }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = flexible_leader
							value < "scope:recipient.has_trait_xp(flexible_leader)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_FLEXIBLE_LEADER
	}
	send_option = {
		flag = desert_warrior
		is_shown = {
			scope:recipient = {
				has_trait = desert_warrior
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = desert_warrior }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = desert_warrior
							value < "scope:recipient.has_trait_xp(desert_warrior)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_DESERT_WARRIOR
	}
	send_option = {
		flag = jungle_stalker
		is_shown = {
			scope:recipient = {
				has_trait = jungle_stalker
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = jungle_stalker }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = jungle_stalker
							value < "scope:recipient.has_trait_xp(jungle_stalker)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_JUNGLE_STALKER
	}
	send_option = {
		flag = reaver
		is_shown = {
			scope:recipient = {
				has_trait = reaver
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = reaver }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = reaver
							value < "scope:recipient.has_trait_xp(reaver)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_REAVER
	}
	send_option = {
		flag = reckless
		is_shown = {
			scope:recipient = {
				has_trait = reckless
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = reckless }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = reckless
							value < "scope:recipient.has_trait_xp(reckless)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_RECKLESS
	}
	send_option = {
		flag = holy_warrior
		is_shown = {
			scope:recipient = {
				has_trait = holy_warrior
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = holy_warrior }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = holy_warrior
							value < "scope:recipient.has_trait_xp(holy_warrior)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
				faith = scope:recipient.faith
			}
		}
		localization = MENTOR_SCHEME_HOLY_WARRIOR
	}
	send_option = {
		flag = open_terrain_expert
		is_shown = {
			scope:recipient = {
				has_trait = open_terrain_expert
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = open_terrain_expert }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = open_terrain_expert
							value < "scope:recipient.has_trait_xp(open_terrain_expert)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_OPEN_TERRAIN_EXPERT
	}
	send_option = {
		flag = rough_terrain_expert
		is_shown = {
			scope:recipient = {
				has_trait = rough_terrain_expert
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = rough_terrain_expert }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = rough_terrain_expert
							value < "scope:recipient.has_trait_xp(rough_terrain_expert)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_ROUGH_TERRAIN_EXPERT
	}
	send_option = {
		flag = forest_fighter
		is_shown = {
			scope:recipient = {
				has_trait = forest_fighter
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = forest_fighter }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = forest_fighter
							value < "scope:recipient.has_trait_xp(forest_fighter)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_FOREST_FIGHTER
	}
	send_option = {
		flag = cautious_leader
		is_shown = {
			scope:recipient = {
				has_trait = cautious_leader
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = cautious_leader }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = cautious_leader
							value < "scope:recipient.has_trait_xp(cautious_leader)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_CAUTIOUS_LEADER
	}
	send_option = {
		flag = organizer
		is_shown = {
			scope:recipient = {
				has_trait = organizer
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = organizer }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = organizer
							value < "scope:recipient.has_trait_xp(organizer)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_ORGANIZER
	}
	send_option = {
		flag = winter_soldier
		is_shown = {
			scope:recipient = {
				has_trait = winter_soldier
			}
		}
		is_valid = {
			scope:secondary_recipient ?= {
				trigger_if = {
					limit = {
						NOT = { has_trait = winter_soldier }
					}
					number_of_commander_traits < 3
				}
				trigger_else = {
					custom_tooltip = {
						text = recipient_need_more_trait_xp
						has_trait_xp = {
							trait = winter_soldier
							value < "scope:recipient.has_trait_xp(winter_soldier)"
						}
					}
				}
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = scope:actor.top_liege }
			}
		}
		localization = MENTOR_SCHEME_WINTER_SOLDIER
	}

	can_send = {
		custom_tooltip = {
			text = mentoring_no_option_selected
			OR = {
				scope:merit = yes
				scope:confucian_education = yes
				scope:logistician = yes
				scope:military_engineer = yes
				scope:aggressive_attacker = yes
				scope:unyielding_defender = yes
				scope:forder = yes
				scope:flexible_leader = yes
				scope:desert_warrior = yes
				scope:jungle_stalker = yes
				scope:reaver = yes
				scope:reckless = yes
				scope:holy_warrior = yes
				scope:open_terrain_expert = yes
				scope:rough_terrain_expert = yes
				scope:forest_fighter = yes
				scope:cautious_leader = yes
				scope:organizer = yes
				scope:winter_soldier = yes
			}
		}
		trigger_if = {
			limit = {
				exists = scope:secondary_recipient
			}
			scope:secondary_recipient = {
				is_physically_able = yes
			}
		}
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = mentoring_interaction_notification

				left_icon = scope:secondary_recipient
				right_icon = scope:recipient

				scope:secondary_recipient = {
					start_scheme = {
						type = mentoring
						target_character = scope:recipient
					}
					if = {
						limit = {
							scope:merit ?= yes
							trigger_if = {
								limit = {	
									is_female = yes
								}
								top_liege ?= {	
									OR = {
										has_realm_law = male_only_law
										has_realm_law = male_preference_law
									}
								}
							}
							trigger_else = {
								top_liege ?= {	
									OR = {
										has_realm_law = female_only_law
										has_realm_law = female_preference_law
									}
								}
							}
						}
						custom_tooltip = mentoring_cannot_be_appointed_tt
					}
				}
				set_elder_relation_effect = {
					ELDER = scope:recipient
					DISCIPLE = scope:secondary_recipient
					MERIT = minor_merit_gain
				}
			}
		}

		scope:secondary_recipient = {
			if = {
				limit = {
					scope:merit = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_merit
						value = yes
					}
				}
				custom_tooltip = mentoring_merit_desc
			}
			if = {
				limit = {
					scope:confucian_education = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_confucian_education
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = confucian_education
					}
					custom_tooltip = mentoring_confucian_education_desc
				}
				else = {
					show_as_tooltip = { add_trait = confucian_education }
				}
			}
			if = {
				limit = {
					scope:logistician = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_logistician
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = logistician
					}
					custom_tooltip = mentoring_logistician_desc
				}
				else = {
					show_as_tooltip = { add_trait = logistician }
				}
			}
			if = {
				limit = {
					scope:military_engineer = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_military_engineer
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = military_engineer
					}
					custom_tooltip = mentoring_military_engineer_desc
				}
				else = {
					show_as_tooltip = { add_trait = military_engineer }
				}
			}
			if = {
				limit = {
					scope:aggressive_attacker = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_aggressive_attacker
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = aggressive_attacker
					}
					custom_tooltip = mentoring_aggressive_attacker_engineer_desc
				}
				else = {
					show_as_tooltip = { add_trait = aggressive_attacker }
				}
			}
			if = {
				limit = {
					scope:unyielding_defender = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_unyielding_defender
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = unyielding_defender
					}
					custom_tooltip = mentoring_unyielding_defender_desc
				}
				else = {
					show_as_tooltip = { add_trait = unyielding_defender }
				}
			}
			if = {
				limit = {
					scope:forder = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_forder
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = forder
					}
					custom_tooltip = mentoring_forder_desc
				}
				else = {
					show_as_tooltip = { add_trait = forder }
				}
			}
			if = {
				limit = {
					scope:flexible_leader = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_flexible_leader
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = flexible_leader
					}
					custom_tooltip = mentoring_flexible_leader_desc
				}
				else = {
					show_as_tooltip = { add_trait = flexible_leader }
				}
			}
			if = {
				limit = {
					scope:desert_warrior = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_desert_warrior
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = desert_warrior
					}
					custom_tooltip = mentoring_desert_warrior_desc
				}
				else = {
					show_as_tooltip = { add_trait = desert_warrior }
				}
			}
			if = {
				limit = {
					scope:jungle_stalker = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_jungle_stalker
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = jungle_stalker
					}
					custom_tooltip = mentoring_jungle_stalker_desc
				}
				else = {
					show_as_tooltip = { add_trait = jungle_stalker }
				}
			}
			if = {
				limit = {
					scope:reaver = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_reaver
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = reaver
					}
					custom_tooltip = mentoring_reaver_desc
				}
				else = {
					show_as_tooltip = { add_trait = reaver }
				}
			}
			if = {
				limit = {
					scope:reckless = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_reckless
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = reckless
					}
					custom_tooltip = mentoring_reckless_desc
				}
				else = {
					show_as_tooltip = { add_trait = reckless }
				}
			}
			if = {
				limit = {
					scope:holy_warrior = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_holy_warrior
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = holy_warrior
					}
					custom_tooltip = mentoring_holy_warrior_desc
				}
				else = {
					show_as_tooltip = { add_trait = holy_warrior }
				}
			}
			if = {
				limit = {
					scope:open_terrain_expert = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_open_terrain_expert
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = open_terrain_expert
					}
					custom_tooltip = mentoring_open_terrain_expert_desc
				}
				else = {
					show_as_tooltip = { add_trait = open_terrain_expert }
				}
			}
			if = {
				limit = {
					scope:rough_terrain_expert = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_rough_terrain_expert
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = rough_terrain_expert
					}
					custom_tooltip = mentoring_rough_terrain_expert_desc
				}
				else = {
					show_as_tooltip = { add_trait = rough_terrain_expert }
				}
			}
			if = {
				limit = {
					scope:forest_fighter = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_forest_fighter
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = forest_fighter
					}
					custom_tooltip = mentoring_forest_fighter_desc
				}
				else = {
					show_as_tooltip = { add_trait = forest_fighter }
				}
			}
			if = {
				limit = {
					scope:cautious_leader = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_cautious_leader
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = cautious_leader
					}
					custom_tooltip = mentoring_cautious_leader_desc
				}
				else = {
					show_as_tooltip = { add_trait = cautious_leader }
				}
			}
			if = {
				limit = {
					scope:organizer = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_organizer
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = organizer
					}
					custom_tooltip = mentoring_organizer_desc
				}
				else = {
					show_as_tooltip = { add_trait = organizer }
				}
			}
			if = {
				limit = {
					scope:winter_soldier = yes
				}
				random_scheme = {
					limit = { scheme_type = mentoring }
					set_variable = {
						name = mentoring_winter_soldier
						value = yes
					}
				}
				if = {
					limit = {
						has_trait = winter_soldier
					}
					custom_tooltip = mentoring_winter_soldier_desc
				}
				else = {
					show_as_tooltip = { add_trait = winter_soldier }
				}
			}
		}
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 36
		duchy = 36
		kingdom = 36
		empire = 36
		hegemony = 36
	}

	ai_targets = {
		ai_recipients = courtiers
		ai_recipients = vassals
		ai_recipients = peer_vassals
		max = 10
	}
	ai_targets = {
		ai_recipients = situation_participant_group
		parameter = dynastic_cycle
		max = 10
	}

	ai_potential = {
		government_has_flag = government_is_celestial
		is_adult = yes
	}

	ai_will_do = {
		base = 0
	}

	ai_accept = {
		base = -10

		# Opinion
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
		}
		opinion_modifier = {
			trigger = {
				scope:actor != scope:secondary_recipient
			}
			opinion_target = scope:secondary_recipient
			who = scope:recipient
			multiplier = 0.5
		}

		# Personality
		modifier = {
			has_trait = generous
			add = 10
			desc = INTERACTION_GENEROUS
		}
		modifier = {
			has_trait = gregarious
			add = 5
			desc = INTERACTION_GREGARIOUS
		}
		modifier = {
			has_trait = trusting
			add = 5
			desc = INTERACTION_TRUSTING
		}
		modifier = {
			has_trait = lazy
			add = -10
			desc = INTERACTION_LAZY
		}
		modifier = {
			has_trait = arbitrary
			add = -10
			desc = INTERACTION_ARBITRARY
		}
		modifier = {
			has_trait = paranoid
			add = -20
			desc = INTERACTION_PARANOID
		}

		# Other traits
		modifier = { # Scholars like to spread knowledge
			has_trait = scholar
			add = 10
			desc = TAKE_THE_VOWS_SCHOLAR
		}

		# You are in the same movement
		modifier = {
			is_in_same_movement_as = { TARGET = scope:actor }
			add = {
				value = 20
				if = {
					limit = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
					multiply = 1.5
				}
			}
			desc = actor_and_recipient_in_same_movement
		}

		# Relations to actor
		modifier = {
			has_relation_friend = scope:actor
			add = 25
			desc = AI_YOUR_FRIEND
		}
		modifier = {
			has_relation_rival = scope:actor
			add = -50
			desc = AI_YOUR_RIVAL
		}
		modifier = { # Recipient is your elder and mentors you
			has_relation_disciple = scope:actor
			scope:secondary_recipient = scope:actor
			add = 30
			desc = AI_YOUR_ELDER
		}
		modifier = { # Recipient is your elder but mentors someone else
			has_relation_disciple = scope:actor
			scope:secondary_recipient != scope:actor
			add = 15
			desc = AI_YOUR_ELDER
		}
		modifier = {
			has_relation_elder = scope:actor
			add = 10
			desc = AI_YOUR_DISCIPLE
		}

		# Higher tier rulers are less likely to accept
		modifier = {
			primary_title.tier > scope:actor.primary_title.tier
			add = {
				value = -15
				multiply = {
					add = primary_title.tier
					subtract = scope:actor.primary_title.tier
				}
			}
			desc = actor_is_of_lower_tier_desc
		}
	}
}

change_career_path_for_family_member_interaction = {
	category = interaction_category_friendly
	icon = tgp_send_to_childrens_examination_interaction
	interface_priority = 8

	desc = change_career_path_for_family_member_interaction_desc

	common_interaction = yes

	override_background = { reference = tgp_examination_room }

	is_shown = {
		has_tgp_dlc_trigger = yes
		scope:actor = {
			government_allows = merit
			is_ai = no
			dynasty ?= {
				has_dynasty_perk = tgp_chinese_legacy_2
			}
		}
		scope:recipient.dynasty = scope:actor.dynasty
		scope:actor != scope:recipient
		scope:recipient = {
			OR = {
				is_ai = yes
				is_child_of = scope:actor
				is_grandchild_of = scope:actor
				is_great_grandchild_of = scope:actor
			}
			trigger_if = {
				limit = {
					scope:actor = {
						faith = { has_doctrine = doctrine_gender_female_dominated }
					}
				}
				is_female = yes
			}
			trigger_else_if = {
				limit = {
					scope:actor = {
						faith = { has_doctrine = doctrine_gender_male_dominated }
					}
				}
				is_female = no
			}
			trigger_else = { always = yes }

			NOR = {
				has_character_flag = passed_child_exam
				has_character_modifier = tgp_child_exam_cooldown_modifier
			}
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			is_at_war = no
		}
		scope:recipient = {
			is_landed = no
			is_adult = yes
			custom_tooltip = {
				text = cant_be_another_player_tt
				is_ai = yes
			}
			custom_tooltip = {
				text = favorite_child_must_be_in_good_health_tt
				NOR = {
					has_trait = incapable
					health <= 2.5
				}
			}
			custom_tooltip = {
				text = cant_be_hostage_tt
				is_hostage = no
			}
		}
	}

	send_options_exclusive = yes
	options_heading = change_career_path_for_family_member_header
	## Civilian
	send_option = {
		#icon = "gfx/interface/icons/character_interactions/icon_dispute_border.dds"
		flag = civilian
		is_valid = {
			custom_tooltip = {
				text = they_have_a_military_career_desc
				trigger_if = {
					limit = {
						scope:recipient = { has_variable = appointment_trait_override }
					}
					scope:recipient = { var:appointment_trait_override != trait:education_stewardship_1 }
				}
				trigger_else = {
					scope:recipient = { NOT = { has_trait_with_flag = civilian_province } }
				}
			}
		}
		localization = tgp_choose_career_path_civilian_name
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = {
					trigger_if = {
						limit = {
							scope:recipient = { has_variable = appointment_trait_override }
						}
						scope:recipient = { var:appointment_trait_override != trait:education_stewardship_1 }
					}
					trigger_else = {
						scope:recipient = { NOT = { has_trait_with_flag = civilian_province } }
					}
				}
				desc = they_have_a_military_career_desc
			}
		}
	}
	## Military
	send_option = {
		#icon = "gfx/interface/icons/character_interactions/icon_dispute_border.dds"
		flag = military
		is_valid = {
			custom_tooltip = {
				text = they_have_a_civilian_career_desc
				trigger_if = {
					limit = {
						scope:recipient = { has_variable = appointment_trait_override }
					}
					scope:recipient = { var:appointment_trait_override != trait:education_martial_1 }
				}
				trigger_else = {
					scope:recipient = { NOT = { has_trait_with_flag = military_province } }
				}
			}
		}
		localization = tgp_choose_career_path_military_name
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = {
					trigger_if = {
						limit = {
							scope:recipient = { has_variable = appointment_trait_override }
						}
						scope:recipient = { var:appointment_trait_override != trait:education_martial_1 }
					}
					trigger_else = {
						scope:recipient = { NOT = { has_trait_with_flag = military_province } }
					}
				}
				desc = they_have_a_civilian_career_desc
			}
		}
	}

	cost = {
		influence = {
			value = 60
		}
	}

	on_auto_accept = {

	}

	on_accept = {
		if = {
			limit = {
				always = scope:military
			}
			scope:recipient = {
				custom_tooltip = {
					text = they_change_to_military_career_desc
					set_variable = {
						name = appointment_trait_override
						value = trait:education_martial_1
					}
				}
			}
		}
		else = {
			scope:recipient = {
				custom_tooltip = {
					text = they_change_to_civilian_career_desc
					set_variable = {
						name = appointment_trait_override
						value = trait:education_stewardship_1
					}
				}
			}
		}
	}

	auto_accept = yes

	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 0
		hegemony = 0
	}

	ai_will_do = {
		base = 0
	}
}

send_child_to_examination_interaction = {
	category = interaction_category_friendly
	icon = tgp_send_to_childrens_examination_interaction
	interface_priority = 8

	desc = send_child_to_examination_interaction_desc

	common_interaction = yes

	override_background = { reference = tgp_examination_room }

	is_shown = {
		has_tgp_dlc_trigger = yes
		scope:actor = { government_allows = merit }
		scope:recipient.dynasty = scope:actor.dynasty
		scope:actor != scope:recipient
		scope:recipient = {
			OR = {
				is_ai = yes
				is_child_of = scope:actor
				is_grandchild_of = scope:actor
				is_great_grandchild_of = scope:actor
			}
			trigger_if = {
				limit = {
					scope:actor = {
						faith = { has_doctrine = doctrine_gender_female_dominated }
					}
				}
				is_female = yes
			}
			trigger_else_if = {
				limit = {
					scope:actor = {
						faith = { has_doctrine = doctrine_gender_male_dominated }
					}
				}
				is_female = no
			}
			trigger_else = { always = yes }
			age < 16
			is_landed = no
			NOT = {
				has_character_flag = passed_child_exam
			}
		}
	}

	is_valid_showing_failures_only = {
		scope:recipient = {
			age > 5
			custom_tooltip = {
				text = cant_be_another_player_tt
				is_ai = yes
			}
			custom_tooltip = {
				text = favorite_child_must_be_in_good_health_tt
				NOR = {
					has_trait = incapable
					health <= 2.5
				}
			}
			custom_tooltip = {
				text = cant_be_hostage_tt
				is_hostage = no
			}
		}
	}

	cost = {
		influence = {
			value = minor_influence_value
		}
	}

	cooldown_against_recipient = { years = 3 }

	on_auto_accept = {

	}

	on_accept = {
		scope:recipient = {
			duel = {
				skill = learning
				value = medium_skill_rating
				40 = { # They complete the exam!
					compare_modifier = {
						value = scope:duel_value
						multiplier = 3.5
						min = -49
					}
					modifier = {
						scope:actor = { employs_court_position = court_tutor_court_position }
						add = 20
					}
					modifier = {
						house ?= { has_house_power_parameter = examination_success_bonus }
						add = 10
					}
					modifier = {
						scope:recipient = {
							learning >= 10
						}
						add = scope:recipient.learning
					}
					min = 5
					desc = send_child_to_examination_success
					scope:actor = {
						send_interface_toast = {
							type = event_toast_effect_good
							title = tgp_china_send_child_to_examination_interaction_effects_good
							left_icon = scope:actor
							right_icon = scope:recipient
							scope:recipient = {
								change_merit = {
									value = {
										add = minor_merit_value
										add = learning
									}
								}
								dynasty = {
									add_dynasty_prestige = 10
								}
							}
						}
					}
					custom_tooltip = increased_exam_chances_tt
					if = {
						limit = {
							scope:actor = {
								employs_court_position = court_tutor_court_position
							}
						}
						custom_description_no_bullet = {
							text = tutor_improved_exam_chances_tt
							object = scope:recipient
						}
					}
					else = {
						custom_description_no_bullet = {
							text = tutor_needed_for_exam_chances_tt
							object = scope:recipient
						}
					}
					add_character_flag = passed_child_exam
					create_character_memory = {
						type = passed_child_exam_memory
						participants = {
							parent_actor = scope:actor
						}
					}
				}
				60 = { # They fail
					desc = send_child_to_examination_failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -0.5
					}
					scope:actor = {
						send_interface_toast = {
							type = event_toast_effect_bad
							title = tgp_china_send_child_to_examination_interaction_effects_bad
							left_icon = scope:actor
							right_icon = scope:recipient
							scope:recipient = {
								add_stress = medium_stress_impact_gain
								add_character_modifier = {
									modifier = tgp_child_exam_cooldown_modifier
									years = 3
								}
								create_character_memory = {
									type = failed_child_exam_memory
								}
							}
						}
					}
				}
			}
		}
	}

	auto_accept = yes

	ai_frequency_by_tier = {
		barony = 0
		county = 12
		duchy = 12
		kingdom = 6
		empire = 6
		hegemony = 6
	}

	ai_targets = {
		ai_recipients = children
	}

	ai_potential = { is_adult = yes }

	ai_will_do = {
		base = 100
		modifier = {
			is_governor = yes
			add = 25
		}
		modifier = {
			has_trait = ambitious
			add = 25
		}
		modifier = {
			has_trait = content
			add = -25
		}
		#modifier = { # LotR
		#	has_religion = religion:confucianism_religion
		#	add = 25
		#}
		modifier = {
			NOT = {
				employs_court_position = court_tutor_court_position
			}
			add = -25
		}
		modifier = {
			scope:recipient = {
				OR = {
					has_trait = curious
				}
			}
			add = 10
		}
	}
}

celestial_ask_to_switch_movements_interaction = {
	icon = scroll_scales
	category = interaction_category_friendly
	send_name = celestial_ask_to_switch_movements_interaction_send_name
	desc = celestial_ask_to_switch_movements_interaction_desc
	common_interaction = yes
	greeting = positive
	notification_text = celestial_ask_to_switch_movements_interaction_flavor
	reply_item_key = celestial_ask_to_switch_movements_interaction_reply_item_key

	interface_priority = 60

	filter_tags = { dynastic_cycle }

	is_shown = {
		#scope:recipient != title:h_china.holder #LotR
		scope:recipient != scope:actor
		scope:recipient = {
			top_participant_group:dynastic_cycle ?= {
				NOT = { participant_group_type = other_rulers }
			}
		}
	}
	is_valid_showing_failures_only = {
		# The hegemon can only ask characters not in the pro dynasty movement
		trigger_if = {
			limit = {
				scope:actor = {
					top_participant_group:dynastic_cycle ?= { participant_group_type = hegemon_ruler }
				}
			}
			situation:dynastic_cycle.situation_participant_group:pro_hegemon_movement ?= {
				NOT = { participant_group_has_character = scope:recipient }
			}
		}
		situation:dynastic_cycle.situation_participant_group:undecided_movement ?= {
			NOT = { participant_group_has_character = scope:actor }
		}
		scope:actor = {
			# You are not part of the same movement
			top_participant_group:dynastic_cycle = {
				NOT = { participant_group_has_character = scope:recipient }
			}
		}
	}
	cost = {
		influence = {
			value = major_influence_value
			add = {
				value = 10
				multiply = scope:recipient.number_of_disciples
			}
		}
	}

	send_options_exclusive = no
	options_heading = invite_agent_to_scheme_interaction.t.options_header
	## Prestige
	send_option = {
		flag = prestige
		is_valid = {
			scope:actor.prestige >= prestige_bribe_value
		}
		localization = SCHEME_AGENT_PRESTIGE
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = { scope:actor.prestige >= prestige_bribe_value }
				desc = SCHEME_AGENT_PRESTIGE_VALID
			}
		}
	}
	## Gold
	send_option = {
		flag = gift
		is_valid = {
			scope:actor.gold >= bribe_value
			custom_tooltip = {
				text = offer_gold.tt.cannot_offer_both_bribes
				scope:gift_significant = no
			}
		}
		localization = SCHEME_AGENT_GOLD
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = { scope:actor.gold >= bribe_value }
				desc = SCHEME_AGENT_GOLD_VALID
			}
		}
	}
	## Even more gold
	send_option = {
		flag = gift_significant
		is_shown = {
			scope:actor = {
				is_ai = no
			}
		}
		is_valid = {
			scope:actor.gold >= greater_bribe_value
			custom_tooltip = {
				text = offer_gold.tt.cannot_offer_both_bribes
				scope:gift = no
			}
		}
		localization = SCHEME_AGENT_GOLD_SIGNIFICANT
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = { scope:actor.gold >= greater_bribe_value }
				desc = SCHEME_AGENT_GOLD_SIGNIFICANT_VALID
			}
		}
	}
	## Offer a hook
	send_option = {
		flag = offer_hook
		is_valid = {
			custom_tooltip = {
				text = offer_hook.tt.cannot_offer_both_hooks
				scope:offer_hook_strong = no
			}
			NOT = {
				scope:recipient = { has_hook = scope:actor }
			}
		}
		localization = SCHEME_AGENT_HOOK
	}
	# Offer a strong hook
	send_option = {
		flag = offer_hook_strong
		is_shown = {
			scope:actor = { has_trait_with_flag = can_offer_strong_hook_to_agents }
		}
		is_valid = {
			custom_tooltip = {
				text = offer_hook.tt.cannot_offer_both_hooks
				scope:offer_hook = no
			}
			NOT = {
				scope:recipient = { has_strong_hook = scope:actor }
			}
		}
		localization = SCHEME_AGENT_HOOK_STRONG
	}
	## Influence
	send_option = {
		flag = influence
		is_shown = {
			scope:actor.top_liege ?= scope:recipient.top_liege
			scope:actor = { government_allows = administrative }
			scope:recipient = {
				OR = {
					government_allows = administrative
					host = { government_allows = administrative }
					AND = {
						highest_held_title_tier = tier_barony
						liege = { government_allows = administrative }
					}
				}
			}
		}
		is_valid = {
			scope:actor.influence >= influence_bribe_value
		}
		localization = SCHEME_AGENT_INFLUENCE
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = { scope:actor.influence >= influence_bribe_value }
				desc = SCHEME_AGENT_INFLUENCE_VALID
			}
		}
	}
	# Cofaithists
	## Piety
	send_option = {
		flag = piety
		is_shown = {
			## recipient amenable to this argument.
			scope:recipient = {
				OR = {
					has_trait = devoted
					has_trait = zealous
					has_council_position = councillor_court_chaplain
					government_has_flag = government_is_theocracy
				}
			}
			## In-group out-group requirements.
			OR = {
				## Either we share a faith.
				scope:actor.faith = scope:recipient.faith
				## Or our faiths *really* get along.
				scope:recipient.faith = {
					faith_hostility_level = {
						target = scope:actor.faith
						value <= faith_fully_accepted_level
					}
				}
			}
		}
		is_valid = {
			scope:actor.piety >= piety_bribe_value
			NOT = {
				scope:recipient = { has_trait = cynical }
			}
		}
		localization = SCHEME_AGENT_PIETY
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = { scope:actor.piety >= piety_bribe_value }
				desc = SCHEME_AGENT_PIETY_VALID
			}
		}
	}
	# Use hook
	send_option = {
		is_valid = {
			scope:actor = {
				has_usable_hook = scope:recipient
			}
		}
		flag = hook
		localization = SCHEME_HOOK
	}
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"

	on_accept = {
		# hegemon can only ask characters to join the pro hegemon movement
		if = { #LotR
		# 	limit = {
		# 		scope:actor = title:h_china.holder
		# 	}
		# 	situation:dynastic_cycle ?= {
		# 		situation_participant_group:pro_hegemon_movement = {
		# 			save_scope_as = actors_movement
		# 		}
		# 	}
		}
		# other characters ask to join their movement
		else = {
			situation:dynastic_cycle ?= {
				random_participant_group = {
					limit = {
						participant_group_has_character = scope:actor
					}
					save_scope_as = actors_movement
				}
			}
		}
		#reset previous variable
		scope:recipient = {
			remove_variable = movement_member
		}
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_good
				title = celestial_ask_to_switch_movements_interaction_accept_tt
				left_icon = scope:recipient
				scope:actors_movement = {
					switch = {
						trigger = participant_group_type
						pro_hegemon_movement = {
							scope:recipient = {
								custom_tooltip = celestial_switch_movement_to_pro_hegemon_tt
								custom_tooltip = adds_movement_power_tt
								every_relation = {
									type = disciple
									custom = every_disciple_joins_movement
									custom_tooltip = celestial_switch_movement_to_pro_hegemon_tt
									custom_tooltip = every_disciple_adds_movement_power_tt
									if = {
										limit = {
											is_ai = yes
										}
										set_variable = {
											name = movement_member
											value = flag:pro_hegemon
										}
										set_variable = {
											name = persuaded_to_join_movement
											value = yes 
										}
									}
									else = {
										send_interface_message = {
											type = send_interface_message
											title = celestial_ask_to_switch_movements_interaction_accept_tt
											left_icon = scope:recipient
											custom_tooltip = celestial_switch_movement_to_pro_hegemon_tt
										}
									}
								}
								set_variable = {
									name = movement_member
									value = flag:pro_hegemon
								}
								set_variable = {
									name = persuaded_to_join_movement
									value = yes 
								}
							}
						}
						expansion_movement = {
							scope:recipient = {
								custom_tooltip = celestial_switch_movement_to_expansion_tt
								custom_tooltip = adds_movement_power_tt
								every_relation = {
									type = disciple
									custom = every_disciple_joins_movement
									custom_tooltip = celestial_switch_movement_to_expansion_tt
									custom_tooltip = every_disciple_adds_movement_power_tt
									if = {
										limit = {
											is_ai = yes
										}
										set_variable = {
											name = movement_member
											value = flag:expansion
										}
										set_variable = {
											name = persuaded_to_join_movement
											value = yes 
										}
									}
									else = {
										send_interface_message = {
											type = send_interface_message
											title = celestial_ask_to_switch_movements_interaction_accept_tt
											left_icon = scope:recipient
											custom_tooltip = celestial_switch_movement_to_expansion_tt
										}
									}
								}
								set_variable = {
									name = movement_member
									value = flag:expansion
								}
								set_variable = {
									name = persuaded_to_join_movement
									value = yes 
								}
							}
						}
						advancement_movement = {
							scope:recipient = {
								custom_tooltip = celestial_switch_movement_to_advancement_tt
								custom_tooltip = adds_movement_power_tt
								every_relation = {
									type = disciple
									custom = every_disciple_joins_movement
									custom_tooltip = celestial_switch_movement_to_advancement_tt
									custom_tooltip = every_disciple_adds_movement_power_tt
									if = {
										limit = {
											is_ai = yes
										}
										set_variable = {
											name = movement_member
											value = flag:advancement
										}
										set_variable = {
											name = persuaded_to_join_movement
											value = yes 
										}
									}
									else = {
										send_interface_message = {
											type = send_interface_message
											title = celestial_ask_to_switch_movements_interaction_accept_tt
											left_icon = scope:recipient
											custom_tooltip = celestial_switch_movement_to_advancement_tt
										}
									}
								}
								set_variable = {
									name = movement_member
									value = flag:advancement
								}
								set_variable = {
									name = persuaded_to_join_movement
									value = yes 
								}
							}
						}
						conservative_movement = {
							scope:recipient = {
								custom_tooltip = celestial_switch_movement_to_conservative_tt
								custom_tooltip = adds_movement_power_tt
								every_relation = {
									type = disciple
									custom = every_disciple_joins_movement
									custom_tooltip = celestial_switch_movement_to_conservative_tt
									custom_tooltip = every_disciple_adds_movement_power_tt
									if = {
										limit = {
											is_ai = yes
										}
										set_variable = {
											name = movement_member
											value = flag:conservative
										}
										set_variable = {
											name = persuaded_to_join_movement
											value = yes 
										}
									}
									else = {
										send_interface_message = {
											type = send_interface_message
											title = celestial_ask_to_switch_movements_interaction_accept_tt
											left_icon = scope:recipient
											custom_tooltip = celestial_switch_movement_to_conservative_tt
										}
									}
								}
								set_variable = {
									name = movement_member
									value = flag:conservative
								}
								set_variable = {
									name = persuaded_to_join_movement
									value = yes 
								}
							}
						}
					}
				}
				# You gain merit
				change_merit = {
					value = miniscule_merit_gain
					add = scope:recipient.number_of_disciples
				}
				# Bribe
				if = {
					limit = { always = scope:gift }
					pay_short_term_gold = {
						gold = bribe_value
						target = scope:recipient
					}
					stress_impact = { greedy = minor_stress_impact_gain }
				}
				# Big Bribe
				if = {
					limit = { always = scope:gift_significant }
					pay_short_term_gold = {
						gold = greater_bribe_value
						target = scope:recipient
					}
					stress_impact = { greedy = medium_stress_impact_gain }
				}
				# Offer Hook
				if = {
					limit = { always = scope:offer_hook }
					stress_impact = {
						base = minor_stress_impact_gain
						paranoid = major_stress_impact_gain
					}
					scope:recipient = {
						add_hook = {
							type = favor_hook
							target = scope:actor
						}
					}
				}
				# Offer Strong Hook
				if = {
					limit = { always = scope:offer_hook_strong }
					stress_impact = { base = major_stress_impact_gain }
					scope:recipient = {
						add_hook = {
							type = strong_favor_hook
							target = scope:actor
						}
					}
				}
				# Use Hook
				if = {
					limit = { always = scope:hook }
					use_hook = scope:recipient
				}
				# Prestige
				if = {
					limit = { always = scope:prestige }
					add_prestige = {
						value = prestige_bribe_value
						multiply = -1
					}
					scope:recipient = { add_prestige = prestige_bribe_value }
				}
				# Piety
				if = {
					limit = { always = scope:piety }
					add_prestige = {
						value = piety_bribe_value
						multiply = -1
					}
					scope:recipient = { add_piety = piety_bribe_value }
				}
				# Influence
				if = {
					limit = { always = scope:influence }
					change_influence = {
						value = influence_bribe_value
						multiply = -1
					}
					scope:recipient = { change_influence = influence_bribe_value }
				}
				# Set elder relation
				set_elder_relation_effect = {
					ELDER = scope:actor
					DISCIPLE = scope:recipient
					MERIT = minor_merit_gain
				}
				if = {
					limit = {
						exists = scope:recipient.var:movement_power
						scope:recipient.var:movement_power >= high_movement_power_value
					}
					switch = {
						trigger = top_participant_group:dynastic_cycle
						# situation:dynastic_cycle.situation_participant_group:advancement_movement = { #LotR
						# 	tgp_activate_catalyst_against_hegemon_effect = {
						# 		HEGEMON = scope:actor.top_liege
						# 		CATALYST = catalyst_movement_gained_power_advancement
						# 	}
						# }
						# situation:dynastic_cycle.situation_participant_group:expansion_movement = {
						# 	tgp_activate_catalyst_against_hegemon_effect = {
						# 		HEGEMON = scope:actor.top_liege
						# 		CATALYST = catalyst_movement_gained_power_expansion
						# 	}
						# }
						# situation:dynastic_cycle.situation_participant_group:conservative_movement = {
						# 	tgp_activate_catalyst_against_hegemon_effect = {
						# 		HEGEMON = scope:actor.top_liege
						# 		CATALYST = catalyst_movement_gained_power_conservative
						# 	}
						# }
						situation:dynastic_cycle.situation_participant_group:pro_hegemon_movement = {
							situation:dynastic_cycle ?= {
								if = {
									limit = {
										OR = {
											situation_current_phase = situation_dynastic_cycle_phase_stability_advancement
											situation_current_phase = situation_dynastic_cycle_phase_stability_expansion
										}
										situation_top_sub_region = {
											phase_takeover_points:situation_dynastic_cycle_phase_instability >= 0
										}
									}
									# scope:actor = { #LotR
									# 	tgp_activate_catalyst_against_hegemon_effect = {
									# 		HEGEMON = scope:actor.top_liege
									# 		CATALYST = catalyst_movement_gained_power_pro_hegemon
									# 	}
									# }
								}
								else_if = {
									limit = {
										OR = {
											situation_current_phase = situation_dynastic_cycle_phase_instability_conquest
											situation_current_phase = situation_dynastic_cycle_phase_instability
										}
										situation_top_sub_region = {
											phase_takeover_points:situation_dynastic_cycle_phase_chaos >= 0
										}
									}
									# scope:actor = { #LotR
									# 	tgp_activate_catalyst_against_hegemon_effect = {
									# 		HEGEMON = scope:actor.top_liege
									# 		CATALYST = catalyst_movement_gained_power_pro_hegemon
									# 	}
									# }
								}
							}
						}
					}
				}
			}
		}
		scope:recipient = {
			hidden_effect = {
				recalculate_participant_group = situation:dynastic_cycle
				every_relation = {
					type = disciple
					recalculate_participant_group = situation:dynastic_cycle
				}
			}
		}
	}
	on_decline = {
		scope:recipient = {
			add_opinion = {
				modifier = refused_faction_switch_modifier
				target = scope:actor
				years = 5
			}
		}
		scope:recipient = {
			if = {
				limit = {
					has_relation_elder = scope:actor
				}
				change_influence = {
					value = influence_bribe_value
					multiply = -0.5
				}
			}
		}
	}
	# AI
	ai_targets = {
		ai_recipients = vassals
		ai_recipients = peer_vassals
		max = 25
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 48
		duchy = 36
		kingdom = 36
		empire = 12
		hegemony = 12
	}

	is_available = {
		#exists = title:h_china.holder #LotR
		any_character_situation = {
			situation_type = dynastic_cycle
		}
		situation:dynastic_cycle ?= {
			situation_participant_group:other_rulers = {
				NOT = {
					participant_group_has_character = root
				}
			}
		}
		top_participant_group:dynastic_cycle ?= {
			NOT = { participant_group_type = undecided_movement }
		}
	}

	ai_will_do = {
		base = -5
		# leader of a Movement
		modifier = {
			situation:dynastic_cycle ?= {
				any_participant_group = {
					var:movement_leader ?= scope:actor
				}
			}
			add = 10
		}
		modifier = {
			scope:actor.house ?= {
				is_dominant_family = yes
			}
			add = 10
		}
		modifier = {
			scope:actor.house ?= {
				is_powerful_family = yes
			}
			add = 5
		}
		modifier = {
			scope:actor = {
				is_powerful_vassal = yes
			}
			add = 5
		}
		## Send Options
		# gold is always good
		modifier = {
			scope:gift = yes
			add = 5
		}
		modifier = {
			scope:prestige = yes
			scope:actor.prestige >= prestige_bribe_value
			add = 5
		}
		modifier = {
			scope:influence = yes
			scope:actor.influence >= influence_bribe_value
			add = 5
		}
		modifier = {
			scope:piety = yes
			scope:actor.piety >= piety_bribe_value
			add = 5
		}
	}
	ai_accept = {
		base = -30
		# Opinion
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
		}
		# is my disciple
		modifier = {
			scope:actor = {
				has_relation_disciple = scope:recipient
			}
			desc = is_actors_disciple
			add = 500
		}
		# is a movement leader
		modifier = {
			situation:dynastic_cycle ?= {
				any_participant_group = {
					var:movement_leader ?= scope:recipient
				}
			}
			desc = fellow_movement_leader
			add = -50
		}
		# Already convinced once to be a member of recipient's current movement
		modifier = {
			add = -50
			scope:recipient = { has_variable = persuaded_to_join_movement }
			desc = already_movement_member
		}
		modifier = { # Difference in merit level
			scope:actor.merit_level != scope:recipient.merit_level
			# title:h_china.holder ?= { #LotR
			# 	this != scope:actor
			# }
			add = {
				add = {
					add = 10
					multiply = scope:actor.merit_level
				}
				subtract = {
					add = 10
					multiply = scope:recipient.merit_level
				}
			}
			desc = difference_in_merit_level_reason
		}
		# house power difference
		modifier = { # If you are from a powerful family, and they are not, they are more likely to accept
			scope:actor.house ?= {
				is_powerful_family = yes
			}
			scope:recipient.house ?= {
				is_powerful_family = no
				is_dominant_family = no
			}
			add = 15
			desc = your_house_is_powerful_reason
		}
		modifier = { # If you are from a dominant family, and they are not, they are more likely to accept
			scope:actor.house ?= {
				is_dominant_family = yes
			}
			scope:recipient.house ?= {
				is_dominant_family = no
			}
			add = 25
			desc = your_house_is_dominant_reason
		}
		modifier = { # If they are from a powerful family, and you are not, they are more likely to refuse
			scope:recipient.house ?= {
				is_powerful_family = yes
			}
			scope:actor.house ?= {
				is_powerful_family = no
				is_dominant_family = no
			}
			add = -15
			desc = their_house_is_powerful_reason
		}
		modifier = { # If they are from a dominant family, and you are not, they are more likely to refuse
			scope:recipient.house ?= {
				is_dominant_family = yes
			}
			scope:actor.house ?= {
				is_dominant_family = no
			}
			add = -25
			desc = their_house_is_dominant_reason
		}
		modifier = { # Difference in influence level
			scope:actor.influence_level != scope:recipient.influence_level
			add = {
				add = {
					add = 5
					multiply = scope:actor.influence_level
				}
				subtract = {
					add = 5
					multiply = scope:recipient.influence_level
				}
			}
			desc = difference_in_influence_level_reason
		}
		modifier = {
			scope:recipient = {
				is_powerful_vassal = yes
			}
			scope:actor = {
				is_powerful_vassal = no
			}
			add = -10
			desc = RECIPIENT_POWERFUL_VASSAL
		}
		modifier = {
			scope:actor = {
				is_powerful_vassal = yes
			}
			scope:recipient = {
				is_powerful_vassal = no
			}
			add = 5
			desc = AI_POWERFUL_VASSAL
		}
		# Difficulty
		## Easy
		modifier = {
			add = 10
			is_ai = yes
			scope:recipient = { is_ai = no }
			has_game_rule = easy_difficulty
			desc = "easy_difficulty"
		}
		## Very Easy
		modifier = {
			add = 20
			is_ai = yes
			scope:recipient = { is_ai = no }
			has_game_rule = very_easy_difficulty
			desc = "very_easy_difficulty"
		}
		# Relations
		## Rivals with scope:recipient
		modifier = {
			add = -20
			has_relation_rival = scope:recipient
			NOT = { has_relation_nemesis = scope:recipient }
			desc = "SCHEME_AGAINST_RIVAL"
		}
		## Nemeses should be even less inclined
		modifier = {
			add = -1000
			has_relation_nemesis = scope:recipient
			desc = SCHEME_AGAINST_NEMESIS
		}
		## Friends with scope:recipient
		modifier = {
			add = 10
			has_relation_friend = scope:recipient
			NOT = { has_relation_best_friend = scope:recipient }
			desc = "SCHEME_AGAINST_FRIEND"
		}
		## Best friends should be even more inclined
		modifier = {
			add = 1000
			has_relation_best_friend = scope:recipient
			desc = SCHEME_AGAINST_BEST_FRIEND
		}
		## As should soulmates
		modifier = {
			add = 1000
			has_relation_soulmate = scope:recipient
			desc = SCHEME_AGAINST_SOULMATE
		}
		## Loving (or at least non-hostile) spouse of scope:recipient
		modifier = {
			add = 10
			is_consort_of = scope:recipient
			opinion = {
				target = scope:recipient
				value > 0
			}
			desc = "SCHEME_AGAINST_SPOUSE"
		}
		## actor is grand secretary director
		modifier = {
			add = 10
			scope:actor.liege ?= {
				has_active_mandate = placate_movements
			}
			desc = placate_movements_bonus
		}
		## Dynasty Legacy
		modifier = {
			scope:actor = {
				dynasty ?= {
					has_dynasty_perk = tgp_chinese_legacy_4
				}
			}
			add = dynasty_legacy_invite_to_movement_value
			desc = tgp_dynasty_legacy_movement_accept
		}
		## Pavilion estate building
		modifier = {
			add = {
				value = 0
				scope:actor = {
					domicile ?= {
						if = {
							limit = { has_domicile_parameter = celestial_invite_to_movement_acceptance_1 }
							add = estate_invite_to_movement_acceptance_1_value
						}
						else_if = {
							limit = { has_domicile_parameter = celestial_invite_to_movement_acceptance_2 }
							add = estate_invite_to_movement_acceptance_2_value
						}
						else_if = {
							limit = { has_domicile_parameter = celestial_invite_to_movement_acceptance_3 }
							add = estate_invite_to_movement_acceptance_3_value
						}
						else_if = {
							limit = { has_domicile_parameter = celestial_invite_to_movement_acceptance_4 }
							add = estate_invite_to_movement_acceptance_4_value
						}
					}
				}
			}
			scope:actor = {
				domicile ?= {
					OR = {
						has_domicile_parameter = celestial_invite_to_movement_acceptance_1
						has_domicile_parameter = celestial_invite_to_movement_acceptance_2
						has_domicile_parameter = celestial_invite_to_movement_acceptance_3
						has_domicile_parameter = celestial_invite_to_movement_acceptance_4
					}
				}
			}
			desc = estate_buildings_with_value_desc
		}
		# Coercion.
		## Sent a gift.
		modifier = {
			add = {
				value = 10
				scope:recipient = {
					# A bit more for greedy chars.
					if = {
						limit = { has_trait = greedy }
						add = 10
					}
				}
			}
			scope:gift ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_GIFT
		}
		## Send a bigger gift.
		modifier = {
			add = {
				value = 20
				scope:recipient = {
					# A bit more for greedy chars.
					if = {
						limit = { has_trait = greedy }
						add = 10
					}
				}
			}
			scope:gift_significant ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_GIFT_SIGNIFICANT
		}
		## Offer a hook on yourself.
		modifier = {
			add = 20
			scope:offer_hook ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_OFFER_HOOK
		}
		## Offer a strong hook on yourself.
		modifier = {
			add = 50
			scope:offer_hook_strong ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_OFFER_HOOK_STRONG
		}
		## Used a hook.
		modifier = {
			add = 100
			scope:hook ?= yes
			desc = SCHEME_WEAK_HOOK_USED
		}
		## Offer prestige.
		modifier = {
			add = {
				value = 20
				scope:recipient = {
					# A bit more for arrogant chars.
					if = {
						limit = { has_trait = arrogant }
						add = 10
					}
					# A bit less for humble ones.
					if = {
						limit = { has_trait = humble }
						add = -10
					}
				}
			}
			scope:prestige ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_PRESTIGE
		}
		## Offer influence.
		modifier = {
			add = {
				value = 20
				scope:recipient = {
					# A bit more for ambitious chars.
					if = {
						limit = { has_trait = ambitious }
						add = 10
					}
					# A bit less for content ones.
					if = {
						limit = { has_trait = content }
						add = -10
					}
				}
			}
			scope:influence ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_INFLUENCE
		}
		## Offer piety.
		modifier = {
			add = {
				value = 20
				scope:recipient = {
					# A bit more if they're zealous.
					if = {
						limit = { has_trait = zealous }
						add = 10
					}
				}
			}
			scope:piety ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_PIETY
		}
	}
}

transfer_small_gold_amount_to_treasury_interaction = {
	common_interaction = yes
	category = interaction_category_friendly
	desc = transfer_gold_amount_to_treasury_interaction_desc
	icon = treasury
	hidden = yes

	ai_targets = {
		ai_recipients = self
	}

	is_shown = {
		scope:recipient = scope:actor
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			has_treasury = yes
			gold > 10
		}
	}

	on_accept = {
		scope:actor = {
			remove_short_term_gold = 10
		}
		scope:recipient = {
			add_treasury = 10
		}
		scope:actor = {
			if = {
				limit = {
					has_trait = greedy
				}
				custom_description_no_bullet = {
					text = transfer_treasury_because_you_are_greedy
				}
				add_stress = 1
			}
			if = {
				limit = {
					has_trait = generous
				}
				custom_description_no_bullet = {
					text = transfer_treasury_because_you_are_generous
				}
				add_stress = -1
			}
		}
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 1
		duchy = 1
		kingdom = 1
		empire = 1
		hegemony = 1
	}
	ai_potential = {
		has_treasury = yes
		gold > medium_gold_value
	}

	ai_will_do = {
		base = 0
		modifier = {
			add = 100
			scope:actor = {
				NOT = { has_trait = greedy }
				treasury < major_gold_value
			}
		}
		modifier = {
			add = 100
			scope:actor = {
				treasury < 0
			}
		}
	}
}

transfer_large_gold_amount_to_treasury_interaction = {
	common_interaction = yes
	category = interaction_category_friendly
	desc = transfer_gold_amount_to_treasury_interaction_desc
	icon = treasury
	hidden = yes

	ai_targets = {
		ai_recipients = self
	}

	is_shown = {
		scope:recipient = scope:actor
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			has_treasury = yes
			gold > 50
		}
	}

	on_accept = {
		scope:actor = {
			remove_short_term_gold = 50
		}
		scope:recipient = {
			add_treasury = 50
		}
		scope:actor = {
			if = {
				limit = {
					has_trait = greedy
				}
				custom_description_no_bullet = {
					text = transfer_treasury_because_you_are_greedy
				}
				add_stress = 1
			}
			if = {
				limit = {
					has_trait = generous
				}
				custom_description_no_bullet = {
					text = transfer_treasury_because_you_are_generous
				}
				add_stress = -1
			}
		}
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 1
		duchy = 1
		kingdom = 1
		empire = 1
		hegemony = 1
	}
	ai_potential = {
		has_treasury = yes
		gold > major_gold_value
	}

	ai_will_do = {
		base = 0
		modifier = {
			add = 100
			scope:actor = {
				NOT = { has_trait = greedy }
				treasury < major_gold_value
			}
		}
		modifier = {
			add = 100
			scope:actor = {
				treasury < 0
			}
		}
	}
}

# Influence Career
# Influence the career of a target character's career - Unlike influence_candidacy_interaction, this increases the general score for a character
influence_meritorious_career_interaction = {
	icon = support_candidacy
	category = interaction_category_succession
	common_interaction = yes
	interface_priority = 100

	desc = influence_meritorious_career_interaction_desc

	is_shown = {
		scope:actor = {
			government_allows = administrative
			government_has_flag = government_has_merit
		}
		scope:recipient = {
			OR = {
				AND = {
					government_allows = administrative
					government_has_flag = government_has_merit
				}
				is_ruler = no
			}
			top_liege = scope:actor.top_liege
			this != top_liege
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			influence >= 0
			OR = {
				is_landed_or_landless_administrative = yes
				OR = {
					has_title = title:e_minister_chancellor
					has_title = title:e_minister_censor
					has_title = title:e_minister_grand_marshal
					has_title = title:e_minister_of_personnel
					has_title = title:e_minister_of_revenue
					has_title = title:e_minister_of_rites
					has_title = title:e_minister_of_war
					has_title = title:e_minister_of_justice
					has_title = title:e_minister_of_works
				}
			}
			is_adult = yes
		}
		scope:recipient = {
			is_adult = yes
			trigger_if = {
				limit = {	
					is_female = yes
				}
				custom_tooltip = {
					text = recipient_cannot_be_appointed_gender_laws_tt
					top_liege ?= {	
						NOR = {
							has_realm_law = male_only_law
							has_realm_law = male_preference_law
						}
					}
				}
			}
			trigger_else = {
				custom_tooltip = {
					text = recipient_cannot_be_appointed_gender_laws_tt
					top_liege ?= {	
						NOR = {
							has_realm_law = female_only_law
							has_realm_law = female_preference_law
						}
					}
				}
			}
		}			
	}

	can_send = {
	}

	# There's no real reason for the AI to refuse
	auto_accept = yes

	send_option = {
		flag = major_influence_option
		localization = "major_influence_option_desc"
		starts_enabled = {
			scope:actor = { influence >= career_score_major_cost_value }
		}
	}
	send_option = {
		flag = medium_influence_option
		localization = "medium_influence_option_desc"
		starts_enabled = {
			scope:actor = {
				influence < career_score_major_cost_value
				influence >= career_score_medium_cost_value
			}
		}
	}
	send_option = {
		flag = minor_influence_option
		localization = "minor_influence_option_desc"
		starts_enabled = {
			scope:actor = { influence < career_score_medium_cost_value }
		}
	}

	localization_values = {
		MAJOR_INFLUENCE_OPTION = scope:actor.career_score_major_total_value
		MEDIUM_INFLUENCE_OPTION = scope:actor.career_score_medium_total_value
		MINOR_INFLUENCE_OPTION = scope:actor.career_score_minor_total_value
	}

	cost = {
		influence = {
			# Base cost
			switch = {
				trigger = yes
				scope:major_influence_option = {
					add = {
						value = career_score_major_cost_value
						desc = BASE
					}
				}
				scope:medium_influence_option = {
					add = {
						value = career_score_medium_cost_value
						desc = BASE
					}
				}
				scope:minor_influence_option = {
					add = {
						value = career_score_minor_cost_value
						desc = BASE
					}
				}
			}

			save_temporary_value_as = calculated_base_cost

			# Movement leaders have a small reduction bonus
			if = {
				limit = {
					scope:actor = { is_any_movement_leader = yes }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.1
					desc = you_are_a_movement_leader_desc
				}
			}

			# Ministers
			if = {
				limit = {
					scope:actor = { has_title = title:e_minister_chancellor }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.2
					desc = you_are_the_grand_chancellor_desc
				}
			}
			if = {
				limit = {
					scope:actor = { has_title = title:e_minister_of_personnel }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.1
					desc = you_are_the_minister_of_personnel_desc
				}
			}

			# A dominant family gets to spend less influence
			if = {
				limit = {
					scope:actor.house ?= { is_dominant_family = yes }
				}
				add = {
					value = scope:calculated_base_cost
					multiply = -0.2
					desc = "[dominant_family|E]"
				}
			}
			
			# House Aspiration
			if = {
				limit = {
					scope:actor.house ?= {
						OR = {
							has_house_power_parameter = influence_career_bonus_1
							has_house_power_parameter = influence_career_bonus_2
						}
					}
					#scope:recipient.house ?= scope:actor.house
				}
				add = {
					value = scope:calculated_base_cost
					multiply = {
						scope:actor.house = {
							if = {
								limit = { has_house_power_parameter = influence_career_bonus_2 }
								add = influence_career_bonus_2_value
							}
							else_if = {
								limit = { has_house_power_parameter = influence_career_bonus_1 }
								add = influence_career_bonus_1_value
							}
						}
					}
					desc = celestial_traditional_name_desc
				}
			}

			# Dynasty Legacy
			if = {
				limit = {
					scope:actor = {
						dynasty ?= {
							has_dynasty_perk = tgp_chinese_legacy_5
						}
					}
				}
				add = {
					value = scope:calculated_base_cost
					multiply = dynasty_legacy_influence_career_discount_value
					desc = court_position_tgp_dynasty_legacy
				}
			}
		}
	}

	on_accept = {
		switch = {
			trigger = yes
			scope:major_influence_option = {
				save_scope_value_as = {
					name = increased_career_score
					value = {
						value = career_score_major_base_value
						multiply = scope:actor.career_score_actor_multiplier_value
					}
				}
				save_scope_value_as = {
					name = opinion_change_value
					value = 15
				}
			}
			scope:medium_influence_option = {
				# Save the score value
				save_scope_value_as = {
					name = increased_career_score
					value = {
						value = career_score_medium_base_value
						multiply = scope:actor.career_score_actor_multiplier_value
					}
				}
				save_scope_value_as = {
					name = opinion_change_value
					value = 10
				}
			}
			scope:minor_influence_option = {
				# Save the score value
				save_scope_value_as = {
					name = increased_career_score
					value = {
						value = career_score_minor_base_value
						multiply = scope:actor.career_score_actor_multiplier_value
					}
				}
				save_scope_value_as = {
					name = opinion_change_value
					value = 5
				}
			}
		}

		# Update the score for the target character
		scope:recipient = {
			hidden_effect = {
				if = {
					limit = {
						is_military_candidate_trigger = yes
					}
					if = {
						limit = {
							has_variable = merit_military_career_score_bonus
						}
						change_variable = {
							name = merit_military_career_score_bonus
							add = scope:increased_career_score
						}
					}
					else = {
						set_variable = {
							name = merit_military_career_score_bonus
							value = scope:increased_career_score
						}
					}
				}
				else = {
					if = {
						limit = {
							has_variable = merit_civilian_career_score_bonus
						}
						change_variable = {
							name = merit_civilian_career_score_bonus
							add = scope:increased_career_score
						}
					}
					else = {
						set_variable = {
							name = merit_civilian_career_score_bonus
							value = scope:increased_career_score
						}
					}
				}
			}
			# Display the relevant information
			if = {
				limit = {
					is_military_candidate_trigger = yes
				}
				custom_tooltip = influence_meritorious_career_effect_military_desc
			}
			else = {
				custom_tooltip = influence_meritorious_career_effect_civilian_desc
			}
			custom_tooltip = influence_meritorious_career_effect_warning_desc
		}
	}

	ai_targets = {
		ai_recipients = self
		ai_recipients = liege
	}
	ai_targets = {
		ai_recipients = family
		max = 10
	}
	ai_targets = {
		ai_recipients = peer_vassals
		max = 10
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 42
		duchy = 30
		kingdom = 18
		empire = 12
		hegemony = 6
	}

	ai_potential = {
		government_allows = merit
		influence >= monumental_influence_value # Only consider doing this if you have the influence to spare
		OR = {
			is_landed_or_landless_administrative = yes
			highest_held_title_tier >= tier_empire
		}
	}

	ai_will_do = {
		base = -10

		# Opinion
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = 0.5
			trigger = { scope:actor != scope:recipient }
		}

		# Family relations
		modifier = {
			add = 25
			exists = scope:recipient.house
			house ?= scope:recipient.house
		}
		modifier = {
			add = 20
			is_close_family_of = scope:recipient
		}

		# Other relations
		modifier = {
			add = 20
			has_relation_disciple = scope:recipient
		}
		modifier = {
			add = 20
			OR = {
				has_relation_friend = scope:recipient
				has_relation_lover = scope:recipient
			}
		}
		modifier = {
			add = 10
			is_in_same_movement_as = { TARGET = scope:recipient }
		}

		# Less useful if recipient is a governor already already
		modifier = {
			add = -50
			scope:recipient = { is_governor = yes }
		}

		# Don't do it at all towards empire tier characters - they cannot get a higher position anyway
		modifier = {
			factor = 0
			scope:recipient = { highest_held_title_tier >= tier_empire }
		}
	}
}

# Minister requests
# Request Military Aid
celestial_request_military_aid_interaction = {
	icon = icon_soldier_survivor
	interface_priority = 60
	category = interaction_category_vassal
	common_interaction = no
	desc = celestial_request_military_aid_interaction_desc
	filter_tags = { celestial_ministry }

	#ai_maybe = yes
	#ai_min_reply_days = 4
	#ai_max_reply_days = 9
	popup_on_receive = yes
	pause_on_receive = yes

	cooldown = { days = 30 }

	greeting = positive
	notification_text = celestial_request_military_aid_interaction_msg

	pre_answer_yes_key = ACCEPT
	pre_answer_no_key = DECLINE

	# Let's save our top liege's marshal, or if there is none, we default to the top liege
	# This is the person we send our request to
	redirect = {
		scope:recipient = {
			if = {
				limit = {
					this = scope:actor.top_liege
				}
				if = {
					limit = {
						tgp_has_access_to_ministry_trigger = yes
						exists = title:e_minister_of_war.holder
						title:e_minister_of_war.holder.top_liege = scope:actor.top_liege
					}
					title:e_minister_of_war.holder = { save_scope_as = recipient }
				}
				else = {
					save_scope_as = recipient
				}
			}
		}
	}

	cost = {
	}

	is_shown = {
		scope:actor = {
			government_allows = administrative
			government_allows = merit
			top_liege != this
			OR = {
				is_governor = yes
				has_title = title:e_minister_grand_marshal
			}
		}
		scope:recipient = {
			OR = {
				this = scope:actor.top_liege
				AND = {
					has_title = title:e_minister_of_war
					liege = {
						tgp_has_access_to_ministry_trigger = yes
						this = scope:actor.top_liege
					}
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		custom_tooltip = {
			text = celestial_request_military_aid_no_military_governors_desc
			scope:recipient.top_liege = {
				any_vassal_or_below = {
					OR = {
						vassal_contract_has_flag = celestial_military_appointment
						vassal_contract_has_flag = meritocratic_military_appointment
					}
				}
			}
		}

		custom_tooltip = {
			text = celestial_request_military_aid_no_available_military_governors_desc
			scope:recipient.top_liege = {
				any_vassal_or_below = {
					tgp_celestial_military_governor_can_join_war_trigger = {
						TARGET_GOVERNOR = scope:actor
						MINISTER_OF_WAR = scope:recipient
					}
				}
			}
		}

		scope:actor = {
			is_at_war = yes # Has to be at war
			is_at_war_with_liege = no # But not with liege - No troops if YOU are the one doing the uprising
			NOR = {
				is_at_war_with = scope:recipient # Not at war with recipient
				# You are not at war with anyone within the realm (this to prevent weird cases of asking for troops in any internal wars)
				custom_tooltip = {
					text = petition_liege_vassal_war_tt
					any_war_enemy = {
						top_liege = scope:actor.top_liege
					}
				}
			}
			# You have to be the war leader
			trigger_if = {
				limit = { is_at_war = yes }
				custom_description = {
					text = target_is_not_war_leader
					object = scope:actor
					any_character_war = {
						scope:actor = { is_leader_in_war = prev }
					}
				}
			}
		}

		trigger_if = {
			limit = {
				scope:actor = { is_ai = yes }
			}
			NOT = {
				scope:recipient = { has_variable = celestial_request_military_aid_cooldown }
			}
		}
	}

	can_send = {
	}

	on_send = {
	}

	# Hook
	send_option = {
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
			NOT = {
				scope:recipient = { has_hook = scope:actor }
			}
		}
		flag = hook
		localization = GENERIC_SPEND_A_HOOK
	}
	# Dominant Family
	send_option = {
		is_shown = {
			scope:actor = {
				house ?= { is_dominant_family = yes }
			}
		}
		flag = dominant_family
		localization = OPTION_DOMINANT_FAMILY
	}
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"
	send_options_exclusive = no

	auto_accept = yes

	on_accept = {
		if = {
			limit = {
				scope:hook = yes
				scope:actor = { has_usable_hook = scope:recipient }
			}
			scope:actor = { use_hook = scope:recipient }
		}
		scope:actor = {
			if = {
				limit = {
					is_ai = yes
				}
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = grateful_opinion
					opinion = 10
				}
				# Set up AI cooldown to prevent spam
				if = {
					limit = {
						NOT = { has_variable = celestial_request_military_aid_cooldown }
					}
					set_variable = {
						name = celestial_request_military_aid_cooldown
						years = 1
					}
				}
			}
			# If you have a hook or is a dominant family, you can request aid for free
			if = {
				limit = {
					NOR = {
						scope:hook = yes
						scope:dominant_family = yes
					}
				}
				pay_short_term_treasury = {
					target = scope:recipient
					treasury = 50
				}
			}
			# Trigger catalyst if applicable
			# tgp_activate_catalyst_against_hegemon_effect = { #LotR
			# 	HEGEMON = scope:recipient
			# 	CATALYST = catalyst_hegemon_influenced_by_interaction
			# }
		}

		# Time to find a military governor to join the war. First, save everyone to a list.
		scope:recipient.top_liege = {
			every_vassal = {
				limit = {
					tgp_celestial_military_governor_can_join_war_trigger = {
						TARGET_GOVERNOR = scope:actor
						MINISTER_OF_WAR = scope:recipient
					}
				}
				add_to_list = military_governors
			}
		}

		# Figure out what military strength we'll need
		scope:actor = {
			every_character_war = {
				limit = {
					scope:actor = { is_leader_in_war = prev }
				}
				add_to_list = actor_ongoing_wars
			}
			ordered_in_list = {
				list = actor_ongoing_wars
				order_by = {
					value = 0
					if = {
						limit = {
							is_defender = scope:actor
						}
						every_war_attacker = {
							add = current_military_strength
						}
					}
					else_if = {
						limit = {
							is_attacker = scope:actor
						}
						every_war_defender = {
							add = current_military_strength
						}
					}
				}
				save_temporary_scope_value_as = {
					name = estimated_military_strength_needed
					value = {
						value = 0
						if = {
							limit = {
								is_defender = scope:actor
							}
							every_war_attacker = {
								add = current_military_strength
							}
						}
						else_if = {
							limit = {
								is_attacker = scope:actor
							}
							every_war_defender = {
								add = current_military_strength
							}
						}
					}
				}
			}
		}

		# Find and assign a suitable governor
		random_in_list = {
			list = military_governors
			weight = {
				base = 10
				# Try to pick someone nearby
				modifier = {
					realm_to_title_distance_squared = {
						target = scope:actor.primary_title
						value < 10000
					}
					add = 20
				}
				modifier = {
					realm_to_title_distance_squared = {
						target = scope:actor.primary_title
						value < 30000
					}
					add = 10
				}
				# Prioritize governors with enough military strength
				modifier = {
					current_military_strength >= scope:estimated_military_strength_needed
					add = 20
				}
				# Slight increase for a governor who isn't already in a war
				modifier = {
					is_at_war = no
					add = 10
				}
				# Miniscule bonus for players, so we make sure they get something to do
				modifier = {
					is_ai = no
					add = 5
				}
			}
			save_scope_as = joining_governor
		}
		scope:recipient = {
			if = {
				limit = {
					is_ai = yes
				}
				custom_tooltip = request_emperor_title_troops_approve_desc
			}
			# Send recipient a letter event and let them respond
			trigger_event = {
				id = tgp_interaction_event.0010
				days = { 1 5 }
			}
		}
	}

	on_decline = {
		scope:actor = {
			if = {
				limit = { is_ai = yes }
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = disappointed_opinion
					opinion = -20
				}
				# Set up AI cooldown to prevent spam
				if = {
					limit = {
						NOT = { has_variable = celestial_request_military_aid_cooldown }
					}
					set_variable = { # If declined, we make the cooldown a bit longer to prevent the AI from asking again too soon
						name = celestial_request_military_aid_cooldown
						years = 3
					}
				}
				else = { # Just in case - If we have a cooldown already, refresh it
					remove_variable = celestial_request_military_aid_cooldown
					set_variable = {
						name = celestial_request_military_aid_cooldown
						years = 3
					}
				}
			}
			hidden_effect = {
				send_interface_message = {
					type = msg_admin_provincial_army_request_denied
					title = msg_admin_provincial_army_request_denied.title
					desc = msg_admin_provincial_army_request_denied.desc
					left_icon = scope:recipient
					right_icon = scope:target
				}
			}
		}
		scope:recipient = {
			if = {
				limit = {
					is_ai = yes
				}
				custom_tooltip = request_emperor_title_troops_deny_desc
			}
			if = {
				limit = { scope:dominant_family = yes }
				change_influence = medium_influence_loss
			}
		}
	}

	ai_targets = {
		ai_recipients = top_liege
		ai_recipients = liege
		ai_recipients = peer_vassals
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 24
		duchy = 6
		kingdom = 6
		empire = 6
		hegemony = 0
	}

	ai_potential = {
		is_at_war = yes
	}

	ai_will_do = {
		base = 0

		# Make sure to request aid if you have no one else on your side
		modifier = {
			add = 100
			any_war_ally = {
				count < 1
				this != scope:actor
			}
		}

		# Keep asking for help if your side is weaker than the enemy side - But do so less frequently
		modifier = {
			add = 30
			any_character_war = {
				# Set up scope values so that we can compare strength
				save_temporary_scope_value_as = {
					name = ai_will_do_defender_strength
					value = 0
				}
				save_temporary_scope_value_as = {
					name = ai_will_do_attacker_strength
					value = 0
				}
				any_war_defender = {
					count = all
					save_temporary_scope_value_as = {
						name = ai_will_do_defender_strength
						value = {
							value = scope:ai_will_do_defender_strength
							add = current_military_strength
						}
					}
				}
				any_war_attacker = {
					count = all
					save_temporary_scope_value_as = {
						name = ai_will_do_attacker_strength
						value = {
							value = scope:ai_will_do_attacker_strength
							add = current_military_strength
						}
					}
				}
				# Check if actor's side is weaker than the opponent
				OR = {
					AND = {
						is_defender = scope:actor
						scope:ai_will_do_defender_strength < scope:ai_will_do_attacker_strength
					}
					AND = {
						is_attacker = scope:actor
						scope:ai_will_do_attacker_strength < scope:ai_will_do_defender_strength
					}
				}
			}
		}

		# Grand Campaign
		modifier = {
			add = 30
			any_character_war = {
				using_cb = grand_campaign_kingdom_invasion_cb
			}
		}
	}

	ai_accept = {
		base = 100 # There's no real reason for the AI to refuse
	}
}

# Request Treasury Funds
celestial_request_treasury_interaction = {
	icon = icon_imperial_treasury
	interface_priority = 61
	category = interaction_category_vassal
	common_interaction = no
	desc = celestial_request_treasury_interaction_desc
	filter_tags = { celestial_ministry dynastic_cycle }

	ai_min_reply_days = 4
	ai_max_reply_days = 9
	popup_on_receive = yes
	pause_on_receive = yes

	cooldown = { years = 5 }

	greeting = positive
	notification_text = celestial_request_treasury_interaction_msg

	pre_answer_yes_key = ACCEPT
	pre_answer_no_key = DECLINE

	# Let's find who we shall direct our request to (Liege's marshal/steward depending on type of governorship)
	redirect = {
		scope:recipient = {
			if = {
				limit = {
					this = top_liege
				}
				if = {
					limit = {
						highest_held_title_tier >= tier_hegemony
						government_has_flag = government_is_celestial
						scope:actor = {
							vassal_contract_has_flag = celestial_military_appointment
							NOT = { is_councillor_of = top_liege }
						}
						exists = cp:councillor_marshal
					}
					cp:councillor_marshal = { save_scope_as = recipient }
				}
				else_if = {
					limit = {
						highest_held_title_tier >= tier_hegemony
						government_has_flag = government_is_celestial
						scope:actor = {
							NOR = {
								vassal_contract_has_flag = celestial_military_appointment
								is_councillor_of = top_liege
							}
						}
						exists = cp:councillor_steward
					}
					cp:councillor_steward = { save_scope_as = recipient }
				}
				else = {
					save_scope_as = recipient
				}
			}
		}
	}

	cost = {
		influence = medium_influence_value
	}

	is_shown = {
		scope:actor = {
			government_has_flag = government_is_celestial
			this != top_liege
			OR = {
				is_governor = yes
				is_councillor_of = top_liege
			}
			this != scope:recipient
		}
		scope:recipient = {
			government_has_flag = government_is_celestial
			OR = {
				this = scope:actor.top_liege
				OR = {
					AND = {
						has_title = title:e_minister_of_war
						liege = {
							highest_held_title_tier >= tier_hegemony
							government_has_flag = government_is_celestial
						}
						scope:actor = {
							vassal_contract_has_flag = celestial_military_appointment
							NOT = { is_councillor_of = top_liege }
						}
					}
					AND = {
						has_title = title:e_minister_of_revenue
						liege = {
							highest_held_title_tier >= tier_hegemony
							government_has_flag = government_is_celestial
						}
						scope:actor = {
							NOR = {
								vassal_contract_has_flag = celestial_military_appointment
								is_councillor_of = top_liege
							}
						}
					}
				}
			}
			trigger_if = {
				limit = {
					scope:actor = { is_ai = yes }
				}
				NOT = { has_variable = celestial_request_treasury_ai_cooldown }
			}
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			# Is not at war with anyone important
			is_at_war_with_liege = no
			NOT = { is_at_war_with = scope:recipient }
		}

		scope:recipient = {
			treasury >= request_treasury_value
		}
	}

	can_send = {
	}

	on_send = {
	}

	# Hook
	send_option = {
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
			NOT = {
				scope:recipient = { has_hook = scope:actor }
			}
		}
		flag = hook
		localization = GENERIC_SPEND_A_HOOK
	}
	# Dominant Family
	send_option = {
		is_shown = {
			scope:actor = {
				house ?= { is_dominant_family = yes }
			}
		}
		flag = dominant_family
		localization = OPTION_DOMINANT_FAMILY
	}
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"
	send_options_exclusive = no

	on_accept = {
		scope:actor = {
			if = {
				limit = {
					is_ai = yes
				}
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = grateful_opinion
					opinion = 10
				}
			}
			if = {
				limit = {
					scope:hook = yes
					has_usable_hook = scope:recipient
				}
				use_hook = scope:recipient
			}
			# Trigger catalyst if applicable
			# tgp_activate_catalyst_against_hegemon_effect = { #LotR
			# 	HEGEMON = scope:recipient
			# 	CATALYST = catalyst_hegemon_influenced_by_interaction
			# }
		}

		scope:recipient = {
			pay_short_term_treasury = {
				target = scope:actor
				treasury = request_treasury_value
			}
			# If recipient is a player - let's add a global AI cooldown so you don't get spammed with requests
			if = {
				limit = {
					is_ai = no
				}
				set_variable = {
					name = celestial_request_treasury_ai_cooldown
					years = 3
				}
			}
		}
	}

	on_decline = {
		scope:actor = {
			if = {
				limit = { is_ai = yes }
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = disappointed_opinion
					opinion = -20
				}
				# Set up AI cooldown
				if = {
					limit = {
						NOT = { has_variable = celestial_request_treasury_cooldown }
					}
					set_variable = { # If declined, we make the cooldown a bit longer to prevent the AI from asking again too soon
						name = celestial_request_treasury_cooldown
						years = 10
					}
				}
			}
		}
		scope:recipient = {
			if = {
				limit = { scope:dominant_family = yes }
				change_influence = medium_influence_loss
			}
			# If recipient is a player - let's add a global AI cooldown so you don't get spammed with requests
			if = {
				limit = {
					is_ai = no
				}
				set_variable = {
					name = celestial_request_treasury_ai_cooldown
					years = 3
				}
			}
		}
	}

	ai_targets = {
		ai_recipients = top_liege
		ai_recipients = liege
		ai_recipients = peer_vassals
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 108
		duchy = 36
		kingdom = 36
		empire = 36
		hegemony = 0
	}

	ai_potential = {
		is_at_war = no
		NOT = { has_variable = celestial_request_treasury_cooldown }
		treasury <= minor_treasury_value
	}

	ai_will_do = {
		base = 10
		
		# Increase chance if we have a negative treasury
		modifier = {
			add = 10
			treasury < 0
		}
		
		# Traits
		modifier = {
			add = 10
			has_trait = greedy
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = 5
			has_trait = impatient
		}
		modifier = {
			add = 5
			has_trait = arbitrary
		}
		modifier = {
			add = -10
			has_trait = patient
		}
		modifier = {
			add = -5
			has_trait = humble
		}

		# Send options
		modifier = { # Leverage your dominant family if applicable
			factor = 1.2
			scope:dominant_family = yes
		}

		# Councillors should be less likely to request funds
		modifier = {
			factor = 0.5
			is_councillor_of = scope:recipient
		}
	}

	ai_accept = {
		base = -20

		# Hook
		modifier = {
			add = 40
			scope:hook = yes
			desc = SCHEME_WEAK_HOOK_USED
		}

		# Opinion
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
		}

		# Movements
		modifier = {
			add = {
				value = 20
				if = {
					limit = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
					multiply = 1.5
				}
			}
			is_in_same_movement_as = { TARGET = scope:actor }
			desc = actor_and_recipient_in_same_movement
		}
		modifier = {
			add = 20
			is_in_same_movement_as = { TARGET = scope:actor }
			scope:actor = { is_any_movement_leader = yes }
			desc = actor_is_recipients_movement_leader
		}

		# Traits
		modifier = {
			add = 20
			has_trait = generous
			desc = INTERACTION_GENEROUS
		}
		modifier = {
			add = -20
			has_trait = greedy
			desc = INTERACTION_GREEDY
		}

		# Treasury
		modifier = {
			add = -40
			treasury < { value = request_treasury_value multiply = 2 }
			desc = INTERACTION_RECIPIENT_WOULD_GET_LOW_TREASURY
		}
		modifier = {
			add = -20
			treasury < { value = request_treasury_value multiply = 4 }
			treasury >= { value = request_treasury_value multiply = 2 }
			desc = INTERACTION_RECIPIENT_WOULD_GET_LOW_TREASURY
		}
		modifier = {
			add = 20
			treasury > { value = request_treasury_value multiply = 8 }
			desc = INTERACTION_RECIPIENT_HIGH_TREASURY
		}
		modifier = {
			add = -30
			scope:actor.treasury > { value = request_treasury_value multiply = 3 }
			scope:actor.treasury <= { value = request_treasury_value multiply = 6 }
			desc = INTERACTION_ACTOR_HIGH_TREASURY
		}
		modifier = {
			add = -60
			scope:actor.treasury > { value = request_treasury_value multiply = 6 }
			desc = INTERACTION_ACTOR_HIGH_TREASURY
		}

		# Relations to actor
		modifier = {
			has_relation_friend = scope:actor
			add = 20
			desc = AI_YOUR_FRIEND
		}
		modifier = {
			has_relation_lover = scope:actor
			add = 10
			desc = AI_YOUR_LOVER
		}
		modifier = {
			has_relation_rival = scope:actor
			add = -50
			desc = AI_YOUR_RIVAL
		}
		modifier = {
			has_relation_elder = scope:actor
			add = 20
			desc = AI_YOUR_DISCIPLE
		}
		modifier = {
			has_relation_disciple = scope:actor
			add = 5
			desc = AI_YOUR_ELDER
		}
		# Grand Campaign
		modifier = {
			add = 30
			any_character_war = {
				using_cb = grand_campaign_kingdom_invasion_cb
			}
		}
	}
}

# Request a Commander
celestial_request_commander_interaction = {
	icon = request_maa_interaction
	interface_priority = 58
	category = interaction_category_vassal
	common_interaction = no
	desc = celestial_request_commander_interaction_desc
	filter_tags = { celestial_ministry dynastic_cycle }

	ai_min_reply_days = 4
	ai_max_reply_days = 9
	popup_on_receive = yes
	pause_on_receive = yes

	cooldown = { years = 5 }

	greeting = positive

	pre_answer_yes_key = ACCEPT
	pre_answer_no_key = DECLINE

	is_shown = {
		scope:actor = {
			government_has_flag = government_is_celestial
			OR = {
				AND = {
					is_governor = yes
					highest_held_title_tier >= tier_kingdom
				}
				top_liege = this
			}
			this != scope:recipient
		}
		scope:recipient = {
			has_title = title:e_minister_of_war
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			# Is not at war with anyone important
			is_at_war_with_liege = no
			NOT = { is_at_war_with = scope:recipient }
		}
		custom_tooltip = {
			text = recipient_no_commanders_available_desc
			scope:recipient = {
				any_courtier = {
					trigger_if = {
						limit = {
							exists = house
						}
						this != scope:recipient
					}
					NOT = { is_close_family_of = scope:recipient }
					can_be_commander_basic_trigger = { ARMY_OWNER = scope:actor }
				}
			}
		}
	}

	can_send = {
	}

	on_send = {
	}

	populate_recipient_list = {
		scope:recipient = {
			every_courtier = {
				limit = {
					trigger_if = {
						limit = {
							exists = house
						}
						this != scope:recipient
					}
					NOT = { is_close_family_of = scope:recipient }
					can_be_commander_basic_trigger = { ARMY_OWNER = scope:actor }
				}
				add_to_list = characters
			}
		}
	}

	cost = {
		treasury = {
			add = {
				value = scope:actor.minor_gold_value_static_max
				desc = BASE
			}
			if = {
				limit = {
					exists = scope:secondary_recipient
				}
				scope:secondary_recipient = {
					add = {
						value = martial
						desc = secondary_recipient_martial_skill_desc
					}
					if = {
						limit = {
							number_of_commander_traits > 0
						}
						add = {
							value = number_of_commander_traits
							multiply = 5
							desc = secondary_recipient_num_commander_traits_desc
						}
					}
				}
			}
			if = {
				limit = {
					scope:hook = yes
				}
				multiply = {
					value = 0.5
					desc = actor_use_hook_desc
				}
			}
		}
	}

	# Hook
	send_option = {
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
			NOT = {
				scope:recipient = { has_hook = scope:actor }
			}
		}
		flag = hook
		localization = GENERIC_SPEND_A_HOOK
	}
	# Dominant Family
	send_option = {
		is_shown = {
			scope:actor = {
				house ?= { is_dominant_family = yes }
			}
		}
		flag = dominant_family
		localization = OPTION_DOMINANT_FAMILY
	}
	send_options_exclusive = no
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"

	on_accept = {
		scope:actor = {
			if = {
				limit = {
					is_ai = yes
				}
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = grateful_opinion
					opinion = 10
				}
			}
			if = {
				limit = {
					scope:hook = yes
					has_usable_hook = scope:recipient
				}
				use_hook = scope:recipient
			}

			# Provide the chosen commander
			send_interface_toast = {
				type = event_toast_effect_good
				title = celestial_request_commander_interaction_accepted_t
				left_icon = scope:secondary_recipient
				right_icon = scope:recipient

				add_courtier = scope:secondary_recipient
			}
		}
	}

	on_decline = {
		scope:actor = {
			if = {
				limit = { is_ai = yes }
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = disappointed_opinion
					opinion = -20
				}
				# Set up AI cooldown
				if = {
					limit = {
						NOT = { has_variable = celestial_request_commander_cooldown }
					}
					set_variable = { # If declined, we make the cooldown a bit longer to prevent the AI from asking again too soon
						name = celestial_request_commander_cooldown
						years = 10
					}
				}
			}

			# Notify actor
			send_interface_toast = {
				type = event_toast_effect_good
				title = celestial_request_commander_interaction_declined_t
				right_icon = scope:recipient
			}
		}
		scope:recipient = {
			if = {
				limit = { scope:dominant_family = yes }
				change_influence = medium_influence_loss
			}
		}
	}

	auto_accept = {
		# Supporters of the hegemon will not refuse
		custom_tooltip = {
			text = recipient_support_hegemon_or_favors_same_era_desc
			scope:recipient = {
				liege = scope:actor
				OR = {
					is_in_pro_hegemon_or_hegemon_movement = yes
					# AND = { #LotR
					# 	title:h_china.holder.hegemon_favored_stability_phase_value < 0
					# 	top_participant_group:dynastic_cycle ?= { participant_group_type = expansion_movement }
					# }
					# AND = {
					# 	title:h_china.holder.hegemon_favored_stability_phase_value >= 0
					# 	top_participant_group:dynastic_cycle ?= { participant_group_type = advancement_movement }
					# }
				}
			}
		}
	}

	ai_targets = {
		ai_recipients = top_liege
		ai_recipients = liege
		ai_recipients = peer_vassals
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 60
		kingdom = 48
		empire = 36
		hegemony = 36
	}

	ai_potential = {
		vassal_contract_has_flag = celestial_military_appointment
		NOT = { has_variable = celestial_request_commander_cooldown }
	}

	ai_will_do = {
		base = 0

		# Do we actually need a commander?
		modifier = {
			add = 50
			NOT = {
				any_courtier = { martial >= decent_skill_rating }
			}
		}

		# Traits
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}

	ai_accept = {
		base = 0

		# Hook
		modifier = {
			scope:hook = yes
			add = 40
			desc = SCHEME_WEAK_HOOK_USED
		}

		# Opinion
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
		}

		# You are a civilian governor
		modifier = {
			scope:actor = { vassal_contract_has_flag = celestial_civil_appointment }
			add = -20
			desc = AI_ACTOR_IS_CIVILIAN_GOVERNOR
		}

		# Movements
		modifier = {
			add = {
				value = 20
				if = {
					limit = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
					multiply = 1.5
				}
			}
			is_in_same_movement_as = { TARGET = scope:actor }
			desc = actor_and_recipient_in_same_movement
		}
		modifier = {
			is_in_same_movement_as = { TARGET = scope:actor }
			scope:actor = { is_any_movement_leader = yes }
			add = 20
			desc = actor_is_recipients_movement_leader
		}

		# Traits
		modifier = {
			add = 20
			has_trait = generous
			desc = INTERACTION_GENEROUS
		}
		modifier = {
			add = -20
			has_trait = greedy
			desc = INTERACTION_GREEDY
		}

		# Relations to actor
		modifier = {
			has_relation_friend = scope:actor
			add = 20
			desc = AI_YOUR_FRIEND
		}
		modifier = {
			has_relation_lover = scope:actor
			add = 10
			desc = AI_YOUR_LOVER
		}
		modifier = {
			has_relation_rival = scope:actor
			add = -50
			desc = AI_YOUR_RIVAL
		}
		modifier = {
			has_relation_elder = scope:actor
			add = 20
			desc = AI_YOUR_DISCIPLE
		}
		modifier = {
			has_relation_disciple = scope:actor
			add = 5
			desc = AI_YOUR_ELDER
		}

		# Your family is dominant
		modifier = {
			scope:actor.house = { is_dominant_family = yes }
			add = 40
			desc = AI_DOMINANT_FAMILY
		}
		# Your family is powerful
		modifier = {
			scope:actor.house = { is_powerful_family = yes }
			add = 20
			desc = AI_POWERFUL_FAMILY
		}

		# Secondary recipient
		modifier = {
			scope:secondary_recipient ?= {
				martial > decent_skill_rating
			}
			add = {
				value = scope:secondary_recipient.martial
				subtract = decent_skill_rating
				multiply = -1
			}
			desc = AI_SECONDARY_RECIPIENT_MARTIAL_SKILL
		}
	}
}

# Request Examination Support
celestial_request_examination_support_interaction = {
	icon = provincial_examination
	interface_priority = 57
	category = interaction_category_vassal
	common_interaction = no
	desc = celestial_request_examination_support_interaction_desc
	filter_tags = { celestial_ministry dynastic_cycle }

	ai_min_reply_days = 4
	ai_max_reply_days = 9
	popup_on_receive = yes
	pause_on_receive = yes

	cooldown = { years = 5 }

	greeting = positive

	pre_answer_yes_key = ACCEPT
	pre_answer_no_key = DECLINE

	is_shown = {
		scope:actor = {
			government_has_flag = government_is_celestial
			is_governor_or_admin_count = yes
			this != scope:recipient
		}
		scope:recipient = {
			has_title = title:e_minister_of_rites
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			# Is not at war with anyone important
			is_at_war_with_liege = no
			NOT = { is_at_war_with = scope:recipient }
		}
	}

	can_send = {
	}

	on_send = {
	}

	cost = {
		influence = {
			add = {
				value = medium_influence_value
				desc = BASE
			}
			if = {
				limit = {
					scope:hook = yes
				}
				multiply = {
					value = 0.5
					desc = actor_use_hook_desc
				}
			}
		}
	}

	# Hook
	send_option = {
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
			NOT = {
				scope:recipient = { has_hook = scope:actor }
			}
		}
		flag = hook
		localization = GENERIC_SPEND_A_HOOK
	}
	send_options_exclusive = no
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"

	on_accept = {
		scope:actor = {
			if = {
				limit = {
					is_ai = yes
				}
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = grateful_opinion
					opinion = 10
				}
				# Set up AI cooldown
				if = {
					limit = {
						NOT = { has_variable = celestial_examination_support_cooldown }
					}
					set_variable = { # Even if accepted, we make the cooldown a bit longer for the AI
						name = celestial_examination_support_cooldown
						years = 15
					}
				}
			}
			if = {
				limit = {
					scope:hook = yes
					has_usable_hook = scope:recipient
				}
				use_hook = scope:recipient
			}

			# Provide the chosen commander
			send_interface_toast = {
				type = event_toast_effect_good
				title = celestial_request_examination_support_interaction_accepted_t
				left_icon = scope:recipient

				# Make sure the minister pay for the cost
				scope:recipient = {
					remove_treasury = {
						# We make a very rudimentery cost predication here
						value = {
							value = 30
							multiply = {
								value = scope:actor.primary_title.tier
								subtract = 1
								min = 1
							}
							if = {
								limit = {
									scope:actor.primary_title.tier > tier_duchy
								}
								add = 50
							}
							multiply = activity_cost_scale_by_era
						}
					}
				}
				# Add a flag to make the next acitivty be free
				custom_tooltip = {
					text = free_local_examination_effect_desc
					add_character_flag = celestial_examination_support_cost_reduction
					if = { # Let's ensure that if the AI asks they'll actually host the exams
						limit = { is_ai = yes }
						add_character_flag = examinations_ai_override
					}
				}
			}
		}
	}

	on_decline = {
		scope:actor = {
			if = {
				limit = { is_ai = yes }
				# Add opinion
				add_opinion = {
					target = scope:recipient
					modifier = disappointed_opinion
					opinion = -20
				}
				# Set up AI cooldown
				if = {
					limit = {
						NOT = { has_variable = celestial_examination_support_cooldown }
					}
					set_variable = { # If declined, we make the cooldown a bit longer to prevent the AI from asking again too soon
						name = celestial_examination_support_cooldown
						years = 20
					}
				}
			}

			# Notify actor
			send_interface_toast = {
				type = event_toast_effect_good
				title = celestial_request_examination_support_interaction_declined_t
				left_icon = scope:recipient
			}
		}
		scope:recipient = {
			if = {
				limit = {
					scope:actor = {
						house ?= { is_dominant_family = yes }
					}
				}
				change_influence = medium_influence_loss
			}
		}
	}

	auto_accept = {
		# Supporters of the hegemon will not refuse
		custom_tooltip = {
			text = recipient_support_hegemon_or_favors_same_era_desc
			scope:recipient = {
				liege = scope:actor
				OR = {
					is_in_pro_hegemon_or_hegemon_movement = yes
					# AND = { #LotR
					# 	title:h_china.holder.hegemon_favored_stability_phase_value < 0
					# 	top_participant_group:dynastic_cycle ?= { participant_group_type = expansion_movement }
					# }
					# AND = {
					# 	title:h_china.holder.hegemon_favored_stability_phase_value >= 0
					# 	top_participant_group:dynastic_cycle ?= { participant_group_type = advancement_movement }
					# }
				}
			}
		}
	}

	ai_targets = {
		ai_recipients = peer_vassals
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 60
		kingdom = 48
		empire = 36
		hegemony = 36
	}

	ai_potential = {
		vassal_contract_has_flag = celestial_civil_appointment
		NOT = { has_variable = celestial_examination_support_cooldown }
	}

	ai_will_do = {
		base = 0

		# Can we host examinations?
		modifier = {
			add = 50
			can_host_activity = activity_local_examination
		}

		# Traits
		modifier = {
			factor = 1.25
			OR = {
				has_trait = confucian_education
				has_trait = scholar
				has_trait = education_learning_3
				has_trait = education_learning_4
			}
		}
	}

	ai_accept = {
		base = 0

		# Hook
		modifier = {
			scope:hook = yes
			add = 40
			desc = SCHEME_WEAK_HOOK_USED
		}

		# Opinion
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
		}

		# Funds
		modifier = {
			treasury <= {
				value = {
					value = 30
					multiply = {
						value = scope:actor.primary_title.tier
						subtract = 1
						min = 1
					}
					if = {
						limit = {
							scope:actor.primary_title.tier > tier_duchy
						}
						add = 50
					}
					multiply = activity_cost_scale_by_era
				}
			}
			add = -25
			desc = recipient_has_low_funds
		}

		# Movements
		modifier = {
			is_in_same_movement_as = { TARGET = scope:actor }
			add = 20
			desc = actor_and_recipient_in_same_movement
		}
		modifier = {
			is_in_same_movement_as = { TARGET = scope:actor }
			scope:actor = { is_any_movement_leader = yes }
			add = 20
			desc = actor_is_recipients_movement_leader
		}

		# Traits
		modifier = {
			add = 20
			has_trait = generous
			desc = INTERACTION_GENEROUS
		}
		modifier = {
			add = 10
			has_trait = trusting
			desc = INTERACTION_TRUSTING
		}
		modifier = {
			add = 10
			has_trait = humble
			desc = INTERACTION_HUMBLE
		}
		modifier = {
			add = -10
			has_trait = arrogant
			desc = INTERACTION_ARROGANT
		}
		modifier = {
			add = -20
			has_trait = greedy
			desc = INTERACTION_GREEDY
		}

		# Relations to actor
		modifier = {
			has_relation_friend = scope:actor
			add = 20
			desc = AI_YOUR_FRIEND
		}
		modifier = {
			has_relation_lover = scope:actor
			add = 10
			desc = AI_YOUR_LOVER
		}
		modifier = {
			has_relation_rival = scope:actor
			add = -50
			desc = AI_YOUR_RIVAL
		}
		modifier = {
			has_relation_elder = scope:actor
			add = 20
			desc = AI_YOUR_DISCIPLE
		}
		modifier = {
			has_relation_disciple = scope:actor
			add = 10
			desc = AI_YOUR_ELDER
		}

		# Your family is dominant
		modifier = {
			scope:actor.house = { is_dominant_family = yes }
			add = 40
			desc = AI_DOMINANT_FAMILY
		}
		# Your family is powerful
		modifier = {
			scope:actor.house = { is_powerful_family = yes }
			add = 20
			desc = AI_POWERFUL_FAMILY
		}
	}
}

# Minister actions
# Have Military Governor Join War
celestial_send_military_aid_interaction = {
	icon = icon_soldier_survivor
	interface_priority = 70
	category = interaction_category_vassal
	common_interaction = no
	desc = celestial_send_military_aid_interaction_desc
	
	filter_tags = { admin_governor }

	popup_on_receive = yes
	pause_on_receive = yes

	pre_answer_yes_key = ACCEPT
	pre_answer_no_key = DECLINE

	cost = {
		influence = {
			value = {
				add = medium_influence_value
				desc = BASE
			}
			if = {
				limit = {
					scope:actor = { has_title = title:e_minister_of_war }
				}
				multiply = {
					value = 0.25
					desc = "[minister_of_war|E]"
				}
			}
		}
	}

	is_shown = {
		scope:actor = {
			OR = {
				# If you are the minister of war
				has_title = title:e_minister_of_war
				# Or if you are an independent admin ruler with military governors
				AND = {
					top_liege = this
					government_allows = administrative
					government_allows = merit
				}
			}
		}
		scope:recipient = {
			top_liege = scope:actor.top_liege
			OR = {
				is_landed = yes
				has_title = title:e_minister_grand_marshal
			}
		}
	}

	is_valid_showing_failures_only = {
		custom_tooltip = {
			text = celestial_request_military_aid_no_military_governors_desc
			scope:recipient.top_liege = {
				any_vassal_or_below = {
					OR = {
						vassal_contract_has_flag = celestial_military_appointment
						vassal_contract_has_flag = meritocratic_military_appointment
					}
				}
			}
		}

		custom_tooltip = {
			text = celestial_request_military_aid_no_available_military_governors_desc
			scope:recipient.top_liege = {
				any_vassal_or_below = {
					tgp_celestial_military_governor_can_join_war_trigger = {
						TARGET_GOVERNOR = scope:recipient
						MINISTER_OF_WAR = scope:actor
					}
				}
			}
		}

		scope:recipient = {
			is_at_war = yes # Has to be at war
			is_at_war_with_liege = no # But not with liege
			NOT = { is_at_war_with = scope:actor }
			# Has to be a war leader
			trigger_if = {
				limit = { is_at_war = yes }
				custom_description = {
					text = target_is_not_war_leader
					object = scope:recipient
					any_character_war = {
						scope:recipient = { is_leader_in_war = prev }
					}
				}
			}
		}
	}

	populate_recipient_list = {
		scope:actor.top_liege = {
			every_vassal_or_below = {
				limit = {
					tgp_celestial_military_governor_can_join_war_trigger = {
						TARGET_GOVERNOR = scope:recipient
						MINISTER_OF_WAR = scope:actor
					}
				}
				add_to_list = characters
			}
		}
	}

	can_send = {
	}

	on_send = {
	}
	
	is_highlighted = {
		scope:recipient = {
			is_at_war = yes
		}
	}

	auto_accept = yes

	on_accept = {
		scope:recipient = {
			# Save scopes for events
			save_scope_as = governor_at_war
			scope:secondary_recipient = { save_scope_as = governor_joining }

			# Have secondary_recipient join recipient's wars
			every_character_war = {
				limit = {
					scope:recipient = { is_leader_in_war = prev }
					is_attacker = scope:recipient
				}
				add_attacker = scope:secondary_recipient
			}
			every_character_war = {
				limit = {
					scope:recipient = { is_leader_in_war = prev }
					is_defender = scope:recipient
				}
				add_defender = scope:secondary_recipient
			}

			# If recipient is AI, add some opinion
			if = {
				limit = {
					is_ai = yes
				}
				add_opinion = {
					target = scope:actor
					modifier = grateful_opinion
					opinion = 10
				}
			}

			# Send recipient a letter event and let them know of your action
			if = {
				limit = {
					scope:actor != scope:recipient
				}
				trigger_event = {
					id = tgp_interaction_event.0015
				}
			}
		}

		scope:secondary_recipient = {
			# Send recipient a letter event and let them know of your action
			trigger_event = {
				id = tgp_interaction_event.0016
			}
		}

		scope:actor = {
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_neutral
					title = celestial_send_military_aid_confirmation
					left_icon = scope:recipient
					right_icon = scope:secondary_recipient

					custom_tooltip = celestial_send_military_aid_effect_desc
				}
			}
		}
	}

	on_decline = {
		# Interaction is auto accepted and cannot be declined
	}

	ai_targets = {
		ai_recipients = peer_vassals
		max = 30
	}
	ai_targets = {
		ai_recipients = vassals
		max = 30
	}
	ai_targets = { # So the minister of war can send aid to the hegemon
		ai_recipients = liege
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 8
		empire = 4
		hegemony = 3
	}

	ai_potential = {
		OR = {
			# If you are the minister of war
			has_title = title:e_minister_of_war
			# Or if you are an independent admin ruler with military governors
			AND = {
				top_liege = this
				government_allows = administrative
				government_allows = merit
				# But don't bother if you have the minister of war, he'll do it for you
				tgp_has_access_to_ministry_trigger = no
			}
		}
	}

	ai_will_do = {
		base = 0

		# Make sure to send aid if there is no one helping
		modifier = {
			add = 100
			scope:recipient = {
				vassal_contract_has_flag = celestial_civil_appointment
				any_war_ally = {
					count < 1
					this != scope:actor
				}
			}
		}
		
		# We'll make sure to send a bit more help to the hegemon (for immersion, more than he actually needing it)
		modifier = {
			add = 100
			scope:recipient = {
				top_liege = this
				any_war_ally = {
					count < 3
				}
			}
		}
		
		# We always want to send the grand marshal to the top liege
		modifier = {
			add = 100
			scope:recipient = {
				top_liege = this
			}
			scope:secondary_recipient = {
				has_title = title:e_minister_grand_marshal
			}
		}

		# Send more aid if recipient is weaker than the enemy side - But do so less frequently
		modifier = {
			add = 40
			scope:recipient = {
				any_character_war = {
					# Set up scope values so that we can compare strength
					save_temporary_scope_value_as = {
						name = ai_will_do_defender_strength
						value = 0
					}
					save_temporary_scope_value_as = {
						name = ai_will_do_attacker_strength
						value = 0
					}
					any_war_defender = {
						count = all
						save_temporary_scope_value_as = {
							name = ai_will_do_defender_strength
							value = {
								value = scope:ai_will_do_defender_strength
								add = current_military_strength
							}
						}
					}
					any_war_attacker = {
						count = all
						save_temporary_scope_value_as = {
							name = ai_will_do_attacker_strength
							value = {
								value = scope:ai_will_do_attacker_strength
								add = current_military_strength
							}
						}
					}
					# Check if actor's side is weaker than the opponent
					OR = {
						AND = {
							is_defender = scope:actor
							scope:ai_will_do_defender_strength < scope:ai_will_do_attacker_strength
						}
						AND = {
							is_attacker = scope:actor
							scope:ai_will_do_attacker_strength < scope:ai_will_do_defender_strength
						}
					}
				}
			}
		}
		
		# We always want to send the grand marshal to the top liege
		modifier = {
			factor = {
				value = 1
				if = {
					limit = {
						scope:secondary_recipient = { highest_held_title_tier >= tier_empire }
					}
					add = 3
				}
				else_if = {
					limit = {
						scope:secondary_recipient = { highest_held_title_tier >= tier_kingdom }
					}
					add = 2
				}
				else_if = {
					limit = {
						scope:secondary_recipient = { highest_held_title_tier >= tier_duchy }
					}
					add = 1.5
				}
			}
			scope:secondary_recipient = {
				is_at_war = no
			}
		}
		
		# Players get a bit of extra score if not already busy
		modifier = {
			factor = 2
			scope:secondary_recipient = {
				is_ai = no
				is_at_war = no
			}
		}
	}

	ai_accept = {
		base = 100 # Auto accepted/no reason to refuse
	}
}

# Designate Favored Minister
set_favored_minister_interaction = {
	icon = icon_boost_efficiency
	interface_priority = 61
	category = interaction_category_vassal
	common_interaction = no
	desc = set_favored_minister_interaction_desc
	filter_tags = { celestial_ministry dynastic_cycle }

	#cooldown = { years = 5 }

	#greeting = positive
	#notification_text = celestial_request_treasury_interaction_msg

	is_shown = {
		scope:actor = {
			government_has_flag = government_is_celestial
			highest_held_title_tier >= tier_hegemony
			#this != scope:recipient
		}
		scope:recipient = {
			exists = top_liege
			is_councillor_of = top_liege
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			# Is not at war with anyone important
			NOT = { is_at_war_with = scope:recipient }
		}

		scope:recipient = {
			NOT = { has_court_position = favored_minister_court_position }
		}
	}

	can_send = {
	}

	on_send = {
	}

	on_accept = {
		scope:actor = {
			if = {
				limit = {
					employs_court_position = favored_minister_court_position
				}
				revoke_court_position = {
					court_position = favored_minister_court_position
					recipient = court_position:favored_minister_court_position
				}
			}
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = favored_minister_court_position
				left_icon = scope:recipient

				appoint_court_position = {
					recipient = scope:recipient
					court_position = favored_minister_court_position
				}
			}
			custom_tooltip = recipient_favored_minister_aptitude_tt
		}
	}

	auto_accept = yes

	ai_targets = {
		ai_recipients = councillors
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 0
		hegemony = 24
	}

	ai_potential = {
		NOT = {
			employs_court_position = favored_minister_court_position
		}
	}

	ai_will_do = {
		base = 20

		# Personal reasons
		modifier = {
			add = 50
			OR = {
				has_relation_friend = scope:recipient
				has_relation_lover = scope:recipient
			}
		}

		# Political reasons
		modifier = {
			add = {
				value = 10
				if = {
					limit = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
					multiply = 1.5
				}
			}
			is_in_same_movement_as = { TARGET = scope:recipient }
		}
		modifier = {
			add = 15
			situation:dynastic_cycle ?= {
				any_participant_group = {
					var:movement_leader ?= scope:recipient
				}
			}
		}
		modifier = {
			add = {
				add = scope:recipient.number_of_disciples
				multiply = 2
			}
			scope:recipient = {
				number_of_disciples > 0
			}
		}
	}
}
# End of minister related interactions

# Movement Power Change (scheme)
celestial_movement_power_promote_interaction = {
	icon = icon_scheme_promote
	category = interaction_category_diplomacy
	send_name = START_SCHEME
	scheme = celestial_movement_power_promote
	desc = celestial_movement_power_promote_interaction_desc
	common_interaction = yes
	filter_tags = { dynastic_cycle }

	interface_priority = 60

	is_shown = {
		scope:actor = {
			exists = var:movement_power
		}
		scope:recipient = {
			exists = var:movement_power
		}
		situation:dynastic_cycle ?= {
			any_participant_group = {
				NOR = {
					participant_group_type = hegemon_ruler
					participant_group_type = other_rulers
				}
				participant_group_has_character = scope:actor
			}
		}
		situation:dynastic_cycle ?= {
			any_participant_group = {
				NOR = {
					participant_group_type = hegemon_ruler
					participant_group_type = other_rulers
				}
				participant_group_has_character = scope:recipient
			}
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			can_start_scheme = {
				type = celestial_movement_power_promote
				target_character = scope:recipient
			}
		}
	}

	can_send = {
	}

	cooldown_against_recipient = { years = 3 }

	# Scheme Starter Packages
	options_heading = schemes.t.agent_packages
	send_options_exclusive = yes
	## Balanced agents.
	send_option = {
		flag = agent_focus_balance
		current_description = celestial_movement_power_promote_interaction.tt.agent_focus_balance
	}
	## Focused on Success Chance.
	send_option = {
		flag = agent_focus_success
		current_description = celestial_movement_power_promote_interaction.tt.agent_focus_success
	}
	## Focused on Speed.
	send_option = {
		flag = agent_focus_speed
		current_description = celestial_movement_power_promote_interaction.tt.agent_focus_speed
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = celestial_movement_power_promote
				left_icon = scope:actor
				right_icon = scope:recipient
				# Success.
				if = {
					limit = { scope:agent_focus_success ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_movement_power_promote
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Success.
						AGENT_1 = agent_proponent
						AGENT_2 = agent_sycophant
						AGENT_3 = agent_eunuch
						AGENT_4 = agent_intermediary
						# Speed.
						AGENT_5 = agent_herald
					}
				}
				# Speed.
				else_if = {
					limit = { scope:agent_focus_speed ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_movement_power_promote
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Speed.
						AGENT_1 = agent_bureaucrat
						AGENT_2 = agent_political_socialite
						AGENT_3 = agent_gabbler
						AGENT_4 = agent_herald
						# Success.
						AGENT_5 = agent_sycophant
					}
				}
				# Balanced.
				else = {
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_movement_power_promote
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Success.
						AGENT_1 = agent_proponent
						AGENT_2 = agent_sycophant
						AGENT_3 = agent_eunuch
						# Speed.
						AGENT_4 = agent_gabbler
						AGENT_5 = agent_herald
					}
				}
			}
			# Scheme progress bonus from education
			education_5_scheme_progress_effect = { SKILL = diplomacy }
			stress_impact = {
				content = medium_stress_impact_gain
			}
			if = {
				limit = {
					has_relation_nemesis = scope:recipient
				}
				stress_impact = { base = major_stress_impact_loss }
			}
			else_if = {
				limit = {
					has_relation_rival = scope:recipient
				}
				stress_impact = { base = medium_stress_impact_loss }
			}
		}
	}

	auto_accept = yes

	# AI
	ai_targets = {
		ai_recipients = situation_participant_group
		parameter = dynastic_cycle
		max = 10
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 108
		duchy = 36
		kingdom = 36
		empire = 36
		hegemony = 36
	}

	ai_potential = {
		NOT = {
			any_scheme = {
				is_scheme_category = political
			}
		}
		NOR = {
			has_trait = deceitful
			has_trait = arrogant
			has_trait = disloyal
			#has_title = title:h_china # the hegemon should rather not be doing this #LotR
		}
	}

	ai_will_do = {
		base = -50

		# Additions.
		## Weight for opinion.
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = 0.5
		}
		## Weight for personality.
		ai_value_modifier = {
			ai_energy = -0.25
			ai_vengefulness = -1
			ai_honor = 0.5
		}
		## Certain traits can affect likelihood directly.
		### +++ Gregarious.
		modifier = {
			add = 50
			has_trait = gregarious
		}
		### ++ Compassionate.
		modifier = {
			add = 30
			has_trait = compassionate
		}
		### + Generous.
		modifier = {
			add = 10
			has_trait = generous
		}
		# focus on characters in your own hierarchy
		modifier = {
			add = 20
			scope:actor = {
				OR = {
					is_vassal_or_below_of = scope:recipient
					is_liege_or_above_of = scope:recipient
				}
			}
		}
		# focus on disciples
		modifier = {
			add = 50
			scope:actor = {
				has_relation_disciple = scope:recipient
			}
		}
		# or fellow disciples
		modifier = {
			add = 20
			scope:recipient = {
				any_relation = {
					type = elder
					any_relation = {
						type = disciple
						this = scope:actor
					}
				}
			}
		}
		# Factors.
		## Don't pick people we hate.
		modifier = {
			factor = 0
			should_prioritise_hostile_action_against_due_to_personal_relations_trigger = {
				ACTOR = scope:actor
				RECIPIENT = scope:recipient
			}
		}
		## Pick our friends or allies.
		modifier = {
			factor = 1.5
			should_avoid_hostile_action_against_due_to_personal_relations_trigger = {
				ACTOR = scope:actor
				RECIPIENT = scope:recipient
			}
		}
	}
}

# Movement Power Change (scheme)
celestial_movement_power_slander_interaction = {
	icon = icon_scheme_slander
	category = interaction_category_diplomacy
	send_name = START_SCHEME
	scheme = celestial_movement_power_slander
	desc = celestial_movement_power_slander_interaction_desc
	common_interaction = yes
	filter_tags = { dynastic_cycle }

	interface_priority = 60

	is_shown = {
		scope:actor = {
			exists = var:movement_power
		}
		scope:recipient = {
			exists = var:movement_power
			this != scope:actor
		}
		situation:dynastic_cycle ?= {
			any_participant_group = {
				NOR = {
					participant_group_type = hegemon_ruler
					participant_group_type = other_rulers
				}
				participant_group_has_character = scope:actor
			}
		}
		situation:dynastic_cycle ?= {
			any_participant_group = {
				NOR = {
					participant_group_type = hegemon_ruler
					participant_group_type = other_rulers
				}
				participant_group_has_character = scope:recipient
			}
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			can_start_scheme = {
				type = celestial_movement_power_slander
				target_character = scope:recipient
			}
		}
		trigger_if = {
			limit = { scope:actor = { has_variable = no_scheming_allowed_var } }
			custom_tooltip = {
				text = no_scheming_allowed_var_tt
				scope:actor.var:no_scheming_allowed_var != scope:recipient
			}
		}
	}

	can_send = {
		scope:actor = {
			custom_description = {
				text = "character_interactions_hostile_actions_disabled_delay"
				NOT = { has_character_flag = flag_hostile_actions_disabled_delay }
			}
		}
	}

	cooldown_against_recipient = { years = 3 }

	# Scheme Starter Packages
	options_heading = schemes.t.agent_packages
	send_options_exclusive = yes
	## Balanced agents.
	send_option = {
		flag = agent_focus_balance
		current_description = celestial_movement_power_slander_interaction.tt.agent_focus_balance
	}
	## Focused on Success Chance.
	send_option = {
		flag = agent_focus_success
		current_description = celestial_movement_power_slander_interaction.tt.agent_focus_success
	}
	## Focused on Speed.
	send_option = {
		flag = agent_focus_speed
		current_description = celestial_movement_power_slander_interaction.tt.agent_focus_speed
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = celestial_movement_power_slander
				left_icon = scope:actor
				right_icon = scope:recipient
				# Success.
				if = {
					limit = { scope:agent_focus_success ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_movement_power_slander
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Success.
						AGENT_1 = agent_proponent
						AGENT_2 = agent_diplomat
						AGENT_3 = agent_eunuch
						AGENT_4 = agent_intermediary
						# Speed.
						AGENT_5 = agent_herald
					}
				}
				# Speed.
				else_if = {
					limit = { scope:agent_focus_speed ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_movement_power_slander
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Speed.
						AGENT_1 = agent_bureaucrat
						AGENT_2 = agent_political_socialite
						AGENT_3 = agent_gabbler
						AGENT_4 = agent_herald
						# Success.
						AGENT_5 = agent_diplomat
					}
				}
				# Balanced.
				else = {
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = celestial_movement_power_slander
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Success.
						AGENT_1 = agent_proponent
						AGENT_2 = agent_diplomat
						AGENT_3 = agent_eunuch
						# Speed.
						AGENT_4 = agent_gabbler
						AGENT_5 = agent_herald
					}
				}
			}
			# Scheme progress bonus from education
			education_5_scheme_progress_effect = { SKILL = diplomacy }
			stress_impact = {
				content = medium_stress_impact_gain
			}
			if = {
				limit = {
					has_relation_nemesis = scope:recipient
				}
				stress_impact = { base = major_stress_impact_loss }
			}
			else_if = {
				limit = {
					has_relation_rival = scope:recipient
				}
				stress_impact = { base = medium_stress_impact_loss }
			}
		}
	}

	auto_accept = yes

	# AI
	ai_targets = {
		ai_recipients = liege
		ai_recipients = top_liege
		ai_recipients = peer_vassals
		ai_recipients = vassals
		max = 10
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 72
		duchy = 36
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	ai_potential = {
		# Morally upright or generally content characters never slander.
		NOR = {
			any_scheme = {
				is_scheme_category = political
			}
			has_trait = honest
			has_trait = generous
			has_trait = just
			has_trait = content
			has_trait = loyal
			#has_title = title:h_china # the hegemon should rather not be doing this #LotR
		}
	}

	ai_will_do = {
		base = -50

		# Additions.
		## Weight for opinion.
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = -1
		}
		## Weight for personality.
		ai_value_modifier = {
			ai_energy = 0.25
			ai_vengefulness = 1
			ai_honor = -0.5
		}
		## Certain traits can affect likelihood directly.
		### +++ Deceitful.
		modifier = {
			add = 50
			has_trait = deceitful
		}
		### ++ Arbitrary.
		modifier = {
			add = 30
			has_trait = arbitrary
		}
		### + Vengeful.
		modifier = {
			add = 10
			has_trait = vengeful
		}
		# focus on peer vassals more than on characters in your own hierarchy
		modifier = {
			add = -20
			scope:actor = {
				OR = {
					is_vassal_or_below_of = scope:recipient
					is_liege_or_above_of = scope:recipient
				}
			}
		}
		# Factors.
		## + Do pick on people we hate.
		modifier = {
			factor = 1.5
			should_prioritise_hostile_action_against_due_to_personal_relations_trigger = {
				ACTOR = scope:actor
				RECIPIENT = scope:recipient
			}
		}
		## Don't do it on fellow movement members
		modifier = {
			factor = 0
			is_in_same_movement_as = { TARGET = scope:recipient }
		}
		## x0 Don't pick on our friends or allies.
		modifier = {
			factor = 0
			should_avoid_hostile_action_against_due_to_personal_relations_trigger = {
				ACTOR = scope:actor
				RECIPIENT = scope:recipient
			}
		}
	}
}

# Dismiss your Disciple - for Player only
break_with_disciple = {
	icon = icon_cross
	interface_priority = 50
	category = interaction_category_hostile
	common_interaction = no
	desc = break_with_disciple_desc

	is_shown = {
		scope:actor = {
			has_relation_disciple = scope:recipient
		}
	}

	auto_accept = yes

	on_accept = {
		scope:actor = {
			remove_relation_disciple = scope:recipient
		}
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = refused_to_be_elder_opinion
				opinion = -20
			}
			trigger_event = tgp_interaction_event.0032
		}
	}
}

break_with_elder = {
	icon = icon_cross
	interface_priority = 50
	category = interaction_category_hostile
	common_interaction = no
	desc = break_with_elder_desc

	is_shown = {
		scope:actor = {
			has_relation_elder = scope:recipient
		}
	}

	auto_accept = yes

	on_accept = {
		scope:actor = {
			remove_relation_elder = scope:recipient
		}
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = refused_to_be_disciple_opinion
				opinion = -50
			}
			trigger_event = tgp_interaction_event.0030
		}
	}

	ai_targets = {
		ai_recipients = scripted_relations
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 120
		duchy = 60
		kingdom = 60
		empire = 60
		hegemony = 60
	}

	ai_potential = {
		num_of_relation_elder > 0
	}

	ai_will_do = {
		base = 0

		# Opinion
		opinion_modifier = {
			who = scope:actor
			opinion_target = scope:recipient
			multiplier = -0.5
		}

		# Personal reasons
		modifier = {
			add = -50
			OR = {
				has_relation_friend = scope:recipient
				has_relation_lover = scope:recipient
			}
		}
		modifier = {
			add = 50
			has_relation_rival = scope:recipient
		}

		# Political reasons
		modifier = { # More likely to stop being a disciple if actor is a movement leader
			add = 20
			situation:dynastic_cycle ?= {
				any_participant_group = {
					var:movement_leader ?= scope:actor
				}
			}
		}
		modifier = { # Elder is no longer part of the same realm (but we ignore this if we are in the chaose phase)
			add = 20
			top_liege != scope:recipient.top_liege
			NAND = {
				any_character_situation = { situation_type = dynastic_cycle }
				situation:dynastic_cycle ?= {
					situation_current_phase = situation_dynastic_cycle_phase_chaos
				}
			}
		}
	}
}

find_elder_interaction = {
	icon = find_elder_interaction
	interface_priority = 50
	category = interaction_category_friendly
	common_interaction = no
	desc = find_elder_interaction_desc
	notification_text = tgp_interaction_event.0031.desc # Intentional
	filter_tags = { dynastic_cycle }
	custom_character_sort = { merit }
	pre_answer_yes_key = find_elder_interaction_yes_key #TODO_TGP_CD_AM: make sure this works after TIT-64165 is fixed
	pre_answer_yes_breakdown_key = find_elder_interaction_yes_key #same as above on purpose
	cooldown = { years = 1 }
	is_shown = {
		scope:actor = {
			government_allows = merit
			#exclude Hegemon if he is celestial
			# trigger_if = { #LotR
			# 	limit = {
			# 		has_title = title:h_china
			# 	}
			# 	NOT = { government_has_flag = government_is_celestial }
			# }
		}
		scope:recipient = {
			government_allows = merit
		}
	}

	is_valid_showing_failures_only = {
		custom_tooltip = {
			text = find_elder_no_eligible_character
			scope:recipient = {
				OR = {
					eligible_for_elder_trigger = {
						DISCIPLE = scope:actor
					}
					any_courtier_or_guest = {
						eligible_for_elder_trigger = {
							DISCIPLE = scope:actor
						}
					}
					trigger_if = {
						limit = {
							exists = scope:recipient.capital_province
						}
						any_pool_character = {
							province = scope:recipient.capital_province
							eligible_for_elder_trigger = {
								DISCIPLE = scope:actor
							}
						}
					}
					any_vassal = {
						eligible_for_elder_trigger = {
							DISCIPLE = scope:actor
						}
					}
				}
			}
		}
	}
	populate_recipient_list = {
		scope:recipient = {
			if = {
				limit = {
					eligible_for_elder_trigger = {
						DISCIPLE = scope:actor
					}
				}
				add_to_list = characters
			}
			every_courtier_or_guest = {
				limit = {
					eligible_for_elder_trigger = {
						DISCIPLE = scope:actor
					}
				}
				add_to_list = characters
			}
			if = {
				limit = {
					exists = scope:recipient.capital_province
				}
				every_pool_character = {
					province = scope:recipient.capital_province
					limit = {
						eligible_for_elder_trigger = {
							DISCIPLE = scope:actor
						}
					}
					add_to_list = characters
				}
			}
			every_vassal = {
				limit = {
					eligible_for_elder_trigger = {
						DISCIPLE = scope:actor
					}
				}
				add_to_list = characters
				every_pool_character = {
					province = scope:recipient.capital_province
					limit = {
						eligible_for_elder_trigger = {
							DISCIPLE = scope:actor
						}
					}
					add_to_list = characters
				}
			}
		}
	}

	auto_accept = {
		custom_description = {
			text = find_elder_interaction_secondary_recipient_decides
			subject = scope:secondary_recipient
			object = scope:actor
			value = scope:secondary_recipient.find_elder_acceptance_value
			scope:recipient != scope:secondary_recipient
		}
	}

	is_highlighted = {
		scope:actor = {
			num_of_relation_elder = 0
		}
	}

	highlighted_reason = HIGHLIGHTED_FIND_ELDER
	on_auto_accept = {
		scope:secondary_recipient = {
			trigger_event = tgp_interaction_event.0031
		}
		show_as_tooltip = {
			scope:actor = {
				set_elder_relation_effect = {
					ELDER = scope:secondary_recipient
					DISCIPLE = scope:actor
					MERIT = minor_merit_gain
				}
			}
		}
	}
	on_accept = {
		if = {
			limit = {
				scope:secondary_recipient = scope:recipient
			}
			scope:actor = { trigger_event = tgp_interaction_event.00311 }
			show_as_tooltip = {
				scope:actor = {
					set_elder_relation_effect = {
						ELDER = scope:secondary_recipient
						DISCIPLE = scope:actor
						MERIT = minor_merit_gain
					}
				}
			}
		}
		else = {
			show_as_tooltip = {
				scope:actor = {
					set_elder_relation_effect = {
						ELDER = scope:secondary_recipient
						DISCIPLE = scope:actor
						MERIT = minor_merit_gain
					}
				}
			}
		}
	}

	on_decline = {
		scope:actor = {
			add_opinion = {
				target = scope:secondary_recipient
				modifier = refused_to_be_elder_opinion
				opinion = -10
			}
		}
	}
	ai_targets = {
		ai_recipients = peer_vassals
		max = 20
	}
	ai_targets = {
		ai_recipients = situation_participant_group
		parameter = dynastic_cycle
		max = 20
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 120
		duchy = 60
		kingdom = 60
		empire = 0
		hegemony = 0
	}

	ai_potential = {
		government_allows = merit
		num_of_relation_elder = 0
	}
	ai_accept = { #has to be the same as find_elder_acceptance_value
		base = 0
		modifier = {
			add = {
				value = scope:actor.age
				subtract = scope:secondary_recipient.age
				multiply = -0.5
			}
			desc = actors_age_difference
		}
		modifier = {
			scope:actor.age >= 50
			add = -10
			desc = actors_age_old
		}
		modifier = {
			scope:actor ?= {
				num_sinful_traits > 0
			}
			add = {
				value = scope:actor.num_sinful_traits
				multiply = 10
			}
			desc = actor_has_sinful_traits
		}

		modifier = {
			scope:actor ?= {
				num_virtuous_traits > 0
			}
			add = {
				value = scope:actor.num_virtuous_traits
				multiply = 10
			}
			desc = actor_has_virtuous_traits
		}

		#modifier = { LotR
		#	scope:actor ?= {
		#		OR = {
		#			has_trait = confucian_education
		#			religion = religion:confucianism_religion
		#		}
		#	}
		#	add = 10
		#	desc = actor_has_confucian_education
		#}
		modifier = {
			scope:secondary_recipient ?= {
				num_of_relation_disciple >= {
					value = scope:secondary_recipient.disciples_limit_value
					add = -1
				}
			}
			add = -20
			desc = secondary_recipient_has_disciples
		}
		# Support your fellow movement members
		modifier = {
			scope:secondary_recipient ?= {
				is_in_same_movement_as = { TARGET = scope:actor }
			}
			add = {
				value = 10
				if = {
					limit = {
						scope:secondary_recipient ?= {
							is_in_pro_hegemon_or_hegemon_movement = yes
						}
					}
					multiply = 1.5
				}
			}
			desc = actor_and_secondary_recipient_in_same_movement
		}

		# Grand Chancellor less likely to accept if you're not high enough rank
		modifier = {
			scope:secondary_recipient.primary_title ?= {
				this = title:e_minister_chancellor
			}
			scope:actor.highest_held_title_tier < tier_kingdom
			add = -10
			desc = actors_grand_chancellor
		}
		opinion_modifier = {
			who = scope:secondary_recipient
			opinion_target = scope:actor
			multiplier = 0.5
		}
	}
	ai_will_do = {
		base = 0

		# Opinion
		opinion_modifier = {
			who = scope:actor
			opinion_target = scope:recipient
			multiplier = 0.5
		}

		# Personal reasons
		modifier = {
			add = 50
			OR = {
				has_relation_friend = scope:recipient
				has_relation_lover = scope:recipient
			}
		}
		modifier = {
			add = -50
			has_relation_rival = scope:recipient
		}

		# Political reasons
		modifier = { # More likely to pick elder if recipient is a movement leader
			add = 20
			situation:dynastic_cycle ?= {
				any_participant_group = {
					var:movement_leader ?= scope:recipient
				}
			}
		}
		modifier = { # recipient is not part of the same realm
			add = -100
			top_liege != scope:recipient.top_liege
		}
		modifier = { # recipient is very meritorious
			add = {
				value = scope:recipient.merit_level
				multiply = 10
			}
		}
	}
}
# Make a Request to Elder/Movement Leader
celestial_request_elders_support_interaction = {
	icon = icon_scheme_befriend
	interface_priority = 50
	category = interaction_category_friendly
	common_interaction = no
	desc = celestial_request_elders_support_interaction_desc

	cooldown_against_recipient = { years = 5 }
	cooldown = { years = 1 }
	
	notification_text = REQUEST_ELDERS_SUPPORT_NOTIFICATION

	is_shown = {
		scope:recipient = {
			this != scope:actor
			OR = {
				has_relation_disciple = scope:actor
				has_relation_elder = scope:actor
				has_relation_fellow_disciple = scope:actor
				AND = {
					is_any_movement_leader = yes
					is_in_same_movement_as = {
						TARGET = scope:actor
					}
				}
			}
		}
	}
	
	can_send = {
		scope:actor = {
			trigger_if = {
				limit = {
					is_ai = no
				}
				custom_tooltip = {
					text = "SELECT_VALID_OPTION"
					OR = {
						scope:request_gold ?= yes
						scope:request_score ?= yes
						scope:request_artifacts ?= yes
						scope:request_scholars ?= yes
						scope:request_maa ?= yes
						scope:request_random_knight ?= yes
						scope:request_feast ?= yes
					}
				}
			}
			trigger_else = {
				always = yes
			}
		}
	}

	#request gold
	send_option = {
		flag = request_gold
		is_valid = {
			custom_tooltip = {
				scope:recipient.gold > 20
				text = contact_list_request_interaction.request_gold_recipient_not_enough_gold
			}
			trigger_if = {
				limit = {
					scope:actor = {
						is_ai = yes
					}
				}
				scope:actor.gold < 0
				scope:recipient.gold > 300
			}
		}
	}
	#request immediate boost to score
	send_option = {
		flag = request_score
		is_valid = {
			custom_tooltip = {
				scope:recipient.influence > major_influence_value
				text = contact_list_request_interaction.request_score_recipient_not_enough_influence
			}
			custom_description = {
				scope:recipient.top_liege = scope:actor.top_liege
				text = "same_realm_as"
			}
		}
	}
	#request an artifact
	send_option = {
		flag = request_artifacts
		is_valid = {
			custom_tooltip = {
				scope:recipient = {
					any_character_artifact = {
						NOR = {
							has_variable = 1025_treasure_map
							has_variable = ungiftable
							has_variable = is_tribute_mission_artifact
							rarity = illustrious
						}
						scope:recipient = { can_benefit_from_artifact = prev }
					}
				}
				text = contact_list_request_interaction.request_artifacts_recipient_not_enough_artifacts
			}
		}
	}
	#request men-at-arms regiment
	send_option = {
		flag = request_maa
		is_valid = {
			scope:recipient = {
				is_landed_or_landless_administrative = yes
			}
			custom_tooltip = {
				scope:actor.maa_regiments_count < scope:actor.maa_regiments_max_count
				text = contact_list_request_interaction.request_maa_actor_too_many_regiments
			}
		}
	}
	#request a knight
	send_option = {
		flag = request_random_knight
		is_valid = {
			custom_tooltip = {
				text = celestial_request_elders_support_interaction.unlocked_expansion
				OR = {
					situation:dynastic_cycle ?= {
						situation_participant_group:expansion_movement = {
							participant_group_has_character = scope:actor
						}
					}
					scope:actor = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
				}
			}
			custom_tooltip = {
				scope:recipient = {
					any_knight = {
						is_ai = yes
						is_landed = no
						NOR = {
							is_spouse_of = scope:recipient
							is_close_family_of = scope:recipient
						}
					}
				}
				text = contact_list_request_interaction.request_knights_recipient_not_enough_knights
			}
		}
	}
	#request a confucian scholar
	send_option = {
		flag = request_scholars
		is_valid = {
			custom_tooltip = {
				text = celestial_request_elders_support_interaction.unlocked_advancement
				OR = {
					situation:dynastic_cycle ?= {
						situation_participant_group:advancement_movement = {
							participant_group_has_character = scope:actor
						}
					}
					scope:actor = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
				}
			}
			custom_tooltip = {
				scope:recipient = {
					any_courtier = {
						is_ai = yes
						is_landed = no
						has_trait = confucian_education
						NOR = {
							is_spouse_of = scope:recipient
							is_close_family_of = scope:recipient
						}
					}
				}
				text = contact_list_request_interaction.request_scholars_recipient_not_enough_scholars
			}
		}
	}
	#request feast
	send_option = {
		flag = request_feast
		is_shown = {
			scope:recipient = {
				is_landed_or_landless_administrative = yes
				capital_province ?= {
					squared_distance = {
						target = scope:actor.capital_province
						value < define:NTaskContract|ADVENTURER_DISTANCE_RESTRICTION
					}
				}
			}
			scope:recipient = { is_ai = yes }
		}
		is_valid = {
			scope:recipient = {
				highest_held_title_tier > tier_barony
				is_at_war = no
				is_available_adult = yes
			}
			custom_tooltip = {
				text = celestial_request_elders_support_interaction.unlocked_conservative
				OR = {
					situation:dynastic_cycle ?= {
						situation_participant_group:conservative_movement = {
							participant_group_has_character = scope:actor
						}
					}
					scope:actor = {
						is_in_pro_hegemon_or_hegemon_movement = yes
					}
				}
			}
			scope:actor = {
				custom_tooltip = {
					text = ACTIVITY_SUMMARY_COOLDOWN_HEADER
					NOT = { has_character_flag = laamp_recently_requested_feast }
				}
			}
		}
	}
	localization_values = {
		MAJOR_INFLUENCE_OPTION = scope:actor.career_score_major_total_value
		MEDIUM_INFLUENCE_OPTION = scope:actor.career_score_medium_total_value
		MINOR_INFLUENCE_OPTION = scope:actor.career_score_minor_total_value
	}

	auto_accept = {
		scope:actor = { has_usable_hook = scope:recipient }
		scope:recipient = { is_ai = yes }
	}
	on_accept = {
		scope:actor = {
			switch = {
				trigger = yes
				scope:request_feast ?= {
					scope:actor = { custom_tooltip = contact_list_request_interaction.request_feast_honor }
					scope:recipient = {
						add_opinion = {
							modifier = laamp_used_contact_opinion
							target = scope:actor
							opinion = -30
						}
						custom_tooltip = contact_list_request_interaction.request_feast
					}
					hidden_effect = {
						scope:recipient = {
							add_character_flag = {
								flag = feast_ai_override
							}
							ai_attempt_to_host_activity = activity_feast
						}
						scope:actor = {
							add_character_flag = {
								flag = laamp_recently_requested_feast
								days = 1875
							}
						}
					}
				}
				scope:request_gold ?= {
					save_scope_value_as = {
						name = requested_gold_value
						value = {
							value = scope:recipient.gold
							divide = 4
							multiply = {
								value = scope:recipient.ai_greed
								divide = -300
								add = 1
							}
							if = {
								limit = {
									scope:recipient = {
										has_any_best_good_relationship_with_character_trigger = { CHARACTER = scope:actor }
									}
								}
								multiply = 1.5
							}
							else_if = {
								limit = {
									scope:recipient = {
										has_any_moderate_good_relationship_with_character_trigger = { CHARACTER = scope:actor }
									}
								}
								multiply = 1.25
							}
							max = {
								scope:recipient.culture = {
									if = {
										limit = {
											has_cultural_era_or_later = culture_era_late_medieval
										}
										value = 250
									}
									else_if = {
										limit = {
											has_cultural_era_or_later = culture_era_high_medieval
										}
										value = 200
									}
									else_if = {
										limit = {
											has_cultural_era_or_later = culture_era_early_medieval
										}
										value = 150
									}
									else_if = {
										limit = {
											has_cultural_era_or_later = culture_era_tribal
										}
										value = 100
									}
									else = {
										value = 50
									}
								}
							}
							floor = yes
							min = 5
						}
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = contact_list_request_interaction.request_gold_tt
						left_icon = scope:actor
						right_icon = scope:recipient
						scope:actor = {
							show_as_tooltip = {
								add_gold = scope:requested_gold_value
							}
						}
						scope:recipient = {
							pay_short_term_gold = {
								target = scope:actor
								gold = scope:requested_gold_value
							}
							add_opinion = {
								modifier = laamp_used_contact_opinion
								target = scope:actor
								opinion = -40
							}
						}
					}
				}
				scope:request_maa ?= {
					custom_tooltip = contact_list_request_interaction.request_maa
					hidden_effect = {
						ep3_pick_random_maa_regiment_effect = {
							OWNER = scope:recipient
							INCLUDE_BASIC_MAA = no
							INCLUDE_SIEGE_MAA = no
						}
						send_interface_toast = {
							type = event_toast_effect_good
							title = contact_list_request_interaction.request_maa_tt
							left_icon = scope:actor
							right_icon = scope:recipient
							ep3_create_random_maa_regiment_effect = {
								OWNER = scope:actor
								SIZE = 1
							}
						}
					}
					scope:recipient = {
						add_opinion = {
							modifier = laamp_used_contact_opinion
							target = scope:actor
							opinion = -40
						}
					}
				}
				scope:request_random_knight ?= {
					scope:recipient = {
						random_knight = {
							limit = {
								is_ai = yes
								is_landed = no
								NOR = {
									is_spouse_of = scope:recipient
									is_close_family_of = scope:recipient
								}
							}
							save_scope_as = knight
						}
						add_opinion = {
							modifier = laamp_used_contact_opinion
							target = scope:actor
							opinion = -30
						}
					}
					scope:actor = {
						add_courtier = scope:knight
						scope:knight = {
							set_knight_status = force
							add_opinion = {
								modifier = recruited_me_opinion
								target = scope:actor
							}
							add_character_flag = blocked_from_leaving
							hidden_effect = {
								every_traveling_family_member = {
									save_temporary_scope_as = family_to_bring
									scope:actor = { add_courtier = scope:family_to_bring }
								}
							}
						}
					}
				}
				scope:request_scholars ?= {
					scope:recipient = {
						random_courtier = {
							limit = {
								is_ai = yes
								is_landed = no
								has_trait = confucian_education
								NOR = {
									is_spouse_of = scope:recipient
									is_close_family_of = scope:recipient
								}
							}
							save_scope_as = scholar
						}
						add_opinion = {
							modifier = laamp_used_contact_opinion
							target = scope:actor
							opinion = -30
						}
					}
					scope:actor = {
						add_courtier = scope:scholar
						scope:scholar = {
							add_opinion = {
								modifier = recruited_me_opinion
								target = scope:actor
							}
							add_character_flag = blocked_from_leaving
							hidden_effect = {
								every_traveling_family_member = {
									save_temporary_scope_as = family_to_bring
									scope:actor = { add_courtier = scope:family_to_bring }
								}
							}
						}
					}
				}
				scope:request_artifacts ?= {
					scope:recipient = {
						random_character_artifact = {
							limit = {
								NOR = {
									has_variable = 1025_treasure_map
									has_variable = ungiftable
									has_variable = is_tribute_mission_artifact
									rarity = illustrious
								}
								scope:recipient = { can_benefit_from_artifact = prev }
							}
							weight = {
								base = 1
								modifier = {
									artifact_slot_type = book
									add = 10
								}
								modifier = {
									is_equipped = no
									add = 1
								}
							}
							save_scope_as = requested_artifact
						}
						add_opinion = {
							modifier = laamp_used_contact_opinion
							target = scope:actor
							opinion = -30
						}
					}
					scope:actor = {
						scope:requested_artifact = {
							set_owner = {
								target = scope:actor
								history = {
									type = given
									actor = scope:recipient
									recipient = scope:actor
									location = scope:recipient.location
								}
							}
						}
					}
				}
				scope:request_score ?= {
					scope:recipient = {
						save_scope_value_as = {
							name = increased_career_score
							value = {
								value = career_score_medium_base_value
								multiply = scope:actor.career_score_actor_multiplier_value
							}
						}
						change_influence = {
							value = scope:increased_career_score
							multiply = -1
						}
						add_opinion = {
							modifier = laamp_used_contact_opinion
							target = scope:actor
							opinion = -30
						}
					}
					scope:actor = {
						# Update the score for the target character
						hidden_effect = {
							if = {
								limit = {
									is_military_candidate_trigger = yes
								}
								if = {
									limit = {
										has_variable = merit_military_career_score_bonus
									}
									change_variable = {
										name = merit_military_career_score_bonus
										add = scope:increased_career_score
									}
								}
								else = {
									set_variable = {
										name = merit_military_career_score_bonus
										value = scope:increased_career_score
									}
								}
							}
							else = {
								if = {
									limit = {
										has_variable = merit_civilian_career_score_bonus
									}
									change_variable = {
										name = merit_civilian_career_score_bonus
										add = scope:increased_career_score
									}
								}
								else = {
									set_variable = {
										name = merit_civilian_career_score_bonus
										value = scope:increased_career_score
									}
								}
							}
						}
						# Display the relevant information
						if = {
							limit = {
								is_military_candidate_trigger = yes
							}
							custom_tooltip = influence_meritorious_career_effect_military_actor_desc
						}
						else = {
							custom_tooltip = influence_meritorious_career_effect_civilian_actor_desc
						}
						custom_tooltip = influence_meritorious_career_effect_warning_desc
					}
				}
			}
			if = {
				limit = {
					has_usable_hook = scope:recipient
					scope:recipient = { is_ai = yes }
				}
				use_hook = scope:recipient
				custom_tooltip = contact_list_request_interaction.tt.hook_auto_used
			}
		}
		scope:recipient = {
			change_merit = {
				value = scope:actor.merit_level
				multiply = 10
				min = 10
			}
			if = {
				limit = {
					is_ai = no
				}
				set_variable = {
					name = used_for_favors
					value = yes
					years = 3
				}
			}
		}
	}
	ai_targets = {
		ai_recipients = scripted_relations
	}
	ai_targets = {
		ai_recipients = liege
	}
	ai_targets = {
		ai_recipients = situation_participant_group
		parameter = dynastic_cycle
		max = 10
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 36
		duchy = 24
		kingdom = 12
		empire = 12
		hegemony = 0
	}

	ai_potential = {
		OR = {
			num_of_relation_elder > 0
			num_of_relation_disciple > 0
			is_any_movement_leader = no
		}
	}

	ai_will_do = {
		base = 10

		# Set up the AI so that they actually know how to use the send_options.
		## Troops, if they don't have gold.
		modifier = {
			add = 50
			scope:recipient.gold < 50
			scope:request_maa = yes
		}
		## Book if you have non and they have some
		modifier = {
			add = 50
			scope:actor = {
				any_character_artifact = {
					artifact_slot_type = book
					count = 0
				}
			}
			scope:recipient = {
				any_character_artifact = {
					artifact_slot_type = book
					count >= 1
				}
			}
			scope:request_artifacts = yes
		}
		## Scholar if you have non and they have some
		modifier = {
			add = 50
			scope:actor = {
				any_courtier = {
					has_trait = confucian_education
					count = 0
				}
			}
			scope:recipient = {
				any_courtier = {
					is_landed = no
					has_trait = confucian_education
					trigger_if = {
						limit = {
							exists = scope:recipient.dynasty
						}
						NOT = { dynasty ?= scope:recipient.dynasty }
					}
					count >= 1
				}
			}
			scope:request_scholars = yes
		}
		## Don't increase score if you already have it boosted.
		modifier = {
			factor = 0
			scope:actor = {
				OR = {
					has_variable = merit_military_career_score_bonus
					has_variable = merit_civilian_career_score_bonus
				}
			}
			scope:request_score = yes
		}
		modifier = {
			factor = 0
			NOR = {
				scope:request_gold = yes
				scope:request_maa = yes
				scope:request_random_knight = yes
				scope:request_scholars = yes
				scope:request_artifacts = yes
				scope:request_feast = yes
				scope:request_score = yes
			}
		}
		# Don't spam the Player
		modifier = {
			factor = 0
			scope:recipient = {
				has_variable = used_for_favors
			}
		}
	}
	ai_accept = {
		base = -10

		opinion_modifier = { # Opinion Factor
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 0.5
			desc = AI_OPINION_REASON
		}

		modifier = {
			has_relation_disciple = scope:actor
			is_any_movement_leader = yes
			is_in_same_movement_as = {
				TARGET = scope:actor
			}	
			add = 5
			desc = AI_YOUR_ELDER
		}

		modifier = {
			add = -50
			scope:recipient = {
				has_opinion_modifier = {
					modifier = laamp_used_contact_opinion
					target = scope:actor
				}
			}
			desc = contact_list_request_interaction.repeated_request
		}

		ai_value_modifier = {
			ai_compassion = -0.5
			ai_greed = -0.5
			min = -50
			max = 50
		}

		modifier = {
			add = -30
			desc = contact_list_request_interaction.request_gold.poor_recipient
			scope:request_gold ?= yes
			scope:recipient = {
				gold < major_gold_value
			}
		}

		modifier = {
			add = 25
			desc = contact_list_request_interaction.request_gold.stewardship
			scope:request_gold ?= yes
			scope:recipient = {
				has_trait = education_stewardship
			}
		}
		modifier = {
			add = 25
			desc = contact_list_request_interaction.request_gold.learning
			OR = {
				scope:request_artifacts ?= yes
				scope:request_scholars ?= yes
			}
			scope:recipient = {
				has_trait = education_learning
			}
		}

		modifier = {
			add = 25
			desc = contact_list_request_interaction.request_gold.martial
			OR = {
				scope:request_maa ?= yes
				scope:request_random_knight ?= yes
			}
			scope:recipient = {
				has_trait = education_martial
			}
		}

		modifier = {
			add = 25
			desc = contact_list_request_interaction.request.defensive_negotiations_perk
			OR = {
				scope:request_maa ?= yes
				scope:request_random_knight ?= yes
			}
			scope:actor = {
				has_perk = defensive_negotiations_perk
			}
		}

		modifier = {
			add = 25
			desc = contact_list_request_interaction.relevant_focus
			OR = {
				scope:request_maa ?= yes
				scope:request_random_knight ?= yes
			}
			scope:recipient = {
				OR = {
					has_focus = martial_strategy_focus
					has_focus = martial_chivalry_focus
					has_focus = martial_authority_focus
				}
			}
		}
		modifier = {
			add = 25
			desc = contact_list_request_interaction.request_artifacts.plenty
			scope:request_artifacts ?= yes
			scope:recipient = {
				any_character_artifact = {
					count >= 4
				}
			}
		}

		modifier = {
			add = -25
			desc = contact_list_request_interaction.request_artifacts.little
			scope:request_artifacts ?= yes
			scope:recipient = {
				any_character_artifact = {
					count < 4
				}
			}
		}
		modifier = {
			add = 25
			desc = contact_list_request_interaction.request_scholars.plenty
			scope:request_scholars ?= yes
			scope:recipient = {
				any_courtier = {
					is_landed = no
					has_trait = confucian_education
					save_temporary_scope_as = temp_scholar
					scope:recipient = {
						any_spouse = {
							this != scope:temp_scholar
						}
						trigger_if = {
							limit = {
								exists = scope:temp_scholar.dynasty
							}
							dynasty ?= scope:temp_scholar.dynasty
						}
					}
					count > 2
				}
			}
		}

		modifier = {
			add = -25
			desc = contact_list_request_interaction.request_scholars.little
			scope:request_scholars ?= yes
			scope:recipient = {
				any_courtier = {
					is_landed = no
					has_trait = confucian_education
					save_temporary_scope_as = temp_scholar
					scope:recipient = {
						any_spouse = {
							this != scope:temp_scholar
						}
						trigger_if = {
							limit = {
								exists = scope:temp_scholar.dynasty
							}
							dynasty ?= scope:temp_scholar.dynasty
						}
					}
					count = 1
				}
			}
		}

		modifier = {
			add = 5
			desc = contact_list_request_interaction.request_score.plenty
			scope:request_score ?= yes
			scope:recipient = {
				influence > monumental_influence_value
			}
		}

		modifier = {
			add = -50
			desc = contact_list_request_interaction.request_score.little
			scope:request_score ?= yes
			scope:recipient = {
				influence <= massive_influence_value
			}
		}

		modifier = {
			add = 25
			desc = contact_list_request_interaction.request_knights.plenty
			scope:request_random_knight ?= yes
			scope:recipient = {
				number_of_knights > 6
			}
		}

		modifier = {
			add = -25
			desc = contact_list_request_interaction.request_knights.little
			scope:request_random_knight ?= yes
			scope:recipient = {
				number_of_knights <= 6
			}
		}

		modifier = {
			add = -25
			desc = contact_list_request_interaction.powerful
			scope:request_maa ?= yes
			scope:actor = {
				max_military_strength >= 400
				max_military_strength < 800
			}
		}

		modifier = {
			add = -50
			desc = contact_list_request_interaction.very_powerful
			scope:request_maa ?= yes
			scope:actor.max_military_strength >= 800
		}

		modifier = {
			add = -30
			desc = contact_list_request_interaction.stronger_than_me
			scope:request_maa ?= yes
			scope:actor.max_military_strength > scope:recipient.max_military_strength
		}
		modifier = { # Difference in merit level
			scope:actor.merit_level != scope:recipient.merit_level
			# title:h_china.holder ?= { #LotR
			# 	this != scope:actor
			# }
			add = {
				add = scope:actor.merit_level
				subtract = scope:recipient.merit_level
			}
			desc = difference_in_merit_level_reason
		}
		# Your level of influence.
		## Impotent
		modifier = {
			add = -10
			desc = AI_OPINION_INFLUENCE_LEVEL_IMPOTENT
			scope:actor.influence_level = 0
		}
		## Influential
		### Would be zero, so it wouldn't appear.
		## Persuasive
		modifier = {
			add = 10
			desc = AI_OPINION_INFLUENCE_LEVEL_PERSUASIVE
			scope:actor.influence_level = 2
		}
		## Controlling
		modifier = {
			add = 20
			desc = AI_OPINION_INFLUENCE_LEVEL_CONTROLLING
			scope:actor.influence_level = 3
		}
		## Authoritative
		modifier = {
			add = 30
			desc = AI_OPINION_INFLUENCE_LEVEL_AUTHORITATIVE
			scope:actor.influence_level = 4
		}
		## Imperious
		modifier = {
			add = 40
			desc = AI_OPINION_INFLUENCE_LEVEL_IMPERIOUS
			scope:actor.influence_level = 5
		}
		modifier = {
			add = 10
			desc = celestial_request_elders_support_interaction.request_score
			scope:actor = {
				is_landed = no
			}
			scope:request_score = yes
		}
		modifier = {
			add = 10
			desc = celestial_request_elders_support_interaction.province_military
			scope:actor = {
				vassal_contract_has_flag = celestial_military_appointment
			}
			OR = {
				scope:request_gold = yes
				scope:request_maa = yes
				scope:request_random_knight = yes
			}
		}
		modifier = {
			add = 10
			desc = celestial_request_elders_support_interaction.province_civilian
			scope:actor = {
				vassal_contract_has_flag = celestial_civil_appointment
			}
			OR = {
				scope:request_scholars = yes
				scope:request_artifacts = yes
				scope:request_feast = yes
			}
		}
		modifier = {
			add = -10
			desc = celestial_request_elders_support_interaction.province_civilian
			scope:actor = {
				vassal_contract_has_flag = celestial_civil_appointment
			}
			OR = {
				scope:request_gold = yes
				scope:request_maa = yes
				scope:request_random_knight = yes
			}
		}
		modifier = {
			add = -10
			desc = celestial_request_elders_support_interaction.province_military
			scope:actor = {
				vassal_contract_has_flag = celestial_military_appointment
			}
			OR = {
				scope:request_scholars = yes
				scope:request_artifacts = yes
				scope:request_feast = yes
			}
		}
	}
}

# Default Request Great Project Contribution
# REFERENCED BY CODE, DO NOT REMOVE OR RENAME
request_great_project_contribution_interaction = {
	special_interaction = request_great_project_contribution
	hidden = yes

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				left_icon = scope:recipient
				title = request_great_project_contribution.accept
				scope:recipient = {
					fund_great_project_contribution = {
						contribution = scope:great_project_contribution
						check_can_contribute = no
					}
				}
			}
			# Mandala Trickster
			if = {
				limit = { always = scope:mandala_serenity }
				set_variable = {
					name = mandala_serenity_force_request_cooldown
					years = mandala_serenity_force_request_cooldown_value
				}
			}
			# Admin realms
			if = {
				limit = { always = scope:offer_influence }
				scope:actor = {
					change_influence = major_influence_loss
				}
				scope:recipient = {
					change_influence = major_influence_gain
				}
			}
			# Offer Hook
			if = {
				limit = { always = scope:offer_hook }
				stress_impact = {
					base = minor_stress_impact_gain
					paranoid = major_stress_impact_gain
				}
				scope:recipient = {
					add_hook = {
						type = favor_hook
						target = scope:actor
					}
				}
			}
			# Offer Strong Hook
			if = {
				limit = { always = scope:offer_hook_strong }
				stress_impact = { base = major_stress_impact_gain }
				scope:recipient = {
					add_hook = {
						type = strong_favor_hook
						target = scope:actor
					}
				}
			}
			# Use Hook
			if = {
				limit = { always = scope:hook }
				use_hook = scope:recipient
			}
		}
		scope:recipient = {
			set_variable = {
				name = recently_contributed_via_request
				years = mandala_recently_contributed_via_request_value
			}
		}
	}

	ai_accept = {
		base = -50

		modifier = {
			add = "ai_will_do_contribution(scope:great_project_contribution)"
			desc = base_contribution_desire
		}

		#Your Radiance
		modifier = {
			scope:actor = { has_mandala_capital_trigger = yes }
			add = scope:actor.mandala_radiance_value
			desc = actor_positive_mandala_radiance
		}

		modifier = {
			scope:actor = {
				has_realm_law_flag = tributaries_more_likely_to_contribute_to_GPs
			}
			add = 25
			desc = actor_has_realm_flag_tributaries_more_likely_to_contribute
		}

		modifier = {
			scope:recipient = { has_variable = recently_contributed_via_request }
			add = -1000
			desc = recipient_recently_contributed_via_request
		}

		#Personality
		modifier = { # the greedier they are, the less likely they will agree to this
			scope:recipient = { 
				is_tributary_of = scope:actor
				ai_greed > 0 
			}
			add = {
				value = scope:recipient.ai_greed
				multiply = -1
				divide = 3
			}
			desc = TRIBUTARY_GREED_REASON
		}

		#Do they have enough gold?
		modifier = {
			scope:actor = {
				any_great_project = {
					great_project_type = mandala_capital_05
					great_project_construction_phase_is = planned
					great_project_owner = scope:actor
				}
			}
			scope:recipient = { gold <= mandala_contribution_high_gold_cost }
			add = -25
			desc = recipient_has_low_funds
		}
		modifier = {
			scope:actor = {
				any_great_project = {
					great_project_construction_phase_is = planned
					great_project_owner = scope:actor
					OR = {
						great_project_type = mandala_capital_04
						great_project_type = mandala_capital_03
					}
				}
			}
			scope:recipient = { gold <= mandala_contribution_mid_gold_cost }
			add = -25
			desc = recipient_has_low_funds
		}
		modifier = {
			scope:actor = {
				any_great_project = {
					great_project_construction_phase_is = planned
					great_project_owner = scope:actor
					OR = {
						great_project_type = mandala_capital_02
						great_project_type = mandala_capital_01
					}
				}
			}	
			scope:recipient = { gold <= mandala_contribution_low_gold_cost }
			add = -25
			desc = recipient_has_low_funds
		}

		#Dynasty Legacy
		modifier = {
			scope:actor = {
				dynasty ?= { has_dynasty_perk = tgp_sea_legacy_3 }
			}
			add = tgp_sea_legacy_gp_contribution_value
			desc = tgp_sea_legacy_tributaries_likely_to_contribute
		}

		#Are they a competing Mandala?
		modifier = {
			#Here we don't check if its ruined, if they have one then they are likely not wanting to contribute to yours even if they need to rebuild it.
			scope:recipient = { has_mandala_capital_trigger = yes }
			add = -1000
			desc = recipient_is_competing_mandala
		}

		#Differing Aspects
		modifier = {
			scope:recipient = {
				government_has_flag = government_is_mandala
				has_mandala_aspect_trigger = yes
			}
			NOT = {
				same_mandala_aspect_trigger = { FIRST_CHAR = scope:actor SECOND_CHAR = scope:recipient }
			}
			add = -15
			desc = recipient_not_same_aspect
		}

		#Are you Disbelieved?
		modifier = {
			scope:actor = { has_character_modifier = disbelieved_mandala_modifier }
			desc = is_disbelieved_mandala
			add = -25
		}

		## Paid Influence
		modifier = {
			add = 50
			scope:offer_influence ?= yes
			desc = INFLUENCE_USED
		}
		## Offer a hook on yourself.
		modifier = {
			add = 20
			scope:offer_hook ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_OFFER_HOOK
		}
		## Offer a strong hook on yourself.
		modifier = {
			add = 50
			scope:offer_hook_strong ?= yes
			exists = scope:recipient
			desc = SCHEME_WITH_OFFER_HOOK_STRONG
		}
		## Used a hook.
		modifier = {
			add = 100
			scope:hook ?= yes
			desc = SCHEME_WEAK_HOOK_USED
		}
		# Opinion
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
		}
	}

	auto_accept = {
		trigger_if = {
			limit = { scope:mandala_serenity = yes }
			custom_tooltip = {
				text = mandala_can_force_request
				always = yes
			}
		}
		trigger_else_if = {
			limit = {
				scope:hook = yes
				scope:actor = { has_strong_hook = scope:recipient }
			}
			custom_description = {
				text = "spending_hook"
				subject = scope:actor
				object = scope:recipient
				always = yes
			}
		}
		trigger_else = { always = no }
	}

	options_heading = invite_agent_to_scheme_interaction.t.options_header
	# Everyone
	## Mandala Serenity Aspect
	send_option = {
		flag = mandala_serenity
		is_shown = {
			scope:actor = {
				government_has_flag = government_is_mandala
				house ?= { has_house_head_parameter = can_force_request_contribution }
				is_house_head = yes
			}
		}
		is_valid = {
			scope:actor = {
				custom_tooltip = {
					text = mandala_serenity_force_is_on_cooldown
					NOT = { has_variable = mandala_serenity_force_request_cooldown }
				}
				custom_tooltip = {
					text = not_two_overrides
					trigger_if = {
						limit = { scope:hook = yes }
						NOT = {
							scope:actor = { has_strong_hook = scope:recipient }
						}
					}
				}
			}
		}
		localization = mandala_can_force_request
		current_description = {
			# Triggered desc so that we don't get a weird double tooltip.
			triggered_desc = {
				trigger = {
					NOT = { has_variable = mandala_serenity_force_request_cooldown }
				}
				desc = mandala_can_force_request_valid
			}
		}
	}
	## Offer Influence
	send_option = {
		flag = offer_influence
		is_shown = {
			scope:actor = { government_allows = administrative }
			scope:recipient = { government_allows = administrative }
		}
		localization = OFFER_INFLUENCE
	}
	## Offer a hook
	send_option = {
		flag = offer_hook
		is_valid = {
			custom_tooltip = {
				text = offer_hook.tt.cannot_offer_both_hooks
				scope:offer_hook_strong = no
			}
			NOT = {
				scope:recipient = { has_hook = scope:actor }
			}
		}
		localization = SCHEME_AGENT_HOOK
	}
	## Offer a strong hook
	send_option = {
		flag = offer_hook_strong
		is_valid = {
			custom_tooltip = {
				text = offer_hook.tt.cannot_offer_both_hooks
				scope:offer_hook = no
			}
			NOT = {
				scope:recipient = { has_strong_hook = scope:actor }
			}
		}
		localization = SCHEME_AGENT_HOOK_STRONG
	}
	## Use hook.
	### Strong hook is in the auto_accept block.
	send_option = {
		flag = hook
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
			custom_tooltip = {
				text = not_two_overrides
				trigger_if = {
					limit = {
						scope:actor = { has_strong_hook = scope:recipient }
					}
					scope:mandala_serenity = no
				}
			}
		}
		localization = SCHEME_HOOK_EXPLICIT
	}
	send_options_exclusive = no
}

tgp_mandala_send_missionary_interaction = {
	icon = religious
	category = interaction_category_vassal
	send_name = SEND_MISSIONARY
	desc = tgp_mandala_send_missionary_interaction_desc
	common_interaction = yes

	interface_priority = 60

	is_shown = {
		scope:actor != scope:recipient
		scope:actor = {
			government_has_flag = government_is_mandala
		}
		scope:recipient = {
			is_landed = yes
			faith != scope:actor.faith
			is_tributary_of = scope:actor
		}
	}

	is_valid_showing_failures_only = {
		# Cannot be at war
		NOT = {
			scope:actor = { is_at_war_with = scope:recipient }
		}
	}

	can_be_picked = {
		scope:recipient = {
			is_tributary_of = scope:actor
		}
	}

	cooldown = { years = 3 }
	cooldown_against_recipient = { years = 5 }

	on_accept = {
		scope:actor = {
			hidden_effect = {
				add_opinion = {
					modifier = pleased_opinion
					target = scope:recipient
					opinion = 20
				}
				# Fervor change doesn't render well in interaction interface; false entry added with custom tooltip
				faith = {
					change_fervor = {
						value = 1
						desc = fervor_gain_suzerain_missionaries
					}
				}
			}

			send_interface_toast = {
				type = event_toast_effect_good
				title = tgp_mandala_send_missionary.success
				left_icon = scope:new_missionary
				right_icon = scope:recipient

				add_piety = minor_piety_gain

				reverse_add_opinion = {
					modifier = respect_opinion
					target = scope:recipient
					opinion = 20
				}

				custom_tooltip = tgp_mandala_send_missionary_interaction_fervor_gain_tt
			}
		}
		scope:recipient = {
			custom_tooltip = tgp_mandala_send_missionary_interaction_tt
			custom_tooltip = tgp_mandala_send_missionary_interaction_cheaper_conversion_tt

			create_character = {
				age = { 25 60 }
				dynasty = none
				random_traits_list = {
					count = 1
					education_learning_2 = {}
					education_learning_3 = {}
					education_learning_4 = {}
				}
				trait = devoted
				random_traits = yes
				culture = scope:actor.culture
				faith = scope:actor.faith
				gender_female_chance = scope_actor_faith_clergy_gender_female_chance
				learning = {
					min_template_high_skill
					max_template_high_skill
				}
				employer = scope:recipient
				save_scope_as = new_missionary
				after_creation = {
					add_character_flag = suzerains_missionary
					add_character_flag = blocked_from_leaving
				}
			}
		}
	}

	on_decline = {
		scope:actor = {

			hidden_effect = {
				# Fervor change doesn't render well in interaction interface; false entry added with custom tooltip
				faith = {
					change_fervor = {
						value = -1
						desc = fervor_loss_suzerain_missionaries
					}
				}
			}

			send_interface_toast = {
				type = event_toast_effect_bad
				title = tgp_mandala_send_missionary.failure
					left_icon = scope:actor
					right_icon = scope:recipient

				add_prestige = minor_prestige_loss
				add_opinion = {
					modifier = insult_opinion
					target = scope:recipient
					opinion = -20
				}
				reverse_add_opinion = {
					modifier = disrespect_opinion
					target = scope:recipient
					opinion = -20
				}

				custom_tooltip = tgp_mandala_send_missionary_interaction_fervor_loss_tt
			}
		}
	}

	auto_accept = no

	ai_will_do = {
		base = -10

		ai_value_modifier = {
			ai_zeal = 1
			ai_compassion = -0.25
		}
		modifier = {
			scope:recipient.faith = {
				NOT = { has_doctrine = unreformed_faith_doctrine }
			}
			add = -25
		}
		modifier = {
			scope:recipient = {
				government_has_flag = government_is_tribal
			}
			add = 50
		}
		# AI will not do this if fervor is already low, don't want the AI to just needless tank fervor further
		modifier = {
			faith = {
				fervor < 35
			}
			factor = 0
		}
	}

	# AI
	ai_targets = {
		ai_recipients = vassals
		ai_recipients = tributaries
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 12
		empire = 6
		hegemony = 6
	}

	ai_potential = {
		is_adult = yes
		government_has_flag = government_is_mandala
	}

	ai_accept = {
		base = 0

		opinion_modifier = { # Opinion Factor
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 0.5
			desc = AI_OPINION_REASON
		}

		modifier = {
			add = -50
			has_trait = zealous
			desc = INTERACTION_ZEALOUS
		}

		modifier = {
			faith = {
				faith_hostility_level = {
					target = scope:actor.faith
					value > faith_astray_level
				}
			}
			add = -25
		}

		# Relations to actor
		modifier = {
			scope:actor = {
				has_relation_friend = scope:recipient
			}
			add = 25
			desc = AI_YOUR_FRIEND
		}
		modifier = {
			scope:actor = {
				has_relation_rival = scope:recipient
				NOT = { has_relation_nemesis = scope:recipient }
			}
			add = -50
			desc = AI_YOUR_RIVAL
		}
		# Rank difference.
		modifier = {
			desc = AI_REFUSAL_RANK_DIFFERENCE
			scope:recipient = {
				is_ruler = yes
				is_landed = yes
				highest_held_title_tier < tier_kingdom
			}
			add = {
				value = -10

				# Duke/Count or King/Duke suffers from malus, but King/Count at least cancels out the rank difference malus.
				if = {
					limit = {
						scope:actor = {
							tier_difference = {
								target = scope:recipient
								value >= 2
							}
						}
					}
					add = 10
				}
				# King asking count or hegemon asking duke, modifier becomes positive
				if = {
					limit = {
						scope:actor = {
							tier_difference = {
								target = scope:recipient
								value >= 3
							}
						}
					}
					add = 5
				}
				# Hegemon asking count
				if = {
					limit = {
						scope:actor = {
							tier_difference = {
								target = scope:recipient
								value >= 4
							}
						}
					}
					add = 5
				}
			}
		}
	}
}


# Force Ceremonial Abdication
force_abdication_interaction = {
	icon = force_abdication
	common_interaction = no
	interface_priority = 135
	category = interaction_category_succession
	filter_tags = { ceremonial_liege }

	cooldown = { years = 5 }

	target_type = title
	target_filter = recipient_domain_titles
	can_be_picked_title = {
		scope:target = scope:recipient.top_liege.primary_title.var:administrative_ui_special_title
	}
	has_valid_target_showing_failures_only = {
		scope:target = scope:recipient.top_liege.primary_title.var:administrative_ui_special_title
	}
	ai_targets = {
		ai_recipients = vassals
		ai_recipients = peer_vassals
		max = 1
	}

	ai_maybe = yes
	ai_min_reply_days = 4
	ai_max_reply_days = 9
	can_send_despite_rejection = yes
	popup_on_receive = yes

	greeting = negative
	notification_text = FORCE_ABDICATION_PROPOSAL

	pre_answer_yes_key = ACCEPT
	pre_answer_no_key = DECLINE

	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 180
		hegemony = 0
	}

	is_shown = {
		scope:actor != scope:recipient
		scope:recipient = {
			tgp_is_ceremonial_liege_trigger = yes
			top_liege = scope:actor.top_liege
		}
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			is_available_adult = yes
			is_incapable = no
			is_independent_ruler = yes
			is_in_civil_war = no
		}
		scope:recipient = {
			is_adult = yes
			trigger_if = {
				limit = { is_imprisoned = yes }
				imprisoner ?= scope:actor
			}
			is_in_civil_war = no
			exists = player_heir
			NOT = { has_usable_hook = scope:actor }
		}
	}

	desc = force_abdication_interaction_desc

	send_options_exclusive = no
	send_option = {
		flag = hook
		is_valid = {
			scope:actor = { has_usable_hook = scope:recipient }
			NOT = {
				scope:recipient = { has_hook = scope:actor }
			}
		}
		localization = GENERIC_SPEND_A_HOOK
	}
	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"
	send_option = {
		flag = influence
		is_valid = {
			scope:actor.influence >= massive_influence_value
			scope:recipient = { is_imprisoned = no }
		}
		localization = SPEND_INFLUENCE
	}
	send_option = {
		flag = gold
		is_valid = {
			scope:actor.gold >= scope:actor.massive_gold_value
			scope:recipient = { is_imprisoned = no }
		}
		localization = GENERIC_SPEND_GOLD
	}
	send_option = {
		flag = criminal_secret_recipient
		is_shown = {
			scope:recipient = {
				any_secret = {
					is_criminal_for = scope:recipient
					is_known_by = scope:actor
					can_be_exposed_by = scope:actor
				}
				is_imprisoned = no
			}
		}
		localization = LEVERAGE_CRIMINAL_SECRET_RECIPIENT
	}

	on_accept = {
		scope:recipient.player_heir = { save_scope_as = heir }
		scope:actor = {
			if = {
				limit = { scope:hook = yes }
				use_hook = scope:recipient
			}
			if = {
				limit = { scope:influence = yes }
				change_influence = {
					value = massive_influence_loss
					multiply = 2
				}
			}
			if = {
				limit = { scope:gold = yes }
				pay_short_term_gold = {
					target = scope:recipient
					gold = {
						value = massive_gold_value
						multiply = 2
					}
				}
			}
			if = {
				limit = { scope:criminal_secret_recipient = yes}
				scope:actor = {
					random_known_secret = {
						limit = {
							secret_owner = scope:recipient
							is_criminal_for = scope:recipient
							can_be_exposed_by = scope:actor
						}
						disable_exposure_by = scope:actor
					}
				}
			}
			add_tyranny = major_tyranny_gain
			send_interface_toast = {
				type = event_toast_effect_good
				title = force_governor_resignation_accepted_toast
				left_icon = scope:target
				right_icon = scope:recipient
				scope:recipient = {
					custom_tooltip = abdicate_target_title_tt
					if = {
						limit = { is_ai = yes }
						add_opinion = {
							target = scope:actor
							modifier = forced_my_abdication_opinion
						}
					}
					if = {
						limit = { can_set_relation_rival_trigger = { CHARACTER = scope:actor } }
						set_relation_rival = {
							target = scope:actor
							reason = rival_forced_my_abdication_reason
						}
					}
					hidden_effect = {
						create_title_and_vassal_change = {
							type = conquest
							save_scope_as = change
							add_claim_on_loss = yes
						}
						scope:recipient.top_liege.primary_title.var:administrative_ui_special_title = {
							change_title_holder_include_vassals = {
								holder = scope:recipient.primary_heir
								change = scope:change
							}
						}
						resolve_title_and_vassal_change = scope:change
					}
				}
			}
			scope:recipient = {
				if = {
					limit = {
						NOT = { has_trait = former_emperor }
					}
					add_trait = former_emperor
				}
				house ?= {
					if = {
						limit = { this != scope:actor.house }
						every_house_member = {
							custom = custom.every_house_member_recipient
							limit = {
								is_ai = yes
								this != scope:secondary_recipient
							}
							add_opinion = {
								target = scope:actor
								modifier = forced_my_house_members_abdication_opinion
							}
						}
					}
				}
			}
		}
	}

	on_decline = {
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_bad
				title = force_abdication_declined_toast
				left_icon = scope:target
				right_icon = scope:recipient
				change_influence = major_influence_loss
				add_prestige = medium_prestige_loss
				scope:recipient = {
					add_opinion = {
						target = scope:actor
						modifier = attempted_force_step_down_opinion
					}
					if = {
						limit = { can_set_relation_rival_trigger = { CHARACTER = scope:actor } }
						set_relation_rival = {
							target = scope:actor
							reason = rival_attempted_to_force_my_abdication_reason
						}
					}
				}
				if = {
					limit = { scope:criminal_secret_recipient = yes}
					scope:actor = {
						random_known_secret = {
							limit = {
								secret_owner = scope:recipient
								is_criminal_for = scope:recipient
								can_be_exposed_by = scope:actor
							}
							expose_secret = scope:actor
						}
					}
				}
			}
			scope:recipient.house ?= {
				if = {
					limit = { this != scope:actor.house }
					every_house_member = {
						custom = custom.every_house_member_recipient
						limit = {
							is_ai = yes
							this != scope:secondary_recipient
						}
						add_opinion = {
							target = scope:actor
							modifier = demanded_my_house_members_abdication_opinion
						}
					}
				}
			}
		}
	}

	auto_accept = {
		trigger_if = {
			limit = {
				scope:hook ?= yes
				scope:actor = { has_strong_hook = scope:recipient }
			}
			custom_description = {
				text = "spending_hook"
				subject = scope:actor
				object = scope:recipient
				scope:hook ?= yes
				scope:actor = { has_strong_hook = scope:recipient }
			}
		}
		trigger_else_if = {
			limit = {
				scope:recipient = {
					is_imprisoned = yes
					imprisoner ?= scope:actor
				}
			}
			custom_description = {
				text = "imprisoned"
				subject = scope:actor
				object = scope:recipient
				scope:recipient = {
					is_imprisoned = yes
					imprisoner ?= scope:actor
				}
			}
		}
		trigger_else = { always = no }
	}

	ai_accept = {
		base = 0

		# SEND OPTIONS
		modifier = {
			scope:hook = yes
			add = 30
			desc = SCHEME_WEAK_HOOK_USED
		}
		modifier = {
			desc = INFLUENCE_REASON
			scope:influence = yes
			add = {
				value = 20
				multiply = scope:actor.influence_level
				min = 5
			}
		}
		modifier = {
			desc = GOLD_REASON
			scope:gold = yes
			add = 30
		}
		modifier = {
			desc = RECIPIENT_SECRET
			scope:criminal_secret_recipient = yes
			add = 50
		}

		opinion_modifier = {
			opinion_target = scope:actor
			multiplier = 0.25
		}

		# TRAITS
		modifier = {
			scope:recipient = { has_trait = craven }
			add = 10
			desc = INTERACTION_CRAVEN
		}
		modifier = {
			scope:recipient = { has_trait = trusting }
			add = 5
			desc = INTERACTION_TRUSTING
		}
		modifier = {
			scope:recipient = { has_trait = generous }
			add = 5
			desc = INTERACTION_GENEROUS
		}
		modifier = {
			scope:recipient = { has_trait = lazy }
			add = 10
			desc = INTERACTION_LAZY
		}
		modifier = {
			scope:recipient = { has_trait = paranoid }
			add = -20
			desc = INTERACTION_PARANOID
		}
		modifier = {
			scope:recipient = { has_trait = patient }
			add = -5
			desc = INTERACTION_PATIENT
		}
		modifier = {
			scope:recipient = { has_trait = brave }
			add = -10
			desc = INTERACTION_BRAVE
		}
		modifier = {
			scope:recipient = { has_trait = greedy }
			add = -10
			desc = INTERACTION_GREEDY
		}
		modifier = {
			scope:recipient = { has_trait = ambitious }
			add = -20
			desc = INTERACTION_AMBITIOUS
		}

		# INTRIGUE COMPARISON
		modifier = {
			add = {
				value = scope:actor.intrigue
				multiply = 2
			}
			desc = INTERACTION_ACTOR_INTRIGUE
		}
		modifier = {
			add = {
				value = scope:recipient.intrigue
				multiply = -2
			}
			desc = INTERACTION_RECIPIENT_INTRIGUE
		}


		modifier = {
			OR = {
				is_healthy = no
				has_trait = wounded
				has_trait = ill
			}
			add = 50
			desc = INTERACTION_POOR_HEALTH
		}

		modifier = {
			age < 6
			add = -50
			desc = INTERACTION_RULER_TOO_YOUNG
		}

		modifier = {
			age > 30
			add = {
				value = age
				subtract = 30
			}
			desc = THEIR_AGE_REASON
		}

		modifier = {
			age > 30
			add = {
				value = age
				subtract = 30
			}
			desc = THEIR_AGE_REASON
		}

		modifier = {
			NOT = {
				player_heir ?= {
					OR = {
						is_child_of = scope:recipient
						is_grandchild_of = scope:recipient
						is_great_grandchild_of = scope:recipient
					}
				}
			}
			add = -50
			desc = INTERACTION_HEIR_NOT_MY_DESCENDENT
		}

		modifier = {
			trigger_if = {
				limit = { exists = player_heir }
				player_heir.age < 6
			}
			add = -25
			desc = INTERACTION_HEIR_TOO_YOUNG
		}

		# TODO_CD_JP_TGP AWAITING CODE SUPPORT
 		#modifier = {
 		#	exists = scope:actor.house.house_confederation
 		#	exists = scope:recipient.house.house_confederation
 		#	scope:actor.house.house_confederation != scope:recipient.house.house_confederation
 		#	add = {
 		#		value = scope:recipient.tgp_confederation_military_power
 		#		subtract = scope:actor.tgp_confederation_military_power
 		#	}
		#	desc = AI_RELATIVE_BLOC_MILITARY_POWER
 		#}

		# Relationships
		modifier = {
			add = -25
			has_any_mild_bad_relationship_with_character_trigger = { CHARACTER = scope:actor }
			desc = INTERACTION_BAD_RELATIONSHIP_WITH_ACTOR
		}

		modifier = {
			add = -50
			has_any_moderate_bad_relationship_with_character_trigger = { CHARACTER = scope:actor }
			desc = INTERACTION_BAD_RELATIONSHIP_WITH_ACTOR
		}

		modifier = {
			add = -100
			has_any_worst_bad_relationship_with_character_trigger = { CHARACTER = scope:actor }
			desc = INTERACTION_BAD_RELATIONSHIP_WITH_ACTOR
		}
	}

	ai_potential = {
		is_independent_ruler = yes
	}

	ai_will_do = {
		base = -200

		opinion_modifier = {
			who = scope:actor
			opinion_target = scope:recipient
			multiplier = -1
		}

		modifier = {
			scope:recipient.player_heir = {
				OR = {
					is_child_of = scope:actor
					is_grandchild_of = scope:actor
					is_great_grandchild_of = scope:actor
					any_spouse = {
						OR = {
							is_child_of = scope:actor
							is_grandchild_of = scope:actor
							is_great_grandchild_of = scope:actor
						}
					}
				}
			}
			add = 150
		}

		#Personality
		modifier = {
			scope:actor = { has_trait = vengeful }
			add = 10
		}

		modifier = {
			scope:actor = { has_trait = deceitful }
			add = 10
		}

		modifier = {
			scope:actor = { has_trait = honest }
			add = -10
		}

		# Relationships
		modifier = {
			add = 25
			has_any_mild_bad_relationship_with_character_trigger = { CHARACTER = scope:recipient }
		}

		modifier = {
			add = 50
			has_any_moderate_bad_relationship_with_character_trigger = { CHARACTER = scope:recipient }
		}

		modifier = {
			add = 100
			has_any_worst_bad_relationship_with_character_trigger = { CHARACTER = scope:recipient }
		}

		modifier = {
			add = -50
			has_any_mild_good_relationship_with_character_trigger = { CHARACTER = scope:recipient }
		}

		modifier = {
			add = -100
			has_any_moderate_good_relationship_with_character_trigger = { CHARACTER = scope:recipient }
		}

		modifier = {
			factor = 0
			has_any_best_good_relationship_with_character_trigger = { CHARACTER = scope:recipient }
		}
	}
}


# Create Ceremonial Claimant Faction
# (hard coded interaction - do not remove)
create_ceremonial_claimant_faction_against_interaction = {
	icon = vassal_claim_liege_title_interaction
	category = interaction_category_vassal
	interface_priority = 270
	use_diplomatic_range = no
	needs_recipient_to_open = no

	desc = create_ceremonial_claimant_faction_against_interaction_desc

	special_interaction = create_ceremonial_claimant_faction_against_interaction
	interface = create_claimant_faction_against

	redirect = {
		scope:actor.top_liege.primary_title.var:administrative_ui_special_title.holder ?= { save_scope_as = secondary_actor }
		clear_saved_scope = recipient
	}

	is_shown = {
		scope:actor = {
			tgp_realm_has_ceremonial_liege_trigger = yes
			NOT = { scope:secondary_actor ?= this }
			scope:secondary_actor.top_liege ?= top_liege
			custom_description = {
				text = "faction_can_join_create_in_another_faction"
				is_a_faction_member = no
			}
			scope:secondary_actor ?= {
				tgp_is_ceremonial_liege_trigger = yes
			}
			highest_held_title_tier > tier_barony
		}
	}

	is_valid_showing_failures_only = {
		scope:actor.top_liege.primary_title.var:administrative_ui_special_title = {
			save_temporary_scope_as = title_temp
			any_claimant = { save_temporary_scope_as = heir_temp }
		}
		scope:heir_temp ?= {
			NOR = {
				has_truce = scope:actor
				is_at_war_with = scope:actor
				has_trait = incapable
				has_strong_hook = scope:actor
			}
		}
		trigger_if = {
			limit = { exists = scope:landed_title }
			custom_description = {
				text = "claimant_faction_already_exists"
				subject = scope:landed_title
				object = scope:heir_temp
				scope:actor.top_liege = {
					NOT = {
						any_targeting_faction = {
							faction_type = ceremonial_claimant_faction
							special_character = scope:heir_temp
							special_title = scope:landed_title
						}
					}
				}
			}
		}
		scope:actor = {
			can_join_or_create_faction_against = {
				who = scope:actor.top_liege
				faction = ceremonial_claimant_faction
				check_in_a_faction = no # already checked in is_shown. Via the faction interface we'd see this twice if it fails (TIT-11380)
			}
		}
		trigger_if = {
			limit = { exists = scope:recipient }
			scope:recipient = {
				tgp_is_in_ceremonial_house_trigger = yes
				NOT = { has_trait = devoted }
				trigger_if = {
					limit = {
						scope:title_temp = {
							holder.faith = { has_doctrine = doctrine_gender_male_dominated }
							any_claimant = { is_male = yes }
						}
					}
					is_male = yes
				}
				trigger_else_if = {
					limit = {
						scope:title_temp = {
							holder.faith = { has_doctrine = doctrine_gender_female_dominated }
							any_claimant = { is_female = yes }
						}
					}
					is_female = yes
				}
				trigger_else = { always = yes }
			}
		}
	}

	on_send = {
		scope:actor = {
			top_liege.primary_title.var:administrative_ui_special_title = { save_scope_as = landed_title }
			set_variable = {
				name = claiming_title
				value = scope:landed_title
			}
			if = {
				limit = {
					can_create_faction = {
						type = ceremonial_claimant_faction
						target = scope:actor.top_liege
					}
				}
				create_faction = {
					type = ceremonial_claimant_faction
					target = scope:actor.top_liege
				}
				joined_faction = {
					set_special_character = scope:recipient
					set_special_title = scope:landed_title
				}
				scope:recipient = {
					add_to_variable_list = {
						name = ceremonial_claimant_factions
						target = scope:actor.joined_faction
					}
				}
				if = {
					limit = { this != scope:recipient }
					save_scope_as = faction_invite_from
					joined_faction = { save_scope_as = faction }
					scope:secondary_actor = { save_scope_as = faction_target }
					scope:recipient = {
						trigger_event = faction_invitation.0001
					}
				}
			}
			remove_variable = claiming_title
		}
	}

	auto_accept = yes
}

##################
# Coup Ceremonial Liege Scheme
# by Joe Parkin
##################

coup_ceremonial_liege_interaction = {
	icon = icon_scheme_claim_throne
	category = interaction_category_hostile
	interface_priority = 10

	ignores_pending_interaction_block = yes

	scheme = coup_ceremonial_liege

	send_name = START_SCHEME

	is_shown = {
		scope:actor.top_liege = scope:recipient.top_liege
		scope:actor = {  tgp_is_ceremonial_regent_trigger = yes }
		scope:recipient = {  tgp_is_ceremonial_liege_trigger = yes }
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			can_start_scheme = {
				type = coup_ceremonial_liege
				target_character = scope:recipient
			}
		}
		NOT = {
			scope:recipient = { has_strong_hook = scope:actor }
		}
	}

	desc = {
		triggered_desc = {
			trigger = {
				scope:actor = {
					can_start_scheme = {
						type = coup_ceremonial_liege
						target_character = scope:recipient
					}
				}
			}
			desc = scheme_interaction_tt_coup_ceremonial_liege_approved
		}
	}

	# Scheme Starter Packages
	options_heading = schemes.t.agent_packages
	send_options_exclusive = yes
	## Balanced agents.
	send_option = {
		flag = agent_focus_balance
		current_description = coup_ceremonial_liege_interaction.tt.agent_focus_balance
	}
	## Focused on Success Chance.
	send_option = {
		flag = agent_focus_success
		current_description = coup_ceremonial_liege_interaction.tt.agent_focus_success
	}
	## Focused on Speed.
	send_option = {
		flag = agent_focus_speed
		current_description = coup_ceremonial_liege_interaction.tt.agent_focus_speed
	}
	## Focused on Secrecy.
	send_option = {
		flag = agent_focus_secrecy
		current_description = coup_ceremonial_liege_interaction.tt.agent_focus_secrecy
	}

	on_accept = {
		scope:actor = {
			stress_impact = {
				compassionate = major_stress_impact_gain
				honest = medium_stress_impact_gain
				just = medium_stress_impact_gain
			}
		}
		scope:actor = {
			send_interface_toast = {
				title = start_coup_ceremonial_liege_interaction_notification

				left_icon = scope:actor
				right_icon = scope:recipient

				# Success.
				if = {
					limit = { scope:agent_focus_success ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = coup_ceremonial_liege
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Success.
						AGENT_1 = agent_muscle
						AGENT_2 = agent_muscle
						AGENT_3 = agent_diplomat
						# Speed.
						AGENT_4 = agent_infiltrator
						# Secrecy.
						AGENT_5 = agent_lookout
					}
				}
				# Speed.
				else_if = {
					limit = { scope:agent_focus_speed ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = coup_ceremonial_liege
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Speed.
						AGENT_1 = agent_infiltrator
						AGENT_2 = agent_footpad
						AGENT_3 = agent_planner
						# Success.
						AGENT_4 = agent_muscle
						# Secrecy.
						AGENT_5 = agent_lookout
					}
				}
				# Secrecy.
				else_if = {
					limit = { scope:agent_focus_secrecy ?= yes }
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = coup_ceremonial_liege
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Secrecy.
						AGENT_1 = agent_lookout
						AGENT_2 = agent_decoy
						AGENT_3 = agent_decoy
						# Success.
						AGENT_4 = agent_muscle
						# Speed.
						AGENT_5 = agent_infiltrator
					}
				}
				# Balanced.
				else = {
					begin_scheme_with_agents_effect = {
						SCHEME_TYPE = coup_ceremonial_liege
						TARGET_TYPE = target_character
						TARGET_SCOPE = scope:recipient
						# Success.
						AGENT_1 = agent_muscle
						AGENT_2 = agent_muscle
						# Speed.
						AGENT_3 = agent_infiltrator
						AGENT_4 = agent_planner
						# Secrecy.
						AGENT_5 = agent_lookout
					}
				}

				show_as_tooltip = {
					stress_impact = {
						honest = medium_stress_impact_gain
						just = medium_stress_impact_gain
					}
				}
			}
		}
	}

	auto_accept = yes
}

# Secretary Director ability to change their own mandates
diarch_set_own_mandate_interaction = {
	icon = icon_entrench_regency
	interface_priority = 50
	category = interaction_category_diarch
	common_interaction = no
	desc = diarch_set_own_mandate_interaction_desc

	is_shown = {
		scope:actor = {
			is_diarch_of_target = scope:recipient
		}
	}
	is_valid_showing_failures_only = {
		scope:recipient = {
			has_diarchy_active_parameter = unlock_diarch_set_own_mandate_interaction
		}
	}
	auto_accept = yes

	send_options_exclusive = yes
	send_option = {
		flag = placate_movements
		current_description = diarch_set_own_mandate_interaction.tt.placate_movements
	}
	send_option = {
		flag = promote_might
		current_description = diarch_set_own_mandate_interaction.tt.promote_might
	}
	send_option = {
		flag = promote_merit
		current_description = diarch_set_own_mandate_interaction.tt.promote_merit
	}

	on_accept = {
		scope:actor = {
			switch = {
				trigger = yes
				scope:placate_movements = {
					set_diarchy_mandate = placate_movements
				}
				scope:promote_might = {
					set_diarchy_mandate = promote_might
				}
				scope:promote_merit = {
					set_diarchy_mandate = promote_merit
				}
			}
			# tgp_activate_catalyst_against_hegemon_effect = { #LotR
			# 	HEGEMON = scope:recipient
			# 	CATALYST = catalyst_diarch_mandate
			# }
		}
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = changed_mandate_opinion
				opinion = -20
			}
			trigger_event = tgp_interaction_event.0041
		}
	}
}

# Secretary Director trains knights - basically a copy of task_contract_train_knight_interaction
diarch_train_knight_interaction = {
	category = interaction_category_diarch
	interface_priority = 120
	common_interaction = yes
	icon = icon_combat

	popup_on_receive = yes
	pause_on_receive = yes

	cooldown_against_recipient = { years = 5 }
	cooldown = { years = 1 }
	is_shown = {
		scope:actor = {
			is_diarch = yes
		}
	}

	is_valid_showing_failures_only = {
			scope:actor.liege = {
				has_active_mandate = promote_might
			}
		custom_tooltip = {
			text = diarch_train_knight_interaction.no_knights
			scope:recipient = {
				any_knight = {
					is_available_ai_adult = yes
				}
			}
		}
	}

	populate_recipient_list = {
		scope:recipient = {
			every_knight = {
				limit = {
					is_available_ai_adult = yes
				}
				add_to_list = characters
			}
		}
	}

	is_highlighted = {
		scope:actor.liege = {
			has_active_mandate = promote_might
		}
	}

	on_accept = {
		scope:secondary_recipient = {
			save_scope_as = knight
			custom_tooltip = task_contract_train_knight_interaction.tt
		}
		scope:actor = {
			trigger_event = tgp_interaction_event.0042
		}
	}

	auto_accept = yes

	ai_accept = {
		base = 100
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 12
		hegemony = 0
	}
	ai_targets = {
		ai_recipients = situation_participant_group
		parameter = dynastic_cycle
		max = 20
	}
	ai_potential = {
		is_at_war = no
		is_diarch = yes
	}
	ai_will_do = {
		base = 100 #no downside to ai trying this
	}
}

#Landless administrative can change top liege 
landless_admin_switch_non_admin_top_liege_interaction = {
	icon = icon_liege
	interface_priority = 50
	category = interaction_category_vassal
	common_interaction = yes
	desc = landless_admin_switch_non_admin_top_liege_interaction_desc
	
	is_shown = {
		scope:actor = {
			government_allows = administrative
			any_held_title = {
				count = all
				is_noble_family_title = yes
			}
			top_liege = {
				this != scope:recipient
				OR = {
					NOT = {
						has_same_government = scope:actor
					}
					AND = {
						situation:dynastic_cycle ?= {
							situation_current_phase = situation_dynastic_cycle_phase_chaos
						}
						scope:actor = {
							government_has_flag = government_is_celestial
						}
					}
				}
			}
		}
		scope:recipient = {
			has_same_government = scope:actor
			this = top_liege
		}
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			is_imprisoned = no
			is_at_war = no
		}
		scope:recipient = {
			trigger_if = {
				limit = {
					situation:dynastic_cycle ?= {
						situation_current_phase = situation_dynastic_cycle_phase_chaos
					}
					scope:actor = {
						government_has_flag = government_is_celestial
					}
				}
				custom_tooltip = {
					text = is_part_of_dynastic_cycle
					any_character_situation = {
						situation_type = dynastic_cycle
					}
				}
			}
			trigger_else = {
				custom_description = {
					text = "offer_fealty_neighboring_condition"
					subject = scope:recipient
					any_neighboring_and_across_water_top_liege_realm_owner = { this = scope:actor.top_liege }
				}				
			}
			#making sure that if this gov types got land you won't be able to swear fealty to them
			NOR = {
				government_has_flag = government_is_landless_adventurer
				government_has_flag = government_is_holy_order
				government_has_flag = government_is_mercenary
			}
		}
	}

	greeting = positive
	notification_text = OFFER_FEALTY_INTERACTION_NOTIFICATION

	ai_min_reply_days = 5
	ai_max_reply_days = 10

	ai_accept = {
		base = 50
		# MAIN
		# Heretic/Infidel modifier.
		# Tier difference modifier.
		# Dejure modifier.
		# Distant/Remote Realm modifier.

		# MINOR
		# Rivalry modifier.
		# Same Dynasty modifier.
		# Cultural/Cultural Group modifiers.
		# Claimant modifier.

		# OPINION SCALES
		# Personality modifier.
		# Compare Opinion modifier.

		modifier = { # Different faith, no pluralism.
			desc = offer_vassalization_interaction_aibehavior_differentfaith_tt
			trigger = {
				scope:actor = {
					NOR = { # Of two different faiths AND the potential vassal's faith is not pluralistic.
						faith = scope:recipient.faith
						faith = { has_doctrine = doctrine_pluralism_pluralistic }
					}
				}
			}
			add = {
				value = -25
				if = {
					limit = {
						scope:actor.faith = {
							faith_hostility_level = {
								target = scope:recipient.faith
								value >= faith_hostile_level
							}
						}
					}
					add = -10
				}
				if = {
					limit = {
						scope:actor.faith = {
							faith_hostility_level = {
								target = scope:recipient.faith
								value >= faith_evil_level
							}
						}
					}
					add = -25
				}
			}
		}

		modifier = { # They are my Rightful Liege
			desc = offer_vassalization_interaction_aibehavior_rightfulvassaltitleholder_tt
			trigger = {
				scope:recipient = { is_rightful_liege_of = scope:actor }
			}
			add = 25
		}

		# MINOR
		modifier = { # Rivalry modifier.
			desc = offer_vassalization_interaction_aibehavior_rival_tt
			trigger = {
				scope:recipient = {
					has_relation_rival = scope:actor
					NOT = { has_relation_nemesis = scope:actor }
				}
			}
			add = -10
		}
		modifier = { # Nemesis modifier.
			desc = offer_vassalization_interaction_aibehavior_nemesis_tt
			trigger = {
				scope:recipient = {
					has_relation_nemesis = scope:actor
				}
			}
			add = -50
		}
		modifier = { # Same Dynasty modifier.
			desc = offer_vassalization_interaction_aibehavior_dynasty_tt
			trigger = {
				scope:recipient = {
					dynasty = scope:actor.dynasty
				}
			}
			add = 10
		}

		modifier = { # Cultural Acceptance
			add = -5
			desc = cultural_acceptance_interaction_reason
			trigger = {
				scope:actor = {
					NOT = { has_same_culture_as = scope:recipient }
					culture = {
						cultural_acceptance = { target = scope:recipient.culture value < 50 }
					}
				}
			}
		}

		modifier = { # Same language
			add = 5
			desc = speaks_same_language_interaction_reason
			trigger = {
				scope:actor = {
					knows_language_of_culture = scope:recipient.culture
				}
			}
		}

		modifier = { # Claimant modifier.
			desc = offer_vassalization_interaction_aibehavior_claimant_tt
			trigger = {
				scope:actor.primary_title = {
					scope:recipient = {
						has_claim_on = prev
					}
				}
			}
			add = -15
		}

		# PERSONALITY
		ai_value_modifier = {
			ai_greed = 0.75
			min = 0
		}

		# OPINION INFLUENCE
		opinion_modifier = { # Compare Opinion modifier.
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 0.5
		}

		#Confederation wants same-culture rulers
		modifier = {
			add = 100
			desc = CONFEDERATION_CULTURE_REASON
			scope:recipient = {
				is_confederation_member = yes
				culture = {
					this = scope:actor.culture
				}
			}
		}
	}
	on_accept = {
		scope:actor.liege = {
			save_scope_as = former_liege
		}
		hidden_effect = {
			offer_fealty_interaction_effect = yes
		}
		scope:actor = {
			trigger_event = char_interaction.0010	
			domicile = {
				move_domicile = scope:recipient.capital_province
			}
			if = {
				limit = {
					government_has_flag = government_is_administrative
					scope:recipient = { NOT = { government_has_flag = government_is_administrative } }
				}
				custom_tooltip = will_change_from_administrative_tt
				custom_tooltip = will_lose_administrative_government_type_tt
			}
			if = {
				limit = {
					scope:recipient = {
						is_confederation_member = yes
					}
				}
				add_character_flag = {
					flag = new_confederate
					years = 3
				}
			}
		}

		scope:former_liege = {
			send_interface_message = {
				type = msg_liege_changed
				title = actor_moved_to_other_realm_title
				desc = actor_moved_to_other_realm_desc
				left_icon = scope:former_liege
				right_icon = scope:actor
				add_opinion = {
					target = scope:actor
					modifier = actor_moved_to_other_realm
				}
				show_as_tooltip = {
					offer_fealty_interaction_effect = yes
				}
			}
		}
		scope:recipient = {
			if = {
				limit = {
					has_imprisonment_reason = scope:actor
				}
				consume_imprisonment_reasons = scope:actor
			}
			if = {
				limit = {
					has_revoke_title_reason = scope:actor
				}
				consume_revoke_title_reason = scope:actor
			}
			if = {
				limit = {
					has_banish_reason = scope:actor
				}
				consume_banish_reasons = scope:actor
			}
			if = {
				limit = {
					has_execute_reason = scope:actor
				}
				consume_execute_reasons = scope:actor
			}
		}
	}
	on_decline = {
		scope:actor = {
			trigger_event = char_interaction.0011
		}
	}
	ai_will_do = {
		base = 100
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 36
		duchy = 36
		kingdom = 0
		empire = 0
		hegemony = 0
	}
	ai_targets = {
		ai_recipients = neighboring_rulers
	}
	ai_potential = {
		is_at_war = no
	}
}

censor_find_secrets_interaction = {
	icon = secret
	interface_priority = 50
	category = interaction_category_hostile
	common_interaction = yes
	desc = censor_find_secrets_interaction_desc
	
	is_shown = {
		scope:actor = {
			has_council_position = councillor_spymaster
			top_liege = {
				tgp_has_access_to_ministry_trigger = yes
			}
		}
		scope:recipient.top_liege = scope:actor.top_liege
		scope:recipient != scope:actor.top_liege
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			is_imprisoned = no
		}
		scope:recipient = {
			is_imprisoned = no
		}
	}

	auto_accept = yes

	on_accept = {
		scope:actor = {
			begin_scheme_with_agents_effect = {
				SCHEME_TYPE = celestial_minister_find_secrets_scheme
				TARGET_TYPE = target_character
				TARGET_SCOPE = scope:recipient
				# Success.
				AGENT_1 = agent_diplomat
				AGENT_2 = agent_shill
				AGENT_3 = agent_gabbler
				# Speed.
				AGENT_4 = agent_theologian
				# Secrecy.
				AGENT_5 = agent_justiciar
			}
		}
	}
	ai_will_do = {
		base = 100
		
	}
	ai_frequency_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 36 #The Censor title is empire tier
		hegemony = 0
	}
	ai_targets = {
		ai_recipients = peer_vassals
	}
	ai_potential = {
		is_at_war = no
		NOT = {
			any_scheme = {
				is_scheme_category = political
			}
		}
	}	
}
