



# Set one of your children as heir
#This interaction is referenced in code! If it's renamed you have to ping a coder
designate_heir_interaction = {
	icon = heir

	category = interaction_category_diplomacy

	desc = designate_heir_interaction_desc

	is_shown = {
		scope:actor = {
			can_designate_heir_trigger = yes
		}

		# Is candidate (recipient) valid?
		scope:recipient = {
			is_child_of = scope:actor
		}
		NOR = {
			scope:recipient = scope:actor.designated_heir
			scope:recipient = scope:actor
		}

		#trigger_if = { #LotR
		#	limit = {
		#		scope:actor = { NOT = { primary_title = title:e_byzantium } }
		#	}
		#	custom_description = {
		#		text = "dynasty_member_leads_election"
		#		scope:actor = {
		#			NAND = {
		#				primary_title = {
		#					has_title_law_flag = elective_succession_law
		#				}
		#				dynasty = primary_heir.dynasty
		#			}
		#		}
		#	}
		#}
	}

	cost = {
		prestige = {
			value = {
				if = {
					limit = { 
						scope:actor = { government_has_flag = government_is_mandala }
					}
					multiply = 0
				}
				else_if = {
					limit = {
						scope:actor = { government_has_flag = government_is_landless_adventurer }
					}
					multiply = {
						value = 0
						desc = "[adventurer|E]"
					}
				}
				else = {
					add = {
						if = {
							limit = {
								scope:actor = {
									government_allows = administrative
									any_held_title = {
										is_noble_family_title = yes
									}
								}
							}
							value = designate_heir_admin_prestige_cost
						}
						else = {
							value = designate_heir_cost
						}
						desc = BASE
					}
				}
			}
		}
		influence = {
			value = {
				add = 0
				if = {
					limit = {
						scope:actor = {
							government_allows = administrative
							any_held_title = {
								is_noble_family_title = yes
							}
						}
					}
					add = {
						value = designate_heir_admin_influence_cost
						desc = "[administrative_government|E]"
					}
				}
			}
		}
		piety = {
			value = {
				add = 0
				if = {
					limit = {
						scope:actor = { government_has_flag = government_is_mandala }
					}
					add = designate_heir_cost
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		trigger_if = {
			limit = { exists = scope:recipient }
			scope:recipient = {
				is_eunuch_trigger = no
				NOR = {
					has_trait = disinherited
					has_trait = devoted
					has_trait = order_member
					has_trait = bastard
				}
				house ?= scope:actor.house
			}
		}
		scope:actor = {
			trigger_if = {
				limit = {
					government_allows = administrative
					any_held_title = {
						is_noble_family_title = yes
					}
				}
				prestige >= designate_heir_admin_prestige_cost
				influence >= designate_heir_admin_influence_cost
				
				custom_tooltip = {
					text = valid_co_emperor_candidate_liege_trigger
					scope:recipient.top_liege = scope:actor.top_liege
				}
			}
			trigger_else_if = {
				limit = {
					NOR = { 
						government_has_flag = government_is_mandala
						government_has_flag = government_is_landless_adventurer
					}
				}
				prestige >= designate_heir_cost
			}
			trigger_else = {}
			trigger_if = {
				limit = {
					government_has_flag = government_is_landless_adventurer
					exists = scope:recipient
				}
				scope:recipient = {
					is_adult = yes
				}
			}
			trigger_if = {
				limit = {
					government_has_flag = government_is_mandala
				}
				piety >= designate_heir_cost
			}
			custom_tooltip = {
				text = designate_heir_interaction.tt.currently_coruling
				NOT = { has_diarchy_active_parameter = diarchy_is_co_rulership }
			}
		}
		NOT = { #Tamska don't get the choice! - LotR
			has_title = title:d_tamska_main
		}
	}

	on_auto_accept = {
		scope:recipient = {
			trigger_event = char_interaction.0120
		}
	}

	on_accept = {
		scope:actor = {
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = designate_heir_interaction_notification

				left_icon = scope:actor					
				right_icon = scope:recipient

				set_designated_heir = scope:recipient
			}
		}
	}

	auto_accept = yes
}
