lotr_orc_ruler_appoint_second_in_command_interaction = {
	category = interaction_category_diplomacy
	common_interaction = yes
	icon = icon_dismiss_temporary_regency

	desc = lotr_orc_ruler_appoint_second_in_command_interaction_desc

	###
	### The below commented out code is something to consider, especially for the AI
	### Essentially, allows us to curate the list according to very specific triggers
	###

	# # Everyone sorted into the list 'characters' has
	# # the potential of being shown to be selected.
	# #
	# # Uses the scopes actor, recipient,
	# # secondary_actor and secondary_recipient.
	# populate_recipient_list = { sort_co_emperor_candidates_to_list_effect = yes }

	is_shown = {
		# The obvious.
		NOT = { scope:actor = scope:recipient }
		scope:actor = { lotr_may_appoint_heir_to_orc_realm_trigger = yes }
	}

	is_valid = {
		scope:recipient = {
			is_lotr_adult = yes
			is_diarch = no
			OR = {
				is_courtier_of = scope:actor
				is_vassal_or_below_of = scope:actor
				is_spouse_of = scope:actor
			}
			trigger_if = {
				limit = { is_landed = yes }
				highest_held_title_tier > tier_barony
			}
		}
	}

	is_valid_showing_failures_only = {
		# Basic requirements must be fulfilled.
		scope:actor = {
			trigger_if = {
				limit = { exists = diarch }
				custom_tooltip = {
					text = lotr_orc_same_character_as_second_in_command
					NOT = { diarch = scope:recipient }
				}
			}
		}
	}
	
	on_accept = {
		scope:actor = {
			if = {
				limit = { 
					exists = diarch
					NOT = { diarch = scope:recipient }
				}
				diarch = {
					add_opinion = {
						target = scope:actor
						modifier = lotr_orc_removed_me_as_second_in_command_modifier
					}
					progress_towards_rival_effect = {
						REASON = lotr_orc_removed_me_as_second_in_command_modifier_reason
						CHARACTER = scope:actor
						OPINION = -50 #Opinion value of lotr_orc_removed_me_as_second_in_command_modifier
					}
				}
			}
			try_start_diarchy = lotr_orc_second_in_command
			set_diarch = scope:recipient
			# We set them to be our designated heir.
			## First grabbing the old one for opinions.
			designated_heir ?= {
				if = {
					limit = { this != scope:recipient }
					# Nab them for use further on.
					save_scope_as = old_heir
				}
			}
			## Then overwriting.
			set_designated_heir_unsafe = scope:recipient
		}
	}
	
	auto_accept = yes

	# AI
	ai_targets = {
		ai_recipients = courtiers
		max = 10
	}
	ai_targets = {
		ai_recipients = vassals
		max = 10
	}
	
	ai_targets = {
		ai_recipients = dynasty
		max = 10
	}
	
	ai_targets = {
		ai_recipients = family
		max = 10
	}
	
	ai_targets = {
		ai_recipients = spouses
	}

	is_available = { government_has_flag = may_appoint_second_in_command }

	ai_will_do = {
		# You never _don't_ want to do this.
		base = 1000
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 12
		duchy = 12
		kingdom = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
		empire = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
		hegemony = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
	}
}

lotr_orc_ruler_dismiss_second_in_command_interaction = {
	category = interaction_category_diplomacy
	common_interaction = yes
	icon = icon_dismiss_temporary_regency

	desc = liege_dismiss_temporary_regency_interaction_desc


	is_shown = {
		# The obvious.
		NOT = { scope:actor = scope:recipient }
		# Diarchy checks for scope:actor.
		scope:actor = {
			# If you're not in a diarchy, we don't care.
			exists = diarch
			diarch = scope:recipient
			# With the extra consideration that we only want this to appear for Temporary Regencies.
			# has_diarchy_parameter = can_be_instantly_dismissed
		}
	}

	is_valid_showing_failures_only = {
		# Basic requirements must be fulfilled.
		scope:actor = { can_leave_diarchy_trigger = yes }
	}
	
	on_accept = {
		scope:actor = {
			diarch = {
				add_opinion = {
					target = scope:actor
					modifier = lotr_orc_removed_me_as_second_in_command_modifier
				}
				progress_towards_rival_effect = {
					REASON = lotr_orc_removed_me_as_second_in_command_modifier_reason
					CHARACTER = scope:actor
					OPINION = -50 #Opinion value of lotr_orc_removed_me_as_second_in_command_modifier
				}
			}
			# Tell scope:recipient what's up.
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = liege_dismiss_temporary_regency_interaction.tt.recipient_notification
				left_icon = scope:actor
				# End the diarchy.
				end_diarchy = yes
			}
		}
		scope:actor = { ### Set a new fallback heir
			if = {
				limit = { any_child = { count > 0 } }
				ordered_child = {
					limit = { 
						is_alive = yes 
						NOT = { is_player_heir_of = scope:actor }
					}
					order_by = age
					save_scope_as = new_heir
				}
			} else_if = {
				limit = { any_sibling = { count > 0 } }
				ordered_sibling = {
					limit = { 
						is_alive = yes 
						NOT = { is_player_heir_of = scope:actor }
					}
					order_by = age
					save_scope_as = new_heir
				}
			} else_if = {
				limit = { any_dynasty_member = { count > 0 } }
				ordered_dynasty_member = {
					limit = { 
						is_alive = yes 
						NOT = { is_player_heir_of = scope:actor }
					}
					order_by = age
					save_scope_as = new_heir
				}
			} else = {
				ordered_courtier = {
					limit = { is_alive = yes is_lotr_adult = yes }
					order_by = martial
					save_scope_as = new_heir
				}
			}

			if = {
				limit = { exists = scope:new_heir }
				set_designated_heir_unsafe = scope:new_heir
			}
		}
	}
	
	auto_accept = yes

	# AI
	ai_targets = { ai_recipients = diarch }
	ai_frequency = 24
	ai_potential = { has_active_diarchy = yes }

	ai_will_do = {
		# You never _don't_ want to do this.
		base = 1000
	}
}
