lotr_orc_ruler_appoint_second_in_command_interaction = {
	category = interaction_category_diplomacy
	common_interaction = yes
	icon = icon_dismiss_temporary_regency

	desc = lotr_orc_ruler_appoint_second_in_command_interaction_desc

	is_shown = {
		# The obvious.
		scope:actor = { is_valid_designated_heir = scope:recipient }
		scope:actor = { is_landed = yes }
		NOT = { scope:actor = scope:recipient }
		scope:actor = { lotr_may_appoint_heir_to_orc_realm_trigger = yes }
	}

	is_valid = {
		scope:actor = { #Can't appoint any grandpas/grandmas to be your heir.
			NOT = { any_ancestor = { this = scope:recipient } }
		}
		custom_tooltip = {
			text = lotr_orc_ruler_appoint_second_in_command_interaction_round_robin_trigger
			lotr_check_heirs_for_round_robin = yes
		}
		
		scope:recipient = {
			is_lotr_adult = yes
			is_diarch = no
			OR = {
				is_courtier_of = scope:actor
				is_vassal_or_below_of = scope:actor
				is_spouse_of = scope:actor
			}
			NOT = { is_at_war_with = scope:actor }
		}
	}

	is_valid_showing_failures_only = {
		# Basic requirements must be fulfilled.
		scope:actor = {
			trigger_if = {
				limit = { exists = diarch }
				custom_tooltip = {
					text = lotr_orc_same_character_as_second_in_command
					NOT = { diarch = scope:recipient }
				}
			}
		}
	}
	
	on_accept = {
		scope:actor = {
			if = {
				limit = { 
					exists = diarch
					NOT = { diarch = scope:recipient }
				}
				diarch = {
					add_opinion = {
						target = scope:actor
						modifier = lotr_orc_removed_me_as_second_in_command_modifier
					}
					progress_towards_rival_effect = {
						REASON = lotr_orc_removed_me_as_second_in_command_modifier_reason
						CHARACTER = scope:actor
						OPINION = -50 #Opinion value of lotr_orc_removed_me_as_second_in_command_modifier
					}
				}
			}
			try_start_diarchy = lotr_orc_second_in_command
			set_diarch = scope:recipient
			# We set them to be our designated heir.
			## First grabbing the old one for opinions.
			designated_heir ?= {
				if = {
					limit = { this != scope:recipient }
					# Nab them for use further on.
					save_scope_as = old_heir
				}
			}
			## Then overwriting.
			set_designated_heir_unsafe = scope:recipient
		}
	}
	
	auto_accept = yes

	# AI
	ai_targets = {
		ai_recipients = courtiers
		max = 10
	}
	ai_targets = {
		ai_recipients = vassals
		max = 10
	}
	
	ai_targets = {
		ai_recipients = dynasty
		max = 10
	}
	
	ai_targets = {
		ai_recipients = family
		max = 10
	}
	
	ai_targets = {
		ai_recipients = spouses
	}

	is_available = { government_has_flag = may_appoint_second_in_command }

	ai_will_do = {
		# You never _don't_ want to do this.
		base = 1000
	}

	ai_frequency_by_tier = {
		barony = 0
		county = 12
		duchy = 12
		kingdom = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
		empire = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
		hegemony = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
	}
}

lotr_orc_ruler_dismiss_second_in_command_interaction = {
	category = interaction_category_diplomacy
	common_interaction = yes
	icon = icon_dismiss_temporary_regency

	desc = liege_dismiss_temporary_regency_interaction_desc


	is_shown = {
		# The obvious.
		NOT = { scope:actor = scope:recipient }
		# Diarchy checks for scope:actor.
		scope:actor = {
			# If you're not in a diarchy, we don't care.
			exists = diarch
			diarch = scope:recipient
			# With the extra consideration that we only want this to appear for Temporary Regencies.
			# has_diarchy_parameter = can_be_instantly_dismissed
		}
	}

	is_valid_showing_failures_only = {
		# Basic requirements must be fulfilled.
		scope:actor = { can_leave_diarchy_trigger = yes }
	}
	
	on_accept = {
		scope:actor = {
			diarch = {
				progress_towards_rival_effect = {
					REASON = lotr_orc_removed_me_as_second_in_command_modifier_reason
					CHARACTER = scope:actor
					OPINION = -50 #Opinion value of lotr_orc_removed_me_as_second_in_command_modifier
				}
			}
			# Tell scope:recipient what's up.
			send_interface_toast = {
				type = event_toast_effect_neutral
				title = liege_dismiss_temporary_regency_interaction.tt.recipient_notification
				left_icon = scope:actor
				# End the diarchy.
				end_diarchy = yes
			}
		}
		scope:actor = { ### Set a new fallback heir
			clear_designated_heir = yes
		}
	}
	
	auto_accept = yes

	# AI
	ai_targets = { ai_recipients = diarch }
	ai_potential = { has_active_diarchy = yes }
	
	ai_frequency_by_tier = {
		barony = 0
		county = 12
		duchy = 12
		kingdom = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
		empire = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
		hegemony = 6 #We expect these second in commands to uhhh... die due to... accidents ;)
	}

	ai_will_do = {
		# You don't really want to do this.
		base = -20

		modifier = { #If their martial is lower... we want someone strong inheriting our relma
			add = 10
			scope:recipient.martial < scope:actor.martial
		}
		modifier = { #If their prowess is lower... we want someone strong inheriting our relma
			add = 10
			scope:recipient.prowess < scope:actor.prowess
		}
		modifier = { #If their intrigue is lower... we want someone strong inheriting our relma
			add = 5
			scope:recipient.intrigue < scope:actor.intrigue
		}
		modifier = { #If their learning is lower... we want someone strong inheriting our relma
			add = 2
			scope:recipient.learning < scope:actor.learning
		}
		modifier = { #If they're older than us... we want someone that will ideally live throughout our reign
			add = 5
			scope:recipient.age > scope:actor.age
		}
		modifier = { #If they're older than us... we want someone that will ideally live throughout our reign
			add = 5
			scope:recipient.age > scope:actor.age
		}
		modifier = { #If their dread is lower than ours... we want someone that will make other orcs fear them
			add = 5
			scope:recipient.dread < scope:actor.dread
		}
		modifier = { #I'm rivals with my second-in-command
			add = 15
			has_relation_rival = scope:recipient
		}
		modifier = { #I'm nemesis with my second-in-command
			add = 30
			has_relation_nemesis = scope:recipient
		}
		modifier = { #I'm friend of my second-in-command
			add = -5
			has_relation_friend = scope:recipient
		}
		modifier = { #I'm best friends/blood brother with my second-in-command
			add = -10
			OR = {
				has_relation_best_friend = scope:recipient
				has_relation_blood_brother = scope:recipient
			}
		}
		opinion_modifier = { # Opinion Factor
			opinion_target = scope:recipient
			multiplier = -1
		}
	}
}
