elven_hope_situation = {

	window = situation
	gui_window_name = "lotr_window_elven_hope_situation"
	map_mode = sub_regions
	is_unique = yes # Only exists once
	migration = no
	illustration = "gfx/interface/illustrations/event_story/elven_hope_situation.dds"
	situation_group_type = major
	
	### Regions ###
	sub_regions = {
		rivendell_lorien = { # Rivendell, Lothlórien, Imladris, Misty Mountains, Anduin Vale - >"lorien"
			icon = "gfx/interface/icons/situations/elven_hope/imladris_lorien.dds"
			map_color = { 100 52 25 }
			geographical_regions = { middleearth_west_rhovanion_lothlorien middleearth_west_eregion middleearth_mountains_misty middleearth_west_rhovanion_anduin } 
		}
		lindon = { # Lindon -> "lindon"
			icon = "gfx/interface/icons/situations/elven_hope/lindon.dds"
			map_color = { 205 169 0 }
			geographical_regions = { middleearth_west_beleriand middleearth_mountains_blue } 
		}
		lasgalen = { # Greenwood -> #"greenwood"
			icon = "gfx/interface/icons/situations/elven_hope/greenwood.dds"
			map_color = { 33 99 32 }
			geographical_regions = { middleearth_west_rhovanion_mirkwood }
		}
		nelornieth = { # Nelornieth and Rhûn -> "nelornieth"
			icon = "gfx/interface/icons/regimenttypes/nuinevari.dds"
			map_color = { 240 175 10 }
			geographical_regions = { middleearth_rhun_dorwinion middleearth_rhun_seaofrhun middleearth_rhun_nurunkizdin }
		}
		thani_hazad = { # Thani-Hazad -> "drel"
			icon = "gfx/interface/icons/regimenttypes/greenwood_swordsmen.dds"
			map_color = { 22 77 155 }
			geographical_regions = { middleearth_uttersouth_thanihazad middleearth_mountains_yellow_west }
		}
		utter_south = { # Mumakan/Usakan/Mag-Tumag/Shayn -> "kinnlai"
			icon = gfx/interface/icons/regimenttypes/cuind_skirmishers.dds
			map_color = { 12 105 84 }
			geographical_regions = {
				middleearth_uttersouth_mumakan
				middleearth_uttersouth_usakan
				middleearth_uttersouth_twinkingdoms
				middleearth_uttersouth_shayn
			}
		}
		# western_rhovanion = { # Anduin Vale, Rohan, Isengard -> anduinvale~~ currently unused 
			# icon = gfx/interface/icons/regimenttypes/falathrim_haven_guard.dds
			# map_color = { 197 232 8 }
			# geographical_regions = { middleearth_west_rhovanion_anduin middleearth_west_isengard middleearth_west_rohan }
		# }
		eriador = { # Eriador, Enedhwaith, and Angmar -> eriador
			icon = gfx/interface/icons/regimenttypes/arnorian_soldiers.dds
			map_color = { 123 217 172 }
			geographical_regions = { middleearth_west_arnor middleearth_forodwaith middleearth_west_enedhwaith }
		}
		eastern_rhovanion = { # Eastern Rhovanion and Northern Mountains -> rhovanion
			icon = gfx/interface/icons/regimenttypes/gilded_guard.dds
			map_color = { 173 49 19 }
			geographical_regions = { middleearth_west_rhovanion_brownlands middleearth_west_rhovanion_dalelands middleearth_mountains_iron }
		}
		gondor = { # Gondor, Rohan, White Mountains -> gondor
			icon = gfx/interface/icons/regimenttypes/citadel_guard.dds
			map_color = { 33 44 122 }
			geographical_regions = { middleearth_west_gondor middleearth_mountains_white middleearth_west_isengard middleearth_west_rohan }
		}
		bay_of_ormal = { # Sirayn/Khy/Yellows -> ormal
			icon = gfx/interface/icons/regimenttypes/galadhrim_warriors.dds
			map_color = { 176 104 10 }
			geographical_regions = { middleearth_harad_bayoformal middleearth_mountains_yellow_east }
		}
		bay_of_tulwang = { # Bay of Tulwang -> sumarieth
			icon = gfx/interface/icons/regimenttypes/galadhrim_sentinels.dds
			map_color = { 88 17 29 }
			geographical_regions = { 
				middleearth_harad_far_bellakar_central
				middleearth_harad_far_tulwang
				middleearth_harad_far_ray
			}
		}
		haradwaith = { # Haradwaith -> haradwaith
			icon = gfx/interface/icons/regimenttypes/haradrim_raiders.dds
			map_color = { 227 225 157 }
			geographical_regions = { 
				middleearth_harad_dunesea
				middleearth_harad_near
				middleearth_harad_far_bellakar_bayoffelaya
			}
		}
		mordor = { # Mordor & Khand -> mordor
			icon = gfx/interface/icons/regimenttypes/unburied_wights.dds
			map_color = { 100 50 170 }
			geographical_regions = { middleearth_mordor middleearth_rhun_khand }
		}
	}
	
	### Participants ###
	participant_groups = {
		elven_rulers_capital = {
			icon = gfx/interface/icons/situations/elven_hope/elven_rulers_capital.dds
			require_capital_in_sub_region = yes
			is_character_valid = {
				OR = {
					has_government = elven_government
					has_character_flag = is_saruman_good 
				}
				highest_held_title_tier >= tier_county
			}

			on_join = {
				if = {
					limit = {
						is_ai = no
						NOT = { has_variable = elven_hope_0001_var }
					}
					trigger_event = elven_hope.0001
				}
				trigger_event = elven_hope.0002
			}

			map_color = { 255 127 80 }
		}
		
		elven_rulers_realm = {
			icon = gfx/interface/icons/situations/elven_hope/elven_rulers_partial.dds
			require_capital_in_sub_region = no
			require_realm_in_sub_region = yes
			is_character_valid = {
				OR = {
					has_government = elven_government
					has_character_flag = is_saruman_good 
				}
				highest_held_title_tier >= tier_county
				is_good_undying = yes
			}

			on_join = {
				if = {
					limit = {
						is_ai = no
						NOT = { has_variable = elven_hope_0001_var }
					}
					trigger_event = elven_hope.0001
				}
			}

			map_color = { 255 127 80 }
		}
		
		elven_rulers_laamps = {
			icon = gfx/interface/icons/situations/elven_hope/elven_laamps.dds
			require_domicile_in_sub_region = yes
			is_character_valid = {
				has_government = landless_adventurer_government
				OR = {
					is_elf = yes 
					is_istari = yes 
				}
				# domicile.domicile_location.county.holder = { is_elf = yes }
			}
			map_color = { 235 213 52 }

			on_join = {
				if = {
					limit = {
						is_ai = no
						NOT = { has_variable = elven_hope_0001_var }
					}
					trigger_event = elven_hope.0001
				}
				trigger_event = elven_hope.0002
			}
		}
	}

	### On Actions ###
	on_monthly = {
		update_lorien_phase_effect = yes
		update_lindon_phase_effect = yes
		update_greenwood_phase_effect = yes
		update_ormal_phase_effect = yes
		update_kinnlai_phase_effect = yes
		update_drel_phase_effect = yes
		update_sumarieth_phase_effect = yes
		update_haradwaith_phase_effect = yes
		update_nelornieth_phase_effect = yes
		update_rhovanion_phase_effect = yes
		#update_anduinvale_phase_effect = yes
		update_eriador_phase_effect = yes
		update_gondor_phase_effect = yes 
		update_mordor_phase_effect = yes
		remove_excess_hope_effect = yes # Hope cannot exceed 1000 
		cap_hope_at_zero_effect = yes # Hope cannot go below 0
	}
	
	on_yearly = {
		check_elven_development_penalties_effect = yes # Dev penalty if low hope
		check_evil_rulers_per_subregion_effect = yes # Hope penalty for every evil county in your subregion
		every_situation_sub_region = { # Get a random event once per year
			every_situation_sub_region_participant = {
				limit = { 
					exists = capital_province 
					is_ai = no # Gets too much out of control if the AI also gets random events all the time
				}
				trigger_event = {# Random 
					on_action = elven_hope_pulse_events
					days = { 80 260 } 
				}
			}
		}
		#elven_hope_trickle_effect = yes
		# title:c_mithrhulond.holder = {
			# if = { limit = { is_elf = yes } }
			# trigger_event = elven_hope.0032
		# }
	}
	
	### Phases ###
	start_phase = situation_elven_waning
	
    phases = { # Fading, Waning, Enduring, Renewing, Thriving
		
		situation_elven_fading = {
			icon =gfx/interface/icons/situations/elven_hope/elven_phase_fading.dds

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_waning = {

				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_subject.dds

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = -20
							defender_advantage = 15
						}
						parameters = {
							elven_hope_very_many_sail_west = yes
							elven_hope_very_high_dev_penalty = yes
							elven_hope_no_colonization = yes
							elven_hope_no_vanquish_darkness = yes 
							elven_hope_slowest_conversion = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_military.dds
					
					elven_rulers_capital = {
						character_modifier = {
							men_at_arms_recruitment_cost = 0.2
							men_at_arms_maintenance = 0.2
							men_at_arms_limit = -3
							levy_reinforcement_rate = -0.2
						}
						county_modifier = {
							additional_fort_level = 7
							defender_holding_advantage = 12
							hostile_raid_time = 0.5
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_character.dds
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 1
							domain_limit_max = 2
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							development_growth_factor = -0.1
						}
					}
				}
			}
		}
		situation_elven_waning = {
			icon =gfx/interface/icons/situations/elven_hope/elven_phase_waning.dds

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_fading = {
				}
				situation_elven_enduring = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_subject.dds

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = -10
							defender_advantage = 10
						}
						parameters = {
							elven_hope_many_sail_west = yes
							elven_hope_high_dev_penalty = yes
							elven_hope_no_colonization = yes
							elven_hope_vanquish_darkness_county = yes
							elven_hope_slow_conversion = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_military.dds
					
					elven_rulers_capital = {
						character_modifier = {
							men_at_arms_recruitment_cost = 0.1
							men_at_arms_maintenance = 0.05
							men_at_arms_limit = -2
							knight_limit = 2
							levy_reinforcement_rate = -0.1
						}
						county_modifier = {
							additional_fort_level = 7
							defender_holding_advantage = 12
							hostile_raid_time = 0.5
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_character.dds
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 3
							domain_limit_max = 3
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							development_growth_factor = -0.05
							monthly_county_control_growth_factor = 0.05
						}
					}
				}
			}
		}
		situation_elven_enduring = {
			icon =gfx/interface/icons/situations/elven_hope/elven_phase_enduring.dds

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_waning = {
				}
				situation_elven_renewing = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_subject.dds

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = 10
							defender_advantage = 10
							vassal_tax_contribution_add = 0.05
							vassal_levy_contribution_add = 0.05
						}
						parameters = {
							elven_hope_few_sail_west = yes
							elven_hope_moderate_dev_penalty = yes
							elven_hope_colonization_enabled = yes
							elven_hope_vanquish_darkness_duchy = yes
							elven_hope_normal_conversion = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_military.dds
					
					elven_rulers_capital = {
						character_modifier = {
							counter_resistance = 0.10
							men_at_arms_recruitment_cost = 0.1
							men_at_arms_maintenance = -0.1
							knight_limit = 2
							men_at_arms_limit = -1
						}
						county_modifier = {
							additional_fort_level = 5
							defender_holding_advantage = 10
							hostile_raid_time = 0.5
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_character.dds
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 5
							domain_limit_max = 4
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							monthly_county_control_growth_factor = 0.1
						}
					}
				}
			}
		}
		situation_elven_renewing = {
			icon =gfx/interface/icons/situations/elven_hope/elven_phase_renewing.dds

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_enduring = {
				}
				situation_elven_thriving = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_subject.dds

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = 15
							defender_advantage = 8
							vassal_tax_contribution_add = 0.05
							vassal_levy_contribution_add = 0.05
						}
						parameters = {
							elven_hope_very_few_sail_west = yes
							elven_hope_low_dev_penalty = yes
							elven_hope_colonization_enabled = yes
							elven_hope_vanquish_darkness_tributary = yes
							elven_hope_fast_conversion = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_military.dds
					
					elven_rulers_capital = {
						character_modifier = {
							counter_resistance = 0.10
							men_at_arms_recruitment_cost = 0.05
							men_at_arms_maintenance = -0.2
							men_at_arms_limit = 1
							knight_limit = 3
							levy_reinforcement_rate = 0.1
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_character.dds
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 5
							domain_limit_max = 5
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							development_growth_factor = 0.05
							monthly_county_control_growth_factor = 0.15
						}
					}
				}
			}
		}
		situation_elven_thriving = {
			icon =gfx/interface/icons/situations/elven_hope/elven_phase_thriving.dds

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_renewing = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_subject.dds

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = 30
							defender_advantage = 10
							vassal_tax_contribution_add = 0.1
							vassal_levy_contribution_add = 0.1
						}
						parameters = {
							elven_hope_none_sail_west = yes
							elven_hope_no_dev_penalty = yes
							elven_hope_colonization_enabled = yes
							elven_hope_vanquish_darkness_kindgom = yes
							elven_hope_vanquish_darkness_tributary = yes
							elven_hope_fastest_conversion = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_military.dds
					
					elven_rulers_capital = {
						character_modifier = {
							counter_resistance = 0.25
							men_at_arms_maintenance = -0.3
							men_at_arms_limit = 2
							knight_limit = 4
							levy_reinforcement_rate = 0.2
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon =gfx/interface/icons/situations/situation_modifier_character.dds
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 10
							domain_limit_max = 6
						}
					}
					elven_rulers_capital = {
						character_modifier = {
							development_growth_factor = 0.1
							monthly_county_control_growth_factor = 0.2
						}
					}
				}
			}
		}
    }
}
