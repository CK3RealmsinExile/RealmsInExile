elven_hope_situation = {

	#window = elven_hope_situation
	gui_window_name = "lotr_window_elven_hope_situation"
	map_mode = sub_regions
	is_unique = yes # Only exists once
	migration = no
	
	### Regions ###
	sub_regions = {
		rivendell_lorien = { # Rivendell, Lothlórien, Imladris, Misty Mountains - >"lorien"
			icon = "gfx/interface/icons/situations/elven_hope/imladris_lorien.dds"
			map_color = { 100 52 25 }
			geographical_regions = { middleearth_west_rhovanion_lothlorien middleearth_west_eregion middleearth_mountains_misty } 
		}
		lindon = { # Lindon -> "lindon"
			icon = "gfx/interface/icons/situations/elven_hope/lindon.dds"
			map_color = { 205 169 0 }
			geographical_regions = { middleearth_west_beleriand middleearth_mountains_blue } 
		}
		lasgalen = { # Greenwood -> #"greenwood"
			icon = "gfx/interface/icons/situations/elven_hope/greenwood.dds"
			map_color = { 10 47 202 }
			geographical_regions = { middleearth_west_rhovanion_mirkwood }
		}
		nelornieth = { # Nelornieth and Rhûn -> "nelornieth"
			icon = "gfx/interface/icons/regimenttypes/nuinevari.dds"
			map_color = { 173 49 19 }
			geographical_regions = { middleearth_rhun }
		}
		thani_hazad = { # Thani-Hazad -> "drel"
			icon = "gfx/interface/icons/regimenttypes/greenwood_swordsmen.dds"
			map_color = { 46 45 199 }
			geographical_regions = { middleearth_uttersouth_thanihazad }
		}
		utter_south = { # Mumakan/Usakan/Mag-Tumag -> "kinnlai"
			icon = "gfx/interface/icons/regimenttypes/cuind_skirmishers.dds"
			map_color = { 12 105 84 }
			geographical_regions = {
				middleearth_uttersouth_mumakan
				middleearth_uttersouth_usakan
				middleearth_uttersouth_twinkingdoms
				middleearth_mountains_yellow
			}
		}
		western_rhovanion = { # Anduin Vale, Rohan, Isengard -> "anduinvale"
			icon = "gfx/interface/icons/regimenttypes/falathrim_haven_guard.dds"
			map_color = { 197 232 8 }
			geographical_regions = { middleearth_west_rhovanion_anduin middleearth_west_isengard middleearth_west_rohan }
		}
		eriador = { # Eriador, Enedhwaith, and Angmar -> "eriador"
			icon = "gfx/interface/icons/regimenttypes/arnorian_soldiers.dds"
			map_color = { 88 17 29 }
			geographical_regions = { middleearth_west_arnor middleearth_forodwaith middleearth_west_enedhwaith }
		}
		eastern_rhovanion = { # Eastern Rhovanion and Northern Mountains -> "rhovanion"
			icon = "gfx/interface/icons/regimenttypes/gilded_guard.dds"
			map_color = { 240 175 10 }
			geographical_regions = { middleearth_west_rhovanion_brownlands middleearth_west_rhovanion_dalelands middleearth_mountains_iron }
		}
		gondor = { # Gondor -> "gondor"
			icon = "gfx/interface/icons/regimenttypes/citadel_guard.dds"
			map_color = { 33 44 122 }
			geographical_regions = { middleearth_west_gondor middleearth_mountains_white }
		}
		bay_of_ormal = { # Sirayn/Khy/Shayn -> "ormal"
			icon = "gfx/interface/icons/regimenttypes/galadhrim_warriors.dds"
			map_color = { 176 104 10 }
			geographical_regions = { middleearth_harad_bayoformal middleearth_uttersouth_shayn }
		}
		bay_of_tulwang = { # Bay of Tulwang -> "sumarieth"
			icon = "gfx/interface/icons/regimenttypes/galadhrim_sentinels.dds"
			map_color = { 123 217 172 }
			geographical_regions = { 
				middleearth_harad_far_bellakar_central
				middleearth_harad_far_tulwang
				middleearth_harad_far_ray
			}
		}
		haradwaith = { # Haradwaith -> "haradwaith"
			icon = "gfx/interface/icons/regimenttypes/haradrim_raiders.dds"
			map_color = { 227 225 157 }
			geographical_regions = { 
				middleearth_harad_dunesea
				middleearth_harad_near
				middleearth_harad_far_bellakar_bayoffelaya
			}
		}
		mordor = { # Mordor -> "mordor"
			icon = "gfx/interface/icons/regimenttypes/unburied_wights.dds"
			map_color = { 100 50 170 }
			geographical_regions = { middleearth_mordor }
		}
	}
	
	### Participants ###
	participant_groups = {
		elven_rulers_capital = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_rulers.dds"
			require_capital_in_sub_region = yes
			is_character_valid = {
				has_government = elven_government
				highest_held_title_tier >= tier_county
			}

			on_join = {
				if = {
					limit = {
						is_ai = no
						NOT = { has_variable = elven_hope_0001_var }
					}
					trigger_event = elven_hope.0001
				}
				trigger_event = elven_hope.0002
			}

			map_color = { 255 127 80 }
		}
		
		elven_rulers_realm = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_rulers_partial.dds"
			require_capital_in_sub_region = no
			require_realm_in_sub_region = yes
			is_character_valid = {
				has_government = elven_government
				highest_held_title_tier >= tier_county
			}

			on_join = {
				if = {
					limit = {
						is_ai = no
						NOT = { has_variable = elven_hope_0001_var }
					}
					trigger_event = elven_hope.0001
				}
			}

			map_color = { 255 127 80 }
		}
		
		elven_rulers_laamps = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_rulers_partial.dds"
			is_character_valid = {
				has_government = landless_adventurer_government
				OR = {
					is_elf = yes 
					is_istari = yes 
				}
				domicile.domicile_location.county.holder = { is_elf = yes }
			}
			map_color = { 235 213 52 }

			on_join = {
				if = {
					limit = {
						is_ai = no
						NOT = { has_variable = elven_hope_0001_var }
					}
					trigger_event = elven_hope.0001
				}
				trigger_event = elven_hope.0002
			}
		}
	}

	### On Actions ###
	on_monthly = {
		update_lorien_phase_effect = yes
		update_lindon_phase_effect = yes
		update_greenwood_phase_effect = yes
		update_ormal_phase_effect = yes
		update_kinnlai_phase_effect = yes
		update_drel_phase_effect = yes
		update_sumarieth_phase_effect = yes
		update_haradwaith_phase_effect = yes
		update_nelornieth_phase_effect = yes
		update_rhovanion_phase_effect = yes
		update_anduinvale_phase_effect = yes
		update_eriador_phase_effect = yes
		update_gondor_phase_effect = yes 
		update_mordor_phase_effect = yes
		remove_excess_hope_effect = yes
	}
	
	on_yearly = {
		check_elven_development_penalties_effect = yes # Dev penalty if low hope
		every_situation_sub_region = { # Get a random event every 3 months
			every_situation_sub_region_participant = {
				limit = { 
					exists = capital_province 
					is_ai = no # Gets too much out of control if the AI also gets random events all the time
				}
				trigger_event = {# Random 
					on_action = elven_hope_pulse_events
					days = { 80 100 } 
				}
				trigger_event = {# Random 
					on_action = elven_hope_pulse_events
					days = { 170 190 }
				}
				trigger_event = {# Random 
					on_action = elven_hope_pulse_events
					days = { 260 280 }
				}
				trigger_event = {# Random 
					on_action = elven_hope_pulse_events
					days = { 350 370 }
				}
			}
		}
	}
	
	### Phases ###
	start_phase = situation_elven_waning
	
    phases = { # Fading, Waning, Enduring, Renewing, Thriving
		
		situation_elven_fading = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_phase_fading.dds"

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_waning = {

				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_subject.dds"

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = -10
						}
						parameters = {
							elven_hope_very_many_sail_west = yes
							elven_hope_very_high_dev_penalty = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_military.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							men_at_arms_maintenance = 0.2
							men_at_arms_limit = -3
							levy_reinforcement_rate = -0.2
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_character.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 1
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							prowess = 1
						}
					}
				}
			}
		}
		situation_elven_waning = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_phase_waning.dds"

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_fading = {
				}
				situation_elven_enduring = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_subject.dds"

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = -5
							defender_advantage = 5
						}
						parameters = {
							elven_hope_many_sail_west = yes
							elven_hope_high_dev_penalty = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_military.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							men_at_arms_maintenance = 0.1
							men_at_arms_limit = -2
							levy_reinforcement_rate = -0.1
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_character.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 3
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							prowess = 3 
						}
					}
				}
			}
		}
		situation_elven_enduring = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_phase_enduring.dds"

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_waning = {
				}
				situation_elven_renewing = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_subject.dds"

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = 10
							defender_advantage = 5
						}
						parameters = {
							elven_hope_few_sail_west = yes
							elven_hope_moderate_dev_penalty = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_military.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							men_at_arms_maintenance = -0.1
							men_at_arms_limit = -1
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_character.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 5
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							prowess = 5 
						}
					}
				}
			}
		}
		situation_elven_renewing = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_phase_renewing.dds"

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_enduring = {
				}
				situation_elven_thriving = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_subject.dds"

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = 15
							defender_advantage = 8
						}
						parameters = {
							elven_hope_very_few_sail_west = yes
							elven_hope_low_dev_penalty = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_military.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							men_at_arms_maintenance = -0.2
							men_at_arms_limit = 1
							levy_reinforcement_rate = 0.1
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_character.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 5
						}
					}
					elven_rulers_realm = {
						character_modifier = {
							prowess = 5 
						}
					}
				}
			}
		}
		situation_elven_thriving = {
			icon = "gfx/interface/icons/situations/elven_hope/elven_phase_thriving.dds"

			on_start = {
				scope:situation_sub_region = {
					save_scope_as = my_subregion
					every_situation_sub_region_participant_group = {
						every_situation_group_participant = {
							#remove_elven_hope_phase_flag = yes
							trigger_event = elven_hope.0008
						}
					}
				}
			}

			future_phases = {
				situation_elven_renewing = {
				}
			}

			modifier_sets = { # ALL EFFECTS PLACEHOLDER
				situation_elven_subject_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_subject.dds"

					elven_rulers_capital = {
						character_modifier = {
							vassal_opinion = 30
							defender_advantage = 10
						}
						parameters = {
							elven_hope_none_sail_west = yes
							elven_hope_no_dev_penalty = yes
						}
					}
				}
				
				situation_elven_military_effects = { # Only rulers with their capital in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_military.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							men_at_arms_maintenance = -0.3
							men_at_arms_limit = 2
							levy_reinforcement_rate = 0.2
						}
					}
				}
				
				situation_elven_personal_effects = { # Both rulers with their capital and rulers who own land in the subregion are affected
					icon = "gfx/interface/icons/situations/situation_modifier_character.dds"
					
					elven_rulers_capital = {
						character_modifier = {
							prowess = 10
						}
					}
					elven_rulers_capital = {
						character_modifier = {
							prowess = 10 
						}
					}
				}
			}
		}
    }
}
