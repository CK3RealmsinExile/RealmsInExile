mirkwood_corruption_situation = {
    gui_window_name = "lotr_window_mirkwood_corruption_situation"
    map_mode = sub_regions
    is_unique = yes
    migration = no

    ### Regions ###
    sub_regions = {
        aradhrynd = {
            icon = ""
            map_color = { 20 60 30 }
            geographical_regions = { custom_aradhrynd }
        }
        taurduin = {
            icon = ""
            map_color = { 25 65 35 }
            geographical_regions = { custom_taurduin }
        }
        taur_nu_fuin = {
            icon = ""
            map_color = { 30 70 40 }
            geographical_regions = { custom_taur_nu_fuin }
        }
        emyn_i_firith = {
            icon = ""
            map_color = { 35 75 45 }
            geographical_regions = { custom_emyn_i_firith }
        }
        nivrim = {
            icon = ""
            map_color = { 40 80 50 }
            geographical_regions = { custom_nivrim }
        }
        dundaedelu = {
            icon = ""
            map_color = { 45 85 55 }
            geographical_regions = { custom_dundaedelu }
        }
        angaladh_rhunen = {
            icon = ""
            map_color = { 50 90 60 }
            geographical_regions = { custom_angaladh_rhunen }
        }
        men_i_naugrim = {
            icon = ""
            map_color = { 55 95 65 }
            geographical_regions = { custom_men_i_naugrim }
        }
        gwath_anglennol = {
            icon = ""
            map_color = { 60 100 70 }
            geographical_regions = { custom_gwath_anglennol }
        }
        taur_e_ndaedlos = {
            icon = ""
            map_color = { 65 105 75 }
            geographical_regions = { custom_taur_e_ndaedlos }
        }
        amon_lanc = {
            icon = ""
            map_color = { 70 110 80 }
            geographical_regions = { custom_amon_lanc }
        }
    }

    ### Participants ###
    participant_groups = {
        ## Limited to The Necromancer, Ruler of Lasgalen, and Radagast for now
        mirkwood_corruption_spreaders = {
            icon = ""
            require_capital_in_sub_region = no
            require_realm_in_sub_region = no
            is_character_valid = {
                AND = {
                    OR = {
                        has_character_flag = unknown_sauron_flag
                        has_character_flag = khamul
                    }
                    has_title = title:b_amon_lanc
                }
            }
        }
        mirkwood_corruption_fighters = {
            icon = ""
            require_capital_in_sub_region = no
            require_realm_in_sub_region = no
            is_character_valid = {
                OR = {
                    has_character_flag = ruler_of_lasgalen
                    has_character_flag = radagast
                }
            }

            on_join = {
                if = {
                    limit = {
                        is_ai = no
                        NOT = { has_variable = mirkwood_corruption_0001_var }
                    }
                    #trigger_event = mirkwood_corruption.0001
                }
            }

            map_color = { 255 127 80 }
        }

        mirkwood_rulers_capital = {
            icon = ""
            require_capital_in_sub_region = yes
            is_character_valid = {
                highest_held_title_tier >= tier_county
                NOT = {
                    has_character_flag = ruler_of_lasgalen
                    has_character_flag = radagast
                    has_character_flag = unknown_sauron_flag
                    has_character_flag = khamul
                    has_trait = wastelands
                }
            }

            on_join = {
                if = {
                    limit = {
                        is_ai = no
                        NOT = { has_variable = mirkwood_corruption_0001_var }
                    }
                    #trigger_event = mirkwood_corruption.0001
                }
            }

            map_color = { 255 127 80 }
        }

        mirkwood_rulers_realm = {
            icon = ""
            require_capital_in_sub_region = no
            require_realm_in_sub_region = yes
            is_character_valid = {
                highest_held_title_tier >= tier_county
                NOT = {
                    has_character_flag = ruler_of_lasgalen
                    has_character_flag = radagast
                    has_character_flag = unknown_sauron_flag
                    has_character_flag = khamul
                    has_trait = wastelands
                }
            }

            on_join = {
                if = {
                    limit = {
                        is_ai = no
                        NOT = { has_variable = mirkwood_corruption_0001_var }
                    }
                    #trigger_event = mirkwood_corruption.0001
                }
            }

            map_color = { 255 127 80 }
        }

        mirkwood_rulers_laamps = {
            icon = ""
            require_capital_in_sub_region = no
            require_realm_in_sub_region = no
            is_character_valid = {
                has_government = landless_adventurer_government
                domicile.domicile_location ?= { geographical_region = middleearth_west_rhovanion_mirkwood } # TO DO: Make dynamic
            }

            on_join = {
                if = {
                    limit = {
                        is_ai = no
                        NOT = { has_variable = mirkwood_corruption_0001_var }
                    }
                    #trigger_event = mirkwood_corruption.0001
                }
            }

            map_color = { 255 127 80 }
        }
    }



    ### On Actions ###
    on_start = { # Give each sub-region an id so we can define it's neighbors later
        set_mirkwood_region_id_effect = yes
    }
    on_monthly = {
        update_mirkwood_monthly_phase_effect = yes
    }

    on_yearly = {

    }

    ### Phases ###

    phases = { # Untainted Wood, Whispers in the Leaves, The Withering Shade, Shadow’s Grasp, The Web of Night

        situation_mirkwood_untainted_wood = {
            on_start = {}

            future_phases = {
                situation_mirkwood_whispers_in_the_leaves = {}
            }
        }

        situation_mirkwood_whispers_in_the_leaves = {
            on_start = {}

            future_phases = {
                situation_mirkwood_untainted_wood = {}
                situation_mirkwood_the_withering_shade = {}
            }
        }

        situation_mirkwood_the_withering_shade = {
            on_start = {}
            future_phases = {
                situation_mirkwood_whispers_in_the_leaves = {}
                situation_mirkwood_shadows_grasp = {}
            }
        }

        situation_mirkwood_shadows_grasp = {
            on_start = {}
            future_phases = {
                situation_mirkwood_the_withering_shade = {}
                situation_mirkwood_the_web_of_night = {}
            }
        }

        situation_mirkwood_the_web_of_night = {
            on_start = {}
            future_phases = {
                situation_mirkwood_shadows_grasp = {}
            }
        }

    }
}