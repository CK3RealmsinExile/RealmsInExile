
#####################################
### CULTURAL AND RELIGIOUS GROUPS ###
#####################################

faith_is_good = {
	OR = {
		religion = { is_in_family = rf_eruhini }
		faith = { has_doctrine = doctrine_echoes_of_the_ainur }
		faith = { has_doctrine = special_doctrine_is_freepeople_faith }
	}
}

faith_is_evil = {
	OR = {
		religion = { is_in_family = rf_forcesofevil }
		faith = { has_doctrine = doctrine_dominion_of_the_dark }
	}
}

faith_is_neutral = {
	faith_is_good = no
	faith_is_evil = no
}

lotr_is_immortal_culture_trigger = {
	OR = {
		is_valar = yes
		is_maiar = yes
		is_undead = yes
		is_elf = yes
		culture ?= culture:wastelands
	}
}

lotr_is_spirit_culture_trigger = {
	OR = {
		is_valar = yes
		is_maiar = yes
		is_istari = yes
		is_undead = yes
		culture ?= culture:wastelands
	}
}

is_a_minor = {
	age < majority_age
}

lotr_normal_building_trigger = {
	NOT = { 
		is_orc = yes 
		is_elf = yes 
	} 
}

lotr_gets_nicknames_trigger = {	#checks wether char is eligible to get a nickname
	NOR = {
		culture ?= culture:wastelands
		has_character_flag = had_nickname_event
		is_in_valinor = yes
	}
	NOT = {
		cannot_be_killed = yes
		is_ai = yes
	}
}
#lotr_cannot_get_disease_trigger = {
#	OR = {
#		culture = { has_cultural_pillar = heritage_ainur }
#		culture = { has_cultural_pillar = all elven heritages }
#	}
#}

#lotr_disease_resistant_trigger = {
#	OR = {
#		culture_group = culture_group: dwarves, numenoreans, ect
#	}
#}

#lotr_cannot_die_trigger = {
#	OR = {
#		culture = { has_cultural_pillar = heritage_ainur }
#		add traits/flags if character is immortal like Elrond
#		add artifact holders like Frodo
#	}
#}

lotr_numenor_culture_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_dunedain
			has_cultural_pillar = heritage_bellakari
			has_cultural_pillar = heritage_northern_adunaic
			has_cultural_pillar = heritage_southern_adunaic
		}
	}
}
lotr_gwathuirim_heritage_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_daen 
			has_cultural_pillar = heritage_dunlending 
		}
	}
}
lotr_northron_group_culture_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_hadorim
			has_cultural_pillar = heritage_northron
		}
	}
}
lotr_horse_lords_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_hadorim
			has_cultural_pillar = heritage_tedjin
			has_cultural_pillar = heritage_ioriag
		}
	}
}
lotr_haradrim_group_culture_trigger = {
	OR = {
		culture = culture:umbarean
		culture = culture:mardrukan
		culture = culture:bellanarud
		culture = { any_parent_culture_or_above = { this = culture:umbarean } }
		culture = { any_parent_culture_or_above = { this = culture:mardrukan } }
		culture = { any_parent_culture_or_above = { this = culture:bellanarud } }
		culture = { has_cultural_pillar = heritage_northern_apysaic }
		culture = { has_cultural_pillar = heritage_middle_apysaic }
		culture = { has_cultural_pillar = heritage_southern_apysaic }
		culture = { has_cultural_pillar = heritage_tulwangi }
		culture = { has_cultural_pillar = heritage_nafarati }
		# Matt note: should include Bellanarud and Tantûraki cultures.
		# Check the code after Royal Court.
	}
}
lotr_last_alliance_cultures_trigger = {
	# Cultures that were part of the Last Alliance.
	# A Free Peoples holy war/liberation war fought by the
	# combined strength of these groups.
	OR = {
		culture = { has_cultural_pillar = heritage_dunedain }
		culture = { has_cultural_pillar = heritage_hadorim }
		culture = { has_cultural_pillar = heritage_calaquendi }
		culture = { has_cultural_pillar = heritage_lomiquendi }
		culture = { has_cultural_pillar = heritage_bellakari }
#		Dwarven houses who joined the Last Alliance.
	}
}

lotr_elven_cultures_trigger = {
	OR = {
		culture = { has_cultural_pillar = heritage_quendi }
		culture = { has_cultural_pillar = heritage_moriquendi }
		culture = { has_cultural_pillar = heritage_calaquendi }
		culture = { has_cultural_pillar = heritage_lomiquendi }
	}
}

lotr_beorning_trigger = {
	has_trait = skinchanger
	OR = {
		culture = culture:valemen
		culture = culture:woodmen
		culture = { any_parent_culture_or_above = { this = culture:valemen } }
		culture = { any_parent_culture_or_above = { this = culture:woodmen } }		
	}
}

lotr_urbanised_northron_cultures_trigger = {
	AND = {
		culture = { has_cultural_pillar = heritage_northron }
		OR = {
			culture = culture:dalemen
			culture = culture:dorwinionrim
			culture = { any_parent_culture_or_above = { this = culture:dalemen } }
			culture = { any_parent_culture_or_above = { this = culture:dorwinionrim } }
		}
	}
}

lotr_steppe_cultures_trigger = {
	or = {
		culture = { has_cultural_pillar = heritage_igath }
		culture = { has_cultural_pillar = heritage_ioriag }
		culture = { has_cultural_pillar = heritage_tedjin }
	}
}

############################
### MEN-AT-ARMS TRIGGERS ###
############################

### Elven MaA Triggers ###
noldor_trigger = { # Handles access to Noldor units
	OR = {
		AND = {
			culture = { has_cultural_pillar = heritage_calaquendi }
			OR = {
				culture = culture:noldor
				culture = { any_parent_culture_or_above = { this = culture:noldor } }
			}
		}
		AND = { # For Cirdan-led Lindon to have access to Noldor events and units
			has_title = title:e_lindon 
			is_elf = yes
			NOT = { culture = { has_cultural_pillar = heritage_calaquendi } }
			any_vassal = { has_culture = culture:noldor }
		}
	}
}
sindar_trigger = { # Handles access to Sindar units
	AND = {
		culture = { has_cultural_pillar = heritage_lomiquendi }
		OR = {
			culture = culture:sindar
			culture = { any_parent_culture_or_above = { this = culture:sindar } }
		}
		NOR = { # The Sindar-descended cultures of Rhovanion shouldn't get these units, they have their own!
			culture = culture:nandor
			culture = culture:galadhrim
			culture = culture:silvan
			culture = culture:lasgalendrim
			culture = { any_parent_culture_or_above = { this = culture:silvan } }
			culture = { any_parent_culture_or_above = { this = culture:lasgalendrim } }
			culture = { any_parent_culture_or_above = { this = culture:nandor } }
			culture = { any_parent_culture_or_above = { this = culture:galadhrim } }
		}
	}
}
galadhrim_trigger = { # Handles access to Galadhrim units
	AND = {
		culture = { has_cultural_pillar = heritage_lomiquendi }
		OR = {
			culture = culture:nandor
			culture = culture:galadhrim
			culture = { any_parent_culture_or_above = { this = culture:nandor } }
			culture = { any_parent_culture_or_above = { this = culture:galadhrim } }
		}
		NOR = {
			culture = culture:silvan
			culture = { any_parent_culture_or_above = { this = culture:silvan } }
		}
	}
}
greenwood_trigger = { # Handles access to Greenwood units
	AND = {
		culture = { has_cultural_pillar = heritage_lomiquendi }
		OR = {
			culture = culture:silvan
			culture = culture:lasgalendrim
			culture = { any_parent_culture_or_above = { this = culture:silvan } }
		}
		
	}
}

# Vanyar Triggers - low priority, only Vanyar are in Valinor

# Teleri Triggers - low priority, Valinorean Teleri

# Avari Triggers
neldoreth_trigger = { # Handles access to Neldoreth units
	AND = {
		culture = { has_cultural_pillar = heritage_moriquendi }
		OR = {
			culture = culture:penni
			culture = { any_parent_culture_or_above = { this = culture:penni } }
		}
		has_title = title:k_nelornieth	
	}
}

### Human MaA Triggers ###

ithilien_rangers_trigger = { # handles who and under what circumstances ithilien rangers can be recruited
	AND = { # Available to those of Dúnedain heritage of Gondorian heritage
		culture = { has_cultural_pillar = heritage_dunedain } 
		OR = {
			culture = culture:gondorian
			culture = { any_parent_culture_or_above = { this = culture:gondorian } }
		}
	}
	OR = {
		OR = { # Available to the titular ruler of Ithilien or of Gondor, even if they don't control Ithilien
			has_primary_title = title:k_ithilien
			is_gondor = yes
		}
		any_sub_realm_county = { # Otherwise, if the ruler controls a province in Ithilien of Dúnedain culture
			culture = { has_cultural_pillar = heritage_dunedain }
			kingdom = title:k_ithilien
		}
	}
	is_target_in_global_variable_list = { # Has the decision to form the rangers been taken...
		name = unavailable_unique_decisions
		target = flag:establish_the_ithilien_rangers
	}
}

########################
### WARBAND TRIGGERS ###
########################
lotr_allows_warbands_trigger = {
	AND = {
		OR = {
			this.culture = { has_cultural_pillar = heritage_hadorim }
			this.culture = { has_cultural_pillar = heritage_dunlending }
			this.culture = { has_cultural_pillar = heritage_daen }
		}
		NOT = {
			this.culture = culture:rohirrim
			this.culture = { has_cultural_pillar = heritage_ainur }
			has_character_flag = is_saruman
		}
		NOT = { culture ?= culture:wastelands }
	}
}
lotr_warbands_mirkwood_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		completely_controls = title:c_dorfirnen
		NOT = { culture ?= culture:wastelands }
	}
}
lotr_warbands_parth_celebrant_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		NOT = { culture ?= culture:wastelands }
		OR = {
			completely_controls = title:d_parth_celebrant
			completely_controls = title:c_thorlorien
		}
	}
}
lotr_warbands_bandit_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		NOT = { culture ?= culture:wastelands }
		OR = {
			completely_controls = title:c_varad
			completely_controls = title:c_nanlothanduin
			completely_controls = title:c_southundeep
			completely_controls = title:c_berennyn
			completely_controls = title:c_mernael
			completely_controls = title:c_audaghaim
			completely_controls = title:c_gladden_fields
			completely_controls = title:c_norwold
			completely_controls = title:c_northundeep
			completely_controls = title:c_sutwold
			completely_controls = title:c_fortalf
			completely_controls = title:c_theeasternwall
			completely_controls = title:c_hartalf
		}
	}
}
lotr_warbands_dwarrowhall_leofring_trigger = {
	AND = {
		this.culture = culture:leofring
		NOT = { culture ?= culture:wastelands }
		OR = {
			completely_controls = title:c_byre_tor
			completely_controls = title:c_eorcan
		}
	}
}
#lotr_warbands_leofring_trigger = {
#	AND = {
#		this.culture = culture:leofring
#	}
#}
lotr_warbands_eotheod_trigger = {
	AND = {
		this.culture = culture:eotheod
		NOT = { culture ?= culture:wastelands }
	}
}
lotr_warbands_adornaen_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		OR = {
			this.culture = culture:adornaen
			this.culture = culture:isengard_dunlending
		}
		OR = {
			completely_controls = title:c_frecalund
			completely_controls = title:c_larcnoc
			completely_controls = title:c_earcnoc
			completely_controls = title:c_glasgleann
			completely_controls = title:c_chailcaerdh
			completely_controls = title:c_dunfearnshaws
			completely_controls = title:c_tormcaladach
		}
	}
}
lotr_warbands_fisherfolk_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = {
			OR = {
				has_cultural_pillar = heritage_daen
				has_cultural_pillar = heritage_dunlending
			}
		}
		OR = {
			completely_controls = title:c_iren
			completely_controls = title:c_carreglyn
			completely_controls = title:c_iarnburn
			completely_controls = title:c_cadlus
		}
		NOT = {
			this.culture = culture:isengard_dunlending
		}
	}
}
lotr_warbands_dunlending_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = {
			OR = {
				has_cultural_pillar = heritage_daen
				has_cultural_pillar = heritage_dunlending
			}
		}
		OR = {
			completely_controls = title:c_westmarches
			completely_controls = title:c_valesoftheadorn
			completely_controls = title:c_emyndunendor
			completely_controls = title:c_gaetir
			completely_controls = title:c_galtrev
			completely_controls = title:c_starkmoors
			completely_controls = title:c_cailintur
			completely_controls = title:c_glasgleann
		}
		NOT = {
			this.culture = culture:isengard_dunlending
		}
	}
}
lotr_warbands_gwathlo_estuary_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = culture:saralain
	}
}
lotr_warbands_gwathlo_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		OR = {
			this.culture = culture:gwathlo_gwathuirim
			this.culture = culture:enedhwaithrim
		}
	}
}
lotr_warbands_gondor_gwathuirim_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = { has_cultural_pillar = heritage_daen }
	}
}
lotr_warbands_haradrim_suladan_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
		OR = {
			completely_controls = title:k_haruzan
		}
	}
}
lotr_warbands_haradrim_corsair_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
		OR = {
			completely_controls = title:c_shafra
			completely_controls = title:c_suk_oda
			completely_controls = title:c_korb_ugarta
		}
	}
}
lotr_warbands_haradrim_desert_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
		OR = {
			completely_controls = title:c_khabazh
			completely_controls = title:c_tajama
			completely_controls = title:c_zakakha
			completely_controls = title:c_ardrista
			completely_controls = title:c_rakha
			completely_controls = title:c_kharga
			completely_controls = title:c_arakh
			completely_controls = title:c_kajbah
			completely_controls = title:c_pazaran
		}
	}
}
lotr_warbands_haradrim_trigger = {
	AND = {
		NOT = { culture ?= culture:wastelands }
		this.culture = { has_cultural_pillar = heritage_northern_apysaic }
	}
}



not_in_use_trigger = {
	OR = {
		culture = { has_cultural_pillar = heritage_dunlending }
		culture = { has_cultural_pillar = heritage_hadorim }
	}
	NOT = {
		culture = culture:rohirrim
		culture = { has_cultural_pillar = heritage_ainur }
		has_character_flag = is_saruman
	}
}

lotr_isengard_urukhai_culture_trigger = {
	culture = culture:isengard_urukhai
}

lotr_isengard_urukai_maa_trigger = {
	    OR = {
        culture = culture:isengard_urukhai
        culture = { any_parent_culture_or_above = { this = culture:isengard_urukhai } }
    }
}

lotr_armies_are_outnumbered = {
	total_enemy_strength > total_ally_strength
}

lotr_at_peace_with_gondor = {
	NOR = { 
		any_war_enemy = {
			has_title = title:e_gondor
		}
		any_war_enemy = {
			has_title = title:e_gondor_steward
		}
	}
}

lotr_at_peace_with_rohan = {
	NOT = {
		any_war_enemy = {
			has_title = title:k_rohan
		}
	}
}


########################
### MISSION TRIGGERS ###
########################

# Abrakhân
character_is_valid_for_abrakhan_subjugation_mission_trigger = {		# this trigger checks if you are considered Sauron's Abrakhan
	#juke note: should be improved to eventually include "saurons permission" for cases where a not nessecarily sauron aligned power conquers abkrahan (for example, the mission stuff wouldnt make sense. i.e. player-led Ar-Adunai conquerors etc)
	custom_tooltip = {
		text = character_is_valid_for_abrakhan_subjugation_mission_trigger
		# Is either GK or someone has taken their place as Sauron's
		# "friendly reminder" for the Haradwaith.
		#OR = {
		#	religion = { is_in_family = rf_forcesofevil }
		#	AND = {
		#		religion = { is_in_family = rf_darkness }
		faith_is_evil = yes
		#	}
		#}
		#should be sauron aligned
		NOR = {	
			faith = faith:melkorite
			faith = faith:way_of_strength
		}
		
		#Sauron should exist
		sauron_is_alive = yes

	highest_held_title_tier >= tier_kingdom
		OR = { 	#juke note: added to avoid situations where sandbox stuff occurs (player-lead independent darsalan kingdom etc)
			has_title = title:k_abrakhan_religious
			has_title = title:k_abrakhan
			#has_title = title:e_abrakhan
			has_title = title:e_nafarat
		}
	capital_province = { geographical_region = middleearth_haradwaith_far_abrakhan }
	}
}


character_is_valid_for_nafarati_subjugation_trigger = {	# this trigger checks if you are valid to submit to Abrakhan at  the beginning
	is_available_adult = yes
	culture = culture:nafarati
	martial >= high_skill_rating
	#	AND = {
	#		OR = {
	#			culture = { has_cultural_pillar = heritage_nafarati }
	#			#faith = faith:faith_nafar	#juke note: we can let them be a different faith, if they are in abrakhans court we can assume they are a servant of the golden king
	#		}
	#	}
}
character_is_valid_for_ray_subjugation_trigger = {
	is_available_adult = yes
	# ToDo: is relevant to Ray and has relevant traits.
	stewardship >= high_skill_rating
	AND = {
		OR = {
			culture = { has_cultural_pillar = heritage_southern_apysaic }
			faith = faith:faith_ray
		}
		OR = {
			has_trait = education_stewardship_3
			has_trait = education_stewardship_4
			has_trait = administrator
			has_trait = avaricious
			short_term_gold >= major_gold_value # Matt note: this should check if they have a large amount of income.
		}
	}
}
character_is_valid_for_umbar_subjugation_trigger = {
	is_available_adult = yes
	stewardship >= high_skill_rating
	# ToDo: is relevant to Umbar and has relevant traits.
	#	AND = {
	#		OR = {
	#			lotr_numenor_culture_trigger = yes
	#			faith = faith:faith_kings_men_castamir
	#			faith = faith:faith_corsair
	#			faith = faith:melkorite
	#		}
	#		OR = {
	#			dynasty = { has_dynasty_perk = lotr_black_numenorean_legacy_1 }
	#			has_trait = adventurer
	#			has_trait = varangian
	#		}
	#	}
}

##############################################
### Numenoreans and their successor states ###
##############################################

is_gondor = {
	culture = { has_cultural_pillar = heritage_dunedain }
	OR = {
		has_primary_title = title:e_gondor_steward
		has_primary_title = title:e_gondor
		has_primary_title = title:e_castamir
	}
}

is_steward_of_gondor = {
	culture = { has_cultural_pillar = heritage_dunedain }
	OR = {
		has_primary_title = title:e_gondor_steward
		has_primary_title = title:k_gondor_steward
		AND = {
            primary_title.tier = tier_kingdom
            has_title = title:k_gondor_steward
        }
	}
}

is_arnor = {
	culture = { has_cultural_pillar = heritage_dunedain }
	OR = {
		has_primary_title = title:e_arnor
		has_primary_title = title:d_northern_dunedain
	}
}

lotr_has_numenorean_culture_trigger = {
	culture = { 
		OR = {
			has_cultural_pillar = heritage_dunedain
			has_cultural_pillar = heritage_bellakari
			has_cultural_pillar = heritage_northern_adunaic
			has_cultural_pillar = heritage_southern_adunaic
		}
	}
}

lotr_has_southern_numenorean_culture_trigger = {
	culture = { 
		OR = {
			has_cultural_pillar = heritage_bellakari
			has_cultural_pillar = heritage_northern_adunaic
			has_cultural_pillar = heritage_southern_adunaic
		}
	}
}

lotr_numenor_in_exile_decision_show_trigger = {
	OR = {
		AND = {
			completely_controls_region = custom_anbalkumagan
			completely_controls_region = custom_gondorian_heartlands
			completely_controls_region = middleearth_haradwaith_umbar
		}
		AND = {
			completely_controls_region = custom_anbalkumagan
			completely_controls_region = custom_gondorian_heartlands
			completely_controls_region = custom_bellakar
		}
		AND = {
			completely_controls_region = custom_anbalkumagan
			completely_controls_region = middleearth_haradwaith_umbar
			completely_controls_region = custom_bellakar
		}
		AND = {
			completely_controls_region = custom_gondorian_heartlands
			completely_controls_region = middleearth_haradwaith_umbar
			completely_controls_region = custom_bellakar
		}
	}
}


### Set Sail Activity Triggers ###

coastal_province_in_realm = {
	any_realm_county = {
		title_province = { is_coastal = yes }
	}
}

owns_a_damaged_boat = {
	OR = {
		has_character_modifier = small_damaged_boat_modifier
		has_character_modifier = medium_damaged_boat_modifier
		has_character_modifier = large_damaged_boat_modifier
	}
}

owns_an_undamaged_boat = {
	OR = {
		has_character_modifier = small_boat_modifier
		has_character_modifier = medium_boat_modifier
		has_character_modifier = large_boat_modifier
	}
}

owns_a_boat = {
	OR = {
		owns_an_undamaged_boat = yes
		owns_a_damaged_boat = yes
	}
}

is_boat_purchased = {
	NOT = {
		has_character_flag =  hired_a_boat
	}
}

can_afford_a_boat = {
	owns_a_boat = no
	gold >= small_boat_hire_cost
}

### War CB ###
can_conduct_slave_expedition = {
	NOT = {
		has_character_flag = successful_slaver_expedition
	}
}

county_is_elven = {
	county = {
		OR = {
			culture = { has_cultural_pillar = heritage_quendi }
			culture = { has_cultural_pillar = heritage_calaquendi }
			culture = { has_cultural_pillar = heritage_lomiquendi }
			culture = { has_cultural_pillar = heritage_moriquendi }
		}
	}
}

no_existing_elven_stronghold_in_duchy = {
	any_province = {
		count = 0
		NOT = { this = root }
		trigger_if = {
			limit = { exists = duchy }
			duchy = root.duchy
		}
		OR = {
			has_building = elven_settlement_03
			has_building = elven_settlement_04
			has_building = elven_settlement_05
		}
	}	
}

has_capacity_for_elven_stronghold = {
	any_realm_province = {
		count < elven_stronghold_limit
		OR = {
			has_building = elven_settlement_03
			has_building = elven_settlement_04
			has_building = elven_settlement_05
		}
	}
}

no_existing_elven_city_in_kingdom = {
	any_province = {
		count = 0
		NOT = { this = root }
		trigger_if = {
			limit = { exists = kingdom }
			kingdom = root.kingdom
		}
		OR = {
			has_building = elven_settlement_06
			has_building = elven_settlement_07
		}
	}
}

has_capacity_for_elven_city = {
	any_realm_province = {
		count < elven_city_limit
		OR = {
			has_building = elven_settlement_06
			has_building = elven_settlement_07
		}
	}
}

lotr_friends_with_elven_king_trigger = {
	any_independent_ruler = {
		has_relation_friend = root
		is_elf = yes
		is_in_valinor = no
		highest_held_title_tier >= tier_kingdom
	}
}

is_in_valinor = {
	trigger_if = {
		limit = {
			exists = capital_province
		}
		capital_province = {
			geographical_region = middleearth_valinor
		}
	}
	trigger_else = {
		# limit = {
		# 	NOT = { exists = capital_province }
		# }
		trigger_if = { 
			limit = { exists = host.capital_province }
			host.capital_province = {
				geographical_region = middleearth_valinor
			}
		}
		trigger_else_if = {
			limit = {
				exists = liege.capital_province
			}
			liege.capital_province = {
				geographical_region = middleearth_valinor
			}
		}
		trigger_else_if = {
			limit = {
				exists = location.province_owner.capital_province
			}
			location.province_owner.capital_province = {
				geographical_region = middleearth_valinor
			}
		}
		trigger_else = { 
			OR = {
				has_trait = sailed_west
				has_trait = doom_sundered
			}
		}
	}
}

##########################
## NEW SORCERY TRIGGERS ##
##########################

is_sorcerer = {
	OR = {
		has_trait = sorcerer_1
		has_trait = sorcerer_2
		has_trait = sorcerer_3
	}
}

can_learn_sorcery = {
	AND = {
		piety_level >= 2
		NOT = {
			has_character_flag = learning_sorcery
			has_character_modifier = studying_dark_arts_modifier
			is_sorcerer = yes
			has_trait = nazgul
			is_evil_istari = yes
			has_trait = maiar
		}
		AND = {
			OR = {
				has_trait = intellect_good_3
				has_trait = zealous
				has_trait = lifestyle_mystic
				has_trait = witch
				has_trait = education_intrigue_4
				has_trait = education_learning_4
			}
			religion = { is_in_family = rf_forcesofevil }
		}
	
		learning >= 16
	}
	
}

can_learn_sorcery_ai = {
	is_ai = yes
	religion = { is_in_family = rf_forcesofevil }
	NOT = {
		has_character_flag = learning_sorcery
		has_character_modifier = studying_dark_arts_modifier
		is_sorcerer = yes
		has_trait = nazgul
		is_evil_istari = yes
		has_trait = maiar
	}
	AND = {
		calc_true_if = {
    		amount >= 2
			piety_level >= 3
			has_trait = intellect_good_3
			has_trait = zealous
			has_trait = schemer
			has_trait = theologian
			has_trait = lifestyle_mystic
			has_trait = witch
			has_trait = education_intrigue_4
			has_trait = education_learning_4
			learning >= 16
		}
	}	
}

##########################
##### STORY TRIGGERS #####
##########################

sauron_is_alive = {
	character:lineofsauron = {
		is_alive = yes
	}
}

is_sauron = {
	this = character:lineofsauron
}

is_radagast = {
	this = character:lineofradagast
}

sauron_has_palantir = {
	character:lineofsauron = {
		any_character_artifact = {
			has_variable = palantir
		}
	}
}

aragorn_is_alive = {
	character:lineisildur42 = {
		is_alive = yes
	}
}

elrond_is_alive = {
	character:linefinwe27 = {
		is_alive = yes
	}
}

arwen_is_alive = {
	character:linefinwe30 = {
		is_alive = yes
	}
}

denethor_is_alive = {
	character:linesteward38 = {
		is_alive = yes
	}
}

saruman_is_alive = {
	character:lineofsaruman = {
		is_alive = yes
	}
}

saruman_is_evil = {
	character:lineofsaruman = {
		OR = {
			has_character_flag = saruman_accepted_sauron
			religion = {
				is_in_family = rf_forcesofevil
			}
		}
	}
}

saruman_is_defeated = {
	character:lineofsaruman = {
		OR = {
			NOT = { completely_controls = title:d_isengard }
			is_alive = no
		}
		faith_is_evil = yes
	}
}

golden_king_is_alive = {
	character:goldenking1 = {
		is_alive = yes
	}
}

witch_king_is_alive = {
	character:nazgul1 = {
		is_alive = yes
	}
}


################
#####KHAND######
################

has_vassals = {
	any_vassal = {
		count > 0
	}	
}

###############
### TRAITS ####
###############

is_berserker = {	#to unify all three traits for event code
	or = {
		has_trait = berserker
		has_trait = urukhai_berserker
		has_trait = nafarati_berserker
	}
}

###################
### ACTIVITIES ####
###################

lotr_can_be_activity_guest = {
	is_sauron = no
	is_nazgul = no
	is_in_valinor = no
	
	# Orcs only attend Orcish events
	trigger_if = {
		limit = { scope:host = { is_orc = yes } }
		is_orc = yes
	}
	trigger_else = { is_orc = no }
	
	#Humans and Dwarves may tolerate other alignments but Elves and Istari do not
	trigger_if = {
		limit = { 
			scope:host = { 
				faith_is_good = yes 
				is_human = no
				is_dwarf = no
			}
		}
		faith_is_good = yes
	}
	
	#Same goes for Sauron and the Nazgûl (if allowed to host activities)
	trigger_else_if = {
		limit = { 
			scope:host = {
				is_human = no
				is_dwarf = no
				faith_is_evil = yes 
			} 
		}
		faith_is_evil = yes
	}

	trigger_else = {
		always = yes
	}
}

unique_human_archives_trigger = {
	OR = {
		province:199 = this #Minas Tirith
		province:315 = this #Dol Amroth
		province:264 = this #Pelargir
		province:20 = this #Isengard
		OR = {
			this = { has_building = wonder_osgiliath_05 }
			this = { has_building = wonder_osgiliath_05 }
		}
		AND = {
			title:c_minas_ithil = {
				NOR = { 
					has_county_modifier = morgul_corruption_modifier
					has_county_modifier = fading_morgul_corruption_modifier
				}
			}
			province:226 = this #Minas Ithil
		}
		this = { has_building = wonder_palace_of_ithilien }
		# Annuminas
		# Fornost
		province:2493 = this #Zadan an-Adûn
		province:2513 = this #Kadar an-Kharadûn
		province:819 = this #Umbar
		this = { has_building = wonder_arminalethor_01 }
		province:1791 = this #Nilulonde
		province:1644 = this #Korlea
		province:1542 = this #Hazaj Tollin
		province:1731 = this #Urezayan
	}
}

unique_elven_archives_trigger = {
	OR = {
		province:3108 = this #Caras Galadhon
		province:3216 = this #Aradhrynd
		has_building = wonder_amon_lanc_01
		has_building = wonder_amon_lanc_03
		has_building = wonder_edhellond_01
		has_building = wonder_edhellond_03
		has_building = wonder_amarthrynd_01
		has_building = wonder_amarthrynd_03
		#Imladris
		#Mithlond
		#Ost-in-Edhil
	}
}

lotr_canon_safe_from_harm_trigger = {
	has_game_rule = default_ai_behavior
	OR = {
		this = character:lineisildur42 #Aragorn
		this = character:linesteward38 #Denethor II
		this = character:linesteward39 #Boromir
		this = character:linesteward40 #Faramir
		this = character:dolamroth27 #Imrahil
		this = character:dolamroth31 #Lothiriel
		has_character_flag = is_eldarion #Eldarion
		this = character:linegilraen12 #Halbarad
		this = character:linelamedon30 #Angbor
		this = character:lossarnach28 #Forlong
		this = character:1518 #Hirluin
		this = character:6000017 #Théoden
		this = character:6000018 #Eomer
		this = character:6000034 #Théodred
		this = character:6000035 #Eowyn
		this = character:6000044 #Grima
		this = character:lineofbeorn2 # Grimbeorn
		this = character:lineoftumakveh82 #Niluhin
		this = character:lineofhuz190 #Huz-Margoz
		this = character:lineblackqueen9 #Beruthiel
		this = character:lineofcassimir23 #Cassimir
		this = character:lineofcassimir24 #Burodapan
		this = character:mouthofsauron #Mouth of Sauron
		this = character:syarrhul1 #Black Vizier
		this = character:lineofhador10 #Tuor
	}
}