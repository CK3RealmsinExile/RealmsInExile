wok_can_marry_character_trigger = {
	trigger_if = { # Things that can override canon spouse
		limit = {
			OR = {
				$CHARACTER$ = { is_married = no }
				is_married = no
			}
		}
		OR = {
			trigger_if = {
				limit = {is_betrothed = yes}
				betrothed = $CHARACTER$
			}
			trigger_if = { # Done this way for tooltipping purposes
				limit = {is_ai = no}
				is_ai = no
			}
			trigger_if = { # Done this way for tooltipping
				limit = {$CHARACTER$ = {is_ai = no}}
				$CHARACTER$ = {is_ai = no}
			}
			trigger_if = {
				limit = {exists = scope:actor}
				scope:actor = {is_ai = no}
			}
			trigger_if = {
				limit = {exists = matchmaker}
				matchmaker = {is_ai = no}
			}
		}
	}
}

wok_ai_wants_marriable_relations = {
	is_ai = yes
	uses_marriage_consent = yes
	wok_has_marriable_relations = no	
}

wok_has_marriable_relations = {
	save_temporary_scope_as = tmp_check
	any_relation = {
		type = soulmate
		could_marry_character_trigger = {CHARACTER = scope:tmp_check}
	}
}

wok_has_marriable_relation_with_target = {
	OR = {
		trigger_if = {
			limit = {exists = betrothed}
			betrothed = $TARGET$
		}
		has_relation_soulmate = $TARGET$
	}
}

uses_marriage_consent = {
	trigger_if = {
		limit = {
			is_elf = yes
		}
	}
	trigger_else = {
		always = no
	}
}

can_marry_target_under_relational_game_rule = {
	trigger_if = {
		limit = {
			uses_marriage_consent = yes
		}
		trigger_if = { # Prevent the AI from marrying characters currently being schemed by the player
			limit = {
				is_ai = yes
				$TARGET$ = {is_ai = yes}
				trigger_if = {
					limit = {exists = scope:actor}
					scope:actor = {
						is_ai = yes
					}
				}
			}
			$TARGET$ = {
				NOT = {
					any_targeting_scheme = {
						scheme_type_is_arrangeable = yes
						scheme_owner = {
							OR = {
								is_ai = no
								any_close_family_member = {
									is_ai = no
								}
							}
						}
					}
				}
			}
		}
		trigger_else = {
			wok_has_marriable_relation_with_target = {TARGET = $TARGET$}
		}
	}
}

scheme_type_is_arrangeable = {
	scheme_type = courting
}

scheme_has_matchmaker = {
	scope:owner = {
		any_scheme = {
			scheme_target_character = scope:target
			exists = var:matchmaker
			var:matchmaker = {is_alive = yes is_ai = no}
			scheme_type_is_arrangeable = yes
		}
	}
}