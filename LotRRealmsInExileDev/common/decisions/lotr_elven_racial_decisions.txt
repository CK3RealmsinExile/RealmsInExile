### Elven Racial Mechanics ###

decision_try_for_elven_child = {
	title = decision_try_for_elven_child
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_elf_love.dds"
	}
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	selection_tooltip = decision_try_for_elven_child_tooltip
	desc = decision_try_for_elven_child_desc
	confirm_text = decision_try_for_elven_child_confirm
	
	decision_group_type = realms_in_exile
	
	is_shown = {
		is_elf = yes
		is_in_valinor = no
		trigger_if = {
			limit = { is_married = yes }
			primary_spouse = { is_elf = yes }
			sex_opposite_of = primary_spouse
			NOR = { 
				has_character_flag = elf_childbirth_ongoing
				has_character_modifier = elf_child_limit_modifier
				primary_spouse = { has_character_modifier = elf_child_limit_modifier }
			}
			OR = {
				is_ai = no
				AND = {
					is_ai = yes
					primary_spouse = { is_ai = yes }
				}
			}
		}
		trigger_else = {
			always = no
		}
	}
	
	is_valid = {
		trigger_if = {
			limit = { is_married = yes }
			has_relation_soulmate = primary_spouse
			stress_level < 1
			is_at_war = no		
			NOR = { 
				has_character_modifier = elf_childraising_modifier
				primary_spouse = { has_character_modifier = elf_childraising_modifier }
			}
		}
		trigger_else = {
			always = no
		}
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	
	effect = {
		trigger_event = elven_racial.0001
		add_character_flag = elf_childbirth_ongoing
		primary_spouse = { add_character_flag = elf_childbirth_ongoing }
	}
	
}

decision_sail_to_valinor = {
	title = decision_sail_to_valinor
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_mithlond_01.dds"
	}
	
	sort_order = 1000

	ai_goal = no
	ai_check_interval = 60	
	ai_potential = {
		always = no
	}
	ai_will_do = { #Finesse this - JS
		base = 0
	}
	
	selection_tooltip = decision_sail_to_valinor_tooltip
	desc = decision_sail_to_valinor_desc
	confirm_text = decision_sail_to_valinor_confirm
	
	decision_group_type = realms_in_exile
	
	is_shown = {
		is_elf = yes
		is_in_valinor = no
		NOT = { 
			has_trait = sailed_west
		}
		is_ai = no
	}
	
	is_valid = {
		is_at_war = no		
		NOT = { 
			has_character_modifier = elf_childraising_modifier
		}
		NOT = { 
			has_character_modifier = valar_ban_modifier
		}
		OR = {
			stress_level >= 2
			AND = {
				stress_level >= 1
				has_trait = depressed_1
			}
			sauron_is_alive = no
		}
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	
	effect = {
		depose = yes
		every_claim = {
			root = { remove_claim = prev }
		}
		add_trait = sailed_west
		custom_tooltip = {
			text = sail_to_valinor
			set_employer = title:k_tirion.holder
		}

		if = { # The Last Ship | Achievement
			limit = { 
				NOT = { exists = global_var:lotr_achievement_52 }
				is_ai = no
				realms_achievements_enabled = yes
				root = character:lineofcirdan
			}
			set_global_variable = lotr_achievement_52
		}
	}
	
}