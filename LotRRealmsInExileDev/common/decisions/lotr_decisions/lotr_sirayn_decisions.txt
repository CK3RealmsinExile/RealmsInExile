# Khorahil's at the bottom
############
## Sirâyn ##
############

decision_chennacatti_animal_sacrifice = {
	title = decision_chennacatti_animal_sacrifice_title
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_personal_religious.dds"
	}
	sort_order = 10
	ai_check_interval = 36
	ai_potential = {
		NOR = {
			has_trait = cynical
			has_trait = greedy
		}
	}
	ai_will_do = {
		base = 100
	}
	selection_tooltip = decision_chennacatti_animal_sacrifice_tooltip
	desc = decision_chennacatti_animal_sacrifice_desc
	confirm_text = decision_chennacatti_animal_sacrifice_confirm

	decision_group_type = realms_in_exile_minor

	is_shown = {
		has_variable = ancestor_to_bury
		is_landed = yes
		OR = {
			culture = culture:chennacatti
			culture = { any_parent_culture_or_above = { this = culture:chennacatti } } #account for divergent cultures
		}
		NOT = { has_character_flag = lotr_chennacatti_animal_sacrifice_flag }
	}
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	cost = { gold = { value = 25 } }

	effect = {
		trigger_event = flavourevent.0015
	}
	
}

# Sikentr Decisions
decision_sikentr_empire = {
	title = decision_sikentr_empire_title
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_king_02.dds"
	}
	sort_order = 500
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	
	selection_tooltip = decision_sikentr_empire_tooltip
	desc = decision_sikentr_empire_desc
	confirm_text = decision_sikentr_empire_confirm
	
	decision_group_type = realms_in_exile_major
	
	is_shown = {
		is_landed = yes
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_sikentr_empire
			}
		}

		
		culture = culture:bulgan #Do not account for divergent cultures- this is Bulgan exclusive
		
	}
	
	is_valid = {
		prestige_level >= 5
		has_title = title:e_sirayn
		completely_controls = title:e_sirayn
		completely_controls = title:k_lyneria
		completely_controls = title:k_harshandatt
		completely_controls = title:k_zajantak
		completely_controls = title:k_raishoul
		completely_controls = title:k_mejhanir
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	
	cost = { prestige = { value = 2500 } }
	
	effect = {
		title:k_lyneria = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:k_harshandatt = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:k_zajantak = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:k_raishoul = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:k_mejhanir = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:e_sirayn = {
			set_title_name = e_sirayn_sikentr
			set_color_from_title = title:e_sirayn_sikentr #placeholder
			set_coa = e_sirayn_sikentr
		}
		root.capital_county = {
			change_development_level = 5
		}
		title:k_chennacatt = {
			change_development_level = 3
		}
		root.dynasty = {
			add_dynasty_prestige = 1000
			add_dynasty_modifier = {
				modifier = sikentr_legacy_dynasty_modifier
				years = 100
			}
		}

		trigger_event = sirayn.1001
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_sikentr_empire
		}
	}
}

decision_sikentr_empire_expand_khy = {
	title = decision_sikentr_empire_expand_khy_title
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_adunai_01.dds"
	}
	sort_order = 499
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	
	selection_tooltip = decision_sikentr_empire_expand_khy_tooltip
	desc = decision_sikentr_empire_expand_khy_desc
	confirm_text = decision_sikentr_empire_expand_khy_confirm
	
	decision_group_type = realms_in_exile_major
	
	is_shown = {
		is_landed = yes
		has_title = title:e_sirayn
		is_target_in_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_sikentr_empire
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_sikentr_empire_expand_khy
			}
		}		
		culture = culture:bulgan #Do not account for divergent cultures- this is Bulgan exclusive		
	}
	
	is_valid = {
		completely_controls = title:k_sammar
		completely_controls = title:k_bulchyades
		completely_controls = title:k_anarike
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	
	cost = { prestige = { value = 1500 } }
	
	effect = {
		title:k_sammar = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:k_bulchyades = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:k_anarike = {
			set_de_jure_liege_title = title:e_sirayn
		}
		root.dynasty = {
			add_dynasty_prestige = 500
		}
		trigger_event = sirayn.1002
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_sikentr_empire_expand_khy
		}
	}
}

decision_sikentr_empire_expand_ray = {
	title = decision_sikentr_empire_expand_ray_title
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	sort_order = 498
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	
	selection_tooltip = decision_sikentr_empire_expand_ray_tooltip
	desc = decision_sikentr_empire_expand_ray_desc
	confirm_text = decision_sikentr_empire_expand_ray_confirm
	
	decision_group_type = realms_in_exile_major
	
	is_shown = {
		is_landed = yes
		has_title = title:e_sirayn
		is_target_in_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_sikentr_empire
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_sikentr_empire_expand_ray
			}
		}		
		culture = culture:bulgan #Do not account for divergent cultures- this is Bulgan exclusive		
	}
	
	is_valid = {
		completely_controls = title:k_ray
		completely_controls = title:k_tulwang
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}
	
	cost = { prestige = { value = 1500 } }
	
	effect = {
		title:k_ray = {
			set_de_jure_liege_title = title:e_sirayn
		}
		title:k_tulwang = {
			set_de_jure_liege_title = title:e_sirayn
		}
		root.dynasty = {
			add_dynasty_prestige = 500
		}
		trigger_event = sirayn.1003
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_sikentr_empire_expand_ray
		}
	}
}

# Radyani decisions
decision_radyani_vengeance = {
	title = decision_radyani_vengeance
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_radyani.dds"
	}
	sort_order = 1000
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	
	selection_tooltip = decision_radyani_vengeance_tooltip
	desc = decision_radyani_vengeance_desc
	confirm_text = decision_radyani_vengeance_confirm
	
	decision_group_type = realms_in_exile_major
	
	is_shown = {
		
		# is_female = yes # Open this up to more people - no need to be a woman!
		# dynasty = dynasty:dynasty_lavrajyatante
		# has_title = title:k_isra

		is_landed = yes
		has_faith = faith:faith_yom

		title:e_sirayn = { # Have the Arienists invaded?
			any_ruler = {
				has_faith = faith:faith_arienism
			}
		}

		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_radyani_vengeance
			}
		}
	}
	
	is_valid = {
		# has_title = title:k_isra
		highest_held_title_tier >= tier_kingdom
		has_faith = faith:faith_yom
		custom_tooltip = {
			text = RADYANI_WAR_TARGET_EXISTS
			title:e_sirayn = {
				any_ruler = {
					has_faith = faith:faith_arienism
				}
			}
		}
		trigger_if = {
			limit = { is_ai = yes }
			realm_size >= major_realm_size
		}
	}
	
	is_valid_showing_failures_only = {
		is_at_war = no
		is_imprisoned = no
		is_available_adult = yes
	}
	
	cost = { 
		piety = 500 
	}
	
	effect = {
		if = {
			limit = {
				title:d_ornad.holder = { has_faith = faith:faith_arienism }
			}
			title:d_ornad.holder = { save_scope_as = radyani_target_character }
			title:d_ornad = { save_scope_as = radyani_target_duchy }
		}
		else_if = {
			title:e_sirayn = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder ?= {
							has_faith = faith:faith_arienism
						}
					}
					this.holder = {
						save_scope_as = radyani_target_character
					}
					save_scope_as = radyani_target_duchy
				}
			}
		}
			
		start_war = {
			casus_belli = religious_war
			target = scope:radyani_target_character
			target_title = scope:radyani_target_duchy
		}
		custom_tooltip = RADYANI_ARIENISTS_RALLY

		root.dynasty = {
			add_dynasty_prestige = 500
		}

		trigger_event = {
			id = sirayn.1601
		}
		
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_radyani_vengeance
		}
	}
}

decision_radyani_avatar = {
	title = decision_radyani_avatar
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_mardruak_01.dds"
	}
	sort_order = 500
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	
	selection_tooltip = decision_radyani_avatar_tooltip
	desc = decision_radyani_avatar_desc
	confirm_text = decision_radyani_avatar_confirm
	
	decision_group_type = realms_in_exile_major
	
	is_shown = {
		is_landed = yes
		has_faith = faith:faith_yom
		has_trait = possessed
		has_title = title:k_isra
		
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_radyani_avatar
			}
		}
	}
	
	is_valid = {
		highest_held_title_tier >= tier_kingdom
		has_faith = faith:faith_yom
		has_trait = possessed
		piety_level >= 4
	}
	
	is_valid_showing_failures_only = {
		is_at_war = no
		is_imprisoned = no
		is_available_adult = yes
	}
	
	cost = { 
		piety = 1000 
	}
	
	effect = {
		faith:faith_yom = {
			change_fervor = {
				value = 10
				desc = fervor_gain_holy_order_founded
			}
			hidden_effect = {
				remove_doctrine = doctrine_no_head
				add_doctrine = doctrine_temporal_head
			}
			set_religious_head_title = title:k_avatar_of_yom
		}
		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}
		title:k_avatar_of_yom = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
		
		hidden_effect = {
			if = { limit = { has_title = title:k_isra } }
			set_primary_title_to = title:k_isra 
		}

		#	Create Holy Order for Yóm
	 	#custom_tooltip = create_holy_order_decision_effect_message
	 	title:c_carnesra = { save_scope_as = designated_county }
	 	# Select an appropriate barony. If there's an empty space in the capital, we create a castle.
	 	# Otherwise, grab an existing non-capital castle/city.
	 	if = {
	 		limit = { scope:designated_county = { any_county_province = { has_holding = no } } }
	 		scope:designated_county = {
	 			random_county_province = {
	 				limit = { has_holding = no }
	 				set_holding_type = castle_holding
	 				barony = { save_scope_as = leased_barony }
				}
	 		}
	 	}
	 	else = {
	 		scope:designated_county = {
	 			random_county_province = {
	 				limit = {
	 					is_county_capital = no
	 					OR = {
	 						has_holding_type = castle_holding
	 						has_holding_type = city_holding
	 					}
	 				}
	 				barony = { save_scope_as = leased_barony }
	 			}
	 		}
	 	}
	 	# Create a suitable leader for the Holy Order.
	 	create_character = {
	 		template = new_warrior_character
			gender_female_chance = 100
			culture = root.capital_county.culture
			faith = root.capital_county.faith
	 		location = scope:leased_barony.title_province
	 		save_scope_as = leader
	 	}
	 	# Create the actual Holy Order.
	 	create_holy_order = {
	 		leader = scope:leader
	 		capital = scope:leased_barony
	 		save_scope_as = new_holy_order
	 	}
	 	hidden_effect = {
	 		scope:leader = {
	 			add_trait = order_member
	 			add_piety_level = 3
	 			add_gold = holy_order_starting_gold
	 			every_courtier = {
	 				add_trait = order_member
 					set_culture = root.culture
	 				set_character_faith = root.faith
	 			}
	 		}
	 	}
	 	# Give it some buildings.
		hidden_effect = {
			scope:leased_barony.title_province = {
				if = {
					limit = { NOT = { has_building_or_higher = watermills_01 } }
					if = {
						limit = { free_building_slots > 0 }
					}
					add_building = watermills_02
				}
				if = {
					limit = { NOT = { has_building_or_higher = caravanserai_01 } }
					if = {
						limit = { free_building_slots > 0 }
					}
					add_building = caravanserai_02
				}
				if = {
					limit = { NOT = { has_building_or_higher = hunting_grounds_01 } }
					if = {
						limit = { free_building_slots > 0 }
					}
					add_building = hunting_grounds_01
				}
			}
		}

		send_interface_toast = {
			type = holy_order_founded_message
			desc = i_created_holy_order_message
			left_icon = scope:leader
			right_icon = scope:new_holy_order.title
		}
		save_scope_as = holy_order_creator
		every_ruler = {
			limit = {
				faith = scope:holy_order_creator.faith
				NOT = { this = scope:holy_order_creator }
			}
			send_interface_message = {
				type = holy_order_founded_message
				desc = someone_created_holy_order_message
				left_icon = scope:holy_order_creator
				right_icon = scope:new_holy_order.title
			}
		}
		every_neighboring_top_liege_realm_owner = {
			limit = { NOT = { faith = scope:holy_order_creator.faith } }
			send_interface_message = {
				type = enemy_holy_order_founded_message
				desc = other_faith_neighbor_created_holy_order_message
				left_icon = scope:holy_order_creator
				right_icon = scope:new_holy_order.title
			}
		}
		
		if = {
			limit = { exists = title:d_arien.holder }
			title:d_arien.holder ?= {
				add_opinion = {
					modifier = annoyed_opinion
					target = root
					opinion = -50
				}
			}
		}
		if = {
			limit = { exists = title:d_nhazadh.holder }
			title:d_nhazadh.holder ?= {
				add_opinion = {
					modifier = annoyed_opinion
					target = root
					opinion = -50
				}
			}
		}

		trigger_event = {
			id = sirayn.1605
		}
		
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_radyani_avatar
		}
	}
}


decision_secure_sirayn = {
	title = decision_secure_sirayn
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_radyani_02.dds" 
	}
	sort_order = 750
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	
	selection_tooltip = decision_secure_sirayn_tooltip
	desc = decision_secure_sirayn_desc
	confirm_text = decision_secure_sirayn_confirm
	
	decision_group_type = realms_in_exile_major
	
	sort_order = 950
	
	is_shown = {
		is_landed = yes
		faith.religion = religion:sirayn_religion
		OR = {
			title:e_sirayn = {
				any_de_jure_county = { # Is there a hostile non-Tayee faith county in Sirayn?
					faith = {
						AND = {
							religion != religion:sirayn_religion
							faith_hostility_level = { 
								target = root.faith
								value >= faith_hostile_level
							}
						}
					}
				}
			}
			faith = faith:faith_yom #Or you're Yomi
		}
		
		NOT = { # Let this be taken more than once, but not by the same person
			has_character_flag = decision_secure_sirayn_flag
		}
	}

	is_valid = {
		highest_held_title_tier >= tier_kingdom #Only Kings and Emperors
		custom_tooltip = {
			text = decision_secure_sirayn_trigger_tt
			title:e_sirayn = {
				any_de_jure_county = { # There are no hostile non-Tayee faith rulers in Sirayn
					holder.faith = {
						NAND = {
							religion != religion:sirayn_religion
							faith_hostility_level = { 
								target = root.faith
								value >= faith_evil_level
							}
						}
					}
					count = all
				}
			}
		}
		custom_tooltip = {
			text = fervor_greater_than_50
			faith.fervor >= 50
		}
	}

	is_valid_showing_failures_only = {
		is_landed = yes
		is_capable_adult = yes
		is_imprisoned = no
		is_independent_ruler = yes
		is_available_adult = yes
		is_at_war = no
	}

	cost = {
		piety = 500
	}

	effect = {
		add_character_modifier = {
			modifier = sirayn_secured_modifier
			years = 20
		}
		custom_tooltip = decision_secure_sirayn_effect_tt
		save_scope_value_as = {
			name = fervor_value
			value = {
				add = root.faith.fervor
				divide = 10
			}
		}
		title:e_sirayn = {
			ordered_de_jure_county = {
				limit = {
					faith != root.faith
					holder.top_liege = root
				}
				order_by = {
					value = 1
					if = {
						limit = {
							any_neighboring_county = {
								faith = root.faith
							}
						}
						every_neighboring_county = {
							limit = {
								faith = root.faith
							}
							add = 50
						}
					}
					if = {
						limit = {
							any_neighboring_county = {
								this = root.capital_county
							}
						}
						add = 10000
					}
					if = {
						limit = {
							kingdom = root.capital_county.kingdom
						}
						add = 10
					}
					if = {
						limit = {
							OR = {
								title_province.barony = {
									is_holy_site_of = root.faith
								}
								faith.religion != root.faith.religion
							}
						}
						multiply = 10
					}
				}
				set_county_faith = root.faith
				max = scope:fervor_value 
			}
		}
		faith = {
			change_fervor = {
				value = 10
				desc = fervor_gain_sirayn_fervor
			}
		}
		add_character_flag = decision_secure_sirayn_flag
	}
}


decision_destroy_arienism = { # Adapted from vanilla Dismantle Papacy
	title = decision_destroy_arienism
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_radyani_02.dds" 
	}
	sort_order = 750
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	
	selection_tooltip = decision_destroy_arienism_tooltip
	desc = decision_destroy_arienism_desc
	confirm_text = decision_destroy_arienism_confirm
	
	decision_group_type = realms_in_exile_major
	
	sort_order = 999
	
	is_shown = {
		is_landed = yes
		has_faith = faith:faith_yom
		faith:faith_arienism = {
			faith_hostility_level = { # In case you do something funny...
				target = root.faith
				value >= faith_hostile_level
			}
		}

		highest_held_title_tier >= tier_kingdom #Only Kings and Emperors

		title:e_khy.holder = { # Does Khy exist?
			has_faith = faith:faith_arienism
			NOT = { 
				this = root
			}
		}
		
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_destroy_arienism
			}
		}
	}

	is_valid = {
		completely_controls = title:k_khy
		trigger_if = { # HOF is smited
			limit = {
				exists = title:d_arien.holder
			}
			title:d_arien.holder = { is_landed = no } #If he fled elsewhere, it cannot be done, the Pope must be landless.
		}
		title:e_khy.holder = { # Empire must still exist
			has_faith = faith:faith_arienism
			has_title = title:e_khy
		}
		highest_held_title_tier >= tier_kingdom #Only Kings and Emperors
		piety_level >= 3
		prestige_level >= 3
		custom_tooltip = {
			text = fervor_greater_than_70
			faith.fervor >= 70
		}
		has_faith = faith:faith_yom
	}

	is_valid_showing_failures_only = {
		is_landed = yes
		is_capable_adult = yes
		is_imprisoned = no
		is_independent_ruler = yes
		is_available_adult = yes
		is_at_war = no

		trigger_if = { # HOF is smited
			limit = {
				exists = title:d_arien.holder
			}
			title:d_arien.holder = { is_at_war = no } #Shouldn't be possible during a Crusade
		}
	}

	cost = {
		piety = 100
		prestige = 500
	}

	effect = {
		custom_tooltip = destroy_arienism_effect_tooltip
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_destroy_arienism
		}
		gain_holy_legend_seed_tooltip_effect = yes
		hidden_effect = {
			legend_seed_great_deed_faith_effect = {
				ANTAGONIST = title:d_arien.holder
				OLD_FAITH = title:d_arien.holder.faith
			}
		}

		# Destroy Khy
		if = {
			limit = {
				exists = title:e_khy
			}
			destroy_title = title:e_khy
		}
		title:e_khy.holder = { # Khy is a wimp now
			add_dread = major_dread_loss
			add_legitimacy = {
				value = 0
				subtract = title:e_khy.holder.legitimacy
			}
		}

		#Destroy the Papacy time
		show_as_tooltip = {
			destroy_arienism_scripted_effect = yes
		}

		# Remove Zarinusha 
		province:6294 = {
			if = {
				limit = {
					has_building = wonder_zarinusha_01
				}
				remove_building = wonder_zarinusha_01
				add_special_building = wonder_zarinusha_destroyed_01
			}
		}
		hidden_effect = {
			title:c_zarinusha = {
				set_county_faith = root.faith
			}
		}

		add_piety_level = 1
		add_dread = 50

		trigger_event = {
			id = sirayn.1650
		}
	}
}


# Powa 

decision_form_powa_kingdom = {
	title = decision_form_powa_kingdom_title
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_harad_03.dds"
	}
	sort_order = 500

	decision_group_type = realms_in_exile_major

	ai_check_interval = 12
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	selection_tooltip = decision_form_powa_kingdom_tooltip
	desc = decision_form_powa_kingdom_desc
	confirm_text = decision_form_powa_kingdom_confirm
	
	is_shown = {
		dynasty ?= dynasty:dynasty_latantee
		has_variable = powan_unification
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_form_powa_kingdom
			}
		}
	}

	is_valid = {
		trigger_if = { #Triggers for diplo route
			limit = {
				has_variable = powan_unification
				var:powan_unification = flag:diplomacy
			}
			prestige_level >= 3
			trigger_if = {
				limit = { has_title = title:k_poa }
				custom_tooltip = {
					text = decision_form_powa_kingdom_diplo_trigger_tt
					decision_unite_poa_value_normalized >= 50
				}
			}
			trigger_else = {
				custom_tooltip = {
					text = decision_form_powa_kingdom_diplo_trigger_tt
					decision_unite_poa_value_normalized >= 80
				}
			}
		}
		trigger_else = { #Triggers for martial route
			custom_tooltip = {
				text = decision_form_powa_kingdom_effect_tt_2
				decision_unite_poa_martial_route >= 50
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
	
	effect = {
		change_government = clan_government
		get_title = title:k_poa
		custom_tooltip = {
			text = decision_form_powa_kingdom_effect_tt_1
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
				add_claim_on_loss = no
			}
			random = {
				chance = 60
				title:k_poa = {
					every_de_jure_county_holder = {
						limit = { 
							OR = {
								root = { has_hook = prev }
								has_relation_friend = root
								has_relation_lover = root
								trigger_if = {
									limit = { 
										root = { is_confederation_member = yes }
										root.confederation = { save_temporary_scope_as = root_confederation }
									}
									OR = {
										is_member_of_confederation = scope:root_confederation
										top_liege = { is_member_of_confederation = scope:root_confederation }
									}
								}
							}
						}
						change_government = clan_government
						every_held_county = {
							title_province = { set_holding_type = castle_holding }
						}
						change_liege = {
							liege = root
							change = scope:change
						}
					}
				}
			}
			resolve_title_and_vassal_change = scope:change
			random = {
				chance = 60
				title:k_poa = {
					every_de_jure_county_holder = {
						limit = { 
							is_independent_ruler = no
							top_liege = root
						}
						change_government = clan_government
						every_held_county = {
							title_province = { set_holding_type = castle_holding }
						}
					}
				}
			}
		}
		title:c_tul_poac.title_province = {
			add_special_building = wonder_tul_poac_monument_01
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_form_powa_kingdom
		}
		trigger_event = sirayn.1004
		every_held_county = {
			title_province = { set_holding_type = castle_holding }
		}
	}
}

decision_make_powa_mercantile_center = {
	title = decision_make_powa_mercantile_center_title
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_harad_03.dds"
	}
	sort_order = 499

	decision_group_type = realms_in_exile_major

	ai_check_interval = 12
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
	selection_tooltip = decision_make_powa_mercantile_center_tooltip
	desc = decision_make_powa_mercantile_center_desc
	confirm_text = decision_make_powa_mercantile_center_confirm
	
	is_shown = {
		dynasty ?= dynasty:dynasty_latantee
		has_variable = powan_unification
		is_target_in_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_form_powa_kingdom
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_make_powa_mercantile_center
			}
		}
	}

	is_valid = {
		has_trait = lifestyle_trans_haradric_merchant
		has_trait_xp = {
			trait = lifestyle_trans_haradric_merchant
			value >= 50
		}
		custom_tooltip = {
			text = decision_make_powa_mercantile_center_effect_tt_1
			any_neighboring_top_liege_realm_owner = {
				count >= 5
				OR = {
					root = { has_hook = prev }
					has_relation_friend = root
					has_relation_lover = root
					is_tributary_of_suzerain_or_above = root
				}
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
	
	effect = {
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_make_powa_mercantile_center
		}
		title:c_tul_poac.title_province = {
			hidden_effect = { remove_building = wonder_tul_poac_monument_01 }
			add_special_building = wonder_tul_poac_monument_02
			
		}
		title:c_tul_poac = {
			add_county_modifier = {
				modifier = powan_unification_county_modifier
				years = 15
			}
		}
		dynasty ?= {
			add_dynasty_modifier = {
				modifier = powan_unification_dynasty_modifier
			}
		}
		trigger_event = sirayn.1005
	}
}

decision_choose_new_tayee_patron = {
	ai_check_interval = 12
	picture = {reference = "gfx/interface/illustrations/decisions/fp3/fp3_decision_foundation.dds"}
	sort_order = 100

	decision_group_type = realms_in_exile_minor
	
	cooldown = { years = 30 }

	is_shown = {
		faith = {
			has_doctrine = tenet_sirayn_syncretism
		}
		is_landed = yes
	}
	
	is_valid_showing_failures_only = {
		OR = {
			faith.religion = religion:sirayn_religion
			faith.religion = religion:harshandatt_religion
		}
	}

	is_valid = {
		
	}
	
	widget = {
		gui = "decision_view_widget_generic_multichoice_with_effects"
		controller = decision_option_list_controller
		decision_to_second_step_button = "CHOOSE_TAYEE_FAITH"
		show_from_start = yes

		# Personality traits get 5 points. All faiths get 10 points for having counties of them. All other weightings are at your, yes, your, discretion
		
		### Mirsaya
		item = {
			value = choose_mirsaya
			is_valid = {
				NOT = { faith = faith:faith_mirsaya }
			}
			current_description = choose_mirsaya_desc
			localization = choose_mirsaya_name
			icon = "gfx/interface/icons/faith/custom_sirayn_mirsaya.dds"
			ai_chance = {
				value = 10 # Traditional head of pantheon = higher base value
				if = {
					limit = {
							has_trait = calm
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = honest
					}
					add = 5
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_mirsaya
						}
					}
					add = 10
				}
			}
		}
		### Num
		item = {
			value = choose_num
			is_valid = {
				NOT = { faith = faith:faith_num }
			}
			current_description = choose_num_desc
			localization = choose_num_name
			icon = "gfx/interface/icons/faith/custom_sirayn_num.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = diligent
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = arrogant
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = just
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = zealous
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = stubborn
					}
					add = 5
				}
				if = { # Scholars follow the scholar faith
					limit = {
							has_trait = scholar
					}
					add = 20
				}
				if = { # Might as well make the HoF relevant
					limit = {
						exists = title:d_gabbaz_balahask.holder
						opinion = {
							target = title:d_gabbaz_balahask.holder
							value > 50
						}
					}
					add = 20
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_num
						}
					}
					add = 10
				}
			}
		}
		### Lalit
		item = {
			value = choose_lalit
			is_valid = {
				NOT = { faith = faith:faith_lalit }
			}
			current_description = choose_lalit_desc
			localization = choose_lalit_name
			icon = "gfx/interface/icons/faith/custom_sirayn_lalit.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = forgiving
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = generous
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = gregarious
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = humble
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = trusting
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = compassionate
					}
					add = 5
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_lalit
						}
					}
					add = 10
				}
			}
		}
		### Vinaleem
		item = {
			value = choose_vinaleem
			is_valid = {
				NOT = { faith = faith:faith_vinaleem }
			}
			current_description = choose_vinaleem_desc
			localization = choose_vinaleem_name
			icon = "gfx/interface/icons/faith/custom_sirayn_vinaleem.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = lustful
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = gluttonous
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = fickle
					}
					add = 5
				}
				if = { # Seducers follow the seducer faith
					limit = {
							has_trait = seducer
					}
					add = 20
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_vinaleem
						}
					}
					add = 10
				}
			}
		}

		### Markur
		item = {
			value = choose_markur
			is_valid = {
				NOT = { faith = faith:faith_markur }
			}
			current_description = choose_markur_desc
			localization = choose_markur_name
			icon = "gfx/interface/icons/faith/custom_sirayn_markur.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = shy
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = patient
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = temperate
					}
					add = 5
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_markur
						}
					}
					add = 10
				}
			}
		}
		### Garauda
		item = {
			value = choose_sirayn_garauda
			is_valid = {
				NOT = { faith = faith:faith_sirayn_garauda }
			}
			current_description = choose_sirayn_garauda_desc
			localization = choose_sirayn_garauda_name
			icon = "gfx/interface/icons/faith/custom_sirayn_garauda.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = diligent
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = content
					}
					add = 5
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_sirayn_garauda
						}
					}
					add = 10
				}
			}
		}
		### Yom
		item = {
			value = choose_yom
			is_valid = {
				NOT = { faith = faith:faith_yom }
			}
			current_description = choose_yom_desc
			localization = choose_yom_name
			icon = "gfx/interface/icons/faith/custom_sirayn_yom.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = vengeful
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = paranoid
					}
					add = 5
				}
				if = { # Witches follow the witch faith
					limit = {
							has_trait = witch
					}
					add = 50
				}
				if = { # To show reactionary sentiment
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_arienism
						}
					}
					add = 20
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_yom
						}
					}
					add = 10
				}
				
			}
		}
		### Ulokan
		item = {
			value = choose_ulokan
			is_valid = {
				NOT = { faith = faith:faith_ulokan }
			}
			current_description = choose_ulokan_desc
			localization = choose_ulokan_name
			icon = "gfx/interface/icons/faith/custom_sirayn_ulokan.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = fickle
					}
					add = 5
				}
				if = { # Mariners follow the mariner faith
					limit = {
							has_trait = lifestyle_mariner
					}
					add = 40
				}
				if = { # Lynerians are always coastal
					limit = {
						OR = {
							culture = culture:lynerian
							culture = { any_parent_culture_or_above = { this = culture:lynerian } }
						}
					}
					add = 50
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_ulokan
						}
					}
					add = 10
				}
			}
		}
		### Anhur
		item = {
			value = choose_anhur
			is_valid = {
				NOT = { faith = faith:faith_anhur }
				liege.capital_county.title_province ?= {
							geographical_region = middleearth_harad_bayoformal_harshandatt
					}
			}
			current_description = choose_anhur_desc
			localization = choose_anhur_name
			icon = "gfx/interface/icons/faith/custom_harshandatt_anhur.dds"
			ai_chance = {
				value = 0
				if = { # Really only a thing among communities with Muranian influence
					limit = {
						OR = {
							culture = culture:muranian
							culture = { any_parent_culture_or_above = { this = culture:muranian } }
						}
					}
					add = 50
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_anhur
						}
					}
					add = 10
				}
			}
		}
		### Shyra
		item = {
			value = choose_shyra
			is_valid = {
				NOT = { faith = faith:faith_shyra }
			}
			current_description = choose_shyra_desc
			localization = choose_shyra_name
			icon = "gfx/interface/icons/faith/custom_sirayn_shyra.dds"
			ai_chance = {
				value = 0
				if = {
					limit = {
							has_trait = sadistic
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = arrogant
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = vengeful
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = brave
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = wrathful
					}
					add = 5
				}
				if = { # Bulgans go unga bunga
					limit = {
						OR = {
							culture = culture:bulgan
						}
					}
					add = 30
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_shyra
						}
					}
					add = 10
				}
			}
		}
		### Taimaraud
		item = {
			value = choose_taimaraud
			is_valid = {
				NOT = { faith = faith:faith_taimaraud }
			}
			current_description = choose_taimaraud_desc
			localization = choose_taimaraud_name
			icon = "gfx/interface/icons/faith/custom_sirayn_taimaraud.dds"
			ai_chance = {
				value = -10 # Shouldn't be popular
				if = {
					limit = {
							has_trait = eccentric
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = temperate
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = callous
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = just
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = vengeful
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = deceitful
					}
					add = 5
				}
				if = {
					limit = {
							has_trait = cynical
					}
					add = 5
				}
				if = { # Schemers follow the schemer faith
					limit = {
							has_trait = schemer
					}
					add = 20
				}
				if = {
					limit = {
						any_sub_realm_county = {
							faith = faith:faith_taimaraud
						}
					}
					add = 10
				}
			}
		}
	}

	effect = {
		if = {
			limit = { scope:choose_markur = yes }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_markur }
			}
			show_as_tooltip = { set_character_faith = faith:faith_markur }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_markur
			}
			faith:faith_markur = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_sirayn_garauda = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_sirayn_garauda }
			}
			show_as_tooltip = { set_character_faith = faith:faith_sirayn_garauda }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_sirayn_garauda
			}
			faith:faith_sirayn_garauda = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_mirsaya = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_mirsaya }
			}
			show_as_tooltip = { set_character_faith = faith:faith_mirsaya }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_mirsaya
			}
			faith:faith_mirsaya = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_num = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_num }
			}
			show_as_tooltip = { set_character_faith = faith:faith_num }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_num
			}
			faith:faith_num = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_lalit = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_lalit }
			}
			show_as_tooltip = { set_character_faith = faith:faith_lalit }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_lalit
			}
			faith:faith_lalit = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_vinaleem = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_vinaleem }
			}
			show_as_tooltip = { set_character_faith = faith:faith_vinaleem }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_vinaleem
			}
			faith:faith_vinaleem = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_yom = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_yom }
			}
			show_as_tooltip = { set_character_faith = faith:faith_yom }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_yom
			}
			faith:faith_yom = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_ulokan = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_ulokan }
			}
			show_as_tooltip = { set_character_faith = faith:faith_ulokan }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_ulokan
			}
			faith:faith_ulokan = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_anhur = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_anhur }
			}
			show_as_tooltip = { set_character_faith = faith:faith_anhur }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_anhur
			}
			faith:faith_anhur = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_shyra = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_shyra }
			}
			show_as_tooltip = { set_character_faith = faith:faith_shyra }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_shyra
			}
			faith:faith_shyra = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
		}
		else_if = {
			limit = { scope:choose_shyra = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_shyra }
			}
			show_as_tooltip = { set_character_faith = faith:faith_shyra }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_shyra
			}
			faith:faith_shyra = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
			show_as_tooltip = { custom_tooltip = choose_new_tayee_patron_loose_access }
		}
		else_if = {
			limit = { scope:choose_taimaraud = yes  }
			
			if = {
				limit = {
					capital_county.faith = faith
				}
				capital_county = { set_county_faith = faith:faith_taimaraud }
			}
			show_as_tooltip = { set_character_faith = faith:faith_taimaraud }
			hidden_effect = {
				set_character_faith_with_conversion = faith:faith_taimaraud
			}
			faith:faith_taimaraud = {
				change_fervor = {
					value = 5
					desc = fervor_gain_sirayn_fervor
				}
			}
			show_as_tooltip = { custom_tooltip = choose_new_tayee_patron_loose_access }
		}
		capital_county = {
			add_county_modifier = {
				modifier = religious_settler_influx
				years = 10
			}
		}
	}
	
	cost = {
		piety = {
			value = major_piety_value
		}
	}
	
	ai_potential = {
		highest_held_title_tier >= tier_county
		is_landed = yes
		is_at_war = no
	}

	ai_will_do = {
		base = 20
		
		modifier = {
			add = {
				value = ai_zeal
				multiply = -0.5
			}
		}
		
		modifier = {
			add = -20
			has_trait = craven
		}
		
		modifier = {
			add = 20
			has_trait = ambitious
		}
	}
}


############################
#### KHORAHIL DECISIONS ####
############################

decision_favor_overseers = { #AKA Stabilise Sirayn
	title = decision_favor_overseers
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_urukhai_04.dds"
	}
	sort_order = 200
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}

	selection_tooltip = decision_favor_overseers_tooltip
	desc = decision_favor_overseers_desc
	confirm_text = decision_favor_overseers_confirm
	
	
	decision_group_type = realms_in_exile_major
	
	is_shown = {
		has_character_flag = is_khorahil
		has_title = title:e_thon_an_kharlokh
		NOT = {
			OR = {
				has_character_flag = khorahil_has_bulgans
				has_character_flag = khorahil_has_black_numenoreans
				has_character_flag = khorahil_has_orcs
			}
		}
	}	
	is_valid = {
		AND = {
			has_title = title:e_sirayn
			completely_controls = title:k_chennacatt
			completely_controls = title:d_ne_tava
			completely_controls = title:d_erim_poa
			completely_controls = title:d_sirsisa
			completely_controls = title:d_maudara
			completely_controls = title:d_devesa
			completely_controls = title:d_harina
			completely_controls = title:d_kirma
		}	
	}
	cost = {
		prestige = 350
	}
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
		}
	effect = {
		custom_tooltip = {
			text = decision_favor_overseers_effect.tt
			trigger_event = {
				id = sirayn.0001
			}
		}
		
	}
}
