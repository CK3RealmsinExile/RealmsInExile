### Mardat storyline decisions ###

@rob_merchants_cooldown_time = 1825

@vatalinar_investigation_cooldown_time = 1095

decision_envoy_haruzan = { # Send envoys to Haruzan for minor rewards
	title = decision_envoy_haruzan
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_harad_04.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_envoy_haruzan_tooltip
	desc = decision_envoy_haruzan_desc
	confirm_text = decision_envoy_haruzan_confirm
	decision_group_type = mardat_civil_war
	sort_order = 40
	ai_will_do = {
		base = 100
	}

	is_shown = {
		title:k_haruzan = { is_title_created = yes }
		title:k_haruzan.holder = {
    		faith = faith:faith_haruze
			dynasty = dynasty:dynasty_ayerikka
		}
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:haruzan_envoy
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	cost = {
		gold = {
			value = 500
			if = {
				limit = {
					is_ai = yes
				}
			multiply = 0.5
			}
		multiply = 1
		}
	}

	is_valid = {
		prestige_level >= 2
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0103
		custom_tooltip = mardat_envoy_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:haruzan_envoy
			}
	}
}

decision_stormhost_support = { # Ask the Stormhost to support you
	title = decision_stormhost_support
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_adunai_01.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_stormhost_support_tooltip
	desc = decision_stormhost_support_desc
	confirm_text = decision_stormhost_support_confirm
	decision_group_type = mardat_civil_war
	sort_order = 90	
	ai_will_do = {
		base = 100
	}
	
	is_shown = {
		title:e_thon_an_kharlokh = { is_title_created = yes }
		title:e_thon_an_kharlokh.holder = {
    		faith = faith:faith_anballukhor
		}
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:stormhost_support
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		trigger_if = {
			limit = {
				NOT= {
					is_ai = yes
				}
			}
			prestige_level >= 2
		}
		trigger_if = {
			limit = { 
				is_ai = yes
			}
			current_date > 7038.1.1
		}		
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	cost = {
		prestige = {
			value = 2000
			if = {
				limit = {
					is_ai = yes
				}
			multiply = 0
			}
		}
	}

	effect = {
		trigger_event = ray_story.0107 
		custom_tooltip = mardat_stormhost_support_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:stormhost_support
		}
	}
}

decision_powan_support = { # Ask the Powans to support you
	title = decision_powan_support
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_harad_06.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_powan_support_tooltip
	desc = decision_powan_support_desc
	confirm_text = decision_powan_support_confirm
	decision_group_type = mardat_civil_war
	ai_will_do = {
		base = 100
	}	
	sort_order = 90

	is_shown = {
		title:d_ne_sargoa = { is_title_created = yes }
		title:d_ne_sargoa.holder = {
    		faith = faith:faith_shyra
			culture = culture:poan
		}
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:powan_support
			}
		}
	}

	is_valid = {
		title:d_ne_sargoa.holder = {
			is_at_war = no
		}
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}				
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		add_character_flag = mardat_schemes_blocked
		trigger_event = ray_story.0114
		custom_tooltip = mardat_powan_support_effects_tt
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:powan_support
			}
	}
}

decision_nafarati_support = { # Ask the Nafarati to support you
	title = decision_nafarati_support
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_harad_07.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_nafarati_support_tooltip
	desc = decision_nafarati_support_desc
	confirm_text = decision_nafarati_support_confirm
	decision_group_type = mardat_civil_war
	ai_will_do = {
		base = 100
	}	
	sort_order = 90

	is_shown = {
		title:d_delritha = { is_title_created = yes }
		title:d_delritha.holder ?= {
    		faith = faith:faith_indur
			culture = culture:nafarati
		}
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:nafarati_support
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		title:d_delritha.holder = {
			is_at_war = no
		}
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}	
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0121
		custom_tooltip = mardat_nafarati_support_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:nafarati_support
			}
	}
}

decision_infiltration = { # Infiltrate the capital
	title = decision_infiltration
	picture = {
        reference = "gfx/interface/illustrations/decisions/fp3_decision_tax_collector.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_infilration_tooltip
	desc = decision_infilration_desc
	confirm_text = decision_infilration_confirm
	decision_group_type = mardat_coup
	ai_will_do = {
		base = 100
	}	
	sort_order = 99

	is_shown = {
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_infiltration
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	cost = {
		gold = {
			value = 500
			multiply = 1
		}
	}

	is_valid = {
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0133
		custom_tooltip = decision_infilration_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_infiltration
		}
	}
}

decision_guard_takeover = { # take over the guard
	title = decision_guard_takeover
	picture = {
        reference = "gfx/interface/illustrations/decisions/fp3_decision_tax_collector.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_guard_takeover_tooltip
	desc = decision_guard_takeover_desc
	confirm_text = decision_guard_takeover_confirm
	decision_group_type = mardat_coup
	ai_will_do = {
		base = 100
	}	
	sort_order = 99

	is_shown = {
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_character_flag = mardat_capital_spies
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_guard
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0136
		custom_tooltip = decision_guard_takeover_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_guard
			}
	}
}

decision_rob_merchants = { # rob merchants
	title = decision_rob_merchants
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_raiding.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_rob_merchants_tooltip
	desc = decision_rob_merchants_desc
	confirm_text = decision_rob_merchants_confirm
	decision_group_type = mardat_coup
	ai_will_do = {
		base = 100
	}	
	sort_order = 90

	cooldown = { days = @rob_merchants_cooldown_time }

	is_shown = {
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		NOT = {has_character_flag = mardat_discovered_rob}
		has_title = title:d_suza_riy
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
	}

	cost = {
		gold = {
			value = 200
			multiply = 1
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		add_character_flag = mardat_schemes_blocked
		trigger_event = ray_story.0138
		custom_tooltip = decision_rob_merchants_effects_tt
	}
}

decision_convert_radicals = { # convert people in the capital to the cult of Khäz-gramaze
	title = decision_convert_radicals
	picture = {
		reference = "gfx/interface/illustrations/decisions/fp3/fp3_decision_foundation.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_convert_radicals_tooltip
	desc = decision_convert_radicals_desc
	confirm_text = decision_convert_radicals_confirm
	decision_group_type = mardat_coup
	ai_will_do = {
		base = 100
	}	
	sort_order = 92

	is_shown = {
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_character_flag = mardat_capital_spies
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_radicals
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
	}

	cost = {
		piety = {
			value = 500
			multiply = 1
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0143
		custom_tooltip = decision_convert_radicals_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_radicals
			}
	}
}

decision_block_port = { # Get a fleet
	title = decision_block_port
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_corsair_02.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_block_port_tooltip
	desc = decision_block_port_desc
	confirm_text = decision_block_port_confirm
	decision_group_type = mardat_coup
	ai_will_do = {
		base = 100
	}	
	sort_order = 93
	is_shown = {
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_character_flag = mardat_capital_spies
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_port
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0149
		custom_tooltip = decision_block_port_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_port
			}
	}
}

decision_mardat_civil_war = { # Start the civil war
	title = decision_mardat_civil_war
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_baghdad.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_mardat_civil_war_tooltip
	confirm_text = decision_mardat_civil_war_confirm
	decision_group_type = mardat_civil_war
	ai_will_do = {
		base = 100
	}	
	sort_order = 100
	desc = { 
		random_valid = {
			triggered_desc = {
				trigger = {
					NOT = {has_character_flag = powan_support}
					NOT = {has_character_flag = nafarati_support }
					NOT = {has_character_flag = stormhost_support }
				}
				desc = mardat_civil_none
			}
			
			triggered_desc = {
				trigger = {
					has_character_flag = powan_support
					NOT = {has_character_flag = nafarati_support }
					NOT = {has_character_flag = stormhost_support }
				}
				desc = mardat_civil_powa_only
			}

			triggered_desc = {
				trigger = {
					has_character_flag = nafarati_support
					NOT = {has_character_flag = powan_support }
					NOT = {has_character_flag = stormhost_support }
				}
				desc = mardat_civil_nafarati_only
			}

			triggered_desc = {
				trigger = {
					has_character_flag = stormhost_support
					NOT = {has_character_flag = nafarati_support }
					NOT = {has_character_flag = powan_support }
				}
				desc = mardat_civil_stormhost_only
			}

			triggered_desc = {
				trigger = {
					has_character_flag = powan_support
					has_character_flag = nafarati_support
					NOT = {has_character_flag = stormhost_support }
				}
				desc = mardat_civil_powa_and_nafarati
			}

			triggered_desc = {
				trigger = {
					has_character_flag = powan_support
					has_character_flag = nafarati_support
					has_character_flag = stormhost_support
				}
				desc = mardat_civil_all_allies
			}
		}
	}
	is_shown = {
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_title = title:d_suza_riy
		NOT = {is_ai = yes}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_started_civil_war
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		custom_tooltip = {
			text = mardat_only_one_scheme
			NOT = {
				has_character_flag = mardat_schemes_blocked
			}
		}	
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0153
		custom_tooltip = decision_mardat_civil_war_tt
		add_character_flag = mardat_schemes_blocked
		start_war = {
			cb = mardat_ray_claim_cb
			target = title:k_ray.holder
			claimant = root
			target_title = title:k_ray
			target_title = title:c_bozisha_dar
			target_title = title:c_aziya
			target_title = title:c_hartas
		}
		if = {
			limit = {
				title:e_bozisha_miraz = { is_title_created = no }
			}
			add_character_flag = mardat_coup_transition
		}		
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_started_civil_war
		}
	}
}

decision_coup_ray = { # Coup Ray
	title = decision_coup_ray
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_huz_margoz_election.dds"
    }
	ai_goal = yes
	ai_will_do = {
		base = 100
	}
	selection_tooltip = decision_coup_ray_tooltip
	desc = decision_coup_ray_desc
	confirm_text = decision_coup_ray_confirm
	decision_group_type = mardat_coup
	sort_order = 100

	is_shown = {
		highest_held_title_tier < tier_kingdom
		has_faith = faith:faith_haruze
		has_character_flag = mardat_is_plotting
		has_title = title:d_suza_riy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_coup_dec
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}		
	}

	is_valid = {
		trigger_if = {
			limit = {
				NOT = {
					is_ai = yes
				}
			}
			custom_tooltip = {
				text = mardat_only_one_scheme
				NOT = {
					has_character_flag = mardat_schemes_blocked
				}
			}
			custom_tooltip = {
				text = mardat_capital_spies_requierment
				has_character_flag = mardat_capital_spies
			}			
		}
		trigger_if = {
			limit = { 
				is_ai = yes
			}
			current_date >= 7043.1.1
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0163		
		custom_tooltip = decision_coup_ray_effects_tt
		add_character_flag = mardat_schemes_blocked
		if = {
			limit = {
				title:e_bozisha_miraz = { is_title_created = no }
			}
			add_character_flag = mardat_coup_transition
		}		
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_coup_dec
		}
	}
}

decision_mardat_murder_bellakar = {
	title = decision_mardat_murder_bellakar
	selection_tooltip = decision_mardat_murder_bellakar_tooltip
	desc = decision_mardat_murder_bellakar_desc
	confirm_text = decision_mardat_murder_bellakar_confirm
	sort_order = 100
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_adunai_01.dds"
	}
	
	ai_goal = yes
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}

	decision_group_type = realms_in_exile_major
	
	is_shown = {
		current_year >= 7000 # During war of the Ring
		is_independent_ruler = yes
		faith = faith:faith_haruze
		has_title = title:k_ray		
		title:e_bellakar.holder = {
			faith_is_good = yes
		}
		NOT = { has_title = title:e_bellakar }
		title:e_bellakar = { is_title_created = yes }
		exists = title:e_bellakar.holder
		not = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:decision_mardat_murder_bellakar
			}
		}
		NAND = {
			is_ai = yes
			max_military_strength < 7500
		}
	}

	is_valid = {
		piety_level >= 3
		OR = {
			has_title = title:e_bozisha_miraz
			AND = {
				has_title = title:k_ray
				has_title = title:k_raishoul
				has_title = title:k_zajantak
				piety_level >= 4
			}
		}
		NOT = { has_truce = title:e_bellakar.holder }
		NOT = { is_allied_to = title:e_bellakar.holder }
	}
	
	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}

	effect = {
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:decision_mardat_murder_bellakar
		}
		start_war = {
			casus_belli = invade_bellakar_cb
			target = title:e_bellakar.holder
			target_title = title:e_bellakar
		}
	}
}

decision_mardat_crush_reactionary = { # Crush Reactionaries
	title = decision_mardat_crush_reactionary
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_huz_01.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_mardat_crush_reactionary_tooltip
	desc = decision_mardat_crush_reactionary_desc
	confirm_text = decision_mardat_crush_reactionary_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 100

	is_shown = {
		has_faith = faith:faith_haruze
		has_character_flag = mardat_ongoing_purge
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_crush_reactionary_dec
			}
		}
	}

	is_valid = {
		custom_tooltip = {
			text = no_reactionary_vassals
			NOT = {
				any_vassal = {
					faith = faith:faith_vatra
					highest_held_title_tier >= tier_county
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = purge_of_ray.0416		
		custom_tooltip = decision_mardat_crush_reactionary_effects_tt
		custom_tooltip = {
			text = mardat_reactionary_county_effect
			every_sub_realm_county = {
				limit = {
					duchy = title:d_dar
				}
				set_county_faith = faith:faith_haruze
				change_development_level = -3
			}			
			every_sub_realm_county = {
				limit = {
					faith = faith:faith_vatra
				}
				add_county_modifier = {
					modifier = mardat_purge_county_modifier
					years = 50
				}
				change_development_level = -5
				random = {
					chance = 33
					set_county_faith = faith:faith_haruze
				}
			}
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_crush_reactionary_dec
		}
	}
}

decision_mardat_crush_revolutionary = { # Crush Revolutionaries
	title = decision_mardat_crush_revolutionary
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_huz_04.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_mardat_crush_revolutionary_tooltip
	desc = decision_mardat_crush_revolutionary_desc
	confirm_text = decision_mardat_crush_revolutionary_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 90

	is_shown = {
		has_faith = faith:faith_haruze
		has_character_flag = mardat_ongoing_purge		
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_crush_revolutionary_dec
			}
		}
	}

	is_valid = {
		custom_tooltip = {
			text = must_have_crushed_reactionaries
			has_character_flag = must_have_crushed_reactionaries_flag
		}
		custom_tooltip = {
			text = no_revolutionary_vassals
			NOT = {
				any_vassal = {
					faith = faith:faith_ray
					highest_held_title_tier >= tier_county
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = purge_of_ray.0417		
		custom_tooltip = decision_mardat_crush_revolutionary_effects_tt		
		custom_tooltip = {
			text = mardat_revolutionary_county_effect
			every_sub_realm_county = {
				limit = {
					faith = faith:faith_ray
				}
				add_county_modifier = {
					modifier = mardat_purge_county_modifier
					years = 50
				}
				change_development_level = -3
				random = {
					chance = 33
					set_county_faith = faith:faith_haruze
				}
			}
		}
		title:c_tresti = { 
			title_province = {
				remove_building = wonder_citadel_of_tresti
			}
			set_county_faith = faith:faith_haruze
			add_county_modifier = {
					modifier = mardat_purge_county_modifier
					years = 100
			}
			change_development_level = -25			
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_crush_revolutionary_dec
		}
	}
}

decision_powan_buy = { # Buy the Powan held county in Rây if you allied them (so that you can take the next decision without breaking your alliance)
	title = decision_powan_buy
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_huz_margoz_patricians.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_powan_buy_tooltip
	desc = decision_powan_buy_desc
	confirm_text = decision_powan_buy_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 70

	is_shown = {
		has_faith = faith:faith_haruze
		has_title = title:k_ray
		has_character_flag = powan_support
		title:c_zizal.holder = {
			is_ai = yes
		}					
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:powan_buy_dec
			}
		}
	}

	is_valid = {

	}

	cost = {
		prestige = 200
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0216	
		custom_tooltip = decision_powan_buy_effects_tt
		add_character_flag = mardat_schemes_blocked
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:powan_buy_dec
		}
	}
}

decision_mardat_consolidate_power = { # Consolidate power in Rây
	title = decision_mardat_consolidate_power
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_khand_01.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_mardat_consolidate_power_tooltip
	desc = decision_mardat_consolidate_power_desc
	confirm_text = decision_mardat_consolidate_power_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 150

	is_shown = {
		has_faith = faith:faith_haruze
		has_character_flag = mardat_ongoing_purge
		has_title = title:k_ray
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:mardat_consolidate_power_dec
			}
		}
	}

	is_valid = {
		custom_tooltip = {
			text = must_have_crushed_reactionaries
			has_character_flag = must_have_crushed_reactionaries_flag
		}
		custom_tooltip = {
			text = must_have_crushed_revolutionaries
			has_character_flag = must_have_crushed_revolutionaries_flag
		}
		custom_tooltip = {
			text = no_heretic_vassals
			NOT = {
				any_vassal = {
					NOT = {
						faith = faith:faith_haruze
					}
					highest_held_title_tier >= tier_county
				}
			}
		}
		completely_controls = title:k_ray
		piety_level >= 3
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = purge_of_ray.0418				
		custom_tooltip = {
			text = mardat_consolidate_county_effect
			every_sub_realm_county = {
				limit = {
					NOT = {
						faith = faith:faith_haruze
					}
				}
				add_county_modifier = {
					modifier = mardat_purge_county_modifier
					years = 50
				}
				change_development_level = -3
				change_county_control = 50
				random = {
					chance = 50
					set_county_faith = faith:faith_haruze
				}
			}
		}
		root.dynasty = {
			add_dynasty_prestige = 2000
		}	
		if = {
			limit = {
				NOR = {
					government_has_flag = government_is_administrative 
					government_has_flag = government_is_tribal
				}
			}
			add_realm_law = crown_authority_3
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:mardat_consolidate_power_dec
		}
	}
}

### Rebels of Rây decision ###

decision_organize_rebels = { # Organize local anti-Mardat rebels
	title = decision_organize_rebels
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_huz_margoz_patricians.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_organize_rebels_tooltip
	desc = decision_organize_rebels_desc
	confirm_text = decision_organize_rebels_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 80

	is_shown = {
		exists = title:k_ray.holder
		title:k_ray.holder ={
			has_character_flag = mardat_ongoing_purge
		}		
		NOT = {
			has_character_flag = purge_rebel_leader
		}
		OR = {
			faith = faith:faith_vatra
			faith = faith:faith_ray
		}
		highest_held_title_tier = tier_duchy
		NAND = {
			is_ai = yes
			has_title = title:d_gai
			NOT = {
				title:d_iunastiy.holder = {
					has_character_flag = purge_rebel_leader
				}
			}
		}
		NOT = {
			is_independent_ruler = yes
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}			
	}

	is_valid = {
		piety_level >= 2
		prestige_level >= 2
	}

	cost = {
		gold = 500
		piety = 500
	}

	effect= {
		custom_tooltip = decision_organize_rebels_effect_tt
		trigger_event = ray_story.0301
		add_character_flag = purge_rebel_leader
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
}

decision_save_purge_refugees = { # Found a refugee safe haven
	title = decision_save_purge_refugees
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_castle.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_save_purge_refugees_tooltip
	desc = decision_save_purge_refugees_desc
	confirm_text = decision_save_purge_refugees_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 70

	is_shown = {
		exists = title:k_ray.holder
		title:k_ray.holder ={
			has_character_flag = mardat_ongoing_purge
		}
		NOT = {
			has_character_flag = purge_safe_haven
		}
		OR = {
			faith = faith:faith_vatra
			faith = faith:faith_ray
		}
		highest_held_title_tier = tier_duchy
		NAND = {
			is_ai = yes
			has_title = title:d_gai
			NOT = {
				title:d_iunastiy.holder = {
					has_character_flag = purge_safe_haven
				}
			}
		}
		NOT = {
			is_independent_ruler = yes
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}						
	}

	is_valid = {
		prestige_level >= 2
		custom_tooltip = {
			text = must_have_mardat_mil_strength
			root.script_current_military_strength >= title:k_ray.holder.eighty_percent_of_current_military_strength
		}		
	}

	cost = {
		gold = 1000
		prestige = 200
	}

	effect= {
		custom_tooltip = decision_save_purge_refugees_effect_tt
		custom_tooltip = immune_from_purge
		add_character_modifier = ray_safe_haven_modifier
		trigger_event = ray_story.0306
		add_character_flag = purge_safe_haven
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
}

decision_ally_felira = { # Ally Felira
	title = decision_ally_felira
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_adunai_02.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_ally_felira_tooltip
	desc = decision_ally_felira_desc
	confirm_text = decision_ally_felira_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 90

	is_shown = {
		title:d_felira = { is_title_created = yes }
		exists = title:k_ray.holder		
		title:k_ray.holder ={
			has_character_flag = mardat_ongoing_purge
		}
		title:d_felira.holder ={
			faith = faith:faith_vatra
			is_independent_ruler = yes
		}
		NOT = {
			is_independent_ruler = yes
		}
		NOT = {
			any_ruler = {
				has_character_flag = ray_felira_alliance
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}
		OR = {
			title:c_dezful.holder = { #Don't game over a player
				is_ai = yes
			}
			title:c_dezful.holder = { 
				highest_held_title_tier > tier_county
			}			
		}
		OR = {
			title:c_baitu.holder = { #Don't game over a player
				is_ai = yes
			}
			title:c_baitu.holder = { 
				highest_held_title_tier > tier_county
			}		
		}
		AND = { #Make sure Rây does rule the counties
			title:c_baitu.holder = {
				OR = {
					AND = {
						is_independent_ruler = yes
						has_title = title:k_ray
					}
					any_liege_or_above = {
						has_title = title:k_ray
					}					
				}
			}
			title:c_dezful.holder = {
				OR = {
					AND = {
						is_independent_ruler = yes
						has_title = title:k_ray
					}
					any_liege_or_above = {
						has_title = title:k_ray
					}					
				}
			}			
		}
		faith = faith:faith_vatra
		highest_held_title_tier = tier_duchy
		NOT = { is_allied_to = title:d_felira.holder }		
	}

	is_valid = {
		prestige_level >= 3		
	}

	cost = {
		prestige = 500
	}

	effect= {
		custom_tooltip = decision_ally_felira_effect_tt
		trigger_event = ray_story.0311
		add_character_flag = ray_felira_alliance
		add_character_flag = sent_felira_alliance_offer
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
}

decision_ally_gai = { # Ally Gaì
	title = decision_ally_gai
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_ask_to_join_balan_lai.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_ally_gai_tooltip
	desc = decision_ally_gai_desc
	confirm_text = decision_ally_gai_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 90

	is_shown = {
		title:d_gai = { is_title_created = yes }
		exists = title:k_ray.holder
		title:k_ray.holder ={
			has_character_flag = mardat_ongoing_purge
		}
		title:d_gai.holder ={
			faith = faith:faith_ray
			NOT = {
				is_independent_ruler = yes
			}
			any_liege_or_above = {
				has_title = title:k_ray
			}			
		}
		NOT = {
			is_independent_ruler = yes
		}
		NOT = {
			any_ruler = {
				has_character_flag = ray_gai_alliance
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}			
		
		faith = faith:faith_ray
		highest_held_title_tier = tier_duchy
		NOT = {
			has_title = title:d_gai
		}
		NOT = { is_allied_to = title:d_gai.holder }
	}
	

	is_valid = {
		prestige_level >= 2
		piety_level >= 2
	}

	cost = {
		prestige = 300
	}

	effect= {
		custom_tooltip = decision_ally_gai_effect_tt
		trigger_event = ray_story.0316
		add_character_flag = ray_gai_alliance
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
}

decision_bellakar_support = { # Seek Bellakar's support
	title = decision_bellakar_support
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_adunai_01.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_bellakar_support_tooltip
	desc = decision_bellakar_support_desc
	confirm_text = decision_bellakar_support_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 95

	is_shown = {
		title:e_bellakar = { is_title_created = yes }
		exists = title:e_bellakar.holder
		title:k_ray.holder ={
			has_character_flag = mardat_ongoing_purge
		}
		title:e_bellakar.holder ={
			faith_is_good = yes	
		}
		NOT = {
			is_independent_ruler = yes
		}
		NOT = {
			any_ruler = {
				has_character_flag = ray_bellakar_support
			}
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}					
		faith = faith:faith_ray
		highest_held_title_tier = tier_duchy
	}
	

	is_valid = {
		prestige_level >= 3
		trigger_if = {
			limit = {
				NOT = {
					has_title = title:d_iunastiy
				}
			}
			NAND = {
				is_ai = yes
				has_title = title:d_gai
			}
		}
		trigger_if = {
			limit = {
				is_ai = yes
			}
			NOT = {
				title:e_thon_an_kharlokh = { is_title_created = yes }
			}
		}		
	}

	cost = {
		prestige = 1000
	}

	effect= {
		custom_tooltip = decision_bellakar_support_effect_tt
		if = {
			limit = {
				title:e_thon_an_kharlokh = { is_title_created = yes }
			}
			custom_tooltip = decision_bellakar_support_stormhost_nerf
		}
		trigger_event = ray_story.0321
		add_character_flag = ray_bellakar_support
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
}

decision_build_up_katri = { # Build up Katri
	title = decision_build_up_katri
	picture = {
        reference = "gfx/interface/illustrations/decisions/decision_castle_02.dds"
    }
	ai_goal = yes
	selection_tooltip = decision_build_up_katri_tooltip
	desc = decision_build_up_katri_desc
	confirm_text = decision_build_up_katri_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 75

	is_shown = {
		title:k_ray = { is_title_created = yes }		
		title:k_ray.holder ={
			has_character_flag = mardat_ongoing_purge
		}
		NOT = {
			is_independent_ruler = yes
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}					
		faith = faith:faith_ray
		highest_held_title_tier = tier_duchy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:build_up_katri
			}
		}	
		has_title = title:c_tresti
	}
	
	is_valid = {
		prestige_level >= 2	
	}

	cost = {
		gold = 1000
	}

	effect= {
		custom_tooltip = decision_build_up_katri_effect_tt
		custom_tooltip = katri_building_slot_warning
		trigger_event = {
			id = ray_story.0326
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:build_up_katri
		}		
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
}

decision_ray_rebel_uprising = { # Begin the great rebel Doom War
	title = decision_ray_rebel_uprising
	picture = {
        reference = "gfx/interface/illustrations/decisions/struggle_thani_hazad_confederation.dds"
    }
	ai_goal = yes
	ai_will_do = {
		base = 100
	}	
	selection_tooltip = decision_ray_rebel_uprising_tooltip
	desc = decision_ray_rebel_uprising_desc
	confirm_text = decision_ray_rebel_uprising_confirm
	decision_group_type = mardat_purge_of_ray
	ai_will_do = {
		base = 100
	}	
	sort_order = 100

	is_shown = {
		title:k_ray = { is_title_created = yes }			
		title:k_ray.holder ={
			has_character_flag = mardat_ongoing_purge
		}
		NOT = {
			is_independent_ruler = yes
		}
		any_liege_or_above = {
			has_title = title:k_ray
		}					
		OR = {
			faith = faith:faith_ray
			faith = faith:faith_vatra
		}
		highest_held_title_tier = tier_duchy
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:started_ray_rebel_war
			}
		}	
	}
	
	is_valid = {
		trigger_if = {
			limit = {
				is_ai = yes
			}
			NOT = {
				title:k_ray.holder = {
					any_vassal = {
						NOT = {
							is_ai = yes
						}
					}
				}
			}
		}
		calc_true_if = {
			amount >= 3
			custom_tooltip = {
				text = bellakar_counts_twice
				has_character_flag = ray_bellakar_yes
			}
			custom_tooltip = {
				text = safe_haven_requierment
				OR = {
					has_character_flag = ray_mil_haven
					has_character_flag = ray_econ_haven
				}
			}
			custom_tooltip = {
				text = is_ray_rebel_leader
				has_character_flag = rebel_consolidate_convince
			}
			custom_tooltip = {
				text = has_felira_alliance
				has_character_flag = felira_yes
			}
			custom_tooltip = {
				text = has_gai_alliance
				has_character_flag = gai_yes
			}
			custom_tooltip = {
				text = mardat_lost_bellakar_invasion
				title:k_ray.holder = {
					has_character_flag = mardat_failed_bellakar_invasion
				}
			}				
			prestige_level >= 3
			piety_level >= 3
			custom_tooltip = {
				text = must_have_mardat_mil_strength
				root.script_current_military_strength >= title:k_ray.holder.eighty_percent_of_current_military_strength
			}					
		}
	}

	cost = {
		
	}

	effect= {
		custom_tooltip = decision_ray_rebel_uprising_effect_tt
		start_war = {
			cb = ray_doom_war_cb
			target = title:k_ray.holder
			claimant = root
			target_title = title:k_ray
			target_title = title:c_bozisha_dar
			target_title = title:c_aziya
			target_title = title:c_hartas
		}		
		trigger_event = {
			id = ray_story.0328
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:started_ray_rebel_war
		}
		custom_tooltip = some_rebel_requierments_impossible	
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
}

decision_investigate_ray = { # Investigate the hidden plots within Rây
	title = decision_investigate_ray
	picture = {
		reference = "gfx/interface/illustrations/decisions/fp3_decision_tax_collector.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_investigate_ray_tooltip
	desc = decision_investigate_ray_desc
	confirm_text = decision_investigate_ray_confirm
	decision_group_type = vatalinar_story_decisions
	ai_will_do = {
		base = 100
	}
	sort_order = 90

	cooldown = { days = @vatalinar_investigation_cooldown_time }

	is_shown = {
		faith = faith:faith_vatra
		title:d_suza_riy = { is_title_created = yes }				
		title:d_suza_riy.holder = {
			has_character_flag = mardat_is_plotting
		}
		NOT = {has_character_flag = ray_mardat_trust}
		NOT = {has_character_flag = vatalinar_discovered_mardat}
		NAND = {
			has_character_flag = vatalinar_criminal_completion
			has_character_flag = vatalinar_army_completion
			has_character_flag = vatalinar_lords_completion
		}
		has_title = title:k_ray
	}

	is_valid = {

	}

	cost = {
		gold = {
			value = 300
			multiply = 1
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0403
		custom_tooltip = decision_investigate_ray_effects_tt
		add_character_modifier = {
			modifier = ray_vatalinar_paranoia
			years = 3
		}
		add_stress = 25
	}
}

decision_vatalinar_civil_war = { # Vatalinar begins the civil war
	title = decision_vatalinar_civil_war
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_baghdad.dds"
	}
	ai_goal = yes
	selection_tooltip = decision_vatalinar_civil_war_tooltip
	desc = decision_vatalinar_civil_war_desc
	confirm_text = decision_vatalinar_civil_war_confirm
	decision_group_type = vatalinar_story_decisions
	ai_will_do = {
		base = 100
	}
	sort_order = 90

	is_shown = {
		faith = faith:faith_vatra
		title:d_suza_riy = { is_title_created = yes }			
		title:d_suza_riy.holder = {
			has_character_flag = mardat_is_plotting
		}
		has_character_flag = vatalinar_discovered_mardat
		has_title = title:k_ray
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:vatalinar_start_civl_war
			}
		}		
	}

	is_valid = {

	}

	cost = {

	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

	effect = {
		trigger_event = ray_story.0420
		custom_tooltip = decision_vatalinar_civil_war_effects_tt		
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:vatalinar_start_civl_war
		}		
	}
}








