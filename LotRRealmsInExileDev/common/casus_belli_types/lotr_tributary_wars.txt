independence_tributary_war_cb = {
    group = tributary
	ai_only_against_neighbors = no

	war_name = INDEPENDENCE_WAR_NAME #independence_tributary_war_cb
	my_war_name = independence_tributary_war_me # Used when the claimant and attacker is the same person
	war_name_base = independence_tributary_war_m_b
	my_war_name_base = independence_tributary_war_m_b

    truce_days = 970

	on_primary_attacker_death = inherit
	on_primary_defender_death = invalidate

	attacker_allies_inherit = yes
	defender_allies_inherit = yes

	transfer_behavior = transfer

	interface_priority = 120

	attacker_capital_gives_war_score = yes
	defender_capital_gives_war_score = no

	attacker_wargoal_percentage = 0.8
	attacker_ticking_warscore = 0.1
	defender_ticking_warscore = 0
	max_attacker_score_from_battles = 100
	max_defender_score_from_battles = 50
	
	max_defender_score_from_occupation = 150
	max_attacker_score_from_occupation = 150

	max_ai_diplo_distance_to_title = 500

    allowed_for_character = {
        scope:attacker = {
            is_tributary = yes
        }
		
		scope:attacker = {		
			NOR = {
				has_culture = culture:wastelands
				AND = {
			        exists = primary_title.empire
			        primary_title.empire = title:e_valinor
		        }
			}
		}
		# The Necromancer is hidden
		NOT = { has_character_flag = unknown_sauron_flag } # LOTR
    }

    allowed_for_character_display_regardless = {
        scope:attacker = {
            is_tributary = yes
			suzerain = scope:defender
        }
    }

	allowed_against_character = {
        scope:attacker = {
            is_tributary = yes            
			suzerain = scope:defender
        }               
		
		scope:attacker = {		
			NOR = {
				has_culture = culture:wastelands
				AND = {
			        exists = primary_title.empire
			        primary_title.empire = title:e_valinor
		        }
			}
		}
		# The Necromancer is hidden
		NOT = { has_character_flag = unknown_sauron_flag } # LOTR
    }

	should_invalidate = {
		OR = {
			scope:defender = {
				is_independent_ruler = no
			}
			scope:defender = {
				is_tributary = yes
			}
			scope:defender = {
				primary_title = {
					tier < tier_county
				}
			}
			scope:attacker = {
				is_independent_ruler = no
			}
			scope:attacker = {
				is_tributary = no
			}
			scope:attacker = {
				primary_title = {
					tier < tier_county
				}
			}
			scope:attacker = {
				has_culture = culture:wastelands
			}
			scope:defender = {
				has_culture = culture:wastelands
			}
		}
	}

    cost = {
		piety = {
			value = 0
			add = common_cb_impious_piety_cost
		}
		prestige = {
			value = 0
			add = {
				desc = CB_BASE_COST
				add = {
					value = 100
				}
			}
			if = {
				limit = {
					scope:defender.primary_title = {
						tier = tier_duchy
					}
				}
				multiply = {
					value = 2
					desc = CB_COST_RULES_DUCHY
				}
			}
			if = {
				limit = {
					scope:defender.primary_title = {
						tier = tier_kingdom
					}
				}
				multiply = {
					value = 3
					desc = CB_COST_RULES_KINGDOM
				}
			}
			if = {
				limit = {
					scope:defender.primary_title = {
						tier = tier_empire
					}
				}
				multiply = {
					value = 4
					desc = CB_COST_RULES_EMPIRE
				}
			}


			#Innovation Prestige Discounts
			if = {
				limit = {
					scope:attacker = {
						culture = {
							has_innovation = innovation_chronicle_writing
							has_innovation = innovation_land_grants
							has_innovation = innovation_rightful_ownership
						}
					}
				}
				multiply = {
					value = 0.7
					desc = CB_ATTACKER_INNOVATIONS
				}
			}
			else_if = {
				limit = {
					scope:attacker = {
						culture = {
							OR = {
								has_innovation = innovation_chronicle_writing
								has_innovation = innovation_land_grants
							}
							OR = {
								has_innovation = innovation_land_grants
								has_innovation = innovation_rightful_ownership
							}
							OR = {
								has_innovation = innovation_chronicle_writing
								has_innovation = innovation_rightful_ownership
							}
						}
					}
				}
				multiply = {
					value = 0.8
					desc = CB_ATTACKER_INNOVATIONS
				}
			}
			else_if = {
				limit = {
					scope:attacker = {
						culture = {
							OR = {
								has_innovation = innovation_chronicle_writing
								has_innovation = innovation_land_grants
								has_innovation = innovation_rightful_ownership
							}
						}
					}
				}
				multiply = {
					value = 0.9
					desc = CB_ATTACKER_INNOVATIONS
				}
			}

			# Bellum Justum Perk
			if = {
				limit = {
					scope:attacker = {
						has_perk = bellum_justum_perk
					}
				}
				multiply = {
					add = bellum_justum_discount_percentage
					divide = 100
					desc = CB_ATTACKER_BELLUM_JUSTUM
				}
			}

			# Dynasty Warfare Perk
			if = {
				limit = {
					scope:attacker = {
						has_dynasty = yes
						dynasty = {
							has_dynasty_perk = warfare_legacy_2
						}
					}
				}
				multiply = {
					value = warfare_legacy_2_discount
					desc = CB_ATTACKER_DYNASTY_WARFARE
				}
			}
			
			if = {
				limit = {
					has_game_rule = no_cost_casus_belli_costs
				}
				multiply = {
					value = 0
					desc = CB_GAME_RULE_NO_COST
				}
			}
	
			if = {
				limit = {
					scope:attacker = {
						ai_should_get_conqueror_bonuses = yes
					}
				}
				multiply = {
					value = 0
					desc = ai_conqueror_modifier
				}
			}
		}
    }

	on_declaration = {
		on_declared_war = yes
		scope:defender = {
			every_tributary = {
				limit = { vassal_contract_has_flag = tributary_contract_tributary_forced_war_override }
				trigger_event = {
					id = tributary.0002
					days = 1
				}
			}
		}
	}

	on_victory_desc = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:attacker = { is_local_player = yes } }
				desc = trib_indp_on_victory_desc_attacker
			}
			triggered_desc = {
				trigger = { scope:defender = { is_local_player = yes } }
				desc = trib_indp_on_victory_desc_defender
			}
			desc = trib_indp_on_victory_desc
		}
	}

    on_victory = {

		#EP2 Accolade glory gain from winning against higher ranked enemy
		scope:attacker = { accolade_attacker_war_end_glory_gain_high_effect = yes }
		
		# Legitimacy
		add_legitimacy_attacker_victory_effect = yes

		scope:attacker = { 
			show_pow_release_message_effect = yes
			add_prestige = medium_prestige_value
			end_tributary = yes

			hidden_effect = {
				set_variable = {
					name = independence_war_former_liege
					value = scope:defender
				}
				add_truce_both_ways = {
					character = scope:defender
					days = 1825
					war = root.war
					result = victory
				}
			}
			
			every_war_ally = {
				limit = {
					is_tributary = yes
					suzerain = scope:defender
					has_character_flag = tributary_should_become_free
				}
				show_pow_release_message_effect = yes
				add_prestige = medium_prestige_value
				end_tributary = yes
				hidden_effect = {
					set_variable = {
						name = independence_war_former_liege
						value = scope:defender
					}
					add_truce_both_ways = {
						character = scope:defender
						days = 1825
						war = root.war
						result = victory
					}
					remove_character_flag = tributary_should_become_free
				}
			}
		}

		if = { #LotR
			limit = { exists = scope:war }
			# EP3: note gold gained from military assistance/join war contracts and their war contribution threshold
			laamp_as_mercenary_payout_tooltip_effect = yes
		}
    }

	on_white_peace_desc = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:attacker = { is_local_player = yes } }
				desc = trib_indp_on_white_peace_desc_attacker
			}
			triggered_desc = {
				trigger = { scope:defender = { is_local_player = yes } }
				desc = trib_indp_on_white_peace_desc_defender
			}
			desc = trib_indp_on_white_peace_desc
		}
	}

	on_white_peace = {
        scope:attacker = {
			show_pow_release_message_effect = yes 
			stress_impact = {
 				ambitious = medium_stress_impact_gain
 				arrogant = medium_stress_impact_gain
 			}
		}
		hidden_effect = {
			scope:attacker = {
				add_truce_both_ways = {
					character = scope:defender
					days = 1825
					war = root.war
					result = white_peace
				}
				every_war_ally = {
					limit = {
						is_tributary = yes
						suzerain = scope:defender
						has_character_flag = tributary_should_become_free
					}
					add_truce_both_ways = {
						character = scope:defender
						days = 1825
						war = root.war
						result = white_peace
					}
					remove_character_flag = tributary_should_become_free
				}
			}
		}
		scope:defender = {
			stress_impact = {
 				arrogant = medium_stress_impact_gain
 			}
			add_prestige = minor_prestige_value
		}

		if = { #LotR
			limit = { exists = scope:war }
			# EP3: note gold gained from military assistance/join war contracts and their war contribution threshold
			laamp_as_mercenary_payout_tooltip_effect = yes
		}
    }


	on_defeat_desc = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:attacker = { is_local_player = yes } }
				desc = trib_indp_on_defeat_desc_attacker
			}
			triggered_desc = {
				trigger = { scope:defender = { is_local_player = yes } }
				desc = trib_indp_on_defeat_desc_defender
			}
			desc = trib_indp_on_defeat_desc
		}
	}

    on_defeat = {
		# Legitimacy
		add_legitimacy_attacker_defeat_effect = yes

		#EP2 accolade glory gain for winning against higher ranked enemy
		scope:defender = { accolade_defender_war_end_glory_gain_med_effect = yes }

		scope:attacker = { show_pow_release_message_effect = yes }
		
		scope:attacker = {
			pay_short_term_gold_reparations_effect = {
				GOLD_VALUE = 2
			}
			every_war_ally = {
				limit = {
					is_tributary = yes
					suzerain = scope:defender
					has_character_flag = tributary_should_become_free
				}
				pay_short_term_gold_reparations_effect = {
					GOLD_VALUE = 2
				}
			}
		}
		
		scope:defender = {
			add_dread = medium_dread_gain
			# Prestige for Defender
			add_prestige_war_defender_effect = {
				PRESTIGE_VALUE = medium_prestige_value
			}
		}
		scope:war = {
			every_war_attacker = {
				limit = {
					is_tributary = yes
					suzerain = scope:defender
					has_character_flag = tributary_should_become_free
				}
				hard_imprison_character_effect = {
					TARGET = this
					IMPRISONER = scope:defender
				}
				
				remove_character_flag = tributary_should_become_free
			}
		}

		if = { #LotR
			limit = { exists = scope:war }
			# EP3: note gold gained from military assistance/join war contracts and their war contribution threshold
			laamp_as_mercenary_payout_tooltip_effect = yes
		}
    }

    on_invalidated_desc = {
        desc = trib_indp_on_invalidated_desc
    }

	ai_score = {
		value = 1
	}

	ai_score_mult = {
		value = 1
		# Do not attempt if already at war
		add = {
			if = {
				limit = {
					scope:attacker = {
						is_at_war = yes
					}
				}
				add = -1000
			}
		}
		# Do not attempt if have high opinion of suzerain
		add = {
			if = {
				limit = {
					scope:attacker = {
						save_temporary_opinion_value_as = { name = target_opinion target = scope:defender }
						scope:target_opinion >= 75
					}
				}
				add = -1000
			}
		}
		# More likely if different culture
		add = {
			if = {
				limit = {
					NOT = { scope:attacker.culture = scope:defender.culture }
				}
				add = 0.5
			}
		}
		# More likely if different religion
		add = {
			if = {
				limit = {
					NOT = { scope:attacker.religion = scope:defender.religion }
				}
				add = 0.5
			}
		}
		# Much less likely if stronger militarily than suzerain
		add = {
			if = {
				limit = {
					scope:attacker.max_military_strength < scope:defender.max_military_strength
				}
				add = -2
			}
		}
		# More likely if suzerain is at war
		add = {
			if = {
				limit = {
					scope:defender = {
						is_at_war = yes
					}
				}
				add = 0.25
			}
		}
		# More likely if large number of potential allies in other tributaries
		add = {
			if = {
				limit = {
					scope:defender = {
						any_tributary = { vassal_contract_has_flag = tributary_contract_tributary_forced_war_override }
					}
				}
				add = 0.5
			}
		}
		# Even more likely if there's a very large number of potential allies in other tributaries
		add = {
			if = {
				limit = {
					scope:defender = {
						any_tributary = { vassal_contract_has_flag = tributary_contract_tributary_forced_war_override }
					}
				}
				add = 0.5
			}
		}
		# Good factions do not like to be under the thumb!
		add = {
			if = {
				limit = {
					faith_is_good = yes
				}
				add = 0.25
			}
		}
		# LotR - Sauron and Nazgul should not target eachother
		add = {
			if = {
				limit = {
					OR = {
						AND = {
							scope:attacker = { is_sauron = yes }
							scope:defender = { has_trait = nazgul }
						}
						AND = {
							scope:defender = { is_sauron = yes }
							scope:attacker = { has_trait = nazgul }
						}
					}
				}
				add = -1000
			}
		}
		# LotR - Non-Evil faith characters leave poor Radagast alone! 
		add = {
			if = {
				limit = {
					scope:attacker = { faith_is_evil = no }
					scope:defender.culture = culture:istari
				}
				add = -1000
			}
		}

		# LotR - Protectorates are much less aggressive
		add = {
			if = {
				limit = {
					scope:attacker = {
						any_tributary = { 
							this = scope:defender
							has_subject_contract_group = tributary_protectorate
						}
					}
				}
				add = -1000
			}
		}

		#LotR
		multiply = elf_target_ai_score_value
	}

}