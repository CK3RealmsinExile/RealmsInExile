###############################
#### LotR Realm Traditions ####
###############################

### Evil Immortals ###

tradition_rule_of_the_shadows = {
    category = realm

    layers = {
        0 = intrigue
        1 = western
        4 = intricate_plotters.dds
    }

    is_shown = {
		OR = {
            has_cultural_pillar = heritage_fallen_ainur
            has_cultural_pillar = heritage_undead
        }
	}

    can_pick = { #LotR
		trigger_if = { #LotR
            limit = {
                scope:replacing ?= culture_tradition:tradition_variag_succession
            }
            custom_tooltip = {
                text = cannot_replace_variag_succession
                NOT = { has_cultural_tradition = tradition_variag_succession } #To prevent stacking after hybridization
            }
        }
	}

    parameters = {
		peasant_and_populist_factions_less_common = yes
	}
    character_modifier = {
        monthly_prestige_gain_mult = -0.30
        monthly_court_grandeur_change_mult = -0.20
        castle_holding_build_gold_cost = -0.10
		castle_holding_holding_build_gold_cost = -0.10
        dread_per_tyranny_add = 0.3
        dread_decay_mult = -0.25
        revolting_siege_morale_loss_mult = 0.25
    }
    culture_modifier = {
        cultural_acceptance_gain_mult = -0.25
    }

    ai_will_do = {
		value = 0
	}
}

tradition_conservative = { # Free version of Staunch Traditionalist
	category = realm

	layers = {
		0 = intrigue
		1 = western
		4 = king.dds
	}
	
	is_shown = {
		
	}
	can_pick = {
		NOT = {
			has_cultural_tradition = tradition_fp3_fierce_independence
			lotr_culture_has_adunaic_supremacy_tradition = yes
		}
		trigger_if = { #LotR
            limit = {
                scope:replacing ?= culture_tradition:tradition_variag_succession
            }
            custom_tooltip = {
                text = cannot_replace_variag_succession
                NOT = { has_cultural_tradition = tradition_variag_succession } #To prevent stacking after hybridization
            }
        }
	}
	
	parameters = {
		expensive_convert_to_local_culture = yes
		harder_to_hybridize = yes
		less_likely_to_culture_convert = yes
		ai_doesnt_marry_outside_culture = yes
		dislikes_marrying_outside_of_culture = yes
	}
	character_modifier = {
		controlled_province_advantage = 5
		cultural_head_fascination_mult = -0.05
		opinion_of_different_culture = -5
		same_culture_opinion = 5
		learning = 1
		legitimacy_gain_mult = 0.05
	}
	
	cost = {
		prestige = {
			add = {
				value = tradition_base_cost
				desc = BASE
				format = "BASE_VALUE_FORMAT"
			}
			if = {
				limit = {
					NOR = {
						culture_pillar:ethos_communal = { is_in_list = traits }
						culture_pillar:ethos_spiritual = { is_in_list = traits }
						culture_pillar:ethos_stoic = { is_in_list = traits }
					}
				}
				add = {
					value = tradition_incompatible_ethos_penalty
					desc = not_communal_spiritual_or_stoic_desc
				}
			}
			if = {
				limit = {
					scope:character = {
						any_sub_realm_county = {
							NOT = {
								culture = scope:character.culture
							}
						}
					}
				}
				add = {
					value = tradition_unfulfilled_criteria_penalty
					desc = has_other_cultures_in_realm_desc
				}
			}
			if = {
				limit = {
					OR = {
						has_variable = defensive_traditionalist_discount
						has_variable = aggressive_traditionalist_discount
					}
				}
				add = {
					value = traditionalist_discount
					desc = traditionalist_discount_desc
				}
			}

			if = {
				limit = {
					culture_tradition_reduction_trigger = { TRADITION = tradition_conservative }
				}
				multiply = {
					value = 0.5
					desc = inspired_by_culture_desc
				}
			}
			
			multiply = tradition_replacement_cost_if_relevant
		}
	}
	
	ai_will_do = {
		value = 50
		if = {
			limit = {
				NOT = {
					is_divergent_culture = yes
				}
			}
			multiply = 0
		}
		if = {
			limit = {
				culture_pillar:ethos_egalitarian = { is_in_list = traits }
			}
			multiply = 0
		}
	}
}

# Koronandi #
tradition_harbourworks = { # Koronandi unique tradition, based on polders and wetlanders, gives bonuses to coastal wetland cities.
	category = realm

	layers = {
		0 = steward
		1 = mena
		4 = svamp.dds
	}

	is_shown = {
		OR = {
			this = culture:koronandi
			any_parent_culture_or_above = {
				this = culture:koronandi
			}
		}
	}
	can_pick = {
		OR = {
			this = culture:koronandi
			any_parent_culture_or_above = {
				this = culture:koronandi
			}
		}
		custom_description = {
			text = culture_on_coast_desc
			any_culture_county = {
				any_county_province = {
					is_coastal = yes
				}
			}
		}
		custom_tooltip = {
			text = culture_in_wetlands_desc
			any_culture_county = {
				any_county_province = {
					terrain = wetlands
				}
			}
		}
		trigger_if = { #LotR
            limit = {
                scope:replacing ?= culture_tradition:tradition_variag_succession
            }
            custom_tooltip = {
                text = cannot_replace_variag_succession
                NOT = { has_cultural_tradition = tradition_variag_succession } #To prevent stacking after hybridization
            }
        }
	}
	
	parameters = {
		coastal_agriculture_building_bonuses = yes
		coastal_holding_bonuses = yes
		peat_quarries_building_bonuses = yes
		logging_camps_building_bonuses = yes
		outposts_building_bonuses = yes
		watermills_forestries_unlock = yes	
	}
	county_modifier = {
		wetlands_development_growth_factor = 0.25
	}
	province_modifier = {
		wetlands_supply_limit_mult = 0.1
		wetlands_construction_gold_cost = -0.1
		city_holding_holding_build_gold_cost = -0.1
	}

	cost = {
		prestige = {
			add = {
				value = tradition_base_cost
				desc = BASE
				format = "BASE_VALUE_FORMAT"
			}
			if = {
				limit = {
					NOR = {
						any_in_list = { list = traits this = flag:ethos_communal }
						any_in_list = { list = traits this = flag:ethos_bureaucratic }
						any_in_list = { list = traits this = flag:ethos_egalitarian }
					}
				}
				add = {
					value = tradition_incompatible_ethos_penalty
					desc = not_communal_bureaucratic_or_egalitarian_desc
				}
			}
			if = {
				limit = {
					NOT = {
						any_culture_county = {
							percent >= 0.3
							any_county_province = {
								is_coastal = yes
							}
						}
					}
				}
				add = {
					value = tradition_unfulfilled_criteria_penalty
					desc = coastal_percentage_desc
				}
			}
			if = {
				limit = {
					NOT = {
						any_culture_county = {
							count >= 3
							any_county_province = {
								terrain = wetlands
							}
						}
					}
				}
				add = {
					value = tradition_unfulfilled_criteria_penalty
					desc = culture_in_wetlands_count_desc
				}
			}
			if = {
				limit = {
					culture_tradition_reduction_trigger = { TRADITION = tradition_wetlanders }
				}
				multiply = {
					value = 0.5
					desc = inspired_by_culture_desc
				}
			}
			multiply = tradition_replacement_cost_if_relevant
		}
	}
	
	ai_will_do = {
		value = 100
		if = {
			limit = {
				NOT = {
					any_culture_county = {
						percent >= 0.2
						any_county_province = {
							terrain = wetlands
							is_coastal = yes
						}
					}
				}
			}
			multiply = 0
		}
		if = {
			limit = {
				any_culture_county = {
					percent >= 0.4
					any_county_province = {
						terrain = wetlands
						is_coastal = yes
					}
				}
			}
			multiply = 3
		}
	}
}

# Hathorim # 
tradition_hathorim_councils = {
	category = regional

	layers = {
		0 = learning
		1 = indian
		4 = crown.dds
	}
	
	is_shown = {
		has_cultural_pillar = heritage_hathorim
	}
	
	can_pick = {
		trigger_if = {
            limit = {
                scope:replacing ?= culture_tradition:tradition_variag_succession
            }
            custom_tooltip = {
                text = cannot_replace_variag_succession
                NOT = { has_cultural_tradition = tradition_variag_succession } #To prevent stacking after hybridization
            }
        }
		scope:character = {
			government_has_flag = government_is_tribal
		}
	}
	
	parameters = {
		tribal_elective_enabled = yes
		just_trait_gives_bonuses = yes
		pardoning_gives_prestige = yes

		bonuses_from_patriarch_matriarch_trait = yes
		landing_house_members_give_prestige = yes
		penalty_for_revoking_titles_from_house_members = yes
		loyal_trait_more_valued = yes
		tribal_holding_stationed_bonus = yes
		lotr_may_adopt_oligarchy = yes # LotR
	}
	character_modifier = {
		owned_personal_scheme_success_chance_add = 10
		opinion_of_liege = -5
	}
	
	cost = {
		prestige = {
			add = {
				value = tradition_base_cost
				desc = BASE
				format = "BASE_VALUE_FORMAT"
			}
			if = {
				limit = {
					NOR = {
						culture_pillar:ethos_communal = { is_in_list = traits }
						culture_pillar:ethos_spiritual = { is_in_list = traits }
						culture_pillar:ethos_stoic = { is_in_list = traits }
					}
				}
				add = {
					value = tradition_incompatible_ethos_penalty
					desc = not_communal_spiritual_or_stoic_desc
				}
			}
			if = {
				limit = {
					NOT = {
						scope:character = {
							any_sub_realm_county = {
								county_opinion < 0
							}
						}
					}
				}
				add = {
					value = tradition_unfulfilled_criteria_penalty
					desc = counties_with_low_county_opinion_desc
				}
			}

			if = {
				limit = {
					has_variable = defensive_traditionalist_discount
				}
				add = {
					value = traditionalist_discount
					desc = traditionalist_discount_desc
				}
			}
			
			if = {
				limit = {
					culture_tradition_reduction_trigger = { TRADITION = tradition_hathorim_councils }
				}
				multiply = {
					value = 0.5
					desc = inspired_by_culture_desc
				}
			}
			
			multiply = tradition_replacement_cost_if_relevant
		}
	}
	
	ai_will_do = {
		value = 100
	}
}

### Wastelands ###

tradition_wastelands = {
	category = realm

	layers = {
		0 = learning
		1 = indian
		4 = desert_mountains.dds
	}
	
	county_modifier = {
		development_growth_factor = -1.0
		monthly_county_control_growth_factor = 1.0
		build_speed = -10.0
		monthly_county_control_growth_add = 1
	}
	
	character_modifier = { 
		monthly_county_control_growth_factor = 1.0
		vassal_opinion = 100 
		general_opinion = 1000
		
		ai_greed = -100
		ai_honor = 100
		ai_war_chance = -1
		ai_war_cooldown = 0
	}
	culture_modifier = {
		mercenary_count_mult = -1
	}
	
	is_shown = {
		scope:character = {
			has_culture = culture:wastelands
		}
	}

	can_pick = {
		always = yes
	}
	
	ai_will_do = {
		value = 0
	}

}
