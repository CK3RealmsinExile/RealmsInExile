##################################################
# GREAT PROJECTS FOR CHINESE MINISTERS
#
# Grand Campaign - Minister of War
# Sinicize Area - Minister of Rites
# Develop Communities - Minister of Works
# Establish Control - Minister of Rites
##################################################

@msg_completion_effect_generic = "event:/DLC/EP4/SFX/Stingers/China/tgp_mx_sting_finishing_great_project_generic"

@great_project_china_icon = "gfx/interface/icons/great_projects/city_china.dds"
@great_project_default_icon = "gfx/interface/icons/great_projects/_default.dds"
@great_project_campaign_icon = "gfx/interface/icons/court_position_types/grand_guardian_court_position.dds"
@great_project_sinicize_icon = "gfx/interface/icons/court_position_types/minister_bureaucrat_court_position.dds"
@great_project_control_icon = "gfx/interface/icons/icon_game_concept_house_realm_county_control.dds"

@default_illustration = "gfx/interface/illustrations/great_projects/asia_great_project_default.dds"
@city_china_illustration = "gfx/interface/illustrations/holding_types/tgp_city_china.dds"
@castle_china_illustration = "gfx/interface/illustrations/holding_types/tgp_castle_china.dds"
@sinicize_illustration = "gfx/interface/illustrations/event_story/tgp_dynastic_cycle_stability.dds"
@camp_asia_illustration = "gfx/interface/illustrations/event_scenes/tgp_camp_asia.dds"
@develop_communities_default = "gfx/interface/illustrations/event_scenes/ep3_medi_market.dds"

# Grand Campaign
grand_campaign_project = {
	icon = {
		reference = @great_project_campaign_icon
	}
	illustration = {
		reference = @camp_asia_illustration
	}

	is_important = yes
	is_shown = {
		has_tgp_dlc_trigger = yes
		OR = {
			has_title = title:e_minister_grand_marshal
			AND = {
				has_title = title:h_china
				exists = cp:minister_grand_marshal
			}
			AND = {
				is_diarch_of_target = top_liege
				top_liege = {
					has_diarchy_type = grand_secretariat
				}
			}
		}
	}
	province_filter = top_liege_border_outer
	owner = founder_top_liege_title_owner

	can_start_planning = {
		#there can only be one Grand Campaign!
		NOR = {
			is_planning_great_project = grand_campaign_project
			custom_tooltip = {
				text = only_single_great_project_type_allowed
				any_great_project = {
					great_project_type = grand_campaign_project
				}
			}
		}
	}

	is_location_valid = {
		trigger_if = {
			limit = {
				scope:province.kingdom ?= {
					any_in_de_jure_hierarchy = {
						tier = tier_duchy
						holder ?= {
							top_overlord != root.top_overlord
						}
					}
				}
			}
			scope:province.kingdom = {
				any_in_de_jure_hierarchy = {
					tier = tier_duchy
					holder ?= {
						top_overlord != root.top_overlord
					}
				}
			}
		}
		trigger_else = {
			# have at least one valid duchy to attack
			scope:province.county.holder.top_liege = {
				NOT = {
					is_tributary_of = root.top_liege
				}
			}
		}
	}

	cost = {
		influence = {
			value = major_influence_value
			if = {
				limit = {
					has_title = title:h_china
				}
				multiply = 2
			}
		}
		treasury_or_gold = {
			value = great_project_base_starting_cost
			if = {
				limit = {
					has_title = title:h_china
				}
				multiply = 2
			}
		}
	}

	construction_time = {
		value = great_project_base_construction_time
		multiply = 2 #10 years
	}

	contributor_cooldown = standard_contributor_cooldown_value
	contribution_threshold = 80

	is_valid = { exists = title:h_china }

	on_plan_build = {
		title:h_china = {
			set_variable = {
				name = num_of_grand_campaign_projects
				value = {
					add = 1
					if = {
						limit = { exists = var:num_of_grand_campaign_projects }
						add = var:num_of_grand_campaign_projects
					}
				}
			}
		}
	    save_scope_as = grand_campaign_project
	    great_project_location.kingdom = {
            every_in_de_jure_hierarchy = {
           		limit = {
					tier = tier_duchy
               		holder.top_overlord != scope:owner
	            }
	            add_to_list = duchies_to_attack
            }
            save_scope_as = target
	    }
		set_variable = {
			name = grand_campaign_target
			value = scope:target
		}
		set_duchies_to_attack_effect = yes
	}

	on_start_build = {
		situation:dynastic_cycle = {
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_grand_campaign
				}
				trigger_situation_catalyst = {
					catalyst = catalyst_grand_campaign
					character = scope:founder
				}
			}
		}
	}
	on_complete = {
		show_as_tooltip = {
			scope:great_project.var:grand_campaign_war ?= {
				end_war = attacker
			}
		}		
		custom_tooltip = grand_campaign_won_tt
		custom_tooltip = grand_campaign_lost_tt
		hidden_effect = {
			every_contribution = {
				limit = {
					contribution_is_funded = yes
				}
				contributor = {
					add_to_list = all_contributors
					remove_character_modifier = tgp_joined_grand_campaign_modifier
				}
			}
			every_in_list = {
				variable = grand_campaign_targets
				if = {
					limit = {
						top_overlord = scope:owner
					}
					add_to_list = titles_won
				}
				else = {
					add_to_list = titles_lost
				}
			}
			scope:owner = {
				trigger_event = tgp_china_ministry.0005
			}
		}
	}

	on_cancel = {
		scope:owner = {
			trigger_event = tgp_china_ministry.0006
		}
		every_contribution = {
			limit = {
				contribution_is_funded = yes
			}
			contributor = {
				trigger_event = tgp_china_ministry.0006
			}
		}
	}

	allowed_contributor_filter = {
		vassals = yes
	}

	project_contributions = {
		attack_1 = {
			is_shown = {
				always = yes #it's the mandatory contribution
			}
			contributor_is_valid = {
				has_title = title:e_minister_grand_marshal
			}

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_1
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = 1000
			}
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_2 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_2
				}
			}
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 2 }
			}
			is_required = no
			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_2
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_3 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_3
				}
			}
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 3 }	
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_3
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_4 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_4
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 4 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_4
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_5 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_5
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 5 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_5
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_6 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_6
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 6 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_6
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_7 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_7
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 7 }	
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_7
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_8 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_8
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 8 }	
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_8
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_9 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_9
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 9 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_9
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_10 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_10
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 10 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_10
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_11 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_11
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 11 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_11
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_12 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_12
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 12 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_12
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_13 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_13
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 13 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_13
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_14 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_14
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 14 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_14
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_15 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_15
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 15 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_15
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_16 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_16
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 16 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_16
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_17 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_17
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 17 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_17
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_18 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_18
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 18 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_18
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_19 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_19
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 19 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_19
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
		attack_20 = {
			is_shown = {
				scope:great_project ?= {
					exists = var:attack_20
				}
			}
			show_in_planning_phase = no
			contributor_is_valid = {
				grand_campaign_valid_contributor_trigger = { ID = 20 }
			}
			is_required = no

			cost = { treasury_or_gold = great_project_base_contribution_cost }

			contributor_cooldown = individual_contribution_cooldown_value

			on_contribution_funded = {
				grand_campaign_contribution_effect = {
					TITLE = attack_20
				}
			}
			on_complete = {
				grand_campaign_contribution_complete_effect = yes
			}
			ai_will_do = {
				value = contribute_to_grand_campaign_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 24
				duchy = 6
				kingdom = 6
				empire = 6
				hegemony = 0
			}
		}
	}

	ai_will_do = {
		value = 10
		if = {
			limit = {
				title:h_china.holder.hegemon_favored_stability_phase_value < 0
			}
			add = 50
		}
		if = {
			limit = {
				situation:dynastic_cycle ?= {
					OR = {
						situation_current_phase = situation_dynastic_cycle_phase_stability_expansion
						situation_current_phase = situation_dynastic_cycle_phase_instability_conquest
					}
				}
			}
			add = 250
		}
		if = {
			limit = {
				is_at_war = yes
			}
			multiply = 0
		}
	}

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 24
		hegemony = 24
	}

	ai_target_quick_trigger = {
		adult = yes
		rank = empire
	}

	completion_sound_effect = @msg_completion_effect_generic
}

# Sinicize Area
minister_project_culture = {
	icon = {
		reference = @great_project_sinicize_icon
	}
	illustration = {
		reference = @sinicize_illustration
	}
	
	is_shown = {
		has_tgp_dlc_trigger = yes
		# You are the hegemon or the relevant minister
		OR = {
			has_title = title:e_minister_of_rites
			AND = {
				has_title = title:h_china
				exists = cp:councillor_court_chaplain
			}
			AND = {
				is_diarch_of_target = top_liege
				top_liege = {
					has_diarchy_type = grand_secretariat
				}
			}
		}
		trigger_if = { # The AI should not plan more of these projects than there are valid characters to start them
			limit = {
				is_ai = yes
			}
			NOT = {
				any_great_project = {
					count >= 2
					great_project_type = minister_project_culture
				}
			}
		}
	}
	
	province_filter = top_realm

	can_start_planning = {
		# You/your liege/the minister have not already planned this project
		trigger_if = {
			limit = { # When in the advancement phase, we allow everyone with access to do this simultaneously
				situation:dynastic_cycle ?= {
					situation_current_phase = situation_dynastic_cycle_phase_stability_advancement
				}
			}
			NOT = { is_planning_great_project = minister_project_culture }
		}
		trigger_else = { # Otherwise, only a single project at a time
			NOR = {
				is_planning_great_project = minister_project_culture
				custom_tooltip = {
					text = only_single_great_project_type_allowed
					any_great_project = {
						great_project_type = minister_project_culture
					}
				}
			}
		}
	}
	
	is_location_valid = {
		scope:province = {
			county = {
				custom_tooltip = {
					text = not_same_culture_as_top_liege_desc
					culture != root.top_liege.culture
				}
			}
			root.top_liege = {
				completely_controls = scope:province.duchy
			}
			custom_tooltip = {
				text = GREAT_PROJECT_CAN_PLAN
				NOT = {
					duchy = {
						any_in_de_jure_hierarchy = {
							tier = tier_barony
							title_province = {
								any_great_project_in_province = {
									great_project_type = minister_project_culture
								}
							}
						}
					}
				}
			}
		}
		trigger_if = {
			limit = {
				scope:founder = {
					is_ai = yes
				}
			}
			scope:province.county.culture = {
				NOT = {
					has_same_culture_heritage = root.top_liege.culture
				}
			}
		}
	}

	is_valid = {
	
	}
	
	cost = {
		treasury_or_gold = {
			value = great_project_base_starting_cost
			multiply = 0.2
			if = {
				limit = {
					is_councillor = yes
				}
				multiply = 0.5
			}
		}
	}

	construction_time = {
		value = great_project_base_construction_time
		multiply = 7
		scope:great_project = {
			if = {
				limit = {
					has_variable = project_founded_by_minister
				}
				multiply = 0.75
			}
			every_contribution = {
				limit = {
					NOT = { contribution_id = cultural_liason }
					contribution_is_funded = yes
				}
				subtract = 365
			}
		}
		multiply = common_great_project_construction_time_multiplier_value
	}

	contributor_cooldown = standard_contributor_cooldown_value

	allowed_contributor_filter = {
		vassals = yes
		top_liege = yes
	}
	
	on_plan_build = {
		scope:founder ?= {
			if = {
				limit = {
					is_councillor = yes
				}
				root = { set_variable = project_founded_by_minister }
			}
		}
	}

	on_start_build = {
	}

	on_complete = {
		situation:dynastic_cycle = {
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_minister_project_culture
				}
				trigger_situation_catalyst = {
					catalyst = catalyst_minister_project_culture
					character = scope:founder
				}
			}
		}
		if = {
			limit = {
				scope:founder = scope:founder.top_liege
				tgp_has_access_to_ministry_trigger = yes
			}
			custom_tooltip = minister_project_cost_desc
		}
		if = {
			limit = {
				NOT = { exists = scope:province }
			}
			custom_tooltip = minister_project_culture_effect_desc
		}
		scope:owner ?= {
			send_interface_toast = {
				type = event_generic_neutral_text
				title = great_project_completed_msg_t
				left_icon = scope:owner
				right_icon = scope:province.county
				desc = great_project_completed_msg_desc
			}
		}
		scope:province ?= {
			duchy = {
				every_de_jure_county = {
					# Change culture or increase cultural acceptance
					if = {
						limit = {
							culture = {
								NOT = { has_same_culture_heritage = scope:owner.top_liege.culture }
							}
						}
						set_county_culture = scope:owner.top_liege.culture
					}
					else_if = {
						limit = {
							culture = {
								this != scope:owner.top_liege.culture
								NOT = { is_in_list = culture_gaining_acceptance }
							}
						}
						culture = {
							add_to_list = culture_gaining_acceptance # So you only increase it once per culture
							change_cultural_acceptance = {
								target = scope:owner.top_liege.culture
								value = {
									value = 2
									if = {
										limit = {
											scope:great_project ?= { has_variable = project_founded_by_minister }
										}
										multiply = 2
									}
								}
								desc = cultural_acceptance_gain_minister_project
							}
						}
					}
					# Tribal rulers become admin
					if = {
						limit = {
							holder ?= {
								OR = {
									government_has_flag = government_is_tribal
									government_has_flag = government_is_nomadic
									government_has_flag = government_is_herder
								}
								NOT = { is_in_list = feudalized_rulers }
							}
						}
						holder = {
							change_to_administrative_effect = yes
							add_to_list = feudalized_rulers # To prevent effect from potentially showing multiple times
						}
					}
					# Tribal holdings are feudalized
					if = {
						limit = {
							title_province = {
								OR = {
									has_holding_type = tribal_holding
									has_holding_type = nomad_holding
									has_holding_type = herder_holding
								}
							}
						}
						title_province = {
							set_holding_type = castle_holding
						}
					}
				}
			}
		}
	}
	
	project_contributions = {
		cultural_liason = {
			contributor_is_valid = {
			}

			cost = {
				treasury_or_gold = {
					value = great_project_base_contribution_cost
					multiply = 0.5
				}
			}

			contributor_cooldown = individual_contribution_cooldown_value
			
			is_required = yes

			on_complete = {
				great_project_reward_contribution_completion_notification_effect = {
					LEVEL = major
					NON_OWNER_REWARD_EFFECT = great_project_reward_contribution_completion_null
					OWNER_REWARD_EFFECT = great_project_reward_contribution_completion_null
				}
			}
			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}
		send_inhabitants = {
			contributor_is_valid = {
				culture = top_liege.culture
			}

			cost = {
				treasury_or_gold = {
					value = great_project_base_contribution_cost
					multiply = 0.25
				}
			}

			contributor_cooldown = 0
			
			is_required = no

			on_contribution_funded = {
				custom_tooltip = great_project_construction_time_is_reduced_desc
				if = {
					limit = {
						this != scope:owner
						this != scope:founder						
					}
					scope:owner ?= {
						send_interface_toast = {
							type = event_generic_good_with_text
							title = great_project_contributed_msg_t
							desc = great_project_contributed_msg_desc
							left_icon = root
							right_icon = scope:great_project.great_project_location.county
						}			
					}
				}
			}

			on_complete = {
				send_interface_toast = {
					title = great_project_contribution_msg_t
					left_icon = root
					right_icon = scope:great_project.great_project_location.duchy
					
					if = {
						limit = {
							has_trait = governor
						}
						increase_governance_effect = { VALUE = 10 }
					}
					else_if = {
						limit = {
							government_has_flag = government_has_influence
						}
						change_influence = monumental_influence_gain
					}
					else = {
						add_prestige = major_prestige_gain
					}
				}
			}
			
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}
		send_inhabitants_2 = {
			contributor_is_valid = {
				culture = top_liege.culture
			}
			show_in_planning_phase = no

			cost = {
				treasury_or_gold = {
					value = great_project_base_contribution_cost
					multiply = 0.25
				}
			}

			contributor_cooldown = 0
			
			is_required = no

			on_contribution_funded = {
				custom_tooltip = great_project_construction_time_is_reduced_desc
				if = {
					limit = {
						this != scope:owner
						this != scope:founder						
					}
					scope:owner ?= {
						send_interface_toast = {
							type = event_generic_good_with_text
							title = great_project_contributed_msg_t
							desc = great_project_contributed_msg_desc
							left_icon = root
							right_icon = scope:great_project.great_project_location.county
						}			
					}
				}
			}

			on_complete = {
				send_interface_toast = {
					title = great_project_contribution_msg_t
					left_icon = root
					right_icon = scope:great_project.great_project_location.duchy
					
					if = {
						limit = {
							has_trait = governor
						}
						increase_governance_effect = { VALUE = 10 }
					}
					else_if = {
						limit = {
							government_has_flag = government_has_influence
						}
						change_influence = monumental_influence_gain
					}
					else = {
						add_prestige = major_prestige_gain
					}
				}
			}
			
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}
		send_inhabitants_3 = {
			contributor_is_valid = {
				culture = top_liege.culture
			}
			show_in_planning_phase = no

			cost = {
				treasury_or_gold = {
					value = great_project_base_contribution_cost
					multiply = 0.25
				}
			}

			contributor_cooldown = 0
			
			is_required = no

			on_contribution_funded = {
				custom_tooltip = great_project_construction_time_is_reduced_desc
				if = {
					limit = {
						this != scope:owner
						this != scope:founder						
					}
					scope:owner ?= {
						send_interface_toast = {
							type = event_generic_good_with_text
							title = great_project_contributed_msg_t
							desc = great_project_contributed_msg_desc
							left_icon = root
							right_icon = scope:great_project.great_project_location.county
						}			
					}
				}
			}
			
			on_complete = {
				send_interface_toast = {
					title = great_project_contribution_msg_t
					left_icon = root
					right_icon = scope:great_project.great_project_location.duchy
					
					if = {
						limit = {
							has_trait = governor
						}
						increase_governance_effect = { VALUE = 10 }
					}
					else_if = {
						limit = {
							government_has_flag = government_has_influence
						}
						change_influence = monumental_influence_gain
					}
					else = {
						add_prestige = major_prestige_gain
					}
				}
			}
			
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}
	}
	
	ai_will_do = {
		value = 100
		
		if = {
			limit = {
				situation:dynastic_cycle ?= {
					situation_current_phase = situation_dynastic_cycle_phase_stability_advancement
				}
			}
			add = 400
		}
		if = {
			limit = {
				has_trait = diligent
			}
			add = 10
		}
		if = {
			limit = {
				has_trait = arrogant
			}
			add = 5
		}
		if = {
			limit = {
				has_trait = compassionate
			}
			add = -10
		}
		if = {
			limit = {
				has_trait = trusting
			}
			add = -10
		}
		if = {
			limit = {
				culture = {
					NOT = { has_same_culture_heritage = root.top_liege.culture }
				}
			}
			multiply = 0
		}
		if = {
			limit = {
				is_at_war = yes
			}
			multiply = 0
		}
	}

	ai_target_quick_trigger = {
		adult = yes
		rank = empire
	}
	
	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 5
		hegemony = 3
	}

	completion_sound_effect = @msg_completion_effect_generic
}

# Develop Communities
minister_project_development = {
	icon = {
		trigger = {
			trigger_if = {
				limit = { exists = scope:province }
				scope:province = {
					OR = {
						geographical_region = world_asia
						geographical_region = world_steppe_east
					}
				}
			}
			trigger_else = {
				scope:founder = {
					capital_province ?= {
						OR = {
							geographical_region = world_asia
							geographical_region = world_steppe_east
						}
					}
				}
			}
		}
		reference = @great_project_china_icon
	}
	icon = {
		reference = @great_project_default_icon
	}
	illustration = {
		trigger = {
			trigger_if = {
				limit = { exists = scope:province }
				scope:province = {
					OR = {
						geographical_region = world_asia
						geographical_region = world_steppe_east
					}
				}
			}
			trigger_else = {
				scope:founder = {
					capital_province ?= {
						OR = {
							geographical_region = world_asia
							geographical_region = world_steppe_east
						}
					}
				}
			}
		}
		reference = @default_illustration
	}
	illustration = {
		reference = @develop_communities_default
	}
	
	is_shown = {
		has_tgp_dlc_trigger = yes
		government_allows = administrative
		# You are the hegemon / emperor or the relevant minister / diarch
		OR = {
			AND = {
				this = top_liege
				trigger_if = {
					limit = {
						has_title = title:h_china
					}
					exists = cp:minister_works
				}
			}
			has_title = title:e_minister_of_works
			AND = {
				is_diarch_of_target = top_liege
				top_liege = {
					OR = {
						has_diarchy_type = grand_secretariat
						has_diarchy_type = co_emperorship
					}
				}
			}
		}
	}
	
	province_filter = top_realm

	can_start_planning = {
		# You/your liege/the minister have not already planned this project
		trigger_if = {
			limit = { # When in the advancement phase, we allow everyone with access to do this simultaneously
				situation:dynastic_cycle ?= {
					situation_current_phase = situation_dynastic_cycle_phase_stability_advancement
				}
			}
			NOT = { is_planning_great_project = minister_project_development }
		}
		trigger_else = { # Otherwise, only a single project at a time
			NOR = {
				is_planning_great_project = minister_project_development
				custom_tooltip = {
					text = only_single_great_project_type_allowed
					any_great_project = {
						great_project_type = minister_project_development
					}
				}
			}
		}
	}
	
	is_location_valid = {
		scope:province = {
			is_county_capital = yes
			root.top_liege = {
				completely_controls = scope:province.duchy
			}
			duchy = {
				title_capital_county = scope:province.county
			}
			custom_tooltip = {
				text = GREAT_PROJECT_CAN_PLAN
				NOT = {
					duchy = {
						any_in_de_jure_hierarchy = {
							tier = tier_barony
							title_province = {
								any_great_project_in_province = {
									great_project_type = minister_project_development
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
	
	}
	
	cost = {
		treasury_or_gold = {
			value = great_project_base_contribution_cost
			multiply = 4
			if = {
				limit = {
					is_councillor = yes
				}
				divide = 2
			}
		}
	}

	construction_time = {
		value = 3650
		scope:great_project = {
			if = {
				limit = {
					has_variable = project_founded_by_minister
				}
				multiply = 0.75
			}
		}
		multiply = common_great_project_construction_time_multiplier_value
	}

	contributor_cooldown = 0

	allowed_contributor_filter = {
		vassals = yes
		top_liege = yes
	}
	
	on_plan_build = {
		scope:founder ?= {
			if = {
				limit = {
					is_councillor = yes
				}
				root = { set_variable = project_founded_by_minister }
			}
		}
	}

	on_start_build = {
	}

	on_complete = {
		if = {
			limit = {
				scope:founder = scope:founder.top_liege
				tgp_has_access_to_ministry_trigger = yes
			}
			custom_tooltip = minister_project_cost_desc
		}
		if = {
			limit = {
				NOT = { exists = scope:province }
			}
			custom_tooltip = minister_project_development_effect_desc
		}
		save_scope_value_as = {
			name = project_development_value
			value = {
				value = 50
				if = {
					limit = {
						has_variable = project_founded_by_minister
					}
					add = 50
				}
				every_contribution = {
					limit = {
						NOR = {
							contribution_id = personnel
							contribution_id = engineers
						}
						contribution_is_funded = yes
					}
					add = 25
				}
			}
		}
		scope:province ?= {
			duchy = {
				custom_tooltip = minister_project_development_building_desc
				custom_tooltip = minister_project_development_modifier_desc
				hidden_effect = {
					every_de_jure_county = {
						every_county_province = {
							limit = {
								has_holding = yes
							}
							# We set this flag to make the AI want to prioritize economy buildings, which makes the building effect below construct those first and foremost
							barony.holder = {
								add_character_flag = { flag = ai_desire_economy_buildings days = 30 }
							}
							# Add or upgrade a building
							generate_building = yes
						}
						add_county_modifier = {
							modifier = tgp_minister_project_development_modifier
							years = 10
						}
					}
				}
				change_development_progress = scope:project_development_value
			}
		}
		if = {
			limit = {
				has_variable = project_founded_by_minister
			}
			title:e_minister_of_works.holder ?= {
				change_merit = monumental_merit_gain
			}
		}
	}
	
	project_contributions = {
		personnel = {
			cost = {
				treasury_or_gold = great_project_base_contribution_cost
			}

			contributor_cooldown = 0
			
			is_required = yes

			on_complete = {
				if = {
					limit = {
						is_alive = yes
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = great_project_contribution_msg_t
						left_icon = root
						right_icon = scope:great_project.great_project_location.duchy
						
						if = {
							limit = {
								government_allows = merit
							}
							change_merit = {
								value = monumental_merit_gain
								if = {
									limit = {
										has_title = title:e_minister_of_personnel
									}
									multiply = 2
								}
							}
						}
						else = {
							add_prestige = major_prestige_gain
						}
					}
				}
			}
			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}
		engineers = {
			cost = {
				treasury_or_gold = great_project_base_contribution_cost
			}

			contributor_cooldown = 0
			
			is_required = yes

			on_complete = {
				if = {
					limit = {
						is_alive = yes
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = great_project_contribution_msg_t
						left_icon = root
						right_icon = scope:great_project.great_project_location.duchy
						
						change_influence = {
							value = monumental_influence_gain
							if = {
								limit = {
									OR = {
										has_title = title:e_minister_chancellor
										has_title = title:e_minister_censor
									}
								}
								multiply = 2
							}
						}
					}
				}
			}
			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}
		infrastructure = {
			contributor_is_valid = {
				is_governor = yes
				custom_tooltip = {
					text = great_project_is_near_capital_desc
					capital_province ?= {
						duchy = {
							OR = {
								NOT = { exists = scope:great_project } # safeguard for before the project is planned
								this = scope:great_project.great_project_location.duchy
								any_title_to_title_neighboring_duchy = { this = scope:great_project.great_project_location.duchy }
							}
						}
					}
				}
			}

			cost = {
				treasury_or_gold = {
					value = great_project_base_contribution_cost
					multiply = 2
				}
			}

			contributor_cooldown = 0
			
			is_required = no

			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}

			on_complete = {
				if = {
					limit = {
						is_alive = yes
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = great_project_contribution_msg_t
						left_icon = root
						right_icon = scope:great_project.great_project_location.duchy
						
						if = {
							limit = {
								has_trait = governor
							}
							increase_governance_effect = { VALUE = 10 }
						}
						capital_province.county ?= {
							change_development_level = 1
						}
					}
				}
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
		}
	}
	
	ai_will_do = {
		value = 30
		
		if = {
			limit = {
				treasury >= 20000
			}
			add = 70
		}
		if = {
			limit = {
				has_trait = diligent
			}
			add = 10
		}
		if = {
			limit = {
				has_trait = just
			}
			add = 5
		}
		if = {
			limit = {
				has_trait = compassionate
			}
			add = -10
		}
		if = {
			limit = {
				has_trait = trusting
			}
			add = -10
		}
		if = {
			limit = {
				culture = {
					NOT = { has_same_culture_heritage = root.top_liege.culture }
				}
			}
			multiply = 0
		}
		if = {
			limit = {
				is_at_war = yes
			}
			multiply = 0
		}
	}

	ai_target_quick_trigger = {
		adult = yes
		rank = empire
	}
	
	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 5
		hegemony = 3
	}

	completion_sound_effect = @msg_completion_effect_generic
}

# Establish Control
minister_project_establish_control = {
	icon = {
		trigger = {
			trigger_if = {
				limit = { exists = scope:province }
				scope:province = {
					OR = {
						geographical_region = world_asia
						geographical_region = world_steppe_east
					}
				}
			}
			trigger_else = {
				scope:founder = {
					capital_province ?= {
						OR = {
							geographical_region = world_asia
							geographical_region = world_steppe_east
						}
					}
				}
			}
		}
		reference = @great_project_control_icon
	}
	icon = {
		reference = @great_project_control_icon
	}
	illustration = {
		reference = @city_china_illustration
	}

	is_shown = {
		has_tgp_dlc_trigger = yes
		# You are the hegemon or a relevant minister
		OR = {
			has_title = title:h_china
			has_title = title:e_minister_of_rites
			AND = {
				is_diarch_of_target = top_liege
				top_liege = {
					has_diarchy_type = grand_secretariat
				}
			}
		}
	}

	can_start_planning = {
		# You/your liege/the minister have not already planned this project
		trigger_if = {
			limit = { # When in a stable phase, we allow everyone with access to do this simultaneously
				situation:dynastic_cycle ?= {
					OR = {
						situation_current_phase = situation_dynastic_cycle_phase_stability_expansion
						situation_current_phase = situation_dynastic_cycle_phase_stability_advancement
					}
				}
			}
			NOT = { is_planning_great_project = minister_project_establish_control }
		}
		trigger_else = { # Otherwise, only a single project at a time
			NOR = {
				is_planning_great_project = minister_project_establish_control
				custom_tooltip = {
					text = only_single_great_project_type_allowed
					any_great_project = {
						great_project_type = minister_project_establish_control
					}
				}
			}
		}
		# There are valid counties in the realm
		any_realm_county = {
			custom_tooltip = {
				text = has_low_control_or_county_corruption_desc
				OR = {
					has_county_corruption_trigger = yes
					county_control < 100
				}
			}
		}
	}
	
	is_valid = {
	}
	
	is_location_valid = {
		scope:province.duchy ?= {
			custom_tooltip = {
				text = has_low_control_or_county_corruption_desc
				any_de_jure_county = {
					OR = {
						has_county_corruption_trigger = yes
						county_control < 100
					}
				}
			}
		}
		scope:province = {
			custom_tooltip = {
				text = GREAT_PROJECT_CAN_PLAN
				NOT = {
					duchy = {
						any_in_de_jure_hierarchy = {
							tier = tier_barony
							title_province = {
								any_great_project_in_province = {
									great_project_type = minister_project_establish_control
								}
							}
						}
					}
				}
			}
		}
	}
	
	province_filter = top_realm
	
	cost = {
		treasury_or_gold = {
			value = great_project_base_starting_cost
			multiply = 2
			if = {
				limit = {
					is_councillor = yes
				}
				divide = 2
			}
		}
	}

	construction_time = {
		value = 1825
		multiply = common_great_project_construction_time_multiplier_value
	}

	contributor_cooldown = 0

	allowed_contributor_filter = {
		vassals = yes
		tributaries = yes
	}
	
	on_plan_build = {
		scope:founder ?= {
			if = {
				limit = {
					is_councillor = yes
				}
				root = {
					set_variable = {
						name = project_founded_by_minister
						value = {
							value = 0
							add = scope:founder.learning
						}
					}
				}
			}
		}
	}

	on_complete = {
		if = {
			limit = {
				NOT = { exists = scope:province }
			}
			custom_tooltip = minister_project_establish_control_effect_desc
		}
		scope:province.duchy ?= {
			# Inrease local county control (for all counties)
			change_county_control = {
				# Add a base increase
				value = 10
				# If founded by a minister, increase it further based on skills
				if = {
					limit = {
						exists = scope:great_project.var:project_founded_by_minister
					}
					add = {
						value = scope:great_project.var:project_founded_by_minister
						divide = 2
					}
				}
				else_if = { # To show it properly in the tooltip when shown before starting the project
					limit = {
						scope:founder = { is_councillor = yes }
					}
					add = {
						value = 0
						add = scope:founder.learning
						divide = 2
						round = yes
					}
				}
			}
			
			# Speed up de jure drift if we can
			if = {
				limit = { # If we have a holder, who is within the realm, and the duchy is not a de jure part of our top liege's realm
					exists = holder
					holder.top_liege = scope:owner.top_liege
					NOT = { is_ruler_de_jure_liege_or_above = scope:owner.top_liege }
				}
				if = {
					limit = {
						de_jure_drifting_towards = holder.liege.primary_title
					}
					save_scope_as = drifting_title
					holder.liege.primary_title = { save_scope_as = drift_target_title }
				}
				else_if = {
					limit = {
						kingdom = {
							exists = holder
							de_jure_drifting_towards = holder.liege.primary_title
						}
					}
					kingdom = {
						save_scope_as = drifting_title
						holder.liege.primary_title = { save_scope_as = drift_target_title }
					}
				}
				else_if = {
					limit = {
						empire = {
							exists = holder
							de_jure_drifting_towards = holder.liege.primary_title
						}
					}
					empire = {
						save_scope_as = drifting_title
						holder.liege.primary_title = { save_scope_as = drift_target_title }
					}
				}
			}
			if = {
				limit = {
					exists = scope:drifting_title
					exists = scope:drift_target_title
				}
				change_de_jure_drift_progress = {
					target = scope:drift_target_title
					value = {
						value = 100
						if = {
							limit = {
								exists = scope:great_project.var:project_founded_by_minister
							}
							add = {
								value = scope:great_project.var:project_founded_by_minister
								multiply = 2
							}
						}
						else_if = { # To show it properly in the tooltip before starting
							limit = {
								scope:founder = { is_councillor = yes }
							}
							add = {
								value = 0
								add = scope:founder.learning
								multiply = 2
							}
						}
						if = {
							limit = {
								situation:dynastic_cycle ?= { situation_current_phase = situation_dynastic_cycle_phase_stability_advancement }
							}
							add = 30
						}
					}
				}
			}
			
			# Add county modifiers and enable absolute control (we use custom tooltips to format the tooltips better in-game)
			custom_tooltip = minister_project_establish_control_modifier_desc
			custom_tooltip = minister_project_establish_control_holder_desc
			hidden_effect = {
				every_de_jure_county = {
					holder = {
						set_absolute_country_control = yes
					}
					add_county_modifier = {
						modifier = tgp_minister_project_establish_control_modifier
						years = 20
					}
					if = {
						limit = {
							has_county_corruption_trigger = yes
						}
						remove_every_county_corruption_modifier_effect = yes
					}
				}
			}
		}
	}

	project_contributions = {
		city_guards = {
			contributor_is_valid = {
				trigger_if = {
					limit = {
						NOR = {
							has_title = title:h_china
							has_title = title:e_minister_of_rites
							AND = {
								is_diarch_of_target = top_liege
								top_liege = {
									has_diarchy_type = grand_secretariat
								}
							}
						}
					}
					is_governor = yes
				}
			}

			cost = {
				treasury_or_gold = great_project_base_contribution_cost
			}

			contributor_cooldown = 0
			
			is_required = yes

			on_complete = {
				if = {
					limit = {
						is_alive = yes
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = great_project_contribution_msg_t
						left_icon = root
						right_icon = scope:great_project.great_project_location.duchy
						
						if = {
							limit = {
								government_allows = merit
							}
							change_merit = {
								value = monumental_merit_gain
								if = {
									limit = {
										OR = {
											has_title = title:e_minister_chancellor
											has_title = title:e_minister_censor
											has_title = title:e_minister_of_personnel
										}
									}
									multiply = 2
								}
							}
						}
						else = {
							add_prestige = major_prestige_gain
						}
						if = {
							limit = {
								government_has_flag = government_has_influence
							}
							change_influence = {
								value = monumental_influence_gain
								if = {
									limit = {
										OR = {
											has_title = title:e_minister_chancellor
											has_title = title:e_minister_censor
										}
									}
									multiply = 2
								}
							}
						}
						else = {
							add_prestige = major_prestige_gain
						}
						if = {
							limit = {
								has_trait = governor
							}
							increase_governance_effect = { VALUE = 20 }
						}
					}
				}
			}
			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}

		highway_patrols = {
			contributor_is_valid = {
				trigger_if = {
					limit = {
						NOR = {
							has_title = title:h_china
							has_title = title:e_minister_of_rites
							AND = {
								is_diarch_of_target = top_liege
								top_liege = {
									has_diarchy_type = grand_secretariat
								}
							}
						}
					}
					custom_tooltip = {
						text = is_a_military_governor_desc
						vassal_contract_has_flag = celestial_military_appointment
					}
				}
			}

			cost = {
				treasury_or_gold = great_project_base_contribution_cost
			}

			contributor_cooldown = 0
			
			is_required = yes

			on_complete = {
				if = {
					limit = {
						is_alive = yes
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = great_project_contribution_msg_t
						left_icon = root
						right_icon = scope:great_project.great_project_location.duchy
						
						if = {
							limit = {
								government_allows = merit
								this != top_liege
							}
							change_merit = {
								value = monumental_merit_gain
								if = {
									limit = {
										OR = {
											has_title = title:e_minister_chancellor
											has_title = title:e_minister_censor
											has_title = title:e_minister_of_war
											has_title = title:e_minister_grand_marshal
										}
									}
									multiply = 2
								}
							}
						}
						else = {
							add_prestige = major_prestige_gain
						}
						if = {
							limit = {
								has_trait = organizer
							}
							add_trait_xp = {
								trait = organizer
								value = 15
							}
						}
						add_martial_lifestyle_xp = major_lifestyle_xp
					}
				}
			}
			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}

		administrators = {
			contributor_is_valid = {
			}

			cost = {
				treasury_or_gold = great_project_base_contribution_cost
			}

			contributor_cooldown = 0
			
			is_required = yes

			on_complete = {
				if = {
					limit = {
						is_alive = yes
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = great_project_contribution_msg_t
						left_icon = root
						right_icon = scope:great_project.great_project_location.duchy
						
						if = {
							limit = {
								government_allows = merit
							}
							change_merit = {
								value = monumental_merit_gain
								if = {
									limit = {
										OR = {
											has_title = title:e_minister_chancellor
											has_title = title:e_minister_of_personnel
											has_title = title:e_minister_of_revenue
											has_title = title:e_minister_of_works
										}
									}
									multiply = 2
								}
							}
						}
						else = {
							add_prestige = major_prestige_gain
						}
						if = {
							limit = {
								has_trait = lifestyle_reveler
							}
							add_trait_xp = {
								trait = lifestyle_reveler
								value = 10
							}
						}
						add_stewardship_lifestyle_xp = major_lifestyle_xp
					}
				}
			}
			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}

		court_magistrates = {
			contributor_is_valid = {
				trigger_if = {
					limit = {
						NOR = {
							has_title = title:h_china
							has_title = title:e_minister_of_rites
							AND = {
								is_diarch_of_target = top_liege
								top_liege = {
									has_diarchy_type = grand_secretariat
								}
							}
						}
					}
					custom_tooltip = {
						text = is_a_civilian_governor_desc
						vassal_contract_has_flag = celestial_civil_appointment
					}
				}
			}

			cost = {
				treasury_or_gold = great_project_base_contribution_cost
			}

			contributor_cooldown = 0
			
			is_required = yes

			on_complete = {
				if = {
					limit = {
						is_alive = yes
					}
					send_interface_toast = {
						type = event_toast_effect_good
						title = great_project_contribution_msg_t
						left_icon = root
						right_icon = scope:great_project.great_project_location.duchy
						
						if = {
							limit = {
								government_allows = merit
							}
							change_merit = {
								value = major_merit_gain
								if = {
									limit = {
										OR = {
											has_title = title:e_minister_chancellor
											has_title = title:e_minister_of_personnel
											has_title = title:e_minister_of_rites
										}
									}
									multiply = 2
								}
							}
						}
						else = {
							add_prestige = major_prestige_gain
						}
						if = {
							limit = {
								has_trait = confucian_education
							}
							add_trait_xp = {
								trait = confucian_education
								value = 10
							}
						}
						else = {
							add_trait = confucian_education
						}
						add_learning_lifestyle_xp = major_lifestyle_xp
					}
				}
			}
			on_contribution_funded = {
				great_project_notify_contribution = yes
				great_project_contribution_catalyst_effect = yes
			}
			ai_will_do = {
				value = chinese_great_projects_contribution_ai_will_do_base_value
			}
			
			ai_check_interval_by_tier = {
				barony = 0
				county = 18
				duchy = 12
				kingdom = 6
				empire = 3
				hegemony = 3
			}
		}
	}
	
	ai_will_do = {
		value = 30
		
		if = {
			limit = {
				treasury >= 20000
			}
			add = 70
		}
		if = {
			limit = { has_trait = diligent }
			add = 10
		}
		if = {
			limit = { has_trait = ambitious }
			add = 10
		}
		if = {
			limit = { has_trait = wrathful }
			add = 5
		}
		if = {
			limit = { has_trait = paranoid }
			add = 5
		}
		if = {
			limit = { has_trait = forgiving }
			add = -10
		}
		if = {
			limit = {
				has_trait = lazy
				this != top_liege
			}
			add = -30
		}
		if = {
			limit = {
				culture = {
					NOT = { has_same_culture_heritage = root.top_liege.culture }
				}
			}
			multiply = 0
		}
		if = {
			limit = {
				is_at_war = yes
			}
			multiply = 0
		}
	}

	ai_target_quick_trigger = {
		adult = yes
		rank = empire
	}
	
	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 0
		empire = 5
		hegemony = 3
	}

	completion_sound_effect = @msg_completion_effect_generic
}
