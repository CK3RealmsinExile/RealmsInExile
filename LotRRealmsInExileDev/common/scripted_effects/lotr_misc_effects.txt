lotr_get_aggressive = { root.house = { add_house_modifier = { modifier = lotr_conquering_modifier years = 30 } } }

increase_variable = { # From Tobbzn
    if = { limit = { NOT = { has_variable = $NAME$ } }
        set_variable = { name = $NAME$ value = 0 }
    }
    change_variable = {
        name = $NAME$
        add = $AMOUNT$
    }
}

decrease_variable = { # From Tobbzn
    if = { limit = { NOT = { has_variable = $NAME$ } }
        set_variable = { name = $NAME$ value = 0 }
    }
    change_variable = {
        name = $NAME$
        subtract = $AMOUNT$
    }
}

durins_bane_province_modifier_effect = {
    title:k_khazad_dum = {
        every_de_jure_county = {
            limit = {
                NOR = {
                    this = title:c_dimrill_dale
                    this = title:c_caradhras_pass
                }
            }
            title_province = { add_province_modifier = durins_bane_modifier }
        }
    }
}

set_every_county_wilderness = {
	create_title_and_vassal_change = {
		type = granted
		save_scope_as = change
		add_claim_on_loss = no
	}

	if = {
		limit = {
			OR = {
				$EMPIRE$ = title:e_rhovanion
				$EMPIRE$ = title:e_rhun
			}
		}
		title:e_golden_realm_rhun = {
			holder = {
				every_courtier_or_guest = { death = { death_reason = death_vanished } }
				every_knight = { death = { death_reason = death_vanished } }
			}
			holder = { destroy_title = prev }
		}
	}
	if = {
		limit = { $EMPIRE$ = title:e_bozisha_miraz }
		title:e_thon_an_kharlokh = {
			holder = {
				every_courtier_or_guest = { death = { death_reason = death_vanished } }
				every_knight = { death = { death_reason = death_vanished } }
			}
			holder = { destroy_title = prev }
		} 
	}
	if = {
		limit = { $EMPIRE$ = title:e_calenardhon }
		title:d_isengard = {
			holder = {
				every_courtier_or_guest = { death = { death_reason = death_vanished } }
				every_knight = { death = { death_reason = death_vanished } }
			}
			every_de_jure_county = {
                add_county_modifier = block_settlement_ability
				if = {
					limit = {
						NOT = {
							any_in_list = {
								list = prev_title_holder
								this = holder
							}
							holder = character:k_wastelands_holder
						}
					}
					holder = { add_to_list = prev_title_holder }
				}
	
				every_county_province = {
					limit = {
						OR = {
							has_holding_type = city_holding
							has_holding_type = church_holding
							has_holding_type = settlement_holding
							has_holding_type = tribal_holding
							has_holding_type = castle_holding
							has_holding_type = elven_holding
						}
					}
					set_holding_type = wastelands_holding
				}
				
				change_title_holder = {
					holder = character:k_wastelands_holder
					change = scope:change
					take_baronies = yes
				}
			}
		}
		
	}

	$EMPIRE$ = {
		every_de_jure_county = {
            add_county_modifier = block_settlement_ability
			if = {
				limit = {
					NOT = {
						any_in_list = {
							list = prev_title_holder
							this = holder
						}
						holder = character:k_wastelands_holder
					}
				}
				holder = { add_to_list = prev_title_holder }
			}

			every_county_province = {
				limit = {
					OR = {
						has_holding_type = city_holding
						has_holding_type = church_holding
						has_holding_type = settlement_holding
						has_holding_type = tribal_holding
						has_holding_type = castle_holding
						has_holding_type = elven_holding
					}
				}
				set_holding_type = wastelands_holding
			}
			
			change_title_holder = {
				holder = character:k_wastelands_holder
				change = scope:change
				take_baronies = yes
			}
		}
		set_color_from_title = title:k_invisible_title
	}

	if = {
		limit = { $EMPIRE$ = tier_empire }
		every_de_jure_county = { duchy.kingdom = { set_color_from_title = title:k_invisible_title } }
	}

	resolve_title_and_vassal_change = scope:change

	# Kills off all the previous rulers, stops courtier bloat
	every_in_list = {
		list = prev_title_holder
		if = {
			limit = {
				NOR = {
					this = character:lineofsauron
					this = nazgul1
					this = nazgul2
					this = goldenking1
					this = nazgul4
					this = nazgul5
					this = nazgul6
					this = nazgul7
					this = nazgul7
					this = nazgul9
					this = character:lineofsaruman
					this = character:lineofgandalf
					this = character:lineofradagast
				}
			}
			death = { death_reason = death_disappearance }

			every_close_family_member = {
				limit = { is_ruler = no }
				death = { death_reason = death_disappearance }
			}
		}
		else = {
			set_character_faith_with_conversion = faith:faith_ainur
			set_location = province:3900
		}
	}
		
	character:k_wastelands_holder = {
		every_held_title = {
			limit = { tier = tier_county }
			set_county_faith = faith:faith_wastelands_pagan
			set_county_culture = culture:wastelands
			generate_coa = yes
			# duchy.kingdom = { set_color_from_title = title:k_invisible_title }
			# duchy = { set_color_from_title = title:k_invisible_title }
		}
		
	}
	kill_random_courtiers = yes
	stop_wastelands_wars = yes
}

add_empires_to_global_list = {
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_gondor_steward
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_enedhwaith
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_calenardhon
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_mordor
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_haradwaith
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_umbar
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_bellakar
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_bozisha_miraz
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_nafarat
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_dune_sea
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_thani_hazad
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_laurelindorenan
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_anduin_vale
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_greenwood
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_rhovanion
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_rhun
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_khand
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_arnor
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_lindon
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_forodwaith
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_misty_mountains
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_iron_mountains
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_orrostar
	}
	add_to_global_variable_list = {
		name = all_empires_in_game
		target = title:e_blue_mountains
	}
}

add_kingdom_titles_to_list = {
	every_in_global_list = {
		variable = all_empires_in_game
		every_de_jure_county = {
			duchy.kingdom = {
				if = {
					limit = {
						NOT = {
							any_in_global_list = {
								variable = all_de_jure_kingdoms
								this = prev
							}
						}
					}
					add_to_global_variable_list = {
						name = all_kingdoms_in_game
						target = this
					}
				}
			}
		}
	}
}

canon_area_empires = {
	every_in_global_list = {
		variable = all_empires_in_game
		limit = {
			NOT = {
				this = title:e_gondor_steward
				this = title:e_enedhwaith
				this = title:e_calenardhon
				this = title:e_mordor
				this = title:e_haradwaith
				this = title:e_umbar
				this = title:e_laurelindorenan
				this = title:e_anduin_vale
				this = title:e_greenwood
				this = title:e_rhovanion
				this = title:e_rhun
				this = title:e_khand
				this = title:e_arnor
				this = title:e_lindon
				this = title:e_forodwaith
				this = title:e_misty_mountains
				this = title:e_iron_mountains
				this = title:e_orrostar
				this = title:e_blue_mountains
			}
		}
		add_to_global_variable_list = {
			name = non_canon_areas
			target = this
		}
	}
}

kill_random_courtiers = {
	every_living_character = {
		limit = {
			OR = {
				AND = {
					is_ruler = no
					is_knight = no
					is_sauron = no
					is_councillor = no
					is_concubine = no
					is_clergy = no
					is_courtier = no
					is_in_valinor = no
				}
				primary_title = { is_mercenary_company = yes }
			}
		}
		death = { death_reason = death_disappearance }
	}
}

stop_wastelands_wars = {
	character:k_wastelands_holder = { every_character_war = { end_war = white_peace } }
}