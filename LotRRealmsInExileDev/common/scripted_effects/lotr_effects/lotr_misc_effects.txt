lotr_get_aggressive = { root.house = { add_house_modifier = { modifier = lotr_conquering_modifier years = 30 } } }

increase_variable = { # From Tobbzn
    if = { limit = { NOT = { has_variable = $NAME$ } }
        set_variable = { name = $NAME$ value = 0 }
    }
    change_variable = {
        name = $NAME$
        add = $AMOUNT$
    }
}

decrease_variable = { # From Tobbzn
    if = { limit = { NOT = { has_variable = $NAME$ } }
        set_variable = { name = $NAME$ value = 0 }
    }
    change_variable = {
        name = $NAME$
        subtract = $AMOUNT$
    }
}

decrease_global_variable_effect = {
	if = {
		limit = {
			NOT = { exists = global_var:$VAR$ }
		}
		set_global_variable = {
			name = $VAR$
			value = $VAL$
		}
	}
	else = {
		change_global_variable = {
			name = $VAR$
			subtract = $VAL$
		}
	}
}

test_ai_colonization = {
	every_ruler = {
		trigger_event = wastelands.0006
		every_held_county = {
			limit = { any_county_province = { has_holding_type = settlement_holding } }
			holder = { add_gold = 200 }
			save_scope_as = curr_county
			lotr_upgrade_settlement_to_full_holding_effect = { COUNTY = scope:curr_county }
		}
	}
}

set_balan_lai_game_start = {
	every_balan_lai_member = {
		save_scope_as = curr_balan_lai
		title:k_wastelands = {
			add_to_variable_list = {
				name = balan_lai_members
				target = scope:curr_balan_lai
			}
		}
	}
}

remove_cannot_marry_imrazor_arimith = {
	character:lineofkrassabarohin103 = {
		remove_trait = cannot_marry
	}
	character:linealsariastwo37 = {
		remove_trait = cannot_marry
	}
}

test_create_contract = {
	create_task_contract = {
		task_contract_type = lotr_bountig_story_eastern_rhovanion_war
		location = root.location
		task_contract_employer = root.location.county.holder
		task_contract_tier = 4
	}
}

# Smaug destroyed all my land effect
smaug_become_landless_effect = {
	show_as_tooltip = { banish = yes }
	save_scope_as = allow_imprisoned_landless
	if = {
		limit = { is_valid_for_laampdom = yes }
		custom_tooltip = laamp_may_become_adventurer_tt
	}
	$BANISHER$ = { save_scope_as = banisher }
	trigger_event = { id = smaug_event_chain.0102 }
}

add_building_if_possible = {
	if = {
		limit = {
			has_free_building_slot = yes
			NOT = { has_building = $BUILDING$ }
		}
		add_building = $BUILDING$
	}
}

wulf_negotiation_duel_effect = {
	duel = {
		skill = diplomacy
		target = scope:thorne
		25 = {
			desc = war_of_the_rohirrim.0341.success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 1
				min = -10
			}
			opinion_modifier = {
				who = scope:thorne
				opinion_target = this
				multiplier = 0.1
			}
			modifier = {
				add = 5
				has_character_flag = wulf_rohan_promise_pat_marriage
			}
			modifier = {
				add = 15
				has_character_flag = wulf_rohan_promise_mat_marriage
			}
			modifier = {
				add = 20
				has_character_flag = wulf_rohan_promise_land
			}
			modifier = {
				add = 15
				has_character_flag = wulf_rohan_promise_vassal_contract
			}
			modifier = {
				add = 10
				has_character_flag = wulf_rohan_promise_hook
			}
			modifier = {
				add = 25
				has_character_flag = wulf_rohan_promise_co_monarch
			}
			modifier = {
				add = 10
				has_character_flag = wulf_rohan_promise_independence
			}			
			custom_tooltip = war_of_the_rohirrim.0341.success.effect
			if = {
				limit = {
					has_character_flag = wulf_rohan_promise_pat_marriage
				}
				custom_tooltip = war_of_the_rohirrim.0342.a.effect
			}
			if = {
				limit = {
					has_character_flag = wulf_rohan_promise_mat_marriage
				}
				custom_tooltip = war_of_the_rohirrim.0342.b.effect
			}
			if = {
				limit = {
					has_character_flag = wulf_rohan_promise_land
				}
				custom_tooltip = war_of_the_rohirrim.0342.c.effect
			}
			if = {
				limit = {
					has_character_flag = wulf_rohan_promise_vassal_contract
				}
				custom_tooltip = war_of_the_rohirrim.0342.d.effect
			}
			if = {
				limit = {
					has_character_flag = wulf_rohan_promise_hook
				}
				custom_tooltip = war_of_the_rohirrim.0342.e.effect
			}
			if = {
				limit = {
					has_character_flag = wulf_rohan_promise_co_monarch
				}
				custom_tooltip = war_of_the_rohirrim.0342.f.effect
			}
			if = {
				limit = {
					has_character_flag = wulf_rohan_promise_independence
				}
				custom_tooltip = war_of_the_rohirrim.0342.g.effect
			}
			if = {
				limit = {
					NOR = {
						has_character_flag = wulf_rohan_promise_pat_marriage
						has_character_flag = wulf_rohan_promise_mat_marriage
						has_character_flag = wulf_rohan_promise_land
						has_character_flag = wulf_rohan_promise_vassal_contract
						has_character_flag = wulf_rohan_promise_hook
						has_character_flag = wulf_rohan_promise_co_monarch
						has_character_flag = wulf_rohan_promise_independence
					}
				}
				custom_tooltip = war_of_the_rohirrim.0342.no_promises
			}
			trigger_event = war_of_the_rohirrim.0343
		}
		75 = {
			desc = war_of_the_rohirrim.0341.failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -1
				min = -10
			}
			opinion_modifier = {
				who = scope:thorne
				opinion_target = this
				multiplier = -0.1
			}
			modifier = {
				add = -5
				has_character_flag = wulf_rohan_promise_pat_marriage
			}
			modifier = {
				add = -15
				has_character_flag = wulf_rohan_promise_mat_marriage
			}
			modifier = {
				add = -20
				has_character_flag = wulf_rohan_promise_land
			}
			modifier = {
				add = -15
				has_character_flag = wulf_rohan_promise_vassal_contract
			}
			modifier = {
				add = -10
				has_character_flag = wulf_rohan_promise_hook
			}
			modifier = {
				add = -25
				has_character_flag = wulf_rohan_promise_co_monarch
			}
			modifier = {
				add = -10
				has_character_flag = wulf_rohan_promise_independence
			}
			custom_tooltip = war_of_the_rohirrim.0341.failure.effect
			trigger_event = war_of_the_rohirrim.0344
		}
	}
}

wulf_rohan_victory_thorne_commitments_effect = {
	if = { # Pat Marriage
		limit = {
			has_character_flag = wulf_rohan_promise_pat_marriage
			character:linethorne7 = {
				is_alive = yes
			}
		}
		hidden_effect = {
			remove_trait = cannot_marry
			character:linethorne7 = {
				remove_trait = cannot_marry
			}
		}
		marry = character:linethorne7
		create_alliance = {			
			target = character:linethorne5	
			allied_through_owner = root
			allied_through_target = character:linethorne7
		}
	}
	else_if = { # Mat Marriage
		limit = {
			has_character_flag = wulf_rohan_promise_mat_marriage
			character:linethorne7 = {
				is_alive = yes
			}
		}
		hidden_effect = {
			remove_trait = cannot_marry
			character:linethorne7 = {
				remove_trait = cannot_marry
			}
		}
		marry_matrilineal = character:linethorne7
		create_alliance = {			
			target = character:linethorne5	
			allied_through_owner = root
			allied_through_target = character:linethorne7
		}
	}
	if = { # Lands
		limit = {
			has_character_flag = wulf_rohan_promise_land
		}
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
		}
		every_realm_county = {
			limit = {
				OR = {
					duchy = title:d_thewold
					duchy = title:d_eastemnet
				}
				NOR = {
					holder = character:linethorne5
					holder = {
						any_liege_or_above = {
							this = character:linethorne5
						}
					}
				}
			}
			change_title_holder = {
				holder = character:linethorne5
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
	}
	if = { # Vassal Contract
		limit = {
			has_character_flag = wulf_rohan_promise_vassal_contract
		}
		character:linethorne5 = {
			vassal_contract_set_obligation_level = {
				type = feudal_government_taxes
				level = 0
			}
			vassal_contract_set_obligation_level = {
				type = feudal_government_levies
				level = 1
			}
			vassal_contract_set_obligation_level = {
				type = title_revocation_rights
				level = 1
			}
		}
	}
	if = { # Strong Hook
		limit = {
			has_character_flag = wulf_rohan_promise_hook
		}
		character:linethorne5 = {
			add_hook = {
				target = root
				type = strong_obligation_hook
		   }
		}
	}
	if = { # Co-Monarch
		limit = {
			has_character_flag = wulf_rohan_promise_co_monarch
		}
		try_start_diarchy = co_monarchy
		set_diarch = character:linethorne5
		change_diarchy_swing = 75
	}
	if = { # Independence
		limit = {
			has_character_flag = wulf_rohan_promise_independence
		}
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
			add_claim_on_loss = no
		}
		becomes_independent = { change = scope:change }
		add_truce_both_ways = {
			character = character:linethorne5
			years = 10
			name = TRUCE_TRADE_DEAL
		}
		resolve_title_and_vassal_change = scope:change
	}
}

lotr_special_bountig_contract_passive_spawn_effect = {
	root.story_owner = {
		#count how many contracts you already have
		every_character_task_contract = {
			add_to_list = num_of_contracts_before
		}
		# G'is a contract.
		lotr_bountig_populate_location_with_contracts_effect = {
			AREA_CHAR = root.story_owner.domicile.domicile_location.county.holder
			AMOUNT = $SPAWN_CONTRACTS$
		}
		#count them again to see if the effect above spawned something
		every_character_task_contract = {
			add_to_list = num_of_contracts_after
		}
		set_local_variable = {
			name = current_value
			value = list_size:num_of_contracts_before
		}
		# Make sure we don't get too many of them just sitting in one place.
		while = {
			limit = {
				local_var:current_value < list_size:num_of_contracts_after
			}
			increment_variable_effect = {
				VAR = contract_passive_spawn_tally
				VAL = 1
			}
			change_local_variable = {
				name = current_value
				add = 1
			}
		}
	}
}

lotr_bountig_populate_location_with_contracts_effect = {
	root.story_owner = {
		if = {
			limit = {
				# The AI have their own system for getting contracts.
				trigger_if = {
					limit = { is_landless_adventurer = yes }
					is_ai = no
				}
				lock_contracts_from_spawning_in_sahara_trigger = yes
			}
			# Flag our pre-existing contracts if necessary.
			if = {
				limit = { exists = scope:toggle_distance_ignore }
				every_character_task_contract = { add_to_list = pre_existing_contracts_list }
			}
			# Now populate.
			populate_task_contracts_for_area = {
				location = $AREA_CHAR$.capital_province
				amount = $AMOUNT$
				group = { 
					laamp_contracts_transport_group 
					laamp_contracts_criminal_group
					laamp_contracts_diplomacy_group
					laamp_contracts_hireling_group
					laamp_contracts_hunting_group
					laamp_contracts_intrigue_group
					laamp_contracts_learning_group
					laamp_contracts_martial_group
					laamp_contracts_stewardship_group
					laamp_contracts_justicar_group
					laamp_contracts_ranger_group
				}
			}
			# Then flag our new contracts (again, if necessary).
			if = {
				limit = { exists = scope:toggle_distance_ignore }
				every_character_task_contract = {
					limit = {
						NOT = { is_in_list = pre_existing_contracts_list }
					}
					set_variable = {
						name = retain_despite_distance
						value = yes
					}
				}
			}
		}
	}
}

lotr_recovering_from_long_winter_effects = {
	add_province_modifier = {
		modifier = long_winter_aftermath
		years = 2
	}
}

lotr_faith_has_patrons = { 
	faith:$FAITH$ = { set_variable = lotr_has_patrons }
}

lotr_set_faith_patrons = {
	faith:$FAITH$ = { 
		add_to_variable_list = {
			name = lotr_faith_patrons
			target = flag:$PATRON_GOD$
		}
	}
	lotr_faith_has_patrons = { FAITH = $FAITH$ }
}

get_every_numenor_in_exile_county = {
	title:c_minas_tirith.empire = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:e_umbar = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:e_bellakar = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:e_thani_hazad = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:k_tulwang = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_zajantak = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_raishoul = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_tulwang = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_harondor = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_haruzan = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:e_arnor = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:e_enedhwaith = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:k_south_rhovanion = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_kirmlesra = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_isra = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_lynerian_league = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_harshandatt = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:e_khy = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:k_tanturak = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:e_forodwaith = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:k_eregion = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:e_calenardhon = {
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
		every_de_jure_county = { kingdom = { set_de_jure_liege_title = root.primary_title } }
	}
	title:k_usrievar = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}
	title:k_mejhanir = {
		set_de_jure_liege_title = root.primary_title
		every_de_jure_county_holder = {
			limit = {
				is_wastelands = no
				NOT = { is_vassal_or_below_of = root }
			}
			if = {
				limit = { highest_held_title_tier < tier_empire }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
					add_claim_on_loss = no
				}

				change_liege = {
					liege = root
					change = scope:change
				}

				resolve_title_and_vassal_change = scope:change
			} else = {
				create_title_and_vassal_change = {
					type = created
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				every_held_county = {
					change_title_holder = {
						holder = root
						change = scope:title_change
						take_baronies = yes
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}
		every_de_jure_county = {
			limit = {
				is_wastelands = yes
			}
			save_scope_as = target_county
			ai_colonisation_effect = { WASTELANDS = scope:target_county ROOT_SCOPE = root}
		}
	}

	primary_title = { set_title_name = "e_new_numenor" }
}

# Applicable arguments are:
#		- intro_event
#		- story_content
lotr_set_lore_character_for_bookmark = {
	this = { save_scope_as = lore_char }
	title:k_wastelands = {
		add_to_variable_list = {
			name = lore_character_list
			target = scope:lore_char
		}
	}
	scope:lore_char = { set_variable = { name = lotr_type_of_content value = flag:$TYPE_OF_CONTENT$ } }
}

### Mardat Effects ### 
make_target_character_ruler_of_ray = {
	create_title_and_vassal_change = {
		type = usurped
		save_scope_as = title_change
		add_claim_on_loss = yes
	}
	title:k_ray.holder = {
		every_held_title = {
			change_title_holder_include_vassals = {
				holder = $TARGET$
				change = scope:title_change
			}
		}
	}
	title:k_ray = {
		change_title_holder_include_vassals = {
			holder = $TARGET$
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change
}

full_character_ethnicity_change = {
	save_scope_as = relative_root
	set_culture = $CULTURE$
	create_character = {
		employer = character:k_wastelands_holder
		culture = scope:relative_root.culture
		faith = scope:relative_root.faith
		dynasty = none
		gender = scope:relative_root
		save_scope_as = name_lender
		after_creation = {
			death = { death_reason = death_vanished }
		}
	}
	copy_inheritable_appearance_from = scope:name_lender
	change_first_name = { template_character = scope:name_lender }
	if = {
		limit = { age < 1 }
		set_age = { young_age old_age } 
	}
}