################################
### History Contract Effects ###
################################

add_lotr_historical_subject_contracts = {
    every_ruler = {
        if = { #The Balin-Lai
            limit = {
                OR = {
                    faith = faith:faith_thani_hazad
                    faith = faith:faith_gimileth
                }
            }
            every_vassal = {
                limit = {
                    vassal_contract_has_modifiable_obligations = yes
                }
                vassal_contract_set_obligation_level = { type = title_revocation_rights level = 1 } #Kharadunai get Revocation Protection
                vassal_contract_set_obligation_level = { type = jizya_special_rights level = 1 } #Native vassals get Jizya
                if = { # Blacklocks and Sederi get castellan
                    limit = {
                        government_has_flag = government_is_feudal
                        OR = {
                            culture = culture:blacklocks_nargubraz
                            culture = culture:sederi
                        }
                    }
                    vassal_contract_set_obligation_level = { type = special_contract level = 3 }
                }
                if = { #Pel get palatinate
                    limit = {
                        government_has_flag = government_is_feudal
                        culture = culture:pel
                    }
                    vassal_contract_set_obligation_level = { type = special_contract level = 4 }
                }
            }
        }
        if = { # The Storm Host in Khorsaj
            limit = {
                game_start_date >= 6533.1.1
                game_start_date <= 7033.1.1
                primary_title = title:e_thon_an_kharlokh
            }
            every_vassal = { #Extort for protections
                limit = {
                    vassal_contract_has_modifiable_obligations = yes
                }
                vassal_contract_set_obligation_level = { type = title_revocation_rights level = 1 }
                vassal_contract_set_obligation_level = { type = religious_rights level = 1 }
                if = {
                    limit = { #Extort AB more
                        primary_title = title:k_an_balkumagan
                    }
                    vassal_contract_set_obligation_level = { type = feudal_government_levies level = 4 }
                    vassal_contract_set_obligation_level = { type = fortification_rights level = 1 }
                    vassal_contract_set_obligation_level = { type = coinage_rights level = 1 }
                    vassal_contract_set_obligation_level = { type = feudal_government_taxes level = 4 }
                }
                else = { #Extort Dukes more
                    limit = {
                        government_has_flag = government_is_feudal
                    }
                    vassal_contract_set_obligation_level = { type = special_contract level = 1 }
                    vassal_contract_set_obligation_level = { type = feudal_government_taxes level = 4 }
                }
            }
        }
    }
}

set_administrative_themes_type = { # Fired in title scope in history
    if = {
        limit = {
            exists = holder
            exists = holder.top_liege
            holder = {
                government_allows = administrative
            }
        }
        holder = {
            vassal_contract_set_obligation_level = {
                type = administrative_themes
                level = $LEVEL$
            }
        }
    }
}

administrative_government_dlc_check = { #Fired in title scope in history
    if = {
        limit = {
            exists = holder
            NOT = { has_dlc_feature = roads_to_power }
        }
        holder = {
            change_government = $REPLACEMENT$
            if = {
                limit = {
                    can_keep_single_heir_succession_law_trigger = yes
                }
                add_realm_law_skip_effects = single_heir_succession_law
            }
        }
    }
}