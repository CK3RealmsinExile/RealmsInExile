 ###################################
###								  ###
###		Elven Situation Effects	  ###
###								  ###
 ###################################

### Situation Phase Effects ###

# Move situation to the next phase according to current hope threshold
update_lorien_phase_effect = { # Lorien & Imladris
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:lorien_hope_value
		REGION_CAPITAL = title:c_caras_galadhon
		SUB_REGION = rivendell_lorien
	}
}

update_lindon_phase_effect = { # Lindon
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:lindon_hope_value
		REGION_CAPITAL = title:c_mithrhulond
		SUB_REGION = lindon
	}
}

update_greenwood_phase_effect = { # Greenwood
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:greenwood_hope_value
		REGION_CAPITAL = title:c_aradhrynd
		SUB_REGION = lasgalen
	}
}

update_ormal_phase_effect = { # Bay of Ormal
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:ormal_hope_value
		REGION_CAPITAL = title:c_carnesra
		SUB_REGION = bay_of_ormal
	}
}

update_kinnlai_phase_effect = { # Lands of the Kinn-lai
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:kinnlai_hope_value
		REGION_CAPITAL = title:c_ayahopa
		SUB_REGION = utter_south
	}
}

update_drel_phase_effect = { # Drel & Thani-Hazad
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:drel_hope_value
		REGION_CAPITAL = title:c_ainglad
		SUB_REGION = thani_hazad
	}
}

update_sumarieth_phase_effect = { # Ray, Bellakar, Tulwang
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:sumarieth_hope_value
		REGION_CAPITAL = title:c_bozisha_dar
		SUB_REGION = bay_of_tulwang
	}
}

update_haradwaith_phase_effect = { # Far and Near Harad, plus the Dune Sea
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:haradwaith_hope_value
		REGION_CAPITAL = title:c_mazharath
		SUB_REGION = haradwaith
	}
}

update_nelornieth_phase_effect = { # Nelornieth and wider Rhûn
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:nelornieth_hope_value
		REGION_CAPITAL = title:c_caras_torn
		SUB_REGION = nelornieth
	}
}

update_rhovanion_phase_effect = { # Most of Rhovanion plus the Northern Mountains
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:rhovanion_hope_value
		REGION_CAPITAL = title:c_dale
		SUB_REGION = eastern_rhovanion
	}
}

update_anduinvale_phase_effect = { # Anduin Vale, Rohan, Isengard
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:anduinvale_hope_value
		REGION_CAPITAL = title:c_framsburg
		SUB_REGION = western_rhovanion
	}
}

update_eriador_phase_effect = { # Eriador, Forodwaith, Enedhwaith
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:eriador_hope_value
		REGION_CAPITAL = title:c_fornost
		SUB_REGION = eriador
	}
}

update_gondor_phase_effect = { # Gondor and the White Mountains
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:gondor_hope_value
		REGION_CAPITAL = title:c_minas_tirith
		SUB_REGION = gondor
	}
}

update_mordor_phase_effect = { # Mordor
	update_X_region_phase_effect = { 
		REGION_HOPE_VAR = var:mordor_hope_value
		REGION_CAPITAL = title:c_barad_dur
		SUB_REGION = mordor
	}
}

update_X_region_phase_effect = {
	if = {
		limit = {
			situation:elven_hope_situation.situation_sub_region:$SUB_REGION$ = {
				$REGION_HOPE_VAR$ <= elven_fading_limit
			}
		}
		every_situation_sub_region = {
			limit = { situation_sub_region_has_county = $REGION_CAPITAL$ }
			change_phase = { phase = situation_elven_fading }
		}
	}
	else_if = {
		limit = {
			situation:elven_hope_situation.situation_sub_region:$SUB_REGION$ = {
				$REGION_HOPE_VAR$ <= elven_waning_limit
				$REGION_HOPE_VAR$ > elven_fading_limit
			}
		}
		every_situation_sub_region = {
			limit = { situation_sub_region_has_county = $REGION_CAPITAL$ }
			change_phase = { phase = situation_elven_waning }
		}
	}
	else_if = {
		limit = {
			situation:elven_hope_situation.situation_sub_region:$SUB_REGION$ = {
				$REGION_HOPE_VAR$ <= elven_enduring_limit
				$REGION_HOPE_VAR$ > elven_waning_limit
			}
		}
		every_situation_sub_region = {
			limit = { situation_sub_region_has_county = $REGION_CAPITAL$ }
			change_phase = { phase = situation_elven_enduring }
		}
	}
	else_if = {
		limit = {
			situation:elven_hope_situation.situation_sub_region:$SUB_REGION$ = {
				$REGION_HOPE_VAR$ <= elven_renewing_limit
				$REGION_HOPE_VAR$ > elven_enduring_limit
			}
		}
		every_situation_sub_region = {
			limit = { situation_sub_region_has_county = $REGION_CAPITAL$ }
			change_phase = { phase = situation_elven_renewing }
		}
	}
	else_if = {
		limit = {
			situation:elven_hope_situation.situation_sub_region:$SUB_REGION$ = {
				$REGION_HOPE_VAR$ <= elven_thriving_limit
				$REGION_HOPE_VAR$ > elven_renewing_limit
			}
		}
		every_situation_sub_region = {
			limit = { situation_sub_region_has_county = $REGION_CAPITAL$ }
			change_phase = { phase = situation_elven_thriving }
		}
	}
}

### Remove excess hope ###
remove_excess_hope_effect = {
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = lorien_hope_value
		SUB_REGION = rivendell_lorien
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = lindon_hope_value
		SUB_REGION = lindon
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = greenwood_hope_value
		SUB_REGION = lasgalen
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = nelornieth_hope_value
		SUB_REGION = nelornieth
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = drel_hope_value
		SUB_REGION = thani_hazad
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = kinnlai_hope_value
		SUB_REGION = utter_south
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = anduinvale_hope_value
		SUB_REGION = western_rhovanion
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = eriador_hope_value
		SUB_REGION = eriador
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = rhovanion_hope_value
		SUB_REGION = eastern_rhovanion
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = gondor_hope_value
		SUB_REGION = gondor 
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = ormal_hope_value
		SUB_REGION = bay_of_ormal
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = sumarieth_hope_value
		SUB_REGION = bay_of_tulwang
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = haradwaith_hope_value
		SUB_REGION = haradwaith
	}
	remove_excess_hope_sub_region_effect = {
		REGION_HOPE_VAR = mordor_hope_value
		SUB_REGION = mordor
	}
}

remove_excess_hope_sub_region_effect = {
	if = {
		limit = {
			situation_sub_region:$SUB_REGION$ = {
				var:$REGION_HOPE_VAR$ > elven_thriving_limit
			}
		}
		situation_sub_region:$SUB_REGION$ = {
			set_variable = {
				name = $REGION_HOPE_VAR$
				value = elven_thriving_limit
			}
		}
	}
}

### Cap hope at zero so it can't go below ###
cap_hope_at_zero_effect = {
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = lorien_hope_value
		SUB_REGION = rivendell_lorien
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = lindon_hope_value
		SUB_REGION = lindon
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = greenwood_hope_value
		SUB_REGION = lasgalen
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = nelornieth_hope_value
		SUB_REGION = nelornieth
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = drel_hope_value
		SUB_REGION = thani_hazad
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = kinnlai_hope_value
		SUB_REGION = utter_south
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = anduinvale_hope_value
		SUB_REGION = western_rhovanion
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = eriador_hope_value
		SUB_REGION = eriador
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = rhovanion_hope_value
		SUB_REGION = eastern_rhovanion
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = gondor_hope_value
		SUB_REGION = gondor 
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = ormal_hope_value
		SUB_REGION = bay_of_ormal
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = sumarieth_hope_value
		SUB_REGION = bay_of_tulwang
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = haradwaith_hope_value
		SUB_REGION = haradwaith
	}
	cap_hope_at_zero_effect_sub_region_effect = {
		REGION_HOPE_VAR = mordor_hope_value
		SUB_REGION = mordor
	}
}

cap_hope_at_zero_effect_sub_region_effect = {
	if = {
		limit = {
			situation_sub_region:$SUB_REGION$ = {
				var:$REGION_HOPE_VAR$ < elven_situation_zero
			}
		}
		situation_sub_region:$SUB_REGION$ = {
			set_variable = {
				name = $REGION_HOPE_VAR$
				value = elven_situation_zero
			}
		}
	}
}

### Adding and Removing Hope ###

# Add/Subtract hope through effect 
add_elven_hope_effect = {
	save_scope_as = hope_recipient
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = lorien_hope_value }
			save_scope_as = lorien_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = lindon_hope_value }
			save_scope_as = lindon_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = greenwood_hope_value }
			save_scope_as = greenwood_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = ormal_hope_value }
			save_scope_as = ormal_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = kinnlai_hope_value }
			save_scope_as = kinnlai_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = drel_hope_value }
			save_scope_as = drel_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = sumarieth_hope_value }
			save_scope_as = sumarieth_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = haradwaith_hope_value }
			save_scope_as = haradwaith_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = nelornieth_hope_value }
			save_scope_as = nelornieth_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = rhovanion_hope_value }
			save_scope_as = rhovanion_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = anduinvale_hope_value }
			save_scope_as = anduinvale_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = eriador_hope_value }
			save_scope_as = eriador_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = gondor_hope_value }
			save_scope_as = gondor_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = mordor_hope_value }
			save_scope_as = mordor_situation
		}
	}
	
	if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_west_rhovanion_lothlorien
						geographical_region = middleearth_west_eregion
						geographical_region = middleearth_mountains_misty
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_west_rhovanion_lothlorien
							geographical_region = middleearth_west_eregion
							geographical_region = middleearth_mountains_misty
						}
					}
				}
			}
		}
		scope:lorien_situation = {
			change_variable = {
				name = lorien_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = lorien_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_west_beleriand
						geographical_region = middleearth_mountains_blue
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_west_beleriand
							geographical_region = middleearth_mountains_blue
						}
					}
				}
			}
		}
		scope:lindon_situation = {
			change_variable = {
				name = lindon_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = lindon_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					geographical_region = middleearth_west_rhovanion_mirkwood
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						geographical_region = middleearth_west_rhovanion_mirkwood
					}
				}
			}
		}
		scope:greenwood_situation = {
			change_variable = {
				name = greenwood_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = greenwood_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_harad_bayoformal
						geographical_region = middleearth_uttersouth_shayn
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_harad_bayoformal
							geographical_region = middleearth_uttersouth_shayn
						}
					}
				}
			}
		}
		scope:ormal_situation = {
			change_variable = {
				name = ormal_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = ormal_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_uttersouth_mumakan
						geographical_region = middleearth_uttersouth_usakan
						geographical_region = middleearth_uttersouth_twinkingdoms
						geographical_region = middleearth_mountains_yellow
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_uttersouth_mumakan
							geographical_region = middleearth_uttersouth_usakan
							geographical_region = middleearth_uttersouth_twinkingdoms
							geographical_region = middleearth_mountains_yellow
						}
					}
				}
			}
		}
		scope:kinnlai_situation = {
			change_variable = {
				name = kinnlai_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = kinnlai_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					geographical_region = middleearth_uttersouth_thanihazad
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						geographical_region = middleearth_uttersouth_thanihazad
					}
				}
			}
		}
		scope:drel_situation = {
			change_variable = {
				name = drel_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = drel_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_harad_far_bellakar_central
						geographical_region = middleearth_harad_far_tulwang
						geographical_region = middleearth_harad_far_ray
						geographical_region = middleearth_mountains_yellow
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_harad_far_bellakar_central
							geographical_region = middleearth_harad_far_tulwang
							geographical_region = middleearth_harad_far_ray
							geographical_region = middleearth_mountains_yellow
						}
					}
				}
			}
		}
		scope:sumarieth_situation = {
			change_variable = {
				name = sumarieth_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = sumarieth_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_harad_dunesea
						geographical_region = middleearth_harad_near
						geographical_region = middleearth_harad_far_bellakar_bayoffelaya
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_harad_dunesea
							geographical_region = middleearth_harad_near
							geographical_region = middleearth_harad_far_bellakar_bayoffelaya
						}
					}
				}
			}
		}
		scope:haradwaith_situation = {
			change_variable = {
				name = haradwaith_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = haradwaith_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					geographical_region = middleearth_rhun
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						geographical_region = middleearth_rhun
					}
				}
			}
		}
		scope:nelornieth_situation = {
			change_variable = {
				name = nelornieth_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = nelornieth_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_west_rhovanion_brownlands
						geographical_region = middleearth_west_rhovanion_dalelands
						geographical_region = middleearth_mountains_iron
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_west_rhovanion_brownlands
							geographical_region = middleearth_west_rhovanion_dalelands
							geographical_region = middleearth_mountains_iron
						}
					}
				}
			}
		}
		scope:rhovanion_situation = {
			change_variable = {
				name = rhovanion_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = rhovanion_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_west_rhovanion_anduin
						geographical_region = middleearth_west_isengard
						geographical_region = middleearth_west_rohan
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_west_rhovanion_anduin
							geographical_region = middleearth_west_isengard
							geographical_region = middleearth_west_rohan
						}
					}
				}
			}
		}
		scope:anduinvale_situation = {
			change_variable = {
				name = anduinvale_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = anduinvale_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_west_arnor
						geographical_region = middleearth_forodwaith
						geographical_region = middleearth_west_enedhwaith
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_west_arnor
							geographical_region = middleearth_forodwaith
							geographical_region = middleearth_west_enedhwaith
						}
					}
				}
			}
		}
		scope:eriador_situation = {
			change_variable = {
				name = eriador_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = eriador_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					OR = {
						geographical_region = middleearth_west_gondor
						geographical_region = middleearth_mountains_white
					}
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						OR = {
							geographical_region = middleearth_west_gondor
							geographical_region = middleearth_mountains_white
						}
					}
				}
			}
		}
		scope:gondor_situation = {
			change_variable = {
				name = gondor_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = gondor_situation
		}
	}
	else_if = {
		limit = {
			OR = {
				any_realm_province = {
					geographical_region = middleearth_mordor
				}
				AND = {
					is_landed = no
					domicile.domicile_location = {
						geographical_region = middleearth_mordor
					}
				}
			}
		}
		scope:mordor_situation = {
			change_variable = {
				name = mordor_hope_value
				add = $VALUE$
			}
		}
		create_elven_catalyst_for_history = { 
			VALUE = $VALUE$ 
			HOPE_EFFECT = $HOPE_EFFECT$ 
			SITUATION_REGION = mordor_situation
		}
	}
	custom_description = { text = add_elven_hope_desc value = $VALUE$ }
}

# Increase hope in ALL subregions
add_elven_hope_global_effect = {
	save_scope_as = hope_recipient
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = lorien_hope_value }
			save_scope_as = lorien_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = lindon_hope_value }
			save_scope_as = lindon_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = greenwood_hope_value }
			save_scope_as = greenwood_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = ormal_hope_value }
			save_scope_as = ormal_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = kinnlai_hope_value }
			save_scope_as = kinnlai_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = drel_hope_value }
			save_scope_as = drel_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = sumarieth_hope_value }
			save_scope_as = sumarieth_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = haradwaith_hope_value }
			save_scope_as = haradwaith_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = nelornieth_hope_value }
			save_scope_as = nelornieth_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = rhovanion_hope_value }
			save_scope_as = rhovanion_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = anduinvale_hope_value }
			save_scope_as = anduinvale_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = eriador_hope_value }
			save_scope_as = eriador_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = gondor_hope_value }
			save_scope_as = gondor_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = mordor_hope_value }
			save_scope_as = mordor_situation
		}
	}
	
	scope:lorien_situation = {
		change_variable = {
			name = lorien_hope_value
			add = $VALUE$
		}
	}
	scope:lindon_situation = {
		change_variable = {
			name = lindon_hope_value
			add = $VALUE$
		}
	}
	scope:greenwood_situation = {
		change_variable = {
			name = greenwood_hope_value
			add = $VALUE$
		}
	}
	scope:ormal_situation = {
		change_variable = {
			name = ormal_hope_value
			add = $VALUE$
		}
	}
	scope:kinnlai_situation = {
		change_variable = {
			name = kinnlai_hope_value
			add = $VALUE$
		}
	}
	scope:drel_situation = {
		change_variable = {
			name = drel_hope_value
			add = $VALUE$
		}
	}
	scope:sumarieth_situation = {
		change_variable = {
			name = sumarieth_hope_value
			add = $VALUE$
		}
	}
	scope:haradwaith_situation = {
		change_variable = {
			name = haradwaith_hope_value
			add = $VALUE$
		}
	}
	scope:nelornieth_situation = {
		change_variable = {
			name = nelornieth_hope_value
			add = $VALUE$
		}
	}
	scope:rhovanion_situation = {
		change_variable = {
			name = rhovanion_hope_value
			add = $VALUE$
		}
	}
	scope:anduinvale_situation = {
		change_variable = {
			name = anduinvale_hope_value
			add = $VALUE$
		}
	}
	scope:eriador_situation = {
		change_variable = {
			name = eriador_hope_value
			add = $VALUE$
		}
	}
	scope:gondor_situation = {
		change_variable = {
			name = gondor_hope_value
			add = $VALUE$
		}
	}
	scope:mordor_situation = {
		change_variable = {
			name = mordor_hope_value
			add = $VALUE$
		}
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = lindon_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = lorien_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = greenwood_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = ormal_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = kinnlai_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = drel_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = sumarieth_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = haradwaith_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = nelornieth_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = rhovanion_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = anduinvale_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = eriador_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = gondor_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = mordor_situation
	}
	custom_description = { text = add_elven_hope_global_desc value = $VALUE$ }
}

# Remove hope in ALL subregions
subtract_elven_hope_global_effect = {
	save_scope_as = hope_recipient
	save_scope_as = hope_recipient
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = lorien_hope_value }
			save_scope_as = lorien_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = lindon_hope_value }
			save_scope_as = lindon_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = greenwood_hope_value }
			save_scope_as = greenwood_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = ormal_hope_value }
			save_scope_as = ormal_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = kinnlai_hope_value }
			save_scope_as = kinnlai_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = drel_hope_value }
			save_scope_as = drel_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = sumarieth_hope_value }
			save_scope_as = sumarieth_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = haradwaith_hope_value }
			save_scope_as = haradwaith_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = nelornieth_hope_value }
			save_scope_as = nelornieth_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = rhovanion_hope_value }
			save_scope_as = rhovanion_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = anduinvale_hope_value }
			save_scope_as = anduinvale_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = eriador_hope_value }
			save_scope_as = eriador_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = gondor_hope_value }
			save_scope_as = gondor_situation
		}
	}
	random_character_situation = {
		random_situation_sub_region = {
			limit = { has_variable = mordor_hope_value }
			save_scope_as = mordor_situation
		}
	}
	
	scope:lorien_situation = {
		change_variable = {
			name = lorien_hope_value
			subtract = $VALUE$
		}
	}
	scope:lindon_situation = {
		change_variable = {
			name = lindon_hope_value
			subtract = $VALUE$
		}
	}
	scope:greenwood_situation = {
		change_variable = {
			name = greenwood_hope_value
			subtract = $VALUE$
		}
	}
	scope:ormal_situation = {
		change_variable = {
			name = ormal_hope_value
			subtract = $VALUE$
		}
	}
	scope:kinnlai_situation = {
		change_variable = {
			name = kinnlai_hope_value
			subtract = $VALUE$
		}
	}
	scope:drel_situation = {
		change_variable = {
			name = drel_hope_value
			subtract = $VALUE$
		}
	}
	scope:sumarieth_situation = {
		change_variable = {
			name = sumarieth_hope_value
			subtract = $VALUE$
		}
	}
	scope:haradwaith_situation = {
		change_variable = {
			name = haradwaith_hope_value
			subtract = $VALUE$
		}
	}
	scope:nelornieth_situation = {
		change_variable = {
			name = nelornieth_hope_value
			subtract = $VALUE$
		}
	}
	scope:rhovanion_situation = {
		change_variable = {
			name = rhovanion_hope_value
			subtract = $VALUE$
		}
	}
	scope:anduinvale_situation = {
		change_variable = {
			name = anduinvale_hope_value
			subtract = $VALUE$
		}
	}
	scope:eriador_situation = {
		change_variable = {
			name = eriador_hope_value
			subtract = $VALUE$
		}
	}
	scope:gondor_situation = {
		change_variable = {
			name = gondor_hope_value
			subtract = $VALUE$
		}
	}
	scope:mordor_situation = {
		change_variable = {
			name = mordor_hope_value
			subtract = $VALUE$
		}
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = lindon_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = lorien_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = greenwood_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = ormal_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = kinnlai_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = drel_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = sumarieth_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = haradwaith_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = nelornieth_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = rhovanion_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = anduinvale_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = eriador_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = gondor_situation
	}
	create_elven_catalyst_for_history = { 
		VALUE = $VALUE$ 
		HOPE_EFFECT = $HOPE_EFFECT$ 
		SITUATION_REGION = mordor_situation
	}
	custom_description = { text = subtract_elven_hope_global_desc value = $VALUE$ }
}

### Misc Effects ###

# Apply development penalty when hope is low
check_elven_development_penalties_effect = {
	every_situation_sub_region = {
		every_situation_sub_region_participant = {
			limit = { 
				is_independent_ruler = yes 
				faith_is_evil = no
			}
			trigger_event = {
				id = elven_hope.0020
				months = { 2 10 }
			}
		}
	}
}

# Create catalysts for the situation GUI
create_elven_catalyst_for_history = {
	set_variable = {
		name = elven_hope_catalyst_loc_value
		value = $VALUE$
	}
	set_variable = {
		name = elven_hope_catalyst_loc_key
		value = flag:$HOPE_EFFECT$
	}
	set_variable = {
		name = elven_hope_catalyst_specific_situation
		value = scope:$SITUATION_REGION$
	}

	if = {
		limit = { $VALUE$ > 0 }
		set_variable = {
			name = elven_hope_catalyst_positive_or_negative
			value = flag:positive_effect
		}
	} 
	else_if = {
		limit = { $VALUE$ < 0 }
		set_variable = {
			name = elven_hope_catalyst_positive_or_negative
			value = flag:negative_effect
		}
	} 
	else = {
		set_variable = {
			name = elven_hope_catalyst_positive_or_negative
			value = flag:positive_effect
		}
	}
	
	create_story = story_elven_hope_catalyst
	random_owned_story = {
		limit = {
			save_temporary_scope_as = this_story 
			
			NOT = {
				scope:$SITUATION_REGION$ = {
					is_target_in_variable_list = {
						name = region_$SITUATION_REGION$_localization
						target = scope:this_story
					}
				}
			}
		}
		scope:$SITUATION_REGION$ = {
			add_to_variable_list = {
				name = region_$SITUATION_REGION$_localization
				target = prev
				years = 5
			}
		}
	}
	remove_variable = elven_hope_catalyst_loc_key
	remove_variable = elven_hope_catalyst_loc_value
	remove_variable = elven_hope_catalyst_specific_situation
}

# Counting evil rulers in a subregion 
check_evil_rulers_per_subregion_effect = {
	every_situation_sub_region = {
		every_situation_sub_region_county = {
			limit = { 
				OR = {
					this.holder.top_overlord ?= { faith_is_evil = yes }
					this.holder = { faith_is_evil = yes }
				}
			}
			prev = { 
				change_variable = {
					name = evil_rulers_in_subregion
					add = 1 
				}
			}
		}
		if = {
			limit = { any_situation_sub_region_participant = { is_ai = no } }
			every_situation_sub_region_participant = {
				limit = { is_ai = no }
				trigger_event = elven_hope.0030 # Display the amount of evil rulers and reduce hope accordingly 
			}
		}
		else = {
			random_situation_sub_region_participant = {
				trigger_event = elven_hope.0030 # Display the amount of evil rulers and reduce hope accordingly 
			}
		}
	}
	random_situation_sub_region = { # Fire an event that resets these variables after 2 days 
		random_situation_sub_region_participant = {
			trigger_event = {
				id = elven_hope.0031 
				days = 1 
			}
		}
	}
}			

### Debug Effects ###
add_elven_hope_debug = {
	add_elven_hope_effect = { VALUE = 100 HOPE_EFFECT = effect_elven_hope_debug }
}

subtract_elven_hope_debug = {
	add_elven_hope_effect = { VALUE = -100 HOPE_EFFECT = effect_elven_hope_debug }
}

