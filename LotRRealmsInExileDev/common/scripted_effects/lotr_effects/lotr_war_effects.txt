lotr_delete_all_maa_regiments = { # Deletes all MAA regiments this has
	every_maa_regiment = {
		destroy_maa_regiment = yes
	}
}

lotr_transfer_all_maa_regiments = { # Transfers all MAA regiments from this to NEW_OWNER
	if = {
		limit = { number_of_maa_regiments >= 1 }
		$NEW_OWNER$ = { save_scope_as = new_owner }
		custom_description_no_bullet = {
			text = lotr_transfer_all_maa_regiments
			subject = this
			object = scope:new_owner
			every_maa_regiment = {
				save_scope_as = regiment

				scope:new_owner = {
					if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 1
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 1
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 2
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 2
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 3
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 3
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 4
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 4
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 5
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 5
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 6
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 6
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 7
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 7
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 8
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 8
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 9
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 9
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 10
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 10
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 11
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 11
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 12
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 12
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 13
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 13
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value = 14
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 14
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value >= 16
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 15
						}
					}
					else_if = {
						limit = {
							exists = scope:regiment
							ep3_governor_yearly_3050_regiment_size_value >= 16
						}
						create_maa_regiment = {
							type_of = scope:regiment
							check_can_recruit = no
							size = 16
						}
					}
				}
				hidden_effect = {
					destroy_maa_regiment = yes
				}
			}
		}
	}
}

pay_short_term_gold_raze_effect = {
	pay_short_term_gold = {
		gold = $GOLD_VALUE$
		target = scope:attacker
		yearly_income = yes
	}
}

decrease_building_or_development = {
	if = { ### Checks whether county should be made wilderness
		limit = {
			any_in_list = {
				list = $LIST$ 
				tier = tier_county
				OR = {
					county.development_level = 0
					county = { title_province = { has_building = dwarven_depths_01 } }
					county = { title_province = { has_building = settlement_01 } }
				}	
				OR = {
					scope:defender = county.holder
					scope:defender = county.holder.top_liege
				}
			}
		}
		every_in_list = { 
			list = $LIST$ 
			limit = {
				OR = {
					county.development_level = 0
					county = { title_province = { has_building = dwarven_depths_01 } }
				}
				OR = {
					scope:defender = county.holder
					scope:defender = county.holder.top_liege
				}
			}
			change_development_level = county.development_level.neg
			make_settlement_county_wilderness = { COUNTY = county }
		}
	}
	if = { ### Decrease development + buildings | Dwarves
		limit = { scope:defender = { is_dwarf = yes } }
		every_in_list = { 
			list = $LIST$ 
			limit = {
				OR = {
					scope:defender = county.holder
					scope:defender = county.holder.top_liege
				}
			}
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_ale_house } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_fungal_farm } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_terrace_farm } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = iron_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = tin_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = copper_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = lead_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = silver_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = gold_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = mithril_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = quartz_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = peridot_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = onyx_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = amethyst_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = ruby_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = sapphire_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = emerald_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = diamond_mines } }
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_quarry } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_crafts } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_toolmaker_guild } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_vaults } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_roads } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_armory } } 
			title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_skirmisher_barracks } } 
			### Buildings with only 5 tiers
			title_province = { remove_building_tier_five_effect = { BUILDING = dwarven_siege_workshop } } 
			title_province = { remove_building_tier_five_effect = { BUILDING = dwarven_hoard } } 
			### Duchy Buildings
			title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = military_specialization } } 
			title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = economic_specialization } } 
			title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = glory_specialization } } 
			### Holding
			title_province = { downgrade_tier_ten_holding = { HOLDING = dwarven_depths } }
		}
	}
	else = { ### Decrease development + buildings | Goblins
		if = {
			limit = { scope:defender = { is_orc = yes } }
			every_in_list = { 
				list = $LIST$ 
				limit = {
					OR = {
						scope:defender = county.holder
						scope:defender = county.holder.top_liege
					}
				}
				### In-case underground county has dwarven buildings, due to being conquered earlier
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_ale_house } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_fungal_farm } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_terrace_farm } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = iron_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = tin_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = copper_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = lead_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = silver_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = gold_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = mithril_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = quartz_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = peridot_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = onyx_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = amethyst_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = ruby_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = sapphire_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = emerald_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = diamond_mines } }
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_quarry } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_crafts } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_toolmaker_guild } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_vaults } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_roads } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_armory } } 
				title_province = { remove_building_tier_ten_effect = { BUILDING = dwarven_skirmisher_barracks } } 
				### Buildings with only 5 tiers
				title_province = { remove_building_tier_five_effect = { BUILDING = dwarven_siege_workshop } } 
				title_province = { remove_building_tier_five_effect = { BUILDING = dwarven_hoard } } 

				### Duchy Buildings
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = military_specialization } } 
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = economic_specialization } } 
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = glory_specialization } }

				### Orc Buildings
				title_province = { remove_building_any_level = { BUILDING = raiding_camps } } 
				title_province = { remove_building_any_level = { BUILDING = uruk_pits } } 
				title_province = { remove_building_any_level = { BUILDING = furnaces } } 
				title_province = { remove_building_any_level = { BUILDING = scouting_posts } } 
				title_province = { remove_building_any_level = { BUILDING = warg_pits } } 
				title_province = { remove_building_any_level = { BUILDING = orc_siege_works } } 
				
				### Orc Duchy Buildings
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = liquor_stills } } 
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = orc_barracks } } 
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = loot_houses } }
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = proving_ground } }
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = tunnel_network } }
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = slaughterhouses } }
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = experimental_workshop } }
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = heavy_armoury } }
				title_province = { destroy_or_downgrade_duchy_effect_lotr = { BUILDING = snaga_warrens } }
				### Holding
				title_province = { downgrade_tier_ten_holding = { HOLDING = dwarven_depths } }
			}
		}
	}
}

decrease_county_development = {
	if = {
		limit = { $COUNTY$ = { development_level > 25 } }
		$COUNTY$ = { change_development_level = -5 }
	}
	else_if = { 
		limit = { $COUNTY$ = { development_level > 20 } }
		$COUNTY$ = { change_development_level = -4 }
	}
	else_if = { 
		limit = { $COUNTY$ = { development_level > 15 } }
		$COUNTY$ = { change_development_level = -3 }
	}
	else_if = { 
		limit = { $COUNTY$ = { development_level > 10 } }
		$COUNTY$ = { change_development_level = -2 }
	}
	else = {
		$COUNTY$ = { change_development_level = -1 }
	}
}

lotr_invite_non_evil_claimants_effect = {
	save_scope_as = the_temporary_ruler
	every_held_title = {
		title_tier = county
		save_scope_as = the_county
		ordered_claimant = {
			limit = {
				faith_is_evil = no
				trigger_if = {
					limit = { 
						is_ruler = yes
						top_liege != scope:the_temporary_ruler 
						NOT = { is_in_list = participants_of_split }
					}
					is_landless_adventurer = yes
				}
			}
			order_by = {
				value = this.age
				save_temporary_scope_as = the_claimant
				if = {
					limit = { is_landless_ruler = yes }
					multiply = 2
				}
				# Prioritize people with closer ties to last rulers
				if = {
					limit = {
						scope:the_county = { any_past_holder = { this = scope:the_claimant } }
					}
					multiply = 2
				}
				if = {
					limit = { 
						scope:the_county = { any_past_holder = { is_parent_of = scope:the_claimant } }
					}
					multiply = 2
				}
				if = {
					limit = { 
						scope:the_county = { any_past_holder = { is_grandparent_of = scope:the_claimant } }
					}
					multiply = 2
				}
				if = {
					limit = { 
						scope:the_county = { any_past_holder = { is_great_grandparent_of = scope:the_claimant } }
					}
					multiply = 2
				}
				# Prioritize people being senior party in marriage 
				if = {
					limit = { 
						is_married = yes 
						trigger_if = {
							limit = { is_male = yes }
							matrilinear_marriage = yes
						}
						trigger_else = {
							patrilinear_marriage = yes
						}
					}
					divide = 2
				}
				# Inheritance
				if = {
					limit = { is_female = yes }
					if = {
						limit = { faith = { has_doctrine = doctrine_gender_male_dominated } }
						multiply = 0
					}
					else_if = {
						limit = { faith = { has_doctrine = doctrine_gender_male_orientated } }
						divide = 2
					}
				}
				else = {
					if = {
						limit = { faith = { has_doctrine = doctrine_gender_female_dominated }  }
						multiply = 0
					}
					else_if = {
						limit = { faith = { has_doctrine = doctrine_gender_female_orientated } }
						divide = 2
					}
				}
			}
			save_scope_as = the_new_ruler
			
			if = { # Don't force players to accept the titles, give them an event where they can choose
				limit = { is_ai = no }
				scope:the_new_ruler = {
					add_to_variable_list = {
						name = vanquish_darkness_titles_to_offer
						target = scope:the_county
					}
				}
			}
			else = {
				# Make vassal if ranks work
				every_held_title = { # Get rid of Laamp
					limit = { is_landless_type_title = yes }
					scope:the_new_ruler = { destroy_title = PREV }
				}
				get_title = scope:the_county
				if = {
					limit = {
						scope:the_temporary_ruler.primary_title.tier >= tier_duchy
					}
					create_title_and_vassal_change = {
						type = swear_fealty
						save_scope_as = change
					}
					change_liege = {
						liege = scope:the_temporary_ruler
						change = scope:change
					}
					resolve_title_and_vassal_change = scope:change
				}
				add_to_temporary_list = participants_of_split
			}
		}
	}
	# Mop up the bordergore, copied from exclave independence game rule
	trigger_event = game_rule.2
	
	# Fire an event for every player that is being offered titles 
	every_player = {
		limit = { has_variable_list = vanquish_darkness_titles_to_offer }
		trigger_event = elven_racial.0202
	}
}

lotr_make_berserker_effect = {
	if = { #LotR
		limit = {
			culture = culture:isengard_urukhai
		}
		add_trait = urukhai_berserker
	}
	else = {
		add_trait = berserker
	}
}

################################
### Valinor Invasion Effects ###
################################

swear_holder_fealty_to_eonwe = {
	create_title_and_vassal_change = {
		type = swear_fealty
		save_scope_as = change
		add_claim_on_loss = yes
	}
	holder = {
		change_liege = {
			liege = scope:attacker
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

transfer_conquerred_titles_to_eonwe = {
	create_title_and_vassal_change = {
		type = conquest
		save_scope_as = change
		add_claim_on_loss = yes
	}
	change_title_holder = {
		holder = scope:attacker
		change = scope:change
	}
	resolve_title_and_vassal_change = scope:change
}

valinorean_invasion_settle_local_people_effect = {

	every_in_de_jure_hierarchy = {
		limit = {
			tier < tier_empire
			exists = holder
			NOR = { 
				holder = scope:defender
				holder = title:k_wastelands.holder
				holder = title:h_eonwe_host.holder
			}
			holder.liege = scope:defender
			holder = { faith_is_evil = no }
		}
		swear_holder_fealty_to_eonwe = yes
	}
	
	every_in_de_jure_hierarchy = {
		limit = {
			tier < tier_empire
			exists = holder
			NOR = { 
				holder = scope:defender
				holder = title:k_wastelands.holder
				holder = title:h_eonwe_host.holder 
			}
			holder.liege = scope:defender
			holder = { faith_is_evil = yes }
			NOR = { 
				holder.liege = title:h_eonwe_host.holder
				holder.top_liege = title:h_eonwe_host.holder
			}
		}
		transfer_conquerred_titles_to_eonwe = yes
	}
}

###
# GEOGRAPHICAL_REGION 	--> Area in which the invading party appears
# $KEY_1$ = yes 	--> 
#							KEY_1 => The effect which grabs the specific landing county. 
#									 Needs to save the county to a scope called landing_county
#
# $KEY_2$ = yes		-->
#							KEY_2 => The effect which grabs the character that needs to be revived
#
# $KEY_3$ = yes		-->
#							KEY_3 => Additional scripted effect which can be used
#
# $KEY_4$ = yes		-->
#							KEY_4 => Additional scripted effect which can be used
#
#
# NOTES: 	If there are no scripted effects the coder wants to add, simply do KEY_4 = "#" (WITH the quotation marks)
#			This will effectively comment out that line.
###

sunset_invasion_general_effect = {
	if = { #Eonwe
		limit = { geographical_region:$GEOGRAPHICAL_REGION$ = geographical_region:special_eriador_valinor_invasion_region }
		character:lineofeonwe = { save_scope_as = invader_char }
	}
	# else_if = { #Pharazon
	# 	limit = { $GEOGRAPHICAL_REGION$ = geographical_region:special_bay_of_belfalas_valinor_invasion_region }
	# 	character:lineofeonwe = { save_scope_as = invader_char }
	# }

	### Determine Alignment ###
	if = {
		limit = { exists = scope:invader_char scope:invader_char = { faith_is_evil = yes } }
		set_global_variable = {
			name = alignment_flag
			value = flag:evil
		}
	}
	else_if = {
		limit = { exists = scope:invader_char scope:invader_char = { faith_is_good = yes } }
		set_global_variable = {
			name = alignment_flag
			value = flag:good
		}
	}
	else = {
		set_global_variable = {
			name = alignment_flag
			value = flag:neutral
		}
	}

	### Grab county at which conqueror will land at. 
	### Needs to save the county to a scope called landing_county
	$KEY_1$ = yes
	
	if = { #Resurrect effect
		limit = { exists = scope:invader_char scope:invader_char = { is_alive = no } }
		$KEY_2$ = yes
	}
	scope:invader_char = {
		$KEY_3$ = yes
		$KEY_4$ = yes
	}
}

####################################
### Valinor Invasion Sub-effects ###
####################################

valinor_invasion_grab_landing_county = {
	title:e_lindon = { # Lindon
		ordered_in_de_jure_hierarchy = { # Check the main harbours first
			limit = {
				tier = tier_county
				is_coastal_county = yes
				this = holder.capital_county
			}
			order_by = {
				value = 1
				if = {
					limit = { 
						OR = {
							title_province = { has_building_or_higher = wonder_mithlond_north_01 }
							title_province = { has_building_or_higher = wonder_mithlond_south_01 }
						}
					}
					add = 200
				}
				if = {
					limit = { 
						OR = {
							title_province = { has_building_or_higher = wonder_harlond_01 }
							title_province = { has_building_or_higher = wonder_forlond_01 }
							title_province = { has_building_or_higher = wonder_forlond_02 }
						}
					}
					add = 100
				}
			}
			save_scope_as = landing_county
		}
	}
}

valinor_invasion_landing_effect = {
	create_title_and_vassal_change = {
		type = independency
		save_scope_as = change
	}
	scope:landing_county = {
		every_county_province = {
			limit = { 
				NOT = { has_holding_type = castle_holding }
			}
			set_holding_type = castle_holding
		}
		change_title_holder = {
			holder = scope:invader_char
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change

	scope:invader_char = {
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = independent_change
		}
		becomes_independent = {
			change = scope:independent_change
		}
		resolve_title_and_vassal_change = scope:independent_change
	}

	scope:invader_char = {
		get_title = title:h_eonwe_host
	}
	
	scope:invader_char = {
		add_piety_level = 5
		add_prestige_level = 5
		if = {
			limit = { is_landed = yes }
			add_legitimacy = 3000
		}
		add_prestige = 5000
		add_piety = 5000
		add_gold = 1500
		set_variable = invasion_cb_unlock
	}

	scope:landing_county = {
		set_county_faith = faith:faith_eldar
		set_county_culture = culture:noldor
		
		every_county_province = {
			if = {
				limit = {
					free_building_slots > 0
					NOT = { has_building = castle_04 }
				}
				add_building = castle_04
			}

			add_province_modifier = {
				modifier = landing_of_valinor_host_modifier
				years = 10
			}
		}
		every_county_province = {
			if = {
				limit = {
					free_building_slots > 0
					NOT = { has_building = curtain_walls_08 }
				}
				add_building = curtain_walls_08
			}
		}
		every_county_province = {
			if = {
				limit = {
					free_building_slots > 0
					NOT = { has_building = barracks_05 }
				}
				add_building = barracks_05
			}
		}
		every_county_province = {
			if = {
				limit = {
					free_building_slots > 0
					NOT = { has_building = pastures_05 }
				}
				add_building = pastures_05
			}
		}
		remove_county_modifier = marauding_orc_drags_modifier
		remove_county_modifier = hidden_elven_refugees_modifier
		change_county_control = 100
		change_development_level = -100 
		change_development_level = 25
	}

	valinor_invasion_host_effect = yes
}

###												 ###
# Assumes a `landing_county` scope. A county title #
###												 ###

valinor_invasion_host_effect = {
	# Evil of Middle Earth Scopes
	character:lineofsauron = { save_scope_as = sauron }
	# Valinorian Maia Invader Scopes
	character:lineofmakar = { save_scope_as = makar }
	character:lineofmeasse = { save_scope_as = measse }
	# Valinorian Elven Invader Commander Scopes
	character:lineofingwe4 = { save_scope_as = ingwion }
	character:lineoffinarfin1 = { save_scope_as = finrod_felagund }
	character:lineofolwe3 = { save_scope_as = elulindo }
	# Valinorian Elven Invader Knight Scopes
	character:lineofingwe3 = { save_scope_as = indiel }
	character:lineofmalantur8 = { save_scope_as = astaldo }
	character:lineofgaldortree = { save_scope_as = galdor_of_the_tree }
	character:lineofaranwe2 = { save_scope_as = voronwe_the_mariner }
	character:lineofnellas2 = { save_scope_as = bardir }
	character:lineofnellas3 = { save_scope_as = oronel }
	character:lineofhador10 = { save_scope_as = tuor }

	### Courtiers + Councillors ###
	valinor_invasion_set_courtier_councillor_effect = { # Measse
		TARGET = scope:makar
		TYPE = councillor_marshal
	}

	valinor_invasion_set_courtier_councillor_effect = { # Measse
		TARGET = scope:measse
		TYPE = councillor_court_chaplain
	}

	scope:ingwion = { # Ingwion
		if = {
			limit = { is_alive = yes }
			if = {
				limit = { is_landed = yes }

				### Title changes
				create_title_and_vassal_change = {
					type = usurped
					save_scope_as = change
				}
				every_held_title = {
					change_title_holder = {
						holder = character:lineofingwe7
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change
				}
				scope:ingwion = { 
					change_liege = { 
						liege = scope:invader_char 
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
				
				valinor_invasion_set_courtier_employer_effect = { # Ingwion
					CHARACTER = scope:ingwion
				}
			}
			else = {
				valinor_invasion_set_courtier_employer_effect = { # Ingwion
					CHARACTER = scope:ingwion
				}
			}
		}
	}
	

	valinor_invasion_set_courtier_councillor_effect = { # Finrod Felagund
		TARGET = scope:finrod_felagund
		TYPE = councillor_chancellor
	}

	valinor_invasion_set_courtier_councillor_effect = { # Elulindo
		TARGET = scope:elulindo
		TYPE = councillor_steward
	}

	valinor_invasion_set_courtier_employer_effect = { # Indiel
		CHARACTER = scope:indiel
	}

	valinor_invasion_set_courtier_councillor_effect = { # Astaldo
		TARGET = scope:ingwion
		TYPE = councillor_spymaster
	}
	
	valinor_invasion_set_courtier_employer_effect = { # 
		CHARACTER = scope:astaldo
	}

	valinor_invasion_set_courtier_employer_effect = { # Galdor of the Tree
		CHARACTER = scope:galdor_of_the_tree
	}

	valinor_invasion_set_courtier_employer_effect = { # Voronwe the Mariner
		CHARACTER = scope:voronwe_the_mariner
	}

	valinor_invasion_set_courtier_employer_effect = { # Bardir
		CHARACTER = scope:bardir
	}

	valinor_invasion_set_courtier_employer_effect = { # Oronel
		CHARACTER = scope:oronel
	}

	valinor_invasion_set_courtier_employer_effect = { # Tuor
		CHARACTER = scope:tuor
	}

	scope:invader_char = {
		every_courtier_or_guest = { trigger_event = race.0001 }
	}

	### Army ###
	spawn_army = {
		levies = 0
		men_at_arms = {
			type = high_elven_pikemen
			stacks = host_of_valinor_special_troop_amount
		}
		men_at_arms = {
			type = high_elven_archers
			stacks = host_of_valinor_special_troop_amount
		}
		men_at_arms = {
			type = high_elven_heavy_cavalry
			stacks = host_of_valinor_special_troop_amount
		}
		men_at_arms = {
			type = high_elven_skirmishers
			stacks = host_of_valinor_special_troop_amount
		}
		men_at_arms = {
			type = high_elven_light_cavalry
			stacks = host_of_valinor_special_troop_amount
		}
		men_at_arms = {
			type = high_elven_heavy_infantry
			stacks = host_of_valinor_special_troop_amount
		}
		men_at_arms = {
			type = song_smiths
			stacks = host_of_valinor_special_troop_amount
		}
		location = scope:landing_county.title_province
		origin = scope:landing_county.title_province
		inheritable = yes
		uses_supply = no
		name = valinorian_invasion_army_name
	}

	# Global News Event
	if = {
		limit = { # Major News
			NOT = { has_game_rule = no_news }
		}
		every_player = { #Global News Announcement
			trigger_event = news_event.0034
		}
	}

	# Effect on elven hope
	add_elven_hope_global_effect = { VALUE = monumental_elven_hope_gain HOPE_EFFECT = effect_elven_hope_good_realm_rises }

	scope:finrod_felagund ?= { remove_variable = override_valinor_trigger }
	scope:ingwion ?= { remove_variable = override_valinor_trigger }
	scope:finrod_felagund ?= { remove_variable = override_valinor_trigger }
	scope:elulindo ?= { remove_variable = override_valinor_trigger }

	scope:invader_char = {
		trigger_event = { # Need to do it with slight delay, otherwise event doesn't fire
			id = lotr_war_events.0005
			days = 1
		}
	}
	
	scope:invader_char = {
		set_variable = invisible_conqueror_story
		create_story = story_conqueror
	}
}

valinor_invasion_set_courtier_employer_effect = {
	$CHARACTER$ = { # Bardir
        if = {
            limit = { is_alive = yes } 
            set_variable = override_valinor_trigger
			if = {
				limit = { has_trait = sailed_west }
				remove_trait = sailed_west
			}
			if = {
				limit = { NOT = { scope:invader_char = { is_employer_of = $CHARACTER$ } } }
				set_employer = scope:invader_char
			}
			
			set_location = scope:invader_char.location
        }
	}
	
}

valinor_invasion_set_courtier_councillor_effect = {
	valinor_invasion_set_courtier_employer_effect = { CHARACTER = $TARGET$ } 

	scope:invader_char = {
		assign_councillor_type = {
			type = $TYPE$
			remove_existing_councillor = yes
			target = $TARGET$
		}
	}
}

valinor_invasion_start_invasion_war = {
	scope:invader_char = {
		if = {
			limit = { NOT = { is_at_war_with = character:lineofsauron } }
		}
		start_war = {
			cb = lotr_valinor_invasion_cb
			target = character:lineofsauron
			# Lindon
			target_title = title:e_lindon
			# target_title = title:d_mithlond
			# target_title = title:d_emyn_beraid
			# target_title = title:d_duneriador
			# target_title = title:d_ardolyalinya
			# target_title = title:d_elvaedhorien
			# target_title = title:d_dor_leithan
			# target_title = title:d_dor_tinuviel
			# target_title = title:d_geleidhien
			# target_title = title:d_estolad
			# target_title = title:d_dor_gweydor
			# target_title = title:d_thargelion
			# target_title = title:d_andunaloni

			# Arnor
			target_title = title:e_arnor
			# ## Arthedain
			# target_title = title:d_tarmea
			# target_title = title:d_eketya
			# target_title = title:d_nan_turath
			# target_title = title:d_emyn_sul
			# target_title = title:d_sarn_athrad
			# target_title = title:d_hyarromenya
			# target_title = title:d_siragale
			# target_title = title:d_norinanya
			# target_title = title:d_rammas_forn
			# target_title = title:d_shire
			# ## Cardolan
			# target_title = title:d_minhiriath
			# target_title = title:d_dol_caladir
			# target_title = title:d_ethir_gwathlo
			# target_title = title:d_eryn_vorn
			# target_title = title:d_girithlin
			# target_title = title:d_tyrn_gorthad
			# target_title = title:d_dyr_maenason
			# target_title = title:d_faerdor
			# ## Rhuduar
			# target_title = title:d_cameth_brin
			# target_title = title:d_hithaeglir_harad
			# target_title = title:d_dor_en_egladil
			# target_title = title:d_hithaeglir_forn
			# target_title = title:d_dol_tiriamon
			# target_title = title:d_dul_glandagol
			# target_title = title:d_dyr_eldanaryon

			# Blue Mountains
			## Belegost
			target_title = title:e_blue_mountains
			# target_title = title:d_belegost
			# target_title = title:d_tagakhgershad
			# target_title = title:d_fahamgathol
			# target_title = title:d_kallkizdin
			# target_title = title:d_hadhodor
			# ## Nogrod
			# target_title = title:d_nogrod
			# target_title = title:d_hadnul_dum
			# target_title = title:d_mount_dolmed
			# target_title = title:d_khaglakhjuruk
			# ## Buzra-dum
			# target_title = title:d_ursel_zabad
			# target_title = title:d_amakharasi
			# target_title = title:d_dronun_dum

			# Enedhwaith
			target_title = title:e_enedhwaith
			# target_title = title:d_nen_gwathlo
			# target_title = title:d_angrast
			# target_title = title:d_iarnburn
			# target_title = title:d_runnach
			# target_title = title:d_swanfell
			# target_title = title:d_dunlandfells
			# target_title = title:d_dunfearan
			# target_title = title:d_dathabha
			# target_title = title:d_westmarches
			# target_title = title:d_parth_iaur
			# target_title = title:d_druwaith_iaur
			# target_title = title:d_drulad

			# Orrostar Noldoron
			target_title = title:e_orrostar
			# ## Eregion
			# target_title = title:d_rhawnen
			# target_title = title:d_lhadereg
			# target_title = title:d_dor_maenor
			# target_title = title:d_eregion
			# ## Imladris
			# target_title = title:d_imladris

			# Forodwaith
			target_title = title:e_forodwaith
			# ## Forochel
			# target_title = title:d_jaranikko
			# target_title = title:d_kotiniemi
			# target_title = title:d_jokiranta
			# target_title = title:d_korkein_ma
			# ## Angmar
			# target_title = title:d_kanelemas
			# target_title = title:d_sweicelis
			# target_title = title:d_nan_angmar
			# target_title = title:d_haryagsh
			# target_title = title:d_foryagsh
		}
	}
}
