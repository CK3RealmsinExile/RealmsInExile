

setup_orc_revolt_leader_effect = {
	save_scope_as = faction
	# Does a peasant capital county already exist?
	if = {
		limit = {
			NOT = { exists = scope:orc_county }
		}
		random_faction_county_member = { save_scope_as = orc_county }
	}
	# Does a peasant leader already exist?
	if = {
		limit = {
			NOT = { exists = scope:orc_revolt_leader }
		}
		create_character = {
			location = scope:orc_county.title_province
			template = peasant_faction_leader_template
			faith = faith:way_of_strength
			culture = culture:kazgumhoth
			gender_female_chance = {
				if = {
					limit = { faith:way_of_strength = { has_doctrine = doctrine_gender_male_dominated } }
					add = 0
				}
				else_if = {
					limit = { faith:way_of_strength = { has_doctrine = doctrine_gender_female_dominated } }
					add = 100
				}
				else = {
					add = 50
				}
			}
			save_scope_as = orc_revolt_leader
		}
	}
	scope:orc_revolt_leader = {
		add_character_flag = orc_revolt_faction_random_orc
	}


	create_dynamic_title = {
		tier = duchy
		name = FACTION_ORC_REVOLT_TITLE_NAME
	}
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}

	scope:new_title = {
		set_capital_county = scope:orc_county
		set_landless_title = yes
		set_destroy_on_succession = yes
		set_delete_on_destroy = yes
		set_no_automatic_claims = yes
		set_definitive_form = yes
		set_can_be_named_after_dynasty = no
		change_title_holder = {
			holder = scope:orc_revolt_leader
			change = scope:change
		}

		set_variable = {
			name = faction
			value = scope:faction
		}

		# avoid unused variable error. This variable is referenced in code
		var:faction = {}
	}
	resolve_title_and_vassal_change = scope:change
	scope:orc_revolt_leader = {
		set_variable = {
			name = orc_title
			value = scope:new_title
		}
	}
	scope:new_title = { generate_coa = factions }

	scope:orc_revolt_leader = {
		set_variable = {
			name = rebel_leader_peasants
			value = scope:faction
		}
		join_faction_skip_check = scope:faction
	}

	set_special_character = scope:orc_revolt_leader
}

### Orc Revolt Faction ###
orc_revolt_faction_demands_enforced = {
	$FACTION$ = {
		every_faction_county_member = {
			custom = orc_revolt_faction_every_county
			remove_county_modifier = marauding_orc_drags_modifier
			scope:orc_revolt_leader = {
				get_title = prev
			}
		}
		hidden_effect = {
			clean_revolt_county_modifiers_from_faction_members_effect = yes
			destroy_faction = yes
		}

		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
			add_claim_on_loss = no
		}

		every_faction_member = {
			becomes_independent = {
				CHANGE = scope:change
			}

			hidden_effect = {
				add_truce_both_ways = {
					character = root
					days = 1825
					name = TRUCE_GRANT_INDEPENDENCE
				}	
			}
		}
	}
}

### Maglor Haruzan Faction Leader Effects ###


setup_nadi_manye_leader_effect = {
	save_scope_as = faction
	# Does a peasant capital county already exist?
	if = {
		limit = { NOT = { exists = scope:peasant_county } }
		random_faction_county_member = { save_scope_as = peasant_county }
	}
	if = {
		limit = { NOT = { exists = scope:peasant_leader } } 
		create_character = {
			template = maglor_nadi_manye_leader
			location = root.capital_province
			save_scope_as = peasant_leader
		}
	}
	scope:peasant_leader = { add_character_flag = peasant_faction_random_peasant }

	create_dynamic_title = {
		tier = duchy
		name = maglor_event_chain.0038.dynamic_title
	}
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}

	scope:new_title = {
		set_capital_county = scope:peasant_county
		set_landless_title = yes
		set_destroy_on_succession = yes
		set_delete_on_destroy = yes
		set_no_automatic_claims = yes
		set_definitive_form = yes
		set_can_be_named_after_dynasty = no
		change_title_holder = {
			holder = scope:peasant_leader
			change = scope:change
		}

		set_variable = {
			name = faction
			value = scope:faction
		}

		# avoid unused variable error. This variable is referenced in code
		var:faction = {}
	}
	resolve_title_and_vassal_change = scope:change
	scope:peasant_leader = {
		set_variable = {
			name = peasant_title
			value = scope:new_title
		}
	}
	scope:new_title = { generate_coa = factions }

	scope:nadi_manye_leader = {
		set_variable = {
			name = rebel_leader_peasants
			value = scope:faction
		}
		join_faction_skip_check = scope:faction
	}

	set_special_character = scope:peasant_leader
	set_special_title = scope:peasant_county
}
