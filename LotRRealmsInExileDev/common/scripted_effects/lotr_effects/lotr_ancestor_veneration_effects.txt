###################################
###################################
##### Ancestor Veneration EFFECTS #####
###################################
###################################

#############
### Prestige ###
#############

# Grant prestige upon completion with extra funding
ancestor_veneration_grant_prestige_effect = {
	if = {
		limit = {
			scope:activity = {
				has_activity_option = {
					category = explore_history_funding
					option = explore_history_extra_funding
				}
			}
		}
		add_prestige = medium_prestige_gain
	}
	else_if = {
		limit = {
			scope:activity = {
				has_activity_option = {
					category = explore_history_funding
					option = explore_history_basic_funding
				}
			}
		}
		add_prestige = miniscule_prestige_gain
	}
	if = {
		limit = {
			has_dlc_feature = legends
			any_attending_character = { has_court_position = chronicler_court_position }
		}
		add_prestige = miniscule_prestige_gain
	}
	else_if = {
		limit = {
			NOT = { has_dlc_feature = legends }
			any_attending_character = { has_court_position = antiquarian_court_position }
		}
		add_prestige = miniscule_prestige_gain
	}
}

############################
### Archivist experience ###
############################

disburse_ancestor_activity_rewards = {
	# for the loc
	save_scope_as = root_scope
	if = { # To show correct tooltips for guests
		limit = { has_trait = lifestyle_archivist }
	}
	# zealot Vassal Opinion
	every_vassal = {
		limit = {
			has_vassal_stance = zealot
			is_participant_in_activity = scope:activity
		}
		custom = every_participating_zealot_vassal
		add_opinion = {
			modifier = grateful_opinion
			target = scope:root_scope
			opinion = 35
		}
	}
	scope:activity = { every_attending_character = { disburse_ancestor_veneration_archivist_rewards = yes } }

	# Remove strife if relevant.
	remove_strife_per_invited_powerful_vassal_effect = yes
}

disburse_ancestor_veneration_archivist_rewards = {
	if = {
		limit = {
			has_trait = lifestyle_archivist
			scope:activity = {
				has_activity_option = {
					category = explore_history_scholars
					option = explore_history_many_scholars
				}
			}
			scope:activity = {
				has_activity_option = {
					category = explore_history_funding
					option = explore_history_extra_funding
				}
			}
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = explore_history_type_standard
					}
				}
			}
			add_trait_xp = {
				trait = lifestyle_archivist
				track = historian
				value = 25
			}
		}
	}
	else_if = {
		limit = {
			has_trait = lifestyle_archivist
			scope:activity = {
				has_activity_option = {
					category = explore_history_scholars
					option = explore_history_few_scholars
				}
			}
			scope:activity = {
				has_activity_option = {
					category = explore_history_funding
					option = explore_history_extra_funding
				}
			}
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = explore_history_type_standard
					}
				}
			}
			add_trait_xp = {
				trait = lifestyle_archivist
				track = historian
				value = 20
			}
		}
	}
	else_if = {
		limit = {
			has_trait = lifestyle_archivist
			scope:activity = {
				has_activity_option = {
					category = explore_history_scholars
					option = explore_history_many_scholars
				}
			}
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = explore_history_type_standard
					}
				}
			}
			add_trait_xp = {
				trait = lifestyle_archivist
				track = historian
				value = 15
			}
		}
	}
	else_if = {
		limit = {
			has_trait = lifestyle_archivist
			scope:activity = {
				has_activity_option = {
					category = explore_history_scholars
					option = explore_history_few_scholars
				}
			}
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = explore_history_type_standard
					}
				}
			}
			add_trait_xp = {
				trait = lifestyle_archivist
				track = historian
				value = 10
			}
		}
	}
	else_if = {
		limit = {
			has_trait = lifestyle_archivist
			scope:activity = {
				has_activity_option = {
					category = explore_history_funding
					option = explore_history_extra_funding
				}
			}
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = explore_history_type_standard
					}
				}
			}
			add_trait_xp = {
				trait = lifestyle_archivist
				track = historian
				value = 10
			}
		}
	}
	else_if = {
		limit = { has_trait = lifestyle_archivist }
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = explore_history_type_standard
					}
				}
			}
			add_trait_xp = {
				trait = lifestyle_archivist
				track = historian
				value = 5
			}
		}
	}
	else = { #progress towards archivist
		add_trait = lifestyle_archivist
	}
}