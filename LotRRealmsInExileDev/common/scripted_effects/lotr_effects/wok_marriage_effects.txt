populate_wok_marriage_candidates = {
	every_relation = {
		type = lover
		type = friend
		type = soulmate
		type = crush
		limit = { # Don't marry other faiths' landed HoFs
			NAND = {
				is_landless_ruler = yes
				faith.religious_head = this
				NOT = { scope:secondary_actor.faith = faith }
			}
		}
		add_to_list = characters
	}
}

# Courtship Revamp System

start_wokc_scheme = {
	scope:secondary_actor = {
		start_scheme = {
			type = $SCHEME$
			target_character = scope:secondary_recipient
		}
		random_scheme = {
			limit = {
				scheme_type = $SCHEME$
				scheme_target_character = scope:secondary_recipient
			}
			set_variable = {
				name = matchmaker
				value = scope:actor
			}
			if = {
				limit = {
					exists = scope:secondary_actor
					NOT = {
						scope:actor = scope:secondary_actor
					}
				}
				scope:actor = {
					add_to_variable_list = {
						name = arranged_courtships
						target = prev
					}
				}
			}
		}
	}
}

setup_matchmaker_notification_target = { # Needed because the scheme may end before the matchmaker is notified.
	if = {
		limit = {
			exists = scope:scheme.var:matchmaker
			scope:scheme.var:matchmaker = { 
				is_alive = yes 
				is_ai = no
			}
		}
		scope:scheme.var:matchmaker = {
			save_scope_as = matchmaker
		}
	}
}

notify_matchmaker_of_courting_outcome = { # SUCCESS = bool/flag notify_matchmaker_of_courting_outcome = {SUCCESS = yes}
	hidden_effect = {
		if = {
			limit = {
				exists = scope:matchmaker
				scope:matchmaker = {
					is_alive = yes
					is_ai = no
				}
			}
			save_temporary_scope_value_as = {
				name = match_made
				value = $SUCCESS$
			}
			scope:matchmaker = {
				remove_list_variable = {
					name = arranged_courtships
					target = scope:scheme
				}
				if = {
					limit = {
						exists = scope:scheme_successful
						scope:match_made = yes
					}
					send_interface_message = {
						type = msg_arranged_courtship_good
						title = arrange_courtship_outcome
						desc = msg_effect
						left_icon = scope:scheme.scheme_owner
						right_icon = scope:scheme.scheme_target_character
						custom_tooltip = arrange_courtship_success
					}
				}
				else_if = {
					limit = { 
						NOT = {
							scope:match_made = no
						}
					}
					send_interface_message = {
						type = msg_arranged_courtship_inconclusive
						title = arrange_courtship_outcome
						desc = msg_effect
						left_icon = scope:scheme.scheme_owner
						right_icon = scope:scheme.scheme_target_character
						custom_tooltip = arrange_courtship_inconclusive
					}
				}
				else = {
					send_interface_message = {
						type = msg_arranged_courtship_bad
						title = arrange_courtship_outcome
						desc = msg_effect
						left_icon = scope:scheme.scheme_owner
						right_icon = scope:scheme.scheme_target_character
						custom_tooltip = arrange_courtship_failure
					}
				}
			}
		}
	}
}