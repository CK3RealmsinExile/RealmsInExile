####################################
#
#   ### Search these Titles ###
#
#   Fellowship - Fellowship Related Effects
#   Secrecy - Secrecy Related Effects
#   Corruption - Corruption Related Effects
#
##################################

##################
### Fellowship ###
##################

set_fellowship_member = {
    add_to_global_variable_list = {
        name = lotr_fellowship_members
        target = $CHARACTER$
    }
}

remove_fellowship_member = {
    remove_list_global_variable = {
        name = lotr_fellowship_members
        target = $CHARACTER$
    }
}

set_member_as_ringbearer = {
    
}

debug_form_canon_fellowship = {
    every_in_global_list = {
        variable = lotr_fellowship_members
        save_temporary_scope_as = char_temp
        remove_list_global_variable = {
            name = lotr_fellowship_members
            target = scope:char_temp
        }
    }

    character:lineisildur42 = { add_to_list = sorting_list }
    character:lineoforopher6 = { add_to_list = sorting_list }
    character:lineofdurin100 = { add_to_list = sorting_list }
    character:linesteward39 = { add_to_list = sorting_list }
    character:lineofgandalf = { add_to_list = sorting_list }
    character:lineofbaggins29 = { add_to_list = sorting_list }
    character:lineofbrandybuck31 = { add_to_list = sorting_list }
    character:lineoftook30 = { add_to_list = sorting_list }
    character:lineofgamgee10 = { add_to_list = sorting_list }

    ordered_in_list = { #Ring bearer gets added to the Global List *first*
        list = sorting_list
        order_by = {
            if = {
                limit = { any_character_artifact = { has_variable = one_ring } }
                add = 100000
            } else = {
                add = 10
            }
        }
        max = 9
        save_scope_as = char_temp
        set_fellowship_member = { CHARACTER = scope:char_temp }
        remove_from_list = sorting_list
    }
    intialise_fellowship_corruption = yes
}

intialise_fellowship_corruption = {
    every_in_global_list = {
        variable = lotr_fellowship_members
        set_variable = {
            name = lotr_corruption
            value = 0
        }
    }
}

form_fellowship_camp = {
    
}

###############
### Secrecy ###
###############

increase_fellowship_secrecy = {

}

decrease_fellowship_secrecy = {
    
}

##################
### Corruption ###
##################

increase_fellowship_member_corruption = {
    increase_variable = {
        NAME = lotr_corruption
        AMOUNT = $VALUE$
    }
}

decrease_fellowship_member_corruption = {
    decrease_variable = {
        NAME = lotr_corruption
        AMOUNT = $VALUE$
    }
}


##################
##### Events #####
##################

depart_to_imladris_effect = {
    if = {
        limit = {
            has_ep3_dlc_trigger = yes	 
        }
        save_scope_as = adventurer
		custom_tooltip = become_landless_adventurer_decision_title_created_tt
		if = {
			limit = { has_title = title:e_gondor_steward } # If Denethor himself goes
			root.player_heir = { 
				save_scope_as = laamp_inheritor
				add_character_flag = new_laamp_inheritor
			}
		}
		else = {
			title:e_gondor_steward.holder = { # If Boromir or Faramir goes 
				save_scope_as = laamp_inheritor
				add_character_flag = new_laamp_inheritor
			}
		}
		# Transfer landed titles
		every_held_title = {
			limit = {
				is_landless_type_title = no
				tier > tier_barony
			}
			add_to_list = target_titles
		}
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
			add_claim_on_loss = no
		}
		hidden_effect = {
			every_in_list = {
				list = target_titles
				change_title_holder_include_vassals = {
					holder = scope:laamp_inheritor
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
		}
        create_landless_adventurer_title_effect = {
            REASON = flag:voluntary
            FLAVOR_CHAR = title:e_gondor_steward.holder
        }
        root.primary_title = {
            set_coa = holder.house
        }
        root.primary_title = {
            set_coa = holder.house
            if = {
                limit = {
                    holder = character:linesteward38
                }
                set_title_name = denethor_laamp_name
            }
            if = {
                limit = {
                    holder = character:linesteward39
                }
                set_title_name = boromir_laamp_name
            }
            else_if = {
                limit = {
                    holder = character:linesteward40
                }
                set_title_name = faramir_laamp_name
            }
            else = {
                set_title_name = quest_for_imladris
            }
        }
		adventurer_prestige_reset_effect = yes
    }
	domicile ?= { 
		change_provisions = minor_provisions_gain 			
		move_domicile = title:c_minas_tirith.title_province
	}
    start_travel_plan = { #Travel to Rivendell via Edoras and Tharbad
        destination = title:c_kingstead.title_province
        destination = title:c_tharbad.title_province
        destination = title:c_imladris.title_province
        on_arrival_on_action = boromir_rivendell_on_action
        return_trip = no
        travel_with_domicile = no
        players_use_planner = no
        on_arrival_destinations = all
    }
}