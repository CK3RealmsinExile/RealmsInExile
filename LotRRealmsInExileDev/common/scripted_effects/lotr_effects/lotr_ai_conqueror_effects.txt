lotr_conqueror_settle_wastelands_effect = {
	root.story_owner = { save_scope_as = root_scope }
	every_held_county = {
		limit = { title_province = { has_holding_type = settlement_holding } }
		if = {
			limit = { title_province = { has_building = settlement_01 } }
			title_province = { add_building = settlement_02 }
		} 
		else_if = {
			limit = { title_province = { has_building = settlement_02 } }
			title_province = { add_building = settlement_03 }
		} 
		else_if = {
			limit = { title_province = { has_building = settlement_03 } }
			if = {
				limit = { scope:root_scope = { is_elf = yes } }
				title_province = { set_holding_type = elven_holding }
			} else_if = {
				limit = { title_province = { terrain = halls } }
				title_province = { set_holding_type = dwarven_holding }
			} else_if = {
				limit = { scope:root_scope = { is_hobbit = yes } }
				title_province = { set_holding_type = city_holding }
			} else = {
				if = {
					limit = { scope:root_scope = { has_government = tribal_government } }
					title_province = { set_holding_type = tribal_holding }
				} else = {
					title_province = { set_holding_type = castle_holding }
				}
			}
		}
	}
	
	if = { #default game rule
		limit = {
			has_game_rule = default_colonisation_speed
			scope:root_scope = {
				OR = {
					dynasty = dynasty:dynasty_elendil # Can only start colonising after Aragorn returns
					dynasty = dynasty:dynasty_oropher # Can only start colonising after Aragorn returns
					culture = culture:woodmen # Can only start colonising after Aragorn returns
					culture = culture:valemen # Can only start colonising after Aragorn returns
					culture = { any_parent_culture_or_above = { this = culture:valemen } } # Can only start colonising after Aragorn returns
					culture = { any_parent_culture_or_above = { this = culture:woodmen } } # Can only start colonising after Aragorn returns
					is_nazgul = yes # Can colonise from the start
					is_dwarf = yes # Can colonise from the start
					is_orc = yes # Can colonise from the start
				}
				OR = {
					is_nazgul = yes # Can colonise from the start
					is_dwarf = yes # Can colonise from the start
					is_orc = yes # Can colonise from the start
					is_target_in_global_variable_list = {
						name = unavailable_unique_decisions
						target = flag:aragorn_returned_to_gondor
					}
				}
			}
		}
		### HUMAN ###
		if = { ## COUNTIES AVAILABLE FOR HUMAN AI ##
			limit = {
				scope:root_scope = {
					is_human = yes
					NOR = {
						culture = culture:woodmen # Can only start colonising after Aragorn returns
						culture = culture:valemen # Can only start colonising after Aragorn returns
					}
				}
			}
			debug_log = "Wastelands.0006: Humans List Made"
			every_sub_realm_county = {
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = elven_homeland_county_modifier
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						OR = {
							title:e_arnor = { is_de_jure_liege_or_above_target = scope:target }
							title:e_enedhwaith = { is_de_jure_liege_or_above_target = scope:target }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
						title_province ?= { NOT = { terrain = halls } }
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### ELF ###
		else_if = { ## COUNTIES AVAILABLE FOR ELF AI ##
			limit = { scope:root_scope = { is_elf = yes } }
			debug_log = "Wastelands.0006: Elves List Made"
			every_sub_realm_county = {
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						has_county_modifier = elven_homeland_county_modifier
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						OR = {
							title:e_greenwood = { is_de_jure_liege_or_above_target = scope:target }
							title:e_laurelindorenan = { is_de_jure_liege_or_above_target = scope:target }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
						title_province ?= { NOT = { terrain = halls } }
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### DWARF ###
		else_if = { ## COUNTIES AVAILABLE FOR DWARF AI ##
			limit = { scope:root_scope = { is_dwarf = yes } }
			debug_log = "Wastelands.0006: Dwarves List Made"
			every_sub_realm_county = {
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
							has_county_modifier = elven_homeland_county_modifier
						}
						OR = {
							title_province ?= { terrain = desert_mountains }
							title_province ?= { terrain = caverns }
							title_province ?= { terrain = halls }
							AND = {
								title_province ?= { terrain = hills }
								any_neighboring_county = {
									OR = {
										title_province ?= { terrain = desert_mountains }
										title_province ?= { terrain = caverns }
										title_province ?= { terrain = halls }
										title_province ?= { terrain = mountains }
									}
								}
							}
							title_province ?= { terrain = mountains }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### NAZGUL ###
		else_if = {## COUNTIES AVAILABLE FOR NAZGUL AI ##
			limit = { scope:root_scope = { is_nazgul = yes } }
			debug_log = "Wastelands.0006: Nazgul List Made"
			every_sub_realm_county = {
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						OR = {
							title:e_greenwood = { is_de_jure_liege_or_above_target = scope:target }
							title:k_ehwathrumavuld = { is_de_jure_liege_or_above_target = scope:target }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### ORC ###
		else_if = {## COUNTIES AVAILABLE FOR ORC AI ##
			limit = { scope:root_scope = { is_orc = yes } }
			debug_log = "Wastelands.0006: Orc List Made"
			every_sub_realm_county = {
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						OR = {
							title_province ?= { terrain = desert_mountains }
							title_province ?= { terrain = caverns }
							title_province ?= { terrain = halls }
							title_province ?= { terrain = mountains }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### VALEMEN/WOODMEN ###
		else_if = { ## COUNTIES AVAILABLE FOR HUMAN AI ##
			limit = {
				scope:root_scope = {
					is_human = yes
					OR = {
						culture = culture:woodmen # Can only start colonising after Aragorn returns
						culture = culture:valemen # Can only start colonising after Aragorn returns
						culture = { any_parent_culture_or_above = { this = culture:valemen } } # Can only start colonising after Aragorn returns
						culture = { any_parent_culture_or_above = { this = culture:woodmen } } # Can only start colonising after Aragorn returns
					}
				}
			}
			debug_log = "Wastelands.0006: Valemen/Woodmen List Made"
			every_sub_realm_county = {
				limit = { NOT = { culture = culture:wastelands } }
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						OR = {
							title:e_greenwood = { is_de_jure_liege_or_above_target = scope:target }
							title:e_anduin_vale = { is_de_jure_liege_or_above_target = scope:target }
						}
						title_province ?= { NOT = { terrain = halls } }
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}
	} 
	else_if = {
		limit = { has_game_rule = weighted_colonisation_speed }
		### HUMAN ###
		if = { ## COUNTIES AVAILABLE FOR HUMAN AI ##
			limit = { scope:root_scope = { OR = { is_human = yes is_hobbit = yes } } }
			every_sub_realm_county = {
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							holder = scope:root_scope
							has_county_modifier = elven_homeland_county_modifier
							has_county_modifier = block_settlement_ability
						}
						title_province ?= { NOT = { terrain = halls } }
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### ELF ###
		else_if = { ## COUNTIES AVAILABLE FOR ELF AI ##
			limit = { scope:root_scope = { is_elf = yes } }
			### COUNTY COLONISATION PRIORITY ###
			every_sub_realm_county = {
				limit = { NOT = { culture = culture:wastelands } }
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						OR = {
							has_county_modifier = elven_homeland_county_modifier
							title_province ?= { terrain = deep_forest }
							title_province ?= { terrain = forest }
							title_province ?= { terrain = plains }
							title_province ?= { terrain = mallorn_forest }
							title_province ?= { terrain = hills }
							title_province ?= { terrain = farmlands }
							title_province ?= { terrain = wetlands }
							title_province ?= { terrain = floodplains }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### DWARF ###
		else_if = { ## COUNTIES AVAILABLE FOR DWARF AI ##
			limit = { scope:root_scope = { is_dwarf = yes } }
			every_sub_realm_county = {
				limit = { NOT = { culture = culture:wastelands } }
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
							has_county_modifier = elven_homeland_county_modifier
						}
						OR = {
							title_province ?= { terrain = plains }
							title_province ?= { terrain = steppe }
							title_province ?= { terrain = forest }
							title_province ?= { terrain = desert_mountains }
							title_province ?= { terrain = caverns }
							title_province ?= { terrain = halls }
							title_province ?= { terrain = hills }
							title_province ?= { terrain = mountains }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### NAZGUL ###
		else_if = { ## COUNTIES AVAILABLE FOR NAZGUL AI ##
			limit = { scope:root_scope = { is_nazgul = yes } }
			debug_log = "Wastelands.0006: Nazgul List Made"
			every_sub_realm_county = {
				limit = { NOT = { culture = culture:wastelands } }
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						title_province ?= { NOT = { terrain = halls } }
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### ORC ###
		else_if = {## COUNTIES AVAILABLE FOR ORC AI ##
			limit = { scope:root_scope = { is_orc = yes } }
			debug_log = "Wastelands.0006: Orc List Made"
			every_sub_realm_county = {
				limit = { NOT = { culture = culture:wastelands } }
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						OR = {
							title_province ?= { terrain = desert_mountains }
							title_province ?= { terrain = caverns }
							title_province ?= { terrain = halls }
							title_province ?= { terrain = hills }
							title_province ?= { terrain = mountains }
						}
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

		### VALEMEN/WOODMEN ###
		else_if = { ## COUNTIES AVAILABLE FOR HUMAN AI ##
			limit = {
				scope:root_scope = {
					is_human = yes
					OR = {
						culture = culture:woodmen # Can only start colonising after Aragorn returns
						culture = culture:valemen # Can only start colonising after Aragorn returns
						culture = { any_parent_culture_or_above = { this = culture:valemen } } # Can only start colonising after Aragorn returns
						culture = { any_parent_culture_or_above = { this = culture:woodmen } } # Can only start colonising after Aragorn returns
					}
				}
			}
			debug_log = "Wastelands.0006: Valemen/Woodmen List Made"
			every_sub_realm_county = {
				limit = { NOT = { culture = culture:wastelands } }
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						OR = {
							title:e_greenwood = { is_de_jure_liege_or_above_target = scope:target }
							title:e_anduin_vale = { is_de_jure_liege_or_above_target = scope:target }
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
						title_province ?= { NOT = { terrain = halls } }
					}
					add_to_list = adjacent_wastelands
				}
			}
		}

	} 
	else_if = {
		limit = { has_game_rule = normal_colonisation_speed }
		if = {
			limit = {
				scope:root_scope = {
					OR = {
						is_dwarf = yes
						is_orc = yes
						is_nazgul = yes
						is_istari = yes
						is_maiar = yes
					}
				}
			}
			every_sub_realm_county = {
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
					}
					add_to_list = adjacent_wastelands
				}
			}
		}
		else = {
			every_sub_realm_county = {
				limit = { NOT = { culture = culture:wastelands } }
				every_title_to_title_neighboring_and_across_water_county = {
					limit = {
						culture = culture:wastelands
						this = { save_temporary_scope_as = target }
						NOR = {
							has_county_modifier = block_settlement_ability
							holder = scope:root_scope
						}
						trigger_if = {
							limit = { title:c_throne_of_erebor.title_province = { has_building = smaug } }
							NOT = { scope:target.county.title_province = { has_building = smaug_desolation } }
						}
						title_province ?= { NOT = { terrain = halls } }
					}
					add_to_list = adjacent_wastelands
				}
			}
		}
	}

	ordered_in_list = {
		list = adjacent_wastelands
		order_by = {
			value = 0
			every_neighboring_county = {
				limit = { holder = scope:root_scope }
				add = 2
			}
			every_neighboring_county = {
				limit = {
					holder = scope:root_scope
					trigger_if = {
						limit = { exists = scope:curr_county }
						duchy = scope:curr_county.duchy
					}
					save_temporary_scope_as = curr_county
				}
				add = 16
			}
			every_neighboring_county = {
				limit = {
					holder = scope:root_scope
					trigger_if = {
						limit = { exists = scope:curr_county }
						kingdom = scope:curr_county.kingdom
					}
					save_temporary_scope_as = curr_county
				}
				add = 8
			}
			every_neighboring_county = {
				limit = {
					holder = scope:root_scope
					trigger_if = {
						limit = { exists = scope:curr_county }
						empire = scope:curr_county.empire
					}
					save_temporary_scope_as = curr_county
				}
				add = 4
			}
		}
		save_scope_as = wastelands
		if = {
			limit = { scope:root_scope = { above_settlement_limit = no } }
			scope:root_scope = {
				ai_colonisation_effect = { WASTELANDS = scope:wastelands ROOT_SCOPE = scope:root_scope }
				correct_wastelands_tracker = yes
			}
		}
	}
}

lotr_start_empire_invasion_war_effect = {
	ai_start_best_war = {
		cb = {
			sunset_invasion_cb
		}
		is_valid = {
		}
		on_failure = {
			# Either go for one decent war, or three 'small' wars immediately
			random_list = {
				50 = {
					ai_start_best_war = {
						cb = {
							invasion_war
							duchy_conquest_cb
							vassalization_cb
							individual_duchy_de_jure_cb
						}
						is_valid = {
							scope:target_character = {
								current_military_strength < root.current_military_strength
								OR = {
									gold < root.gold
									current_military_strength <= root.fifty_percent_of_current_military_strength
								}
							}
						}
						on_failure = {
							ai_start_best_war = {
								cb = {
									county_conquest_cb
									individual_county_de_jure_cb
									county_struggle_cb
									ducal_conquest_cb
								}
								is_valid = {
									scope:target_character = {
										current_military_strength <= root.a_third_of_current_military_strength
										gold < root.gold
									}
								}
								on_failure = {
									ai_start_best_war = {
										cb = {
											claim_cb
											county_conquest_cb
											individual_county_de_jure_cb
											county_struggle_cb
											ducal_conquest_cb
										}
										is_valid = {
											scope:target_character = {
												current_military_strength < root.forty_percent_of_current_military_strength
												gold < root.gold
											}
										}
										on_failure = {
											ai_start_best_war = {
												cb = {
													county_conquest_cb
													individual_county_de_jure_cb
													county_struggle_cb
													ducal_conquest_cb
												}
											}
										}
									}
									ai_start_best_war = {
										cb = {
											county_conquest_cb
											individual_county_de_jure_cb
											county_struggle_cb
											ducal_conquest_cb
										}
										is_valid = {
											scope:target_character = {
												current_military_strength < root.forty_percent_of_current_military_strength
												gold < root.gold
											}
										}
									}
								}
							}
							ai_start_best_war = {
								cb = {
									county_conquest_cb
									individual_county_de_jure_cb
									county_struggle_cb
									ducal_conquest_cb
								}
								is_valid = {
									scope:target_character = {
										current_military_strength <= root.a_third_of_current_military_strength
										gold < root.gold
									}
								}
							}
							ai_start_best_war = {
								cb = {
									county_conquest_cb
									individual_county_de_jure_cb
									county_struggle_cb
									ducal_conquest_cb
								}
								is_valid = {
									scope:target_character = {
										current_military_strength <= root.a_third_of_current_military_strength
										gold < root.gold
									}
								}
							}
						}
					}
				}
				50 = {
					ai_start_best_war = {
						cb = {
							duchy_conquest_cb
							vassalization_cb
							individual_duchy_de_jure_cb
							tribal_subjugation_cb
							de_jure_cb
						}
						is_valid = {
							scope:target_character = {
								current_military_strength <= root.a_third_of_current_military_strength
								gold < root.gold
							}
						}
						on_failure = {
							ai_start_best_war = {
								cb = {
									county_conquest_cb
									vassalization_cb
									individual_county_de_jure_cb
									county_struggle_cb
									ducal_conquest_cb
								}
								is_valid = {
									scope:target_character = {
										current_military_strength <= root.a_third_of_current_military_strength
										gold < root.gold
									}
								}
								on_failure = {
									ai_start_best_war = {
										cb = {
											county_conquest_cb
											individual_county_de_jure_cb
											county_struggle_cb
											ducal_conquest_cb
										}
										is_valid = {
											scope:target_character = {
												current_military_strength < root.forty_percent_of_current_military_strength
												gold < root.gold
											}
										}
										on_failure = {
											ai_start_best_war = {
												cb = {
													county_conquest_cb
													individual_county_de_jure_cb
													county_struggle_cb
													ducal_conquest_cb
												}
											}
										}
									}
									ai_start_best_war = {
										cb = {
											county_conquest_cb
											individual_county_de_jure_cb
											county_struggle_cb
											ducal_conquest_cb
										}
										is_valid = {
											scope:target_character = {
												current_military_strength < root.forty_percent_of_current_military_strength
												gold < root.gold
											}
										}
									}
								}
							}
							ai_start_best_war = {
								cb = {
									county_conquest_cb
									individual_county_de_jure_cb
									county_struggle_cb
									ducal_conquest_cb
								}
								is_valid = {
									scope:target_character = {
										current_military_strength <= root.a_third_of_current_military_strength
										gold < root.gold
									}
								}
							}
							ai_start_best_war = {
								cb = {
									county_conquest_cb
									individual_county_de_jure_cb
									county_struggle_cb
									ducal_conquest_cb
								}
								is_valid = {
									scope:target_character = {
										current_military_strength <= root.a_third_of_current_military_strength
										gold < root.gold
									}
								}
							}
						}
					}
					ai_start_best_war = {
						cb = {
							duchy_conquest_cb
							vassalization_cb
							individual_duchy_de_jure_cb
							de_jure_cb
						}
						is_valid = {
							scope:target_character = {
								current_military_strength <= root.a_third_of_current_military_strength
								gold < root.gold
							}
						}
					}
					ai_start_best_war = {
						cb = {
							duchy_conquest_cb
							vassalization_cb
							individual_duchy_de_jure_cb
							de_jure_cb
						}
						is_valid = {
							scope:target_character = {
								current_military_strength <= root.a_third_of_current_military_strength
								gold < root.gold
							}
						}
					}
				}
			}
		}
	}
}