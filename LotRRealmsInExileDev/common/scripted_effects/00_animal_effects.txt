#Effects used in animal events


#####################################################################
# EFFECT LIST
#####################################################################
# !!! Remember to add all new effects here !!!
#

# CAT
#start_cat_story_cycle_effect
#assign_name_options_cat_story_cycle_effect
#assign_cat_gender_effect
#assign_cat_fur_color_effect
#assign_cat_eye_color_effect
#remove_cat_story_modifiers_effect
#transfer_cat_story_cycle_to_effect

#DOG
#start_dog_story_cycle_effect
#assign_name_options_dog_story_cycle_effect
#assign_dog_gender_effect
#assign_dog_fur_color_effect
#assign_dog_eye_color_effect
#dog_got_pregnant_effect
#remove_dog_story_modifiers_effect
#transfer_dog_story_cycle_to_effect

#WARHORSE
#start_warhorse_story_cycle_effect
#assign_horse_gender_effect
#level_horse_modifier_effect
#remove_horse_story_modifiers_effect

#EAGLE
#start_eagle_story_cycle_effect
#assign_eagle_gender_effect
#assign_name_options_eagle_story_cycle_effect

######################################################################
# EFFECTS
######################################################################

########
# CAT
########

#Effect to start the story and show the right modifier
start_cat_story_cycle_effect = {
	show_as_tooltip = {
		add_character_modifier = {
			modifier = cat_story_modifier
		}
	}
	hidden_effect = {
		create_story = story_cycle_pet_cat
	}
}

#Pick out name options to show
assign_name_options_cat_story_cycle_effect = {
	random_list = {
		1 = { #A cat who prowled around Beaulieu Abbey in the 13th century
			trigger = { NOT = { has_character_flag = name_mite } }
			add_character_flag = name_mite
		}
		1 = {
			trigger = { NOT = { has_character_flag = name_paws } }
			add_character_flag = name_paws
		}
		1 = {
			trigger = { NOT = { has_character_flag = name_mittens } }
			add_character_flag = name_mittens
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_gray }
				scope:story.var:cat_fur_color = flag:gray
			}
			add_character_flag = name_gray
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_flame }
				scope:story.var:cat_fur_color = flag:orange
			}
			add_character_flag = name_flame
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_snow }
				scope:story.var:cat_fur_color = flag:white
			}
			add_character_flag = name_snow
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_shadow }
				scope:story.var:cat_fur_color = flag:black
			}
			add_character_flag = name_shadow
		}
		#10 = {
		#	trigger = {
		#		NOT = { has_character_flag = name_spooky }
		#		scope:story.var:cat_fur_color = flag:black
		#	}
		#	add_character_flag = name_spooky
		#}
		#10 = { #Short form of Gilbert - lots of domesticated cats had this name
		#	trigger = { 
		#		NOT = { has_character_flag = name_gyb }
		#		has_culture = culture:english
		#	}
		#	add_character_flag = name_gyb
		#}
		#10 = { #From old Irish legal texts
		#	trigger = { 
		#		NOT = { has_character_flag = name_meone }
		#		culture = { has_cultural_pillar = heritage_goidelic }
		#	}
		#	add_character_flag = name_meone
		#}
		#10 = { #From old Irish legal texts
		#	trigger = {
		#		NOT = { has_character_flag = name_cruibne }
		#		culture = { has_cultural_pillar = heritage_goidelic }
		#	}
		#	add_character_flag = name_cruibne
		#}
	}
}

#Assign the gender of the cat
assign_cat_gender_effect = {
	save_temporary_scope_value_as = {
		name = gender
		value = flag:$GENDER$
	}
	if = {
		limit = { scope:gender = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = cat_gender
						value = flag:female
					}
				}
				50 = {
					set_variable = {
						name = cat_gender
						value = flag:male
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:gender = flag:male
				scope:gender = flag:female
			}
		}
		set_variable = {
			name = cat_gender
			value = flag:$GENDER$
		}
	}
}

#Assign the fur-color of the cat
assign_cat_fur_color_effect = {
	save_temporary_scope_value_as = {
		name = fur_color
		value = flag:$COLOR$
	}
	if = {
		limit = { scope:fur_color = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = cat_fur_color
						value = flag:brown
					}
				}
				50 = {
					set_variable = {
						name = cat_fur_color
						value = flag:gray
					}
				}
				50 = {
					set_variable = {
						name = cat_fur_color
						value = flag:orange
					}
				}
				50 = {
					set_variable = {
						name = cat_fur_color
						value = flag:black
					}
				}
				50 = {
					set_variable = {
						name = cat_fur_color
						value = flag:white
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:fur_color = flag:brown
				scope:fur_color = flag:gray
				scope:fur_color = flag:orange
				scope:fur_color = flag:black
				scope:fur_color = flag:white
			}
		}
		set_variable = {
			name = cat_fur_color
			value = flag:$COLOR$
		}
	}
}

#Assign the eye-color of the cat
assign_cat_eye_color_effect = {
	save_temporary_scope_value_as = {
		name = eye_color
		value = flag:$COLOR$
	}
	if = {
		limit = { scope:eye_color = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = cat_eye_color
						value = flag:blue
					}
				}
				50 = {
					set_variable = {
						name = cat_eye_color
						value = flag:yellow
					}
				}
				50 = {
					set_variable = {
						name = cat_eye_color
						value = flag:green
					}
				}
				50 = {
					set_variable = {
						name = cat_eye_color
						value = flag:amber
					}
				}
				50 = {
					set_variable = {
						name = cat_eye_color
						value = flag:copper
					}
				}
				50 = {
					set_variable = {
						name = cat_eye_color
						value = flag:emerald
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:eye_color = flag:blue
				scope:eye_color = flag:yellow
				scope:eye_color = flag:green
				scope:eye_color = flag:amber
				scope:eye_color = flag:copper
				scope:eye_color = flag:emerald
			}
		}
		set_variable = {
			name = cat_eye_color
			value = flag:$COLOR$
		}
	}
}

#Remove everything related to the story
remove_cat_story_modifiers_effect = {
	if = {
		limit = {
			has_character_modifier = cat_story_modifier
		}
		remove_character_modifier = cat_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = cat_story_allergy_modifier
		}
		remove_character_modifier = cat_story_allergy_modifier
	}
	if = {
		limit = {
			any_spouse = {
				has_character_modifier = cat_story_allergy_modifier
			}
		}
		random_spouse = {
			limit = {
				has_character_modifier = cat_story_allergy_modifier
			}
			remove_character_modifier = cat_story_allergy_modifier
		}
	}
	if = {
		limit = {
			has_character_modifier = rat_hunting_cat_modifier
		}
		remove_character_modifier = rat_hunting_cat_modifier
	}
	if = {
		limit = {
			has_character_modifier = adventurous_pet_modifier
		}
		remove_character_modifier = adventurous_pet_modifier
	}
	if = {
		limit = {
			has_character_modifier = feral_pet_modifier
		}
		remove_character_modifier = feral_pet_modifier
	}
}

remove_cat_name_effect = {
	remove_variable = story_cycle_cat_name
	remove_variable = cat_city
	remove_localized_text = story_cycle_cat_name
}

#Effect to transfer the story to another character
transfer_cat_story_cycle_to_effect = {
	remove_cat_story_modifiers_effect = yes

	save_scope_as = original_owner

	$CHARACTER$ = {
		if = {
			limit = {
				scope:original_owner = {
					has_variable = cat_city
				}
			}
			set_variable = {
				name = cat_city
				value = scope:original_owner.var:cat_city
			}
		}
		set_variable = {
			name = story_cycle_cat_name
			value = $STORY$.var:story_cycle_cat_name
		}
		if = {
			limit = {
				scope:original_owner = { is_alive = yes }
			}
			copy_localized_text = {
				key = story_cycle_cat_name
				target = scope:original_owner
			}
		}
		add_character_modifier = {
			modifier = cat_story_modifier
		}
		add_character_flag = had_cat_story
	}

	remove_cat_name_effect = yes

	$STORY$ = {
		make_story_owner = $CHARACTER$
	}
}


########
# DOG
########

#Effect to start the story and show the right modifier
start_dog_story_cycle_effect = {
	show_as_tooltip = {
		add_character_modifier = {
			modifier = dog_story_modifier
		}
	}
	hidden_effect = {
		create_story = story_cycle_pet_dog
	}
}

#Pick out name options to show
assign_name_options_dog_story_cycle_effect = {
	random_list = {
		1 = {
			trigger = { NOT = { has_character_flag = name_amiable } }
			add_character_flag = name_amiable
		}
		1 = {
			trigger = { NOT = { has_character_flag = name_nosewise } }
			add_character_flag = name_nosewise
		}
		1 = {
			trigger = { NOT = { has_character_flag = name_holdfast } }
			add_character_flag = name_holdfast
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_gray }
				scope:story.var:dog_fur_color = flag:gray
			}
			add_character_flag = name_gray
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_choplicker }
				scope:story.var:dog_fur_color = flag:black
			}
			add_character_flag = name_choplicker
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_shadow }
				scope:story.var:dog_fur_color = flag:black
			}
			add_character_flag = name_shadow
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_snow }
				scope:story.var:dog_fur_color = flag:white
			}
			add_character_flag = name_snow
		}
	}
}

#Assign the gender of the dog
assign_dog_gender_effect = {
	save_temporary_scope_value_as = {
		name = gender
		value = flag:$GENDER$
	}
	if = {
		limit = { scope:gender = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = dog_gender
						value = flag:female
					}
				}
				50 = {
					set_variable = {
						name = dog_gender
						value = flag:male
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:gender = flag:male
				scope:gender = flag:female
			}
		}
		set_variable = {
			name = dog_gender
			value = flag:$GENDER$
		}
	}
}

#Assign the fur-color of the dog
assign_dog_fur_color_effect = {
	save_temporary_scope_value_as = {
		name = fur_color
		value = flag:$COLOR$
	}
	if = {
		limit = { scope:fur_color = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = dog_fur_color
						value = flag:brown
					}
				}
				50 = {
					set_variable = {
						name = dog_fur_color
						value = flag:gray
					}
				}
				50 = {
					set_variable = {
						name = dog_fur_color
						value = flag:black
					}
				}
				50 = {
					set_variable = {
						name = dog_fur_color
						value = flag:white
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:fur_color = flag:brown
				scope:fur_color = flag:gray
				scope:fur_color = flag:black
				scope:fur_color = flag:white
			}
		}
		set_variable = {
			name = dog_fur_color
			value = flag:$COLOR$
		}
	}
}

#Assign the eye-color of the dog
assign_dog_eye_color_effect = {
	save_temporary_scope_value_as = {
		name = eye_color
		value = flag:$COLOR$
	}
	if = {
		limit = { scope:eye_color = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = dog_eye_color
						value = flag:blue
					}
				}
				50 = {
					set_variable = {
						name = dog_eye_color
						value = flag:amber
					}
				}
				50 = {
					set_variable = {
						name = dog_eye_color
						value = flag:gray
					}
				}
				50 = {
					set_variable = {
						name = dog_eye_color
						value = flag:brown
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:eye_color = flag:blue
				scope:eye_color = flag:amber
				scope:eye_color = flag:gray
				scope:eye_color = flag:brown
			}
		}
		set_variable = {
			name = dog_eye_color
			value = flag:$COLOR$
		}
	}
}

dog_got_pregnant_effect = {
	custom_tooltip = dog_got_pregnant_tooltip
	trigger_event = {
		id = pet_animal.1190
		days = { 58 68 }
	}
}

#Remove everything related to the story
remove_dog_story_modifiers_effect = {
	if = {
		limit = {
			has_character_modifier = dog_story_modifier
		}
		remove_character_modifier = dog_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = dog_story_walking_modifier
		}
		remove_character_modifier = dog_story_walking_modifier
	}
	if = {
		limit = {
			has_character_modifier = rat_hunting_dog_modifier
		}
		remove_character_modifier = rat_hunting_dog_modifier
	}
	if = {
		limit = {
			has_character_modifier = adventurous_pet_modifier
		}
		remove_character_modifier = adventurous_pet_modifier
	}
	if = {
		limit = {
			has_character_modifier = feral_pet_modifier
		}
		remove_character_modifier = feral_pet_modifier
	}
	if = {
		limit = {
			has_character_modifier = dog_story_scenthound_modifier
		}
		remove_character_modifier = dog_story_scenthound_modifier
	}
	if = {
		limit = {
			has_character_modifier = dog_story_beasthound_modifier
		}
		remove_character_modifier = dog_story_beasthound_modifier
	}
}

remove_dog_name_effect = {
	remove_variable = story_cycle_dog_name
	remove_localized_text = story_cycle_dog_name
}

#Effect to transfer the story to another character
transfer_dog_story_cycle_to_effect = {
	remove_dog_story_modifiers_effect = yes

	save_temporary_scope_as = original_owner

	$CHARACTER$ = {
		set_variable = {
			name = story_cycle_dog_name
			value = $STORY$.var:story_cycle_dog_name
		}
		if = {
			limit = {
				scope:original_owner = { is_alive = yes }
			}
			copy_localized_text = {
				key = story_cycle_dog_name
				target = scope:original_owner
			}
		}
		add_character_modifier = {
			modifier = dog_story_modifier
		}
		add_character_flag = had_dog_story
	}

	remove_dog_name_effect = yes

	$STORY$ = {
		make_story_owner = $CHARACTER$
	}
}


########
# WARHORSE
########

#Effect to start the story and show the right modifier
start_warhorse_story_cycle_effect = {
	show_as_tooltip = {
		add_character_modifier = {
			modifier = horse_story_modifier
		}
	}
	hidden_effect = {
		create_story = story_cycle_martial_lifestyle_warhorse
	}
}

assign_horse_gender_effect = {
	save_temporary_scope_value_as = {
		name = gender
		value = flag:$GENDER$
	}
	if = {
		limit = { scope:gender = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = horse_gender
						value = flag:female
					}
				}
				50 = {
					set_variable = {
						name = horse_gender
						value = flag:male
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:gender = flag:male
				scope:gender = flag:female
			}
		}
		set_variable = {
			name = horse_gender
			value = flag:$GENDER$
		}
	}
}

level_horse_modifier_effect = {
	if = {
		limit = {
			OR = { #first generation horse modifier
				has_character_modifier = horse_strength_modifier
				has_character_modifier = horse_agility_modifier
				has_character_modifier = horse_endurance_modifier
				has_character_modifier = horse_fierceness_modifier
			}
		}
		if = {
			limit = {
				scope:horse_skill_to_level = flag:strength
			}
			if = {
				limit = {
					has_character_modifier = horse_strength_modifier
				}
				remove_character_modifier = horse_strength_modifier
				add_character_modifier = {
					modifier = horse_strength_strength_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_agility_modifier
				}
				remove_character_modifier = horse_agility_modifier
				add_character_modifier = {
					modifier = horse_agility_strength_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_endurance_modifier
				}
				remove_character_modifier = horse_endurance_modifier
				add_character_modifier = {
					modifier = horse_endurance_strength_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_fierceness_modifier
				}
				remove_character_modifier = horse_fierceness_modifier
				add_character_modifier = {
					modifier = horse_fierceness_strength_modifier
				}
			}
		}
		else_if = {
			limit = {
				scope:horse_skill_to_level = flag:agility
			}
			if = {
				limit = {
					has_character_modifier = horse_strength_modifier
				}
				remove_character_modifier = horse_strength_modifier
				add_character_modifier = {
					modifier = horse_agility_strength_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_agility_modifier
				}
				remove_character_modifier = horse_agility_modifier
				add_character_modifier = {
					modifier = horse_agility_agility_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_endurance_modifier
				}
				remove_character_modifier = horse_endurance_modifier
				add_character_modifier = {
					modifier = horse_endurance_agility_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_fierceness_modifier
				}
				remove_character_modifier = horse_fierceness_modifier
				add_character_modifier = {
					modifier = horse_fierceness_agility_modifier
				}
			}
		}
		else_if = {
			limit = {
				scope:horse_skill_to_level = flag:endurance
			}
			if = {
				limit = {
					has_character_modifier = horse_strength_modifier
				}
				remove_character_modifier = horse_strength_modifier
				add_character_modifier = {
					modifier = horse_endurance_strength_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_agility_modifier
				}
				remove_character_modifier = horse_agility_modifier
				add_character_modifier = {
					modifier = horse_endurance_agility_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_endurance_modifier
				}
				remove_character_modifier = horse_endurance_modifier
				add_character_modifier = {
					modifier = horse_endurance_endurance_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_fierceness_modifier
				}
				remove_character_modifier = horse_fierceness_modifier
				add_character_modifier = {
					modifier = horse_fierceness_endurance_modifier
				}
			}
		}
		else_if = {
			limit = {
				scope:horse_skill_to_level = flag:fierceness
			}
			if = {
				limit = {
					has_character_modifier = horse_strength_modifier
				}
				remove_character_modifier = horse_strength_modifier
				add_character_modifier = {
					modifier = horse_fierceness_strength_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_agility_modifier
				}
				remove_character_modifier = horse_agility_modifier
				add_character_modifier = {
					modifier = horse_fierceness_agility_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_endurance_modifier
				}
				remove_character_modifier = horse_endurance_modifier
				add_character_modifier = {
					modifier = horse_fierceness_endurance_modifier
				}
			}
			else_if = {
				limit = {
					has_character_modifier = horse_fierceness_modifier
				}
				remove_character_modifier = horse_fierceness_modifier
				add_character_modifier = {
					modifier = horse_fierceness_fierceness_modifier
				}
			}
		}
		set_variable = {
			name = warhorse_modifier_level
			value = 2 #In case we want to add more levels later
		}
	}
	else_if = {
		limit = {
			has_character_modifier = horse_story_modifier
		}
		remove_character_modifier = horse_story_modifier
		if = {
			limit = {
				scope:horse_skill_to_level = flag:strength
			}
			add_character_modifier = {
				modifier = horse_strength_modifier
			}
		}
		else_if = {
			limit = {
				scope:horse_skill_to_level = flag:agility
			}
			add_character_modifier = {
				modifier = horse_agility_modifier
			}
		}
		else_if = {
			limit = {
				scope:horse_skill_to_level = flag:endurance
			}
			add_character_modifier = {
				modifier = horse_endurance_modifier
			}
		}
		else_if = {
			limit = {
				scope:horse_skill_to_level = flag:fierceness
			}
			add_character_modifier = {
				modifier = horse_fierceness_modifier
			}
		}
	}
}

remove_horse_story_modifiers_effect = {
	if = {
		limit = {
			has_character_modifier = horse_story_modifier
		}
		remove_character_modifier = horse_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_strength_modifier
		}
		remove_character_modifier = horse_strength_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_agility_modifier
		}
		remove_character_modifier = horse_agility_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_endurance_modifier
		}
		remove_character_modifier = horse_endurance_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_fierceness_modifier
		}
		remove_character_modifier = horse_fierceness_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_strength_strength_modifier
		}
		remove_character_modifier = horse_strength_strength_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_agility_strength_modifier
		}
		remove_character_modifier = horse_agility_strength_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_agility_agility_modifier
		}
		remove_character_modifier = horse_agility_agility_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_endurance_strength_modifier
		}
		remove_character_modifier = horse_endurance_strength_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_endurance_agility_modifier
		}
		remove_character_modifier = horse_endurance_agility_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_endurance_endurance_modifier
		}
		remove_character_modifier = horse_endurance_endurance_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_fierceness_strength_modifier
		}
		remove_character_modifier = horse_fierceness_strength_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_fierceness_agility_modifier
		}
		remove_character_modifier = horse_fierceness_agility_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_fierceness_endurance_modifier
		}
		remove_character_modifier = horse_fierceness_endurance_modifier
	}
	if = {
		limit = {
			has_character_modifier = horse_fierceness_fierceness_modifier
		}
		remove_character_modifier = horse_fierceness_fierceness_modifier
	}
	if = {
		limit = {
			exists = var:warhorse_modifier_level
		}
		remove_variable = warhorse_modifier_level
	}
}


### EAGLE
#Effect to start the story and show the right modifier
start_eagle_story_cycle_effect = {
	if = {
		limit = {
			exists = scope:eagle_capture_method
		}
		if = {
            limit = {
                scope:eagle_capture_method = flag:standard
            }
            add_character_flag = eagle_capture_method_standard
        }
        else_if = {
			limit = {
                scope:eagle_capture_method = flag:lure
            }
            add_character_flag = eagle_capture_method_lure
        }
		else_if = {
			limit = {
                scope:eagle_capture_method = flag:stolen
            }
            add_character_flag = eagle_capture_method_stolen
        }
		else_if = {
			limit = {
                scope:eagle_capture_method = flag:gift
            }
            add_character_flag = eagle_capture_method_gift
        }
		else_if = {
			limit = {
                scope:eagle_capture_method = flag:market
            }
            add_character_flag = eagle_capture_method_market
        }
	}
	else = {
		add_character_flag = eagle_capture_method_none
	}
	add_character_modifier = {
		modifier = eagle_story_modifier
	}
	hidden_effect = {
		create_story = story_cycle_pet_eagle
	}
}

#Assign the gender of the eagle
assign_eagle_gender_effect = {
	save_temporary_scope_value_as = {
		name = gender
		value = flag:$GENDER$
	}
	if = {
		limit = { scope:gender = flag:random }
		hidden_effect = {
			random_list = {
				80 = { # Female eagles are thought to be larger / fiercer
					set_variable = {
						name = eagle_gender
						value = flag:female
					}
				}
				20 = {
					set_variable = {
						name = eagle_gender
						value = flag:male
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:gender = flag:male
				scope:gender = flag:female
			}
		}
		set_variable = {
			name = eagle_gender
			value = flag:$GENDER$
		}
	}
}

#Pick out name options to show
assign_name_options_eagle_story_cycle_effect = {
	random_list = {
		10 = { 
			trigger = { 
				var:eagle_gender = flag:female
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:lyra } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:lyra }
		}
		10 = { 
			trigger = { 
				var:eagle_gender = flag:female
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:astana } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:astana }
		}
		10 = { 
			trigger = { 
				var:eagle_gender = flag:female
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:jargal } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:jargal }
		}
		10 = { 
			trigger = { 
				var:eagle_gender = flag:female
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:khair } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:khair }
		}
		10 = {
			trigger = { 
				var:eagle_gender = flag:male
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:anda } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:anda }
		}
		10 = {
			trigger = { 
				var:eagle_gender = flag:male
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:timur } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:timur }
		}
		10 = {
			trigger = { 
				var:eagle_gender = flag:male
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:torebek } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:torebek }
		}
		10 = {
			trigger = { 
				var:eagle_gender = flag:male
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:elmek } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:elmek }
		}
		10 = {
			trigger = { 
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:khongor } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:khongor }
		}
		10 = {
			trigger = { 
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:chania } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:chania }
		}
		10 = {
			trigger = { 
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:qyliinshaq } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:qyliinshaq }
		}
		10 = {
			trigger = { 
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:janym } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:janym }
		}
		10 = {
			trigger = { 
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:syr } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:syr }
		}
		10 = {
			trigger = { 
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:halik } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:halik }
		}
		10 = {
			trigger = { 
				NOT = { any_in_list = { variable = story_cycle_eagle_names this = flag:zephyr } }
			}
			add_to_variable_list = { name = story_cycle_eagle_names target = flag:zephyr }
		}
	}
}

#Remove everything related to the story
remove_eagle_story_modifiers_effect = {
	if = {
		limit = {
			has_character_modifier = eagle_story_modifier
		}
		remove_character_modifier = eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = weak_eagle_modifier
		}
		remove_character_modifier = weak_eagle_modifier
	}
	if = {
		limit = {
			has_character_modifier = very_weak_eagle_modifier
		}
		remove_character_modifier = very_weak_eagle_modifier
	}
	if = {
		limit = {
			has_character_modifier = strong_eagle_modifier
		}
		remove_character_modifier = strong_eagle_modifier
	}
	if = {
		limit = {
			has_character_modifier = skilled_eagle_modifier
		}
		remove_character_modifier = skilled_eagle_modifier
	}
	remove_eagle_personality_trait_effect = yes
	if = {
		limit = {
			has_variable = eagle_personality_level
		}
		remove_variable = eagle_personality_level
	}
	if = {
		limit = {
			has_variable = eagle_personality_trait_2
		}
		remove_variable = eagle_personality_trait_2
	}
	if = {
		limit = {
			has_character_flag = eagle_marked_for_death
		}
		remove_character_flag = eagle_marked_for_death
	}
	if = {
		limit = {
			has_character_flag = eagle_is_dying
		}
		remove_character_flag = eagle_is_dying
	}
	if = {
		limit = {
			has_character_flag = eagle_capture_method_standard
		}
		remove_character_flag = eagle_capture_method_standard
	}
	if = {
		limit = {
			has_character_flag = eagle_capture_method_lure
		}
		remove_character_flag = eagle_capture_method_lure
	}
	if = {
		limit = {
			has_character_flag = eagle_capture_method_gift
		}
		remove_character_flag = eagle_capture_method_gift
	}
	if = {
		limit = {
			has_character_flag = eagle_capture_method_none
		}
		remove_character_flag = eagle_capture_method_none
	}
	if = {
		limit = {
			has_character_flag = eagle_capture_method_market
		}
		remove_character_flag = eagle_capture_method_market
	}
	if = {
		limit = {
			has_character_flag = eagle_capture_method_stolen
		}
		remove_character_flag = eagle_capture_method_stolen
	}
	if = {
		limit = {
			has_character_flag = cant_sell_eagle
		}
		remove_character_flag = cant_sell_eagle
	}
}

change_eagle_personality_trait_effect = {
	if = {
		limit = {
			has_eagle_personality_trait_trigger = yes
		}
		remove_eagle_personality_trait_effect = yes
	}
	set_random_eagle_personality_trait_effect = { ADD_MODIFIER = yes }
}

remove_eagle_personality_trait_effect = {
	if = {
		limit = {
			has_variable = eagle_personality_level
		}
		remove_variable = eagle_personality_level
	}
	remove_eagle_personality_modifier_effect = yes
}

remove_eagle_personality_modifier_effect = {
	if = {
		limit = {
			has_character_modifier = brave_eagle_story_modifier
		}
		remove_character_modifier = brave_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = curious_eagle_story_modifier
		}
		remove_character_modifier = curious_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = loyal_eagle_story_modifier
		}
		remove_character_modifier = loyal_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = calm_eagle_story_modifier
		}
		remove_character_modifier = calm_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = wise_eagle_story_modifier
		}
		remove_character_modifier = wise_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = cunning_eagle_story_modifier
		}
		remove_character_modifier = cunning_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = aggressive_eagle_story_modifier
		}
		remove_character_modifier = aggressive_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = observant_eagle_story_modifier
		}
		remove_character_modifier = observant_eagle_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = protective_eagle_story_modifier
		}
		remove_character_modifier = protective_eagle_story_modifier
	}
}

set_random_eagle_personality_trait_effect = {
	if = {
		limit = {
			NOT = { has_variable = eagle_personality_level }
		}
		set_variable = { name = eagle_personality_level value = 1 }
	}
	if = {
		limit = {
			has_character_modifier = eagle_story_modifier
		}
		remove_character_modifier = eagle_story_modifier
	}
	random_list = {
		10 = { 
			set_variable = { name = eagle_personality_trait value = flag:brave }
		}
		10 = { 
			set_variable = { name = eagle_personality_trait value = flag:curious }
		}
		10 = {
			set_variable = { name = eagle_personality_trait value = flag:loyal }
		}
		10 = { 
			set_variable = { name = eagle_personality_trait value = flag:calm }
		}
		10 = { 
			set_variable = { name = eagle_personality_trait value = flag:wise }
		}
		10 = { 
			set_variable = { name = eagle_personality_trait value = flag:cunning }
		}
	}
	if = {
		limit = {
			$ADD_MODIFIER$ = yes
		}
		add_eagle_personality_modifier_effect = yes
	}
}

set_eagle_personality_trait_effect = {
	if = {
		limit = {
			NOT = { has_variable = eagle_personality_level }
		}
		set_variable = { name = eagle_personality_level value = 1 }
	}
	set_variable = { name = eagle_personality_trait value = flag:$TRAIT$ }
	if = {
		limit = {
			$ADD_MODIFIER$ = yes
		}
		add_eagle_personality_modifier_effect = yes
	}
}

add_eagle_personality_modifier_effect = {
	if = {
		limit = {
			has_character_modifier = eagle_story_modifier
		}
		remove_character_modifier = eagle_story_modifier
	}
	if = {
		limit = {
			has_variable = eagle_personality_trait
		}
		switch = {
			trigger = var:eagle_personality_trait
			flag:brave = {
				add_character_modifier = brave_eagle_story_modifier
			}
			flag:curious = {
				add_character_modifier = curious_eagle_story_modifier
			}
			flag:loyal = {
				add_character_modifier = loyal_eagle_story_modifier
			}
			flag:calm = {
				add_character_modifier = calm_eagle_story_modifier
			}
			flag:wise = {
				add_character_modifier = wise_eagle_story_modifier
			}
			flag:cunning = {
				add_character_modifier = cunning_eagle_story_modifier
			}
		}
	}	
}

set_random_secondary_eagle_personality_trait_effect = { # Hunt modifiers
	random_list = {
		10 = { # Increase sightings
			set_variable = { name = eagle_personality_trait_2 value = flag:observant }
			add_character_modifier = { modifier = observant_eagle_story_modifier }
		}
		10 = { # Prevent injury
			set_variable = { name = eagle_personality_trait_2 value = flag:protective }
			add_character_modifier = { modifier = protective_eagle_story_modifier }
		}
		10 = { # Increase success chance
			set_variable = { name = eagle_personality_trait_2 value = flag:aggressive }
			add_character_modifier = { modifier = aggressive_eagle_story_modifier }
		}
	}
}

# Eagle getting weak :(
weaken_eagle_effect = {
	if = {
		limit = {
			has_character_modifier = weak_eagle_modifier
		}
		remove_character_modifier = weak_eagle_modifier
		add_character_modifier = very_weak_eagle_modifier
		hidden_effect = {
			random_list = {
				40 = {  # 40% chance of death
					add_character_flag = eagle_marked_for_death
					trigger_event = {
						id = pet_animal.3199
						days = { 120 720 }
					}
				}
				60 = { }
			}
		}
	}
	else_if = {
		limit = {
			has_character_modifier = very_weak_eagle_modifier
		}
		hidden_effect = {
			add_character_flag = cant_sell_eagle
			random_list = {
				70 = {  # 70% chance of death 
					add_character_flag = eagle_marked_for_death
					trigger_event = {
						id = pet_animal.3199
						days = { 60 600 }
					}
				}
				30 = { }
			}
		}
	}
	else = {
		add_character_modifier = weak_eagle_modifier
		hidden_effect = {
			random_list = {
				10 = {  # 10% chance of death 
					add_character_flag = eagle_marked_for_death
					trigger_event = {
						id = pet_animal.3199
						days = { 180 720 }
					}
				}
				90 = { }
			}
		}
	}
}

unweaken_eagle_effect = {
	if = {
		limit = {
			has_character_modifier = weak_eagle_modifier
		}
		remove_character_modifier = weak_eagle_modifier
	}
	if = {
		limit = {
			has_character_modifier = very_weak_eagle_modifier
		}
		remove_character_modifier = very_weak_eagle_modifier
		if = {
			limit = {
				$FULL$ = no
			}
			add_character_modifier = weak_eagle_modifier
		}
	}
	if = {
		limit = {
			has_character_flag = eagle_marked_for_death
		}
		remove_character_flag = eagle_marked_for_death
		if = { # If you couldn't sell the eagle because it was very weak or something
			limit = {
				has_character_flag = cant_sell_eagle
			}
			remove_character_flag = cant_sell_eagle
		}
	}
}

eagle_treatment_effect = {
	$HEALER$ = { save_scope_as = healer }
	random_list = {
		15 = { # Treatment is very successful
			modifier = {
				is_alive = yes
				add = scope:healer.learning
			}
			modifier = {
				flag:$BONUS$ = flag:court_physician
				add = 5
			}
			desc = pet_animal.3030.very_good
			stress_impact = {
				base = medium_stress_impact_loss
			}
			send_interface_toast = {
				title = pet_animal.eagle_unweak_title
				type = event_toast_effect_good
				left_icon = root
				right_icon = scope:healer
				unweaken_eagle_effect = { FULL = yes }
				add_character_modifier = {
					modifier = strong_eagle_modifier
					years = 3
				}
				add_opinion = {
					modifier = grateful_opinion
					target = scope:healer
					opinion = 25
				}
			}
		}
		30 = { # Treatment is successful
			modifier = {
				is_alive = yes
				add = scope:healer.learning
			}
			modifier = {
				flag:$BONUS$ = flag:court_physician
				add = 10
			}
			modifier = {
				OR = {
					flag:$BONUS$ = flag:courtier
					flag:$BONUS$ = flag:hunter
				}
				add = 20
			}
			desc = pet_animal.3030.good
			stress_impact = {
				base = minor_stress_impact_loss
			}
			send_interface_toast = {
				title = pet_animal.eagle_unweak_title
				type = event_toast_effect_good
				left_icon = root
				right_icon = scope:healer
				unweaken_eagle_effect = { FULL = no }
				add_opinion = {
					modifier = grateful_opinion
					target = scope:healer
					opinion = 15
				}
			}
		}
		40 = { # Treatment is unsuccessful
			modifier = {
				flag:$BONUS$ = flag:court_physician
				add = -15
			}
			modifier = {
				flag:$BONUS$ = flag:courtier
				add = -7
			}
			desc = pet_animal.3030.nothing
			stress_impact = {
				base = miniscule_stress_impact_gain
				callous = miniscule_stress_impact_loss
			}
			send_interface_toast = {
				title = pet_animal.3030.nothing
				type = event_toast_effect_bad
				left_icon = root
				right_icon = scope:healer
				add_opinion = {
					modifier = disappointed_opinion
					target = scope:healer
					opinion = -15
				}
			}
		}
		20 = { # Makes it worse somehow
			modifier = {
				flag:$BONUS$ = flag:court_physician
				add = -10
			}
			modifier = {
				flag:$BONUS$ = flag:courtier
				add = -5
			}
			desc = pet_animal.3030.bad
			stress_impact = {
				base = minor_stress_impact_gain
				callous = minor_stress_impact_loss
			}
			send_interface_toast = {
				title = pet_animal.eagle_unweak_title
				type = event_toast_effect_bad
				left_icon = root
				right_icon = scope:healer
				weaken_eagle_effect = yes
				add_opinion = {
					modifier = angry_opinion
					target = scope:healer
					opinion = -25
				}
			}
		}
	}
}

transfer_eagle_effect = {
	$RECIPIENT$ = { save_scope_as = recipient }
	$GIVER$ = { save_scope_as = giver }
	if = {
		limit = {
			flag:$METHOD$ = flag:gift
		}
		scope:recipient = { save_scope_value_as = { name = eagle_capture_method value = flag:gift } }
	}
	else_if = {
		limit = {
			flag:$METHOD$ = flag:market
		}
		scope:recipient = { save_scope_value_as = { name = eagle_capture_method value = flag:market } }
	}
	else_if = {
		limit = {
			flag:$METHOD$ = flag:stolen
		}
		scope:recipient = { save_scope_value_as = { name = eagle_capture_method value = flag:stolen } }
	}
	
	scope:giver = {
		random_owned_story = { # Get the story
			limit = {
				story_type = story_cycle_pet_eagle
			}
			save_scope_as = story
		}
		# Transfer the eagle to the recipient
		scope:recipient = { # Start the story and transfer the age
			add_character_flag = { flag = cant_sell_eagle years = 1 } # Can't sell it for a while
			set_variable = { # Set the name
				name = story_cycle_eagle_name
				value = scope:giver.var:story_cycle_eagle_name
			}
			set_variable = { # Set the gender
				name = eagle_gender
				value = scope:giver.var:eagle_gender
			}
			set_variable = {
				name = eagle_age_variable
				value = scope:giver.var:eagle_age_variable
			}
			start_eagle_story_cycle_effect = yes # Start the story
		} 
		if = { # Get the eagle's personality traits
			limit = {
				has_eagle_personality_trait_trigger = yes
			}
			switch = {
				trigger = var:eagle_personality_trait
				flag:brave = {
					scope:recipient = { set_variable = { name = eagle_personality_trait value = flag:brave } }
				}
				flag:curious = {
					scope:recipient = { set_variable = { name = eagle_personality_trait value = flag:curious } }
				}
				flag:loyal = {
					scope:recipient = { set_variable = { name = eagle_personality_trait value = flag:loyal } }
				}
				flag:calm = {
					scope:recipient = { set_variable = { name = eagle_personality_trait value = flag:calm } }
				}
				flag:wise = {
					scope:recipient = { set_variable = { name = eagle_personality_trait value = flag:wise } }
				}
				flag:cunning = {
					scope:recipient = { set_variable = { name = eagle_personality_trait value = flag:cunning } }
				}
			}
			if = { # Get the eagle's secondary personality trait
				limit = {
					has_secondary_eagle_personality_trait_trigger = yes
				}
				switch = {
					trigger = var:eagle_personality_trait_2
					flag:observant = {
						scope:recipient = { set_variable = { name = eagle_personality_trait_2 value = flag:observant } }
						add_character_modifier = { modifier = observant_eagle_story_modifier }
					}
					flag:protective = {
						scope:recipient = { set_variable = { name = eagle_personality_trait_2 value = flag:protective } }
						add_character_modifier = { modifier = protective_eagle_story_modifier }
					}
					flag:aggressive = {
						scope:recipient = { set_variable = { name = eagle_personality_trait_2 value = flag:aggressive } }
						add_character_modifier = { modifier = aggressive_eagle_story_modifier }
					}
				}
			}
			scope:recipient = { # Get the eagle's personality level + add the modifier
				set_variable = {
					name = eagle_personality_level
					value = scope:giver.var:eagle_personality_level
				}
				add_eagle_personality_modifier_effect = yes
			}
		}
		# Get the eagle's sickness
		if = {
			limit = {
				has_character_modifier = weak_eagle_modifier
			}
			scope:recipient = { add_character_modifier = { modifier = weak_eagle_modifier years = 1 } }
		}
		else_if = {
			limit = {
				has_character_modifier = very_weak_eagle_modifier
			}
			scope:recipient = { add_character_modifier = { modifier = very_weak_eagle_modifier years = 1 } }
		}
		else = {
			limit = {
				has_character_modifier = strong_eagle_modifier
			}
			scope:recipient = { add_character_modifier = { modifier = strong_eagle_modifier years = 1 } }
		}
		# Remove the eagle from the giver
		show_as_tooltip = {
			remove_eagle_story_modifiers_effect = yes
		}
		scope:story = { hidden_effect = { end_story = yes } }
	}

}

sell_eagle_effect = {
	$SELLER$ = { add_gold = $PRICE$ }
	transfer_eagle_effect = {
		RECIPIENT = $RECIPIENT$
		GIVER = $SELLER$
		METHOD = market
	}
}

get_eagle_training_method_effect = {
    random_list = {
        10 = {
            trigger = {
                NOT = {
                    any_in_list = { variable = eagle_training_methods this = flag:martial }
                    has_character_flag = eagle_training_martial
                }
            }
            add_to_variable_list = { name = eagle_training_methods target = flag:martial }
        }
        10 = {
            trigger = {
                NOT = {
                    any_in_list = { variable = eagle_training_methods this = flag:diplomacy }
                    has_character_flag = eagle_training_diplomacy
                }
            }
            add_to_variable_list = { name = eagle_training_methods target = flag:diplomacy }
        }
        10 = {
            trigger = {
                NOT = {
                    any_in_list = { variable = eagle_training_methods this = flag:stewardship }
                    has_character_flag = eagle_training_stewardship
                }
            }
            add_to_variable_list = { name = eagle_training_methods target = flag:stewardship }
        }
        10 = {
            trigger = {
                NOT = {
                    any_in_list = { variable = eagle_training_methods this = flag:intrigue }
                    has_character_flag = eagle_training_intrigue
                }
            }
            add_to_variable_list = { name = eagle_training_methods target = flag:intrigue }
        }
        10 = {
            trigger = {
                NOT = {
                    any_in_list = { variable = eagle_training_methods this = flag:learning }
                    has_character_flag = eagle_training_learning
                }
            }
            add_to_variable_list = { name = eagle_training_methods target = flag:learning }
        }
    }
}

eagle_training_effect = {
    duel = {
        skill = $METHOD$
        value = decent_skill_rating
        50 = {
            compare_modifier = {
                value = scope:duel_value
                multiplier = 3.5
                min = -49
            }
            modifier = { always = yes add = { 15 25 } }
            eagle_training_success_effect = { METHOD = $METHOD$ }
        }
        30 = {
            compare_modifier = {
                value = scope:duel_value
                multiplier = -3.5
                min = -49
            }
            eagle_training_failure_effect = yes
        }
    }
    add_character_flag = {
        flag = eagle_training_$METHOD$
        years = 5
    }
}

eagle_training_success_effect = {
    add_prestige = medium_prestige_gain
    random_list = {
        desc = pet_animal.3040.training_good_desc
        20 = { # Change personality
            show_chance = no
            trigger = {
                has_eagle_personality_trait_trigger = yes
            }
            set_variable = {
                name = eagle_personality_trait_prev
                value = var:eagle_personality_trait
            }
            desc = pet_animal.3040.personality_change
            show_as_tooltip = { remove_eagle_personality_trait_effect = yes }
            custom_tooltip = pet_animal.3040.personality_change_tooltip
            hidden_effect = {
                random_list = {
                    10 = {
                        trigger = { NOT = { var:eagle_personality_trait_prev ?= flag:brave } }
                        modifier = { flag:$METHOD$ = flag:martial add = 10 }
                        send_interface_toast = {
                            title = pet_animal.3040.training_good_title
                            type = event_toast_effect_good
                            left_icon = root
                            remove_eagle_personality_trait_effect = yes
                            set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = brave }
                            show_as_tooltip = { add_character_modifier = brave_eagle_story_modifier }
                        }
                    }
                    10 = {
                        trigger = { NOT = { var:eagle_personality_trait_prev ?= flag:curious } }
                        modifier = { flag:$METHOD$ = flag:learning add = 10 }
                        send_interface_toast = {
                            title = pet_animal.3040.training_good_title
                            type = event_toast_effect_good
                            left_icon = root
                            remove_eagle_personality_trait_effect = yes
                            set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = curious }
                            show_as_tooltip = { add_character_modifier = curious_eagle_story_modifier }
                        }
                    }
                    10 = {
                        trigger = { NOT = { var:eagle_personality_trait_prev ?= flag:cunning } }
                        modifier = { flag:$METHOD$ = flag:intrigue add = 10 }
                        send_interface_toast = {
                            title = pet_animal.3040.training_good_title
                            type = event_toast_effect_good
                            left_icon = root
                            remove_eagle_personality_trait_effect = yes
                            set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = cunning }
                            show_as_tooltip = { add_character_modifier = cunning_eagle_story_modifier }
                        }
                    }
                    10 = {
                        trigger = { NOT = { var:eagle_personality_trait_prev ?= flag:loyal } }
                        modifier = { flag:$METHOD$ = flag:diplomacy add = 10 }
                        send_interface_toast = {
                            title = pet_animal.3040.training_good_title
                            type = event_toast_effect_good
                            left_icon = root
                            remove_eagle_personality_trait_effect = yes
                            set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = loyal }
                            show_as_tooltip = { add_character_modifier = loyal_eagle_story_modifier }
                        }
                    }
                    10 = {
                        trigger = { NOT = { var:eagle_personality_trait_prev ?= flag:wise } }
                        modifier = { flag:$METHOD$ = flag:stewardship add = 10 }
                        send_interface_toast = {
                            title = pet_animal.3040.training_good_title
                            type = event_toast_effect_good
                            left_icon = root
                            remove_eagle_personality_trait_effect = yes
                            set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = wise }
                            show_as_tooltip = { add_character_modifier = wise_eagle_story_modifier }
                        }
                    }
                    10 = {
                        trigger = { NOT = { var:eagle_personality_trait_prev ?= flag:calm } }
                        send_interface_toast = {
                            title = pet_animal.3040.training_good_title
                            type = event_toast_effect_good
                            left_icon = root
                            remove_eagle_personality_trait_effect = yes
                            set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = calm }
                            show_as_tooltip = { add_character_modifier = calm_eagle_story_modifier }
                        }
                    }
                }
            }
            remove_variable = eagle_personality_trait_prev
        }
        30 = { # Give secondary
            show_chance = no
            desc = pet_animal.3040.personality
			modifier = { flag:$METHOD$ = flag:none add = 10 }
            trigger = {
                has_eagle_personality_trait_trigger = yes
                has_secondary_eagle_personality_trait_trigger = no
            }

            random_list = {
                10 = { # Increase sightings
                    show_chance = no
                    desc = pet_animal.3040.personality_new_observant
                    modifier = { flag:$METHOD$ = flag:stewardship add = 10 }
                    modifier = { flag:$METHOD$ = flag:learning add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_learning
                    custom_tooltip = pet_animal.3040.personality_bonus_stewardship
                    set_variable = { name = eagle_personality_trait_2 value = flag:observant }
					send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        add_character_modifier = { modifier = observant_eagle_story_modifier }
                    }
                }
                10 = { # Prevent injury
                    show_chance = no
                    desc = pet_animal.3040.personality_new_protective
                    modifier = { flag:$METHOD$ = flag:intrigue add = 10 }
                    modifier = { flag:$METHOD$ = flag:diplomacy add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_intrigue
                    custom_tooltip = pet_animal.3040.personality_bonus_diplomacy
                    set_variable = { name = eagle_personality_trait_2 value = flag:protective }
					send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        add_character_modifier = { modifier = protective_eagle_story_modifier }
                    }
                }
                10 = { # Increase success chance
                    show_chance = no
                    desc = pet_animal.3040.personality_new_aggressive
                    modifier = { flag:$METHOD$ = flag:martial add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_martial
                    set_variable = { name = eagle_personality_trait_2 value = flag:aggressive }
					send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        add_character_modifier = { modifier = aggressive_eagle_story_modifier }
                    }
                }
            }
        }
        30 = { # Level personality
			show_chance = no
			desc = pet_animal.3040.personality_level
            trigger = {
                has_eagle_personality_trait_trigger = yes
                has_variable = eagle_personality_level
                var:eagle_personality_level <= 2
            }
            hidden_effect = {
                remove_eagle_personality_trait_effect = yes
                change_variable = {
                    name = eagle_personality_level
                    add = 1
                }
            }
            send_interface_toast = {
                title = pet_animal.3040.training_good_title
                type = event_toast_effect_good
                left_icon = root
                add_eagle_personality_modifier_effect = yes
            }
        }
        30 = { # Give personality
            show_chance = no
            desc = pet_animal.3040.personality
            trigger = {
                has_eagle_personality_trait_trigger = no
            }
            random_list = {
                10 = {
                    desc = pet_animal.3040.personality_new_brave
                    show_chance = no
                    modifier = { always = yes add = { 10 20 } }
                    modifier = { flag:$METHOD$ = flag:martial add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_martial
                    send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = brave }
                        show_as_tooltip = { add_character_modifier = brave_eagle_story_modifier }
                    }
                }
                10 = {
                    desc = pet_animal.3040.personality_new_curious
                    show_chance = no
                    modifier = { always = yes add = { 10 20 } }
                    modifier = { flag:$METHOD$ = flag:learning add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_learning
                    send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = curious }
                        show_as_tooltip = { add_character_modifier = curious_eagle_story_modifier }
                    }
                }
                10 = {
                    desc = pet_animal.3040.personality_new_cunning
                    show_chance = no
                    modifier = { always = yes add = { 10 20 } }
                    modifier = { flag:$METHOD$ = flag:intrigue add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_intrigue
                    send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = cunning }
                        show_as_tooltip = { add_character_modifier = cunning_eagle_story_modifier }
                    }
                }
                10 = {
                    desc = pet_animal.3040.personality_new_loyal
                    show_chance = no
                    modifier = { always = yes add = { 10 20 } }
                    modifier = { flag:$METHOD$ = flag:diplomacy add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_diplomacy
                    send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = loyal }
                        show_as_tooltip = { add_character_modifier = loyal_eagle_story_modifier }
                    }
                }
                10 = {
                    desc = pet_animal.3040.personality_new_wise
                    show_chance = no
                    modifier = { always = yes add = { 10 20 } }
                    modifier = { flag:$METHOD$ = flag:stewardship add = 10 }
                    custom_tooltip = pet_animal.3040.personality_bonus_stewardship
                    send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = wise }
                        show_as_tooltip = { add_character_modifier = wise_eagle_story_modifier }
                    }
                }
                10 = {
                    desc = pet_animal.3040.personality_new_calm
                    show_chance = no
                    modifier = { always = yes add = { 15 20 } }
                    send_interface_toast = {
                        title = pet_animal.3040.training_good_title
                        type = event_toast_effect_good
                        left_icon = root
                        set_eagle_personality_trait_effect = { ADD_MODIFIER = yes TRAIT = calm }
                        show_as_tooltip = { add_character_modifier = calm_eagle_story_modifier }
                    }
                }
            }
        }
        10 = { # Generic bonus
            show_chance = no
            desc = pet_animal.3040.training_good_generic
            send_interface_toast = {
                title = pet_animal.3040.training_good_title
                type = event_toast_effect_good
                left_icon = root
                add_character_modifier = {
                    modifier = skilled_eagle_modifier
                    years = 2
                }
            }
        }
    }
}

eagle_training_failure_effect = {
	random_list = {	
		desc = pet_animal.3040.training_bad_desc
		30 = { # Lose some skill 
			show_chance = no
			desc = pet_animal.3040.training_bad
			trigger = {
				has_eagle_personality_trait_trigger = yes 
				var:eagle_personality_level >= 2
			}
			send_interface_toast = {
				title = pet_animal.3040.training_bad_title
				type = event_toast_effect_bad
				left_icon = root
				custom_tooltip = pet_animal.3040.personality_less_effective
				hidden_effect = {
					remove_eagle_personality_trait_effect = yes
					change_variable = {
						name = eagle_personality_level
						add = -1
					}
					add_eagle_personality_modifier_effect = yes
				}
			}
		}
		20 = { # Eagle is injured :(
			show_chance = no
			desc = pet_animal.3040.training_very_bad
			modifier = {
				add = -10
				has_character_modifier = skilled_eagle_modifier
			}
			modifier = {
				add = 10
				has_character_modifier = weak_eagle_modifier
			}
			modifier = {
				add = 20
				has_character_modifier = very_weak_eagle_modifier
			}
			modifier = {
				add = 10
				has_trait = intellect_bad_1
			}
			modifier = {
				add = 20
				has_trait = intellect_bad_2
			}
			modifier = {
				add = 30
				has_trait = intellect_bad_3
			}
			save_scope_value_as = {
				name = eagle_injury_source
				value = flag:training
			}
			show_as_tooltip = {
				weaken_eagle_effect = yes
			}
			trigger_event = {
				id = pet_animal.3030
			}
		}
		40 = { # Nothing happens
			show_chance = no
			desc = pet_animal.3040.training_neutral
			send_interface_toast = {
				title = pet_animal.3040.training_bad_title
				type = event_toast_effect_bad
				left_icon = root
				add_stress = miniscule_stress_impact_gain
				add_prestige = minor_prestige_loss
			}
		}
	}
}