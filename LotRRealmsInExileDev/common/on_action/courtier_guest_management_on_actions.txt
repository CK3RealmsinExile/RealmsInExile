# Called when a courtier gets bored at a court and wants to go adventuring instead.
# root, scope:courtier: the courtier
# liege: their liege (owner of their court)
# characters: list of all characters moving together. Includes the root character.
on_courtier_decided_to_move_to_pool = {
	events = {
		aman.0001 # If it's in Aman, come back
		courtier_guest_management.0001 #Warn liege about important courtiers moving (only liege's children atm)
	}
}

# Called after a set amount of time (COURTIER_MOVE_TO_POOL_DELAY_MONTHS)
# after on_courtier_decided_to_move_to_pool, if the courtier still wants to move.
# root, scope:courtier: the courtier
# liege: their liege (owner of their court)
# characters: list of all characters moving together. Includes the root character.
on_courtier_ready_to_move_to_pool = {
	events = {
		aman.0001 # If it's in Aman, come back
		courtier_guest_management.0101 #Last chance to make them stay (only for claimants atm)
	}
}

######################################################################

# Called when a pool character has appeared at the court. See guest_management in common/courtier_guest_management.
# root, scope:guest: the guest
# host: their host (owner of the court)
# characters: list of all characters moving together. Includes the root character.
on_guest_arrived_from_pool = {
	#effect = {		
    #    debug_log = "on_guest_arrived_from_pool"
	#}
	effect = {
		hidden_effect = {
			#Wasteland effects
			empty_wastelands_inhabitants_effect = yes
			empty_foreign_visitors_to_wastelands_effect = yes		
			remove_traits_wastelands_effect = yes
			
			#Elven guest management
			if = {
				limit = {
					is_elf = yes
					host = { is_elf = no }
				}
				if = {
					limit = { 
						or = {
							culture = { has_cultural_pillar = heritage_calaquendi }
							not = { exists = culture.culture_head }
						}
					}
					move_to_pool_at = title:k_rivendell.holder.location
				}
				else = {
					move_to_pool_at = culture.culture_head.location
				}
			}
			
			#Orcish guest management
			if = {
				limit = {
					is_orc = yes
					host = { faith_is_evil = no }
				}
				if = {
					limit = { 
						not = { exists = culture.culture_head }
						sauron_is_alive = yes
					}
					move_to_pool_at = character:lineofsauron.location
				}
				else_if = {
					limit = { 
						not = { exists = culture.culture_head }
						sauron_is_alive = no
						any_ruler = { is_orc = yes }
					}
					random_ruler = {
						limit = { is_orc = yes }
						save_scope_as = new_host
					}
					move_to_pool_at = scope:new_host.location
				}
				else_if = {
					limit = { 
						not = { exists = culture.culture_head }
						sauron_is_alive = no
						any_ruler = { faith_is_evil = yes }
					}
					random_ruler = {
						limit = { faith_is_evil = yes }
						save_scope_as = new_host
					}
					move_to_pool_at = scope:new_host.location
				}
				else = {
					move_to_pool_at = culture.culture_head.location
				}
			}
			
			#Nazgûl guest management
			if = {
				limit = {
					is_nazgul = yes
					host = { 
						is_nazgul = no
						is_sauron = no
					}
				}
				move_to_pool_at = character:lineofsauron.location
				set_employer = character:lineofsauron
			}
		}
	}
			
			
				
	events = {
		courtier_guest_management.1001 #Guest arriving, development effect, message if they're great
		# wastelands.0005 # If a guest arrives to wilderness, we will send them to somewhere else
		# elven_racial.0400 # If an elven guest arrives to a non-Elven court, move them to their culture head's pool or Elrond's, for Calaquendi
		# nazgul.0400 # If a Nazgûl guest arrives to a non-Nazgûl and non-Sauronic court, move them to Sauron's court
		# orcs.5000 # If an Orc moves to a non-evil court, move them an appropriate
	}
}

# Called after a set amount of time (GUEST_MOVE_TO_POOL_DELAY_MONTHS)
# after a guest has decided to leave the court.
# root, scope:guest: the guest
# host: their host (owner of the court)
# characters: list of all characters moving together. Includes the root character.
# scope:destination: Where they should move to
on_guest_ready_to_move_to_pool = {
	events = {
		courtier_guest_management.0500 # Guest leaves
	}
}
