#On actions directing prison-related events
#Note that prison stress events are handled through the Stress on-actions.
#LOTR: auto-execution of orcs added


# Code on-action: character being imprisoned in root scope
# imprisoning character set as scope:imprisoner
lotr_on_imprison = {
	effect = { # You no longer make such decisions over your life :(

		if = { # Taking the Hobbits to Isengard! | Achievement
			limit = {
				NOT = { exists = global_var:lotr_achievement_43 }
				# realms_achievements_enabled = yes
				scope:imprisoner = { is_ai = no }
				scope:imprisoner = character:lineofsaruman
				scope:imprisoner = { 
					any_prisoner = {
						is_hobbit = yes
						count > 1
					}
				}
			}
			set_global_variable = lotr_achievement_43
		}

		if = { # Learn Sorcery
			limit = {
				scope:imprisoner = {
					has_character_flag = abducting_sorcerer
				}
			}
			scope:imprisoner = {
				# trigger_event = { #LotR - does not exist
				# 	id = evil.0113
				# 	days = 1
				# }
				remove_character_flag = abducting_sorcerer
			}
		}
		if = { #Free Peoples execute orcs automatically
			limit = {
				is_orc = yes
				scope:imprisoner = {
					religion = { is_in_family = rf_eruhini }
					NOT = { is_orc = yes }
				}
			}
			if = { #if war leader, war is lost before it's invalidated by game
				limit = {
					any_character_war = {
						is_war_leader = root
						is_defender = root
						any_war_attacker = {
							this = scope:imprisoner
						}
					}
				}
				every_character_war = {
					limit = {
						is_war_leader = root
						is_defender = root
						any_war_attacker = {
							this = scope:imprisoner
						}
					}
					end_war = attacker
				}
			}
			if = {
				limit = {
					any_character_war = {
						is_war_leader = root
						is_attacker = root
						any_war_defender = {
							this = scope:imprisoner
						}
					}
				}
				every_character_war = {
					limit = {
						is_war_leader = root
						is_attacker = root
						any_war_defender = {
							this = scope:imprisoner
						}
					}
					end_war = defender
				}
			}
			death = {
				death_reason = death_battle # Orcs would rather die than be captured
				killer = scope:imprisoner
			}
		}

		if = { #You can't keep a Nazgûl or Maia behind bars
			limit = { 
				AND = {
					OR = {
						is_maiar = yes
						is_maiar_fallen = yes
						AND = {
							is_nazgul = yes 
							scope:imprisoner = { is_sauron = no }
						}
					}
					NOT = {
						has_character_flag = defeated_maia
					}
				}
			}
			trigger_event = prison.9001
		}
	}
	events = {
		wastelands.0003	# Handling wastelands
	}
}