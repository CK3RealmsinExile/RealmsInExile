# root: The province in which the building was completed
# scope:character: The character that paid for the construction, if available
lotr_on_building_completed = {
	effect = {
		#save the county holder as the character in case the construction wasn't started through GUI or by the AI 
		if = {
			limit = {
				NOT = { exists = scope:character }
			}
			root.county.holder = {
				save_scope_as = character
			}
		}
		root = {
			if = { ### spider_nest_cleared (and other blockers)
				limit = { has_building_with_flag = obstacle }
				county.title_province = {
					save_scope_as = obstacle_province
				}
				county.holder = {
					trigger_event = {
						id = wastelands.9000
						days = 1
					}
				}
			}

			if = {
				limit = { 
					scope:character = { is_ai = no }
					realms_achievements_enabled = yes
				}
				if = { # The Very Image of Eldamar | Achievement
					limit = {
						NOT = { exists = global_var:lotr_achievement_33 } 
						has_building = elven_settlement_07
						county.holder = {
							any_held_county = {
								any_county_province = { has_building = elven_settlement_07 }
								any_county_province = { has_building = elven_settlement_07 }
								count > 2
							}
						}
					}
					set_global_variable = lotr_achievement_33
				}
				if = { # From the deepest cave to the highest peak | Achievement
					limit = { 
						NOT = { exists = global_var:lotr_achievement_32 }
						has_building = dwarven_depths_10 
					}
					set_global_variable = lotr_achievement_32
				}
			}
		}
	}
}

# root: The holder of the province doing the rebuilding
# province: The province in which the great building exists
lotr_on_great_building_rebuilt = {
	effect = {
		if = {
			limit = { 
				is_dwarf = yes
				NOT = { government_has_flag = government_is_mandala }
			}
			#Memory
			create_character_memory = { type = rebuilt_dwarven_capital_memory }
			scope:new_memory ?= {
				set_variable = {
					name = dwarven_capital_rebuilt_location
					value = scope:province
				}
				if = {
					limit = { exists = var:dwarven_capital_rebuilt_location }
					#To prevent 'unused except in loc' errors :catto:
				}
			}
		}
	}
}


