# Called from code after history generation
# Empty scope
lotr_on_game_start = {
	on_actions = { ccu_startup }

	events = {
		lotr_historical_artifacts.0001		# LotR Historical Artifacts Generator
		dwarven.5000						# LotR Dwarven Fathers Reincarnation System #juke note: also known as the LotRRieDFRS(tm)
	}

	effect = {
		##############################
		### Culture Creation Dates ###
		##############################
		lotr_set_culture_form_dates = yes

		#######################
		### DLC LOCK CHECKS ###
		#######################

		# Remove all admin government (KotS handled by PDX)
		if = {
			limit = {
				NOT = { has_dlc_feature = roads_to_power }
			}
			every_ruler = {
				limit = {
					has_government = administrative_government
				}
				if = {
					limit = {
						ep3_is_clan_inclined_trigger = yes
					}
					change_government = clan_government
					add_realm_law_skip_effects = single_heir_succession_law
				}
				else = {
					change_government = feudal_government
					add_realm_law_skip_effects = single_heir_succession_law
				}
			}
		}

		start_situations_effect = yes

		### Bay of Ormal Trade Dominance Bonii ###
		if = {
			limit = {
				game_start_date = 6787.1.1
			}
			title:c_narikhar = {
				add_county_modifier = control_trade_in_the_bay_of_ormal_inyaloni_modifier
			}
		}
		else_if = {
			limit = {
				game_start_date = 7033.1.1
			}
			title:c_narikhar = {
				add_county_modifier = control_trade_in_the_bay_of_ormal_inyaloni_modifier
			}
		}

		### The Long Winter ###
		if = {
			limit = {
				game_start_date = 6787.1.1
			}
			title:k_wastelands.holder = {
				if = {
					limit = {
						has_game_rule = default_ai_behavior
					}
					trigger_event = {
						id = long_winter.0001
						days = 1675
					}
				}
				else = {
					random_list = {
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 1310
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 1675
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 2040
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 2405
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 2770
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 3135
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 3500
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 3865
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 4230
							}
						}
						1 = {
							trigger_event = {
								id = long_winter.0001
								days = 4595
							}
						}
					}
				}
			}
		}

		### RELIGIOUS STUFF ###

		religion:magrin_religion = { every_faith = { set_variable = historical_magrin_faith } }

		#Vidavan reforms in Arienism
		faith:faith_arienism = {
			if = {
				limit = {
					game_start_date >= 6440.1.1
				}
				remove_doctrine = tenet_spread_the_light
				add_doctrine = tenet_vidavan
			}
		}
		if = {
			limit = {
				game_start_date >= 5100.1.1
			}
			religion:ormalbay_religion = {
				set_variable = {
					name = variable_ghw_unlocked
					value = yes
				}
			}
		}

		# Assigning bonuses and states to certain historical characters
		lotr_apply_posthistory_effect = yes

		# Make Dark Lord HOF uncreatable while Sauron is in hiding
		if = {
			limit = {
				game_start_date > 4033
				game_start_date < 6974
			}
			remove_dark_lord_hof_effect = yes
		}

		# Nurn Slaves
		every_county = {
			limit = {
				culture = culture:nurnoth
				faith = faith:faith_nurn_slave
			}
			make_county_crypto_religionists_effect = { FAITH = faith:faith_nurn_good }
		}

		#Dunlending white-hand faith inaccessible
		faith:faith_dunlending_white_hand = {
			set_variable = { name = block_conversion_till_decision_taken }
		}

		# Tweaking faith fervor so we dont have strange game-start heresies and accounting for shift in gender preference
		faith:faith_arysis = {
			change_fervor = {
				value = 80
				desc = fervor_gain_ascetic_example
			}
			if = {
				limit = {
					game_start_date >= 6033.1.1
				}
				remove_doctrine = doctrine_gender_equal
				add_doctrine = doctrine_gender_male_orientated
			}
		}

		### GAME RULE: EXTRA ADMINS
		apply_historic_administrative_game_rule_effect = yes

		# Variables so the window can be made invisble
		#LotR
		religion:religion_wastelands_pagan = { set_variable = religion_invis }
		faith:faith_wastelands_pagan = { set_variable = faith_invis }
		culture:wastelands = { set_variable = culture_invis }

		### Designate Wastelands Code ###
		add_empires_to_global_list = yes
		add_kingdom_titles_to_list = yes
		canon_area_empires = yes

		### Define Elven Homeland Counties
		define_elven_homelands = yes

		### Foundations of Stone modifier setup
		foundations_of_stone_county_setup_effect = yes

		### Define Routes
		define_trade_routes = yes

		### Define Ore and Jewel Deposits
		define_existing_mining_resources = yes

		### Define Natural Disaster Regions
		lotr_define_natural_disaster_regions = yes

		### Set up the Mundburgian Eored
		if = {
			limit = { game_start_date >= 5465.1.1 } #Eldacar returns with his Northmen guard
			if = {
				limit = { exists = title:e_gondor.holder }
				title:e_gondor = { set_variable = founded_mundburgian_eored }
			}
			else = { title:e_gondor_steward = { set_variable = founded_mundburgian_eored } }
		}

		### Set Up Maresh Prosperity ###
		setup_maresh_prosperity_effect = yes

		### Set Up Dates of Acadeh modifier
		title:c_acadeh = {
			add_county_modifier = {
				modifier = lodenuly_date_farms_modifier
			}
		}
		title:c_arnaz = {
			add_county_modifier = {
				modifier = lodenuly_date_farms_modifier
			}
		}

		### Set Up City of Cats in Bellakar
		title:c_esmer = { add_county_modifier = city_of_cats_modifier }

		### Set up the Namâlo Network
		# Namâlo Spice Merchant Network is established in Sîrayn
		lotr_historical_namalo_effect = yes

		###############################
		### Dynasty related effects ###
		###############################

		### Set Up Dorwinion Faction Alignments ###

		dorwinion_dynasty_alignment = yes

		### Set Up Dune Sea Witch Covens ###

		dune_sea_witch_covens = yes

		### Appoint Princely Houses of the Dúnedain ###

		princely_houses_of_dunedain = yes

		### Fix Castamiri names ###
		house:house_castamir = {
			if = {
				limit = {
					game_start_date <= 5480.1.1
				}
				set_house_name = dynn_calimehtar
			}
		}
		# Find some way to change motto

		lotr_gender_flip_the_fathers = yes

		### Fire Intro Events ###
		fire_intro_events = yes

		### Sorcery Setup ###
		generate_sorcery_list_on_start = yes

		title:k_wastelands.holder = { create_story = story_artifact_crafting }

		title:d_tamska_main.holder = { create_story = story_cycle_tamskangi }

		if = { # The Establishment of the Ithilien Rangers
			limit = { game_start_date >= 6934.1.1 } # The year is after T.A. 2901, when Henneth Annun was built
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:establish_the_ithilien_rangers
			}
		}

		character:k_wastelands_holder = {
			trigger_event = elven_racial.0100
			trigger_event = dwarven_racial.0100 # Lifestyle experience for famous dwarven smiths
		}

		every_living_character = {
			trigger_event = {
				id = elven_racial.0010 #Elven racial maintenance event
				days = 1
			}
			trigger_event = {
				id = race.0002
				days = 1
			}
		}

		#########################
		# Gamestart Culture Edits
		# Some culture ethos/traditions vary between start dates
		#########################
		lotr_gamestart_culture_effect = yes

		### *JANK* to fix THE BUG, replace if it ever fixes itself ###
		lotr_THE_BUG_jank_effect = yes

		#########################
		# WILDERNESS total clear of courtiers, guests and downgrading the leader
		# Issue and solution: guests seems to constantly respawn unless you remove the leader, so we do it
		#########################
		empty_wastelands_inhabitants_effect = yes

		#########################
		# WILDERNESS The ruler will be respawned, we need to remove all traits from him/her
		# Issue and solution: ruler is still not a ruler and you can't use every_ruler, it seems to be appointed after, so I use a filtered every_living_character
		#########################
		remove_traits_wastelands_effect = yes

		#########################
		# WILDERNESS:
		# Setting the base number a count/duke/king/emporer can hold before increasing maintenance cosst
		#########################

		#########################
		# COURT LANGUAGES:
		# Makes sure everyone knows their court language
		#########################
		if = {
			limit  = { has_dlc_feature = royal_court }
			every_character_with_royal_court = {
				limit = {
					NOT = { knows_court_language_of = this }
					age > 7
				}
				learn_court_language_of = this
				every_child = {
					limit = {
						NOT = { knows_court_language_of = prev }
						age > 7
						house ?= prev.house
					}
					learn_court_language_of = prev
				}
			}
		}


		#Setup Global Variables
		set_global_variable = {
			name = tedjin_reactionaries_triggered
			value = no
		}
		set_global_variable = {
			name = tedjin_civil_war_over
			value = no
		}
		set_global_variable = {
			name = tedjin_civil_war_result
			value = 0 #Not yet occurred
		}

		# Return of Sauron
		if = {
			limit = {
				game_start_date > 6974.9.1
			}
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:return_of_sauron
			}
		}
		# Sauron Destroyed
		if = {
			limit = {
				game_start_date < 7054.1.1
			}
			set_global_variable = {
				name = sauron_destroyed
				value = no #He's still kicking!
			}
		}
		else = {
			set_global_variable = {
				name = sauron_destroyed
				value = yes #He gone
			}
			set_global_variable = {
				name = fourth_age_date
				value = 7055
			}
		}

		set_global_variable = {
			name = bor_saint
			value = no	#bor isnt a saint yet
		}
		set_global_variable = {
			name = active_conquerors
			value = 0	#to allow conquerors to spawn
		}

		# Achievement Setup
		character:lineukorg5 ?= {
			add_character_flag = gor_good
		}

		if = {
			limit = { game_start_date >= 7033 }
			### Remove prescripted will not marry traits on timeout ###
			character:linesteward40 = {
				trigger_event = {
					id = shattered_earth.3
					years = 21
				}
			}
			character:lineisildur42 = {
				trigger_event = {
					id = shattered_earth.3
					years = 21
				}
			}
			character:dolamroth31 = {
				trigger_event = {
					id = shattered_earth.3
					years = 21
				}
			}
			character:lineofeofor17 = {
				trigger_event = {
					id = shattered_earth.3
					years = 21
				}
			}
			character:lineofeofor18 = {
				trigger_event = {
					id = shattered_earth.3
					years = 21
				}
			}
		}

		title:c_minas_tirith.holder = {
        	trigger_event = { ### LotR Shattered Earth Game Rule Initial Event ###
				id = shattered_earth.1
				days = 1
			}
			trigger_event = { # Initial culture acceptance
				id = culture_acceptance.1
			}
        }

		title:c_minas_ithil.holder = {
        	trigger_event = { # LotR - Set up Morgul Corruption
				id = wraith.0001
				days = 1
			}
        }

		## Ensure Future Tamskas are not prematurely showing as Tamska in earlier start dates
		if = {
			limit = {
				game_start_date = 6787.1.1
			}
			character:linetamska159 = {
				remove_trait = tamska
				add_trait = tamska_heir
			}
		}

		### Cap Dynasty Perks at 5 ###

		every_dynasty = {
        	limit = {
				dynasty_prestige > 6250
			}
			add_dynasty_prestige = {
				value = dynasty_prestige
				multiply = -1
				add = 6250
			}
		}

		### Set Historical Dynasty Level of Splendor ###
		dynasty:dynasty_elros = {
			add_dynasty_prestige_level = 10
		}
		dynasty:dynasty_anarion = {
			add_dynasty_prestige_level = 10
		}
		dynasty:dynasty_elendil = {
			add_dynasty_prestige_level = 10
		}
		dynasty:dynasty_melian = {
			add_dynasty_prestige_level = 10
		}
		dynasty:dynasty_osse = {
			add_dynasty_prestige_level = 10
		}
		dynasty:dynasty_uinen = {
			add_dynasty_prestige_level = 10
		}
		dynasty:dynasty_war_saints = {
			add_dynasty_prestige_level = 10
		}
		dynasty:dynasty_serpentlord = {
			add_dynasty_prestige_level = 3
		}

		#County Modifiers LW
		if = { # 6820 TA
			#Gram Modifiers
			limit = {game_start_date = 6787.1.1 }
			title:c_baruk_zigil = {
				add_county_modifier = orc_anarchy_county_modifier
			}
			title:c_ongbishuk = {
				add_county_modifier = orc_anarchy_county_modifier
			}
			title:c_gormakh = {
				add_county_modifier = orc_anarchy_county_modifier
			}
			title:c_zargul = {
				add_county_modifier = orc_anarchy_county_modifier
			}
			#title:c_garzugul = {	#Wilderness at gamestart
			#	add_county_modifier = orc_anarchy_county_modifier
			#}
		}

		# Unity Set Up
		if = { # 3000 TA
			limit = { game_start_date = 7033.1.1 }
			## Haruzan has had a stable rule for some time but potential new ambition in family
			dynasty:dynasty_ayerikka.dynast.house ?= {
				add_unity_value = {
					value = 30
					# This is from historical circumstances, so we just do use the house head.
					character = house_head
					desc = clan_unity_historical_circumstances.desc
				}
			}
			## Chelkar stands strongly united with enemies on all sides
			dynasty:dynasty_khadnom.dynast.house ?= {
				add_unity_value = {
					value = 90
					# This is from historical circumstances, so we just do use the house head.
					character = house_head
					desc = clan_unity_historical_circumstances.desc
				}
			}
			## Pezarsan is in a state of internal strife and prey to opportunistic neighbours
			dynasty:dynasty_arzagarnom.dynast.house ?= {
				add_unity_value = {
					value = -55
					# This is from historical circumstances, so we just do use the house head.
					character = house_head
					desc = clan_unity_historical_circumstances.desc
				}
			}
			## Ray is strong and stable with little internal strife of the ruling family
			dynasty:dynasty_solarray.dynast.house ?= {
				add_unity_value = {
					value = 75
					# This is from historical circumstances, so we just do use the house head.
					character = house_head
					desc = clan_unity_historical_circumstances.desc
				}
			}
			## Ard the Silent is unshakable
			dynasty:dynasty_silent.dynast.house ?= {
				add_unity_value = {
					value = 100
					# This is from historical circumstances, so we just do use the house head.
					character = house_head
					desc = clan_unity_historical_circumstances.desc
				}
			}
			## Thorin's Tomb in Erebor
			title:c_throne_of_erebor = { add_county_modifier = thorins_tomb_modifier }
		}

		title:d_shire.holder ?= {
			if = {
				limit = {
					is_independent_ruler = no
				}
				vassal_contract_set_obligation_level = { type = title_revocation_rights level = 1 }
			}
		}
		title:c_dru_bhuta.holder ?= { ## Druedain Autonomy
			if = {
				limit = {
					is_independent_ruler = no
				}
				vassal_contract_set_obligation_level = { type = title_revocation_rights level = 1 }
				vassal_contract_set_obligation_level = { type = religious_rights level = 1 }
			}
		}


		#################################
		### Historical Confederations ###
		#################################

		### Logath Confederation ###
		if = {
			limit = {
				game_start_date >= 6690 # Kingdom fractured into loose confederation
				title:c_sadvar.holder.culture = culture:logath
			}
			title:c_sadvar.holder = {
				create_confederation = {
					name = CONFEDERATION_NAME_LOGATH
				}
				scope:new_confederation = {
					set_variable = {
						name = confederation_culture
						value = culture:logath
					}
				}
				every_independent_ruler = {
					limit = {
						is_landed = yes
						highest_held_title_tier > tier_barony
						highest_held_title_tier < tier_kingdom
						culture = culture:logath
						is_confederation_member = no
					}
					scope:new_confederation = {
						add_confederation_member = prev
					}
				}
			}
		}

		### Three Tigers Coalition ###
		if = {
			limit = {
				game_start_date >= 6700
				game_start_date <= 6900
			}
			title:c_bathiria.holder = {
				create_confederation = {
					name = CONFEDERATION_NAME_TIGERS
				}
				scope:new_confederation = {
					set_variable = {
						name = confederation_culture
						value = culture:poan
					}
					# add_confederation_member = title:d_sadhradamrun.holder
					add_confederation_member = title:d_nafar_poan.holder
					add_confederation_member = title:d_zhar_daniz.holder
				}
			}
		}

		### Kalathun Confederation ###
		if = {
			limit = {
				game_start_date >= 6700
				game_start_date <= 6900
			}
			title:c_vynusal.holder = {
				create_confederation = {
					name = CONFEDERATION_NAME_KALATHUN
				}
				scope:new_confederation = {
					set_variable = {
						name = confederation_culture
						value = culture:ayten
					}
					# add_confederation_member = title:c_rohmakhar.holder
					add_confederation_member = title:c_phandurim.holder
					add_confederation_member = title:c_velkarim.holder
				}
			}
		}

		### Estanrewas Confederation ###
		if = {
			limit = {
				game_start_date >= 5345
				game_start_date <= 5385
			}
			title:c_framsburg.holder = {
				create_confederation = {
					name = CONFEDERATION_NAME_ESTANREWAS
				}
				scope:new_confederation = {
					set_variable = {
						name = confederation_culture
						value = culture:estarewas
					}
					add_confederation_member = title:c_taurau.holder
					add_confederation_member = title:c_feorlond.holder
					add_confederation_member = title:c_langburg.holder
					add_confederation_member = title:c_mithlin_vale.holder
					add_confederation_member = title:c_marsham.holder
				}
			}
		}

		### Lynerian League ###
		if = {
			limit = {
				OR = {
					AND = {
						game_start_date >= 3000
						game_start_date <= 6730 # Codyan pupet duchy
					}
					game_start_date >= 6824
				}

			}
			title:c_lyneria.holder = {
				create_confederation = {
					name = CONFEDERATION_NAME_LYNERIA
				}
				scope:new_confederation = {
					set_variable = {
						name = confederation_culture
						value = culture:lynerian
					}
					set_variable = {
						name = lotr_can_not_elevate_confederation
						value = yes
					}
					set_variable = {
						name = lynerian_league_confederation
						value = yes
					}
				}
				every_independent_ruler = {
					limit = {
						is_landed = yes
						highest_held_title_tier > tier_barony
						highest_held_title_tier < tier_kingdom
						culture = culture:lynerian
						is_confederation_member = no
						any_held_title = {
							tier = tier_county
							OR = {
								kingdom = title:k_lyneria
								any_neighboring_county = {
									kingdom = title:k_lyneria
								}
							}
						}
					}
					scope:new_confederation = {
						add_confederation_member = prev
					}
					## Lynerian League Member Intros ##
					trigger_event = {
						id = lyneria.0001
						days = 1
					}
				}
			}
		}

		### Bellanarûd Confederation ###
		if = { #With Bellakars authority weakened, the tribes of the hinterlands have to organize themselves
			limit = {
				game_start_date >= 6955
				game_start_date <= 7056
			}
			title:c_ellin.holder = {
				create_confederation = {
					name = CONFEDERATION_NAME_BELLANARUD
				}
				scope:new_confederation = {
					set_variable = {
						name = confederation_culture
						value = culture:bellanarud
					}
					add_confederation_member = title:d_urudath.holder
					add_confederation_member = title:c_fonir.holder
					add_confederation_member = title:c_kes_tosith.holder
				}
			}
		}

		# Set Important Locations for Enter Realm Events #
		lotr_set_important_location_effect = yes

		## DWARVEN KING TITLES
		# Firing the event through Tom to make titles primary
		dwarven_bizaruldum = yes
		lotr_set_house_head_game_start = yes

		character:k_wastelands_holder = {
			trigger_event = {
				id = dwarven.9800
				days = 1
			}
		}

		clear_dwarven_kingdom_claims = { KINGDOM = title:k_durins_folk }
		clear_dwarven_kingdom_claims = { KINGDOM = title:k_uris_folk }
		clear_dwarven_kingdom_claims = { KINGDOM = title:k_dwalins_folk }
		clear_dwarven_kingdom_claims = { KINGDOM = title:k_thrars_folk }
		clear_dwarven_kingdom_claims = { KINGDOM = title:k_sindris_folk }
		clear_dwarven_kingdom_claims = { KINGDOM = title:k_thulins_folk }
		clear_dwarven_kingdom_claims = { KINGDOM = title:k_bavors_folk }
		dwarven_empire_titular_history_effect = yes

		## Giving Thror the Arkenstone
		if = {
			limit = {
				game_start_date = 6787.1.1
			}
			character:lineofdurin81 = {
				create_artifact_arkenstone_effect = { OWNER = this }
			}
		}

		### Conquerors ###
		character:lineoflavrajyatante21 ?= { # Radyani
		 	if = { # Add conqueror trait if alive and gamerule allows
		 		limit = {
		 			is_alive = yes
		 			NOT = { has_game_rule = no_conquerors_frequency }
		 		}
		 		create_story = story_conqueror
		 	}
			else_if = { # Add conqueror trait if already dead
				limit = {
					is_alive = no
					game_start_date >= 7033
				}
				add_trait = conqueror
			}
		}
		character:linemasamavin1 ?= { # Vimana
		 	if = { # Add conqueror trait if alive and gamerule allows
		 		limit = {
		 			is_alive = yes
		 			NOT = { has_game_rule = no_conquerors_frequency }
		 		}
		 		create_story = story_conqueror
		 	}
			else_if = { # Add conqueror trait if already dead
				limit = {
					is_alive = no
					game_start_date >= 6787
				}
				add_trait = conqueror
			}
		}
	}
}


# Like on_game_start, except it is called once the host (or player, in single player) exits the lobby. Good for anything where you need to know who the players are, or what the game rules are
lotr_on_game_start_after_lobby = {
    on_actions = {
		delay = { days = 1 }
		ccu_startup_debug
    }

	effect = {
		######################################
		### LOTR PROVINCE BUILDING HISTORY ###
		######################################
		## ADDS EXTRA BUILDINGS THAT DON'T WORK IN HISTORY (ONLY TWO CAN BE ADDED VIA HISTORY FILES)

		add_buildings_to_historical_provinces = yes

		every_living_character = {
			if = {
				limit = { is_dwarf = yes }
				if = { # Dwarves learn Khuzdul
					limit = { NOT = { knows_language = language_khuzdul } }
					learn_language = language_khuzdul
				}
				# Dwarven Succession
				if = {
					limit = { is_ruler = yes }
					if = {
						limit = { NOT = { has_realm_law = dwarven_succession_law } }
						add_realm_law = dwarven_succession_law
					}
				}
			}
			if = { # Noble Gondorians all know Sindarin
				limit = {
					culture = {
						has_cultural_pillar = heritage_dunedain
						NOT = { has_cultural_pillar = language_sindarin}
					}
					is_lowborn = no
					NOT = { knows_language = language_sindarin }
				}
				learn_language = language_sindarin
			}
			if = { # Removing Maia traits from non Maia characters
				limit = {
					is_maiar = no
					OR = {
						has_trait = istari
						has_trait = maiar
					}
				}
				if = {
					limit = { has_trait = istari }
					remove_trait = istari
				}
				else_if = {
					limit = { has_trait = maiar }
					remove_trait = maiar
				}
			}
		}

		### Adding Vidugavia special building during certain timeframe ###
		if = {
			limit = {
				game_start_date >= 5295.1.1
				game_start_date < 5977.1.1
			}
			province:3826 = {
				add_special_building_slot = wonder_high_hall_alcisbaurg
				add_special_building = wonder_high_hall_alcisbaurg
			}
		}

		if = {
			limit = {
				title:c_mispir.holder = {
					highest_held_title_tier < tier_kingdom
					NOT = { has_trait = balan_lai_member }
					any_held_county = {
						percent > 0.50
						title_province = { geographical_region = middleearth_thani_hazad_struggle_region }
					}
					OR = {
						any_character_struggle = {
							is_struggle_type = thani_hazad_struggle
							involvement = involved
						}
						any_character_struggle = {
							is_struggle_type = thani_hazad_struggle
							involvement = interloper
						}
					}
				}
			}
			title:c_mispir.holder = { create_story = story_mispir }
		}

		remove_kingdom_and_duchy_variables_from_empires = yes

		### GAME RULE: SAURON STRENGH - FLAMES OF UDUN BUFFS ###
		#Nazgûl - All start dates
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul1 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul2 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul7 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul4 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul5 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul6 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul3 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul8 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:nazgul9 }
		every_living_character = {
			limit = {
				has_trait = nazgul
				is_from_ruler_designer = yes
			}
			save_scope_as = nazgul
			lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = scope:nazgul }
		}
		#WotR start date
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofhuz189 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineoftharzog1 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofafalku15 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:vangarisofkhand }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofanballukkhorohin31 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofdulgu44 } #Storm Marshal
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofgoblinking1 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofazog10 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofazog6 }
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineoflavrajyatante21 } #Radyani
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:serpentlord13 } #Mardat
		#LW start date
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofazog1 } #Azog
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofafalku11a } #Hussamakkir of Harwan
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofcassimir18 } #Arunaru of Umbar
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:linefraluk2 } #Ruler of Gundabad
		lotr_grant_sauron_strength_game_rule_buff = { CHARACTER = character:lineofdulgu31 } #Storm Marshal
		#Fire conqueror story content
		sauron_strength_gamerule_buffs = yes

		### Ruler designer elves get an event to age up
		every_player = {
			if = {
				limit = {
					is_elf = yes
					is_from_ruler_designer = yes
					is_landed_or_landless_administrative = yes
				}
				trigger_event = elven_racial.0102
			}
			if = {
				limit = {
					is_elf = yes
					is_from_ruler_designer = yes
					is_landed_or_landless_administrative = no
				}
				trigger_event = elven_racial.0103
			}
			if = {
				limit = {
					is_orc = yes
					is_from_ruler_designer = yes
					is_landed_or_landless_administrative = yes
				}
				trigger_event = orcs.9951
			}
		}

		gil_galad_parentage_rule_effect = yes # Setting Gil-galad's parentage
		fire_warning_event = yes

		### Give characters with settlement holdings correct amount of upkeep
		add_settlement_upkeep_in_history = yes

		### GAME RULE: RANDOMIZE FAITH
		if = {
			limit = { has_game_rule = randomized_faiths_on }
			# game_rule_randomize_faith_effect = yes # Handled in vanilla on_game_start
			#LotR - Ensure Valinor stays unchanged
			title:c_tol_eressea = {
				set_county_faith = faith:faith_eldar
			}
			title:c_valinor_1 = {
				set_county_faith = faith:faith_eldar
			}
			title:c_valinor_2 = {
				set_county_faith = faith:faith_eldar
			}
			title:c_valinor_3 = {
				set_county_faith = faith:faith_eldar
			}
			character:k_wastelands_holder = {
				set_character_faith = faith:faith_wastelands_pagan
				every_held_title = {
					limit = { tier = tier_county }
					set_county_faith = faith:faith_wastelands_pagan
				}
			}
		}

		### Aesthetically pleasing Rhudaur game rule ###
		if = {
			limit = {
				has_game_rule = aesthetic_rhudaur
				game_start_date = 7033.1.1
			}
			title:d_dyr_maenason = {
				set_de_jure_liege_title = title:k_rhudaur
			}
		}

		### RACE SETUP ###
		every_living_character = {
			limit = {
				is_from_ruler_designer = no
				OR = {
					#not_valar = yes
					not_nazgul = yes
					not_istari = yes
					not_istari_evil = yes
					not_maiar = yes
					not_maiar_fallen = yes
				}
			}
			trigger_event = race.0001
		}

		### UPDATE DYNAMIC COA ###
		every_ruler = {
			every_held_title = {
				update_dynamic_coa = yes
			}
		}

		# Set start-date independent Realm laws
		title:e_khy.holder = { # PLACEHOLDER experimental Khyan anti-blob
			if = {
				limit = {
					is_alive = yes
					has_government = administrative_government
				}
				add_realm_law = imperial_bureaucracy_2
				add_realm_law = province_war_law_2
			}
		}

		# Laamp Setup
		lotr_laamp_setup_effect = yes

		every_player = {
			if = {
				limit = { has_trait = house_customizer }
				trigger_event = lotr_house_customizer.0001
			}
			if = {
				limit = {
					has_trait = nazgul
					is_from_ruler_designer = yes
				}
				save_scope_as = nazgul
				character:lineofsauron = {
					add_hook = {
						type = loyalty_hook
						target = scope:nazgul
					}
				}
			}
		}
	}
}
