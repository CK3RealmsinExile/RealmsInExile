# An artifact has changed ownership
# root = the artifact
# scope:owner = the person who now holds the artifact
# scope:old_owner = the person who used to hold the artifact
lotr_on_artifact_changed_owner = {
	effect = {
		save_scope_as = artifact

		if = {
			limit = {
				scope:owner = { is_ai = no }
				realms_achievements_enabled = yes
			}
			if = { # Stone-talkies | Achievement
				limit = {
					NOT = { exists = global_var:lotr_achievement_68 }
					scope:artifact = {
						OR = {
							has_variable = palantir_elostirion
							has_variable = palantir
						}
					}
					scope:owner = {
						any_character_artifact = {
							has_variable = palantir
							count >= 3
						}
						any_character_artifact = {
							has_variable = palantir_elostirion # the Elostirion stone doesn't have the Palantir variable as it's unusable
						}
					}
				}
				set_global_variable = lotr_achievement_68
			}
			if = { # That’s going in the book! | Achievement
				limit = {
					NOT = { exists = global_var:lotr_achievement_13 }
					scope:artifact = { has_variable = book_of_grudges }
					scope:owner = {
						any_character_artifact = {
							has_variable = book_of_grudges
							count >= 5
						}
					}
				}
				set_global_variable = lotr_achievement_13
			}
			if = { # I still have 8 toes left | Achievement
				limit = {
					NOT = { exists = global_var:lotr_achievement_58 }
					NOR = {
						scope:owner = { cannot_be_killed = yes }
						scope:owner = { is_elf = yes }
					}
					scope:artifact = { has_variable = ring_of_mortals }
					scope:owner = {
						any_character_artifact = {
							has_variable = ring_of_mortals
							NOT = { has_variable = ring_of_dwarves }
							count >= 8
						}
					}
				}
				set_global_variable = lotr_achievement_58
			}
			if = { # Lord of the Rings | Achievement
				limit = {
					NOT = { exists = global_var:lotr_achievement_07 }
					OR = {
						scope:artifact = { has_variable = ring_of_dwarves }
						scope:artifact = { has_variable = ring_of_mortals }
					}
					scope:owner = {
						any_character_artifact = {
							has_variable = ring_of_mortals
							NOT = { has_variable = ring_of_dwarves }
							count >= 8
						}
						any_character_artifact = {
							has_variable = ring_of_dwarves
							count >= 3
						}
					}
				}
				set_global_variable = lotr_achievement_07
			}
		}

		if = {
			limit = { 
				has_variable = ring_of_mortals
				sauron_is_alive = yes
			}
			scope:owner = { 
				trigger_event = lotr_artifact.0100 # Ring modifier switch event
				
				if = { 
					limit = { 
						cannot_be_killed = no
						NOT = { is_elf = yes }
						NOT = { is_dwarf = yes }
					}
					trigger_event = { 
						on_action = nazgul_personality # Ring madness for Human and Orc
						days = { 180 225 }
					}
				}
			}
			scope:old_owner = {
				if = {
					limit = {
						cannot_be_killed = no
						NOT = { is_elf = yes }
						NOT = { has_character_flag = doesnt_care_about_their_ring }
					}
					trigger_event = { 
						id = nazgul.0300 #My PRECIOUSSSSSS!
						days = 5
					}
				}
			}
			
			if = {
				limit = { has_variable = corrupted_ring }
				scope:owner = {
					if = { 
						limit = { is_dwarf = yes }
						trigger_event = { 
							id = lotr_artifact.0021 # Gold madness for Dwarves
							years = 5
						}
					}
				}
			}
			
			if = {
				limit = {
					has_variable = ring_of_men
				}
				if = {
					limit = {
						scope:owner = { 
							cannot_be_killed = no 
							NOT = { is_elf = yes }
						}
					}
					scope:old_owner = {
						if = {
							limit = { is_nazgul = yes }
							save_scope_as = avenging_nazgul
							set_variable = {
								name = failures
								value = 0
							}
						}
					}
					scope:owner = { #The Nazgûl starts his manhunt
						trigger_event = {
							id = nazgul.0001
							days = { 180 225 }
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				has_variable = morgul_blade
			}
			scope:owner = { #It smokes !
				trigger_event = {
					id = lotr_artifact.0001
					days = 1 
				}
			}
		}
		if = {
			limit = {
				has_variable = elven
			}
			scope:owner = { #It burns !
				trigger_event = {
					id = lotr_artifact.0002
					days = 1
				}
			}
		}
		if = {
			limit = {
				has_variable = thorins_tomb
				scope:owner = { NOT = { has_character_modifier = plundered_thorins_tomb_modifier } }
			}
			scope:owner = { #This belongs in a tomb !
				trigger_event = {
					id = lotr_artifact.0031
					days = 1 
				}
			}
		}
		if = {
			limit = {
				has_variable = heirloom_of_title
				scope:owner = var:heirloom_of_title.holder
			}
			scope:owner = {
				trigger_event = {
					id = lotr_artifact.0010
					days = 2
				}
			}
		}
	}
}