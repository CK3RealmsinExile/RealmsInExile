story_cycle_bountig_medlokan = {
	
	on_setup = {
		title:k_south_rhovanion = { # Start a war between a Ioriag duke and Rohan
			random_de_jure_county = {
				limit = {
					is_wastelands = no
					culture = { has_cultural_pillar = heritage_ioriag }
					holder = { highest_held_title_tier > tier_county }
					holder = { is_at_war = no }
				}
				alternative_limit = {
					is_wastelands = no
					culture = { has_cultural_pillar = heritage_ioriag }
					holder = { highest_held_title_tier > tier_barony }
					holder = { is_at_war = no }
				}
				alternative_limit = {
					is_wastelands = no
					culture = { has_cultural_pillar = heritage_ioriag }
					holder = { highest_held_title_tier > tier_county }
				}
				title_province = { save_scope_as = bountig_story_location }
				holder = { save_scope_as = employer }
			}
		}
		story_owner = {
			create_task_contract = {
				task_contract_type = lotr_bountig_story_eastern_rhovanion_war
				task_contract_employer = scope:employer
				location = scope:bountig_story_location
				task_contract_tier = 1
			}
		}
	}

	on_end = {
	}

	on_owner_death = { end_story = yes }

	effect_group = { # Spawns contracts
		months = { 8 12 }
		trigger = { story_owner = { has_variable = bountig_does_contract_work } }
		triggered_effect = {  #Gondor
			trigger = {
				story_owner = {
					var:bountig_does_contract_work = flag:gondor
					domicile.domicile_location.county = {
						save_temporary_scope_as = title_temp
						title:c_minas_tirith.empire = { is_de_jure_liege_or_above_target = scope:title_temp }
					}
					# Make sure we don't do this if we've got lots of contracts already spawned here.
					any_character_task_contract = {
						count <= 6
						task_contract_location = { "squared_distance(root.location)" <= squared_distance_medium }
					}
				}
			}
			effect = {
				story_owner = {
					# Spawn some contracts.
					contract_passive_spawn_effect = {
						SPAWN_CONTRACTS = 2
					}
					# And fire us again in a bit.
					trigger_event = {
						id = bountig_event_chain.4000
						months = { 8 12 }
					}
				}
			}
		}
		triggered_effect = { #Harwan
			trigger = {
				story_owner = {
					var:bountig_does_contract_work = flag:harwan
					domicile.domicile_location.county = {
						save_temporary_scope_as = title_temp
						title:c_amrun.empire = { is_de_jure_liege_or_above_target = scope:title_temp }
					}
					# Make sure we don't do this if we've got lots of contracts already spawned here.
					any_character_task_contract = {
						count <= 6
						task_contract_location = { "squared_distance(root.location)" <= squared_distance_medium }
					}
				}
			}
			effect = {
				story_owner = {
					# Spawn some contracts.
					contract_passive_spawn_effect = {
						SPAWN_CONTRACTS = 2
					}
					# And fire us again in a bit.
					trigger_event = {
						id = bountig_event_chain.4000
						months = { 8 12 }
					}
				}
			}
		}
		triggered_effect = { #Umbar
			trigger = {
				story_owner = {
					var:bountig_does_contract_work = flag:umbar
					domicile.domicile_location.county = {
						save_temporary_scope_as = title_temp
						title:c_umbar.empire = { is_de_jure_liege_or_above_target = scope:title_temp }
					}
					# Make sure we don't do this if we've got lots of contracts already spawned here.
					any_character_task_contract = {
						count <= 6
						task_contract_location = { "squared_distance(root.location)" <= squared_distance_medium }
					}
				}
			}
			effect = {
				story_owner = {
					# Spawn some contracts.
					contract_passive_spawn_effect = {
						SPAWN_CONTRACTS = 2
					}
					# And fire us again in a bit.
					trigger_event = {
						id = bountig_event_chain.4000
						months = { 8 12 }
					}
				}
			}
		}
	}

	effect_group = { # Give appropriate XP 
		months = 6
		trigger = { story_owner = { has_variable = bountig_does_contract_work } }
		triggered_effect = {  #Gondor
			trigger = {
				story_owner = {
					var:bountig_does_contract_work = flag:gondor
					domicile.domicile_location.county = {
						save_temporary_scope_as = title_temp
						title:c_minas_tirith.empire = { is_de_jure_liege_or_above_target = scope:title_temp }
					}
				}
			}
			effect = {
				story_owner = {
					save_scope_as = bountig
					send_interface_message = {
						type = event_generic_good_with_text
						title = bountig_gains_xp_in_special_trait.t
						desc = bountig_gains_xp_in_special_trait.desc

						show_as_tooltip = {
							add_trait_xp = {
								trait = bountig_story_trait
								track = gondor_cities
								value = 7
							}
						}
					}
					set_variable = {
						name = bountig_does_contract_work
						value = flag:gondor
					}
				}
			}
		}
		triggered_effect = { #Harwan
			trigger = {
				story_owner = {
					var:bountig_does_contract_work = flag:harwan
					domicile.domicile_location.county = {
						save_temporary_scope_as = title_temp
						title:c_amrun.empire = { is_de_jure_liege_or_above_target = scope:title_temp }
					}
				}
			}
			effect = {
				story_owner = {
					save_scope_as = bountig
					send_interface_message = {
						type = event_generic_good_with_text
						title = bountig_gains_xp_in_special_trait.t
						desc = bountig_gains_xp_in_special_trait.desc

						show_as_tooltip = {
							add_trait_xp = {
								trait = bountig_story_trait
								track = haruzan_cities
								value = 7
							}
						}
					}
					set_variable = {
						name = bountig_does_contract_work
						value = flag:harwan
					}
				}
			}
		}
		triggered_effect = { #Umbar
			trigger = {
				story_owner = {
					var:bountig_does_contract_work = flag:umbar
					domicile.domicile_location.county = {
						save_temporary_scope_as = title_temp
						title:c_umbar.empire = { is_de_jure_liege_or_above_target = scope:title_temp }
					}
				}
			}
			effect = {
				story_owner = {
					save_scope_as = bountig
					send_interface_message = {
						type = event_generic_good_with_text
						title = bountig_gains_xp_in_special_trait.t
						desc = bountig_gains_xp_in_special_trait.desc

						show_as_tooltip = {
							add_trait_xp = {
								trait = bountig_story_trait
								track = umbar_cities
								value = 7
							}
						}
					}
					set_variable = {
						name = bountig_does_contract_work
						value = flag:umbar
					}
				}
			}
		}
	}

	effect_group = {
		days = 1
		trigger = {
			NOT = { story_owner.var:bountig_does_contract_work = flag:none }
			OR = {
				story_owner = { #Gondor
					has_variable = bountig_does_contract_work
					var:bountig_does_contract_work = flag:gondor
					NOT = { location.empire = title:c_minas_tirith.empire }
				}
				story_owner = { #Harwan
					has_variable = bountig_does_contract_work
					var:bountig_does_contract_work = flag:harwan
					NOT = { location.empire = title:c_amrun.empire }
				}
				story_owner = { #Umbar
					has_variable = bountig_does_contract_work
					var:bountig_does_contract_work = flag:umbar
					NOT = { location.empire = title:c_umbar.empire }
				}
			}
		}
		triggered_effect = {
			effect = {
				set_variable = {
					name = bountig_does_contract_work
					value = flag:none
				}
			}
		}
	}
}
