balrog_struggle = {
	##################################################
	# Setup
	##################################################
	cultures = {
		longbeards
		hallroamer_goblin
		fangstealer_goblin
		gloomdrinker_goblin
		shroombrewer_goblin
		bellbreaker_goblin
		clawscorcher_goblin
	}
	faiths = {
		faith_khazad
		faith_balrog_cult
		way_of_strength
	}
	regions = {
		middleearth_misty_mountains_khazad_dum # LotR Dummy
	}

	involvement_prerequisite_percentage = 0.01 # If you're here in Moria, it's an issue for you...

	on_start = { #TODO
		# Start the over-time catalysts.
		# trigger_event = neutral_struggle.0001
		# Tell the AI to change sides every now and then.
		# trigger_event = {
		# 	id = balrog_struggle.0001
		# 	years = { 1 5 }
		# }
	}

	transition_state_duration = { months = 3 }

	on_change_phase = {
		# If relevant, gather data on when we changed phase.
		# if = {
		# 	limit = { gather_debug_variables_for_persian_struggle_trigger = yes }
		# 	# Are we switching out of the Concession phase?
		# 	if = {
		# 		limit = { is_struggle_phase = struggle_persia_phase_stabilisation }
		# 		increment_global_variable_effect = {
		# 			VAL = 1
		# 			VAR = sp_phase_stabil
		# 		}
		# 	}
		# 	# Are we switching out of the Unrest phase?
		# 	else_if = {
		# 		limit = { is_struggle_phase = struggle_persia_phase_unrest }
		# 		increment_global_variable_effect = {
		# 			VAL = 1
		# 			VAR = sp_phase_unrest
		# 		}
		# 	}
		# }
	}
	
	# Root = the character which has joined the struggle
 	on_join = {
		# if = {
		# 	limit = {
		# 		NOR = {
		# 			has_trait = fp3_struggle_supporter
		# 			has_trait = fp3_struggle_detractor
		# 			# culture = { has_cultural_pillar = heritage_turkic } # LotR
		# 			fp3_character_involved_in_struggle_trigger = no
		# 		}
		# 		trigger_if = {
		# 			limit = {
		# 				NOR = {
		# 					has_trait = zealous
		# 					has_trait = humble
		# 					has_trait = loyal
		# 					ai_zeal >= 75
		# 				}
		# 			}
		# 			NOR = {
		# 				has_trait = cynical
		# 				has_trait = arrogant
		# 				has_trait = vengeful
		# 				has_trait = ambitious
		# 			}
		# 		}
		# 		# OR = { # LotR
		# 		# 	fp3_struggle_is_the_caliph = yes
		# 		# 	AND = {
		# 		# 		liege = {
		# 		# 			fp3_struggle_is_the_caliph = yes
		# 		# 		}
		# 		# 		opinion = {
		# 		# 			target = title:d_sunni.holder
		# 		# 			value >= low_positive_opinion
		# 		# 		}
		# 		# 	}
		# 		# 	AND = {
		# 		# 		faith = { has_doctrine = muhammad_succession_sunni_doctrine }
		# 		# 		exists = title:d_sunni.holder
		# 		# 		opinion = {
		# 		# 			target = title:d_sunni.holder
		# 		# 			value >= medium_negative_opinion
		# 		# 		}
		# 		# 	}
		# 		# }

		# 	}
		# 	add_trait = fp3_struggle_supporter
		# }
		# else_if = {
		# 	limit = {
		# 		NOR = {
		# 			has_trait = fp3_struggle_supporter
		# 			has_trait = fp3_struggle_detractor
		# 		}
		# 	}
		# 	add_trait = fp3_struggle_detractor
		# }

		# if = {
		# 	limit = { is_ai = no }
		# 	trigger_event = fp3_struggle.0051
		# }
 	}

	##################################################
	# Phases
	##################################################
	start_phase = struggle_balrog_phase_slumbering
	
	phase_list = {

		struggle_balrog_phase_slumbering = {
			duration = { points = 5000 }

			future_phases = {
				struggle_balrog_phase_armageddon = {
					catalysts = {
						catalyst_passing_of_time = minimal_struggle_catalyst_over_time_gain
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME
			}

			ending_decisions = {
				struggle_balrog_ending_kill_balrog
				struggle_balrog_ending_serve_balrog
			}
		}

		struggle_balrog_phase_dormant = {
			duration = { points = 500 }

			future_phases = {
				struggle_balrog_phase_wandering = {
					catalysts = {
						catalyst_passing_of_time = minimal_struggle_catalyst_over_time_gain
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME
			}

			ending_decisions = {
				struggle_balrog_ending_kill_balrog
				struggle_balrog_ending_serve_balrog
			}
		}

		struggle_balrog_phase_wandering = {
			duration = { points = 500 }

			future_phases = {
				struggle_balrog_phase_dormant = {
					catalysts = {
						catalyst_passing_of_time = minimal_struggle_catalyst_over_time_gain
					}
				}

				struggle_balrog_phase_active = {
					catalysts = {
						catalyst_passing_of_time = minimal_struggle_catalyst_over_time_gain
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME
			}

			ending_decisions = {
				struggle_balrog_ending_kill_balrog
				struggle_balrog_ending_serve_balrog
			}
		}

		struggle_balrog_phase_active = {
			duration = { points = 500 }

			future_phases = {
				struggle_balrog_phase_wandering = {
					catalysts = {
						catalyst_passing_of_time = minimal_struggle_catalyst_over_time_gain
					}
				}

				struggle_balrog_phase_armageddon = {
					catalysts = {
						catalyst_passing_of_time = minimal_struggle_catalyst_over_time_gain
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME
			}

			ending_decisions = {
				struggle_balrog_ending_kill_balrog
				struggle_balrog_ending_serve_balrog
			}
		}

		struggle_balrog_phase_armageddon = {
			duration = { points = 500 }

			future_phases = {
				struggle_balrog_phase_wandering = {
					catalysts = {
						catalyst_passing_of_time = minimal_struggle_catalyst_over_time_gain
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME
			}

			ending_decisions = {
				struggle_balrog_ending_kill_balrog
				struggle_balrog_ending_serve_balrog
			}
		}
	}
}
