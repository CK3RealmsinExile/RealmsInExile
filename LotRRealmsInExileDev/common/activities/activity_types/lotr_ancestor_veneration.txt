# Ancestor Veneration activity

activity_ancestor_veneration = {

	is_shown = { # Dwarves have access to Ancestor Veneration
		is_playable_character = yes
		is_dwarf = yes
		lotr_is_shown_basic_activity_trigger = yes # LOTR
	}
	
	can_start_showing_failures_only = {
		is_available_adult = yes
	}
	
	is_valid = {
		scope:host = {
			is_alive = yes
			is_capable_adult = yes
			is_imprisoned = no
			is_playable_character = yes
			NOT = { is_incapable = yes }
		}
	}
	
	on_host_death = {
		every_attending_character = {
			limit = { is_alive = yes }
			trigger_event = {
				id = ancestor_veneration.0063
				days = 1 # So you don't get spammed
			}
		}
		# Code sends your entourage home on invalidated
		scope:activity.var:host_var = {
			# Saving the title for loc
			primary_title = { save_scope_as = host_title }
			# Inform your heir if you have one
			player_heir ?= {
				trigger_event = {
					id = ancestor_veneration.0070
					days = 1
				}
			}
		}
	}
	
	on_invalidated = {
		if = {
			limit = {
				scope:host = { is_imprisoned = yes }
			}
			#Host has been imprisoned
			every_attending_character = {
				limit = {
					NOT = { this  = scope:host }
				}
				trigger_event = ancestor_veneration.0065
			}
			scope:host = { 
				trigger_event = ancestor_veneration.0064
			}
		}
		if = {
			limit = {
				scope:host = { is_incapable = yes }
			}
			scope:activity = {
				activity_type = { save_scope_as = activity_type }
			}
			scope:host = {
				trigger_event = activity_system.0330
			}
			every_attending_character = {
				limit = { NOT = { this = scope:host } }
				trigger_event = activity_system.0331
			}
		}
		# Host becomes unlanded
		if = {
			limit = {
				scope:host = { is_landed = no }
			}
			scope:activity = {
				activity_type = { save_scope_as = activity_type }
			}
			every_attending_character = {
				trigger_event = activity_system.0320
			}
		}
	}
	
	## Defining appropriate locations
	
	is_location_valid = {
		has_holding = yes
		has_holding_type = dwarven_holding
		
		#Check that the province is in the list
		trigger_if = {
			limit = {
				county.holder ?= { is_dwarf = yes }
				scope:host = { 
					faith_is_good = yes
					in_diplomatic_range = root.county.holder
				}
			}
			
			custom_tooltip = {
				text = activity_ancestor_veneration.is_location_valid.not_in_list
				OR = {
					province_owner.top_liege ?= scope:host.top_liege
					province_owner ?= { 
						is_contact_of = scope:host
						is_dwarf = yes
					}
					AND = {
						scope:host = { is_dwarf = yes }
					}
				}
			}
			custom_tooltip = {
				text = activity_ancestor_veneration.is_location_valid.wrong_holder_faith
				province_owner.top_liege = { faith_is_evil = no }
			}
		}
		trigger_else = {
			always = no
		}

		# If you are supposed to be the realm's reserve ruler, then you can't take a foreign trip.
		trigger_if = {
			limit = {
				scope:host = { bannable_serving_diarch_trigger = yes }
				NOT = { scope:host.capital_province = root }
			}
			custom_tooltip = {
				text = activity_pilgrimage.serving_diarch
				county.holder = {
					any_liege_or_above = { this = scope:host.liege }
				}
			}
		}
	}
	
	host_description = {
		desc = activity_ancestor_veneration_host_desc
		first_valid = {
			triggered_desc = {
				trigger = { has_trait = lifestyle_archivist }
				desc = activity_ancestor_veneration_host_desc_trait_xp
			}
			desc = activity_ancestor_veneration_host_desc_trait
		}
		triggered_desc = {
			trigger = {
				has_dlc_feature = accolades
			}
			desc = activity_hunt_guest_desc_accolade
		}
		triggered_desc = {
			trigger = {
				has_dlc_feature = legends
				is_landed = yes
				NOT = { employs_court_position = chronicler_court_position }
			}
			desc = activity_ancestor_veneration_host_desc_chronicler
		}
		triggered_desc = {
			trigger = {
				NOR = { 
					employs_court_position = antiquarian_court_position 
					has_dlc_feature = legends
					is_landed = no
				}
			}
			desc = activity_ancestor_veneration_host_desc_antiquarian
		}
	}

	guest_description = {
		first_valid = {
			triggered_desc = {
				trigger = { has_trait = lifestyle_archivist }
				desc = activity_ancestor_veneration_host_desc_trait_xp
			}
			desc = activity_ancestor_veneration_host_desc_trait
		}
		desc = activity_hunt_guest_desc_accolade
	}
	
	conclusion_description = {
		desc = ancestor_veneration.conclusion.desc
	}
	
	###################
	# PARAMETERS
	###################

	is_single_location = yes

	province_filter = all
	ai_province_filter = top_realm

	max_route_deviation_mult = 2.0

	
	province_description = {
		desc = activity_ancestor_veneration_province_desc
		# +++ / triple plus good
		triggered_desc = {
			trigger = { 
				# Mazalabkân
				has_building = wonder_mazalabkan
			}
			desc = activity_ancestor_veneration_province_desc_wonder_mazalabkan
		}
		triggered_desc = {
			trigger = { 
				# Gundabad
				has_building = wonder_gundabad_02
			}
			desc = activity_ancestor_veneration_province_desc_wonder_gundabad_02
		}
		triggered_desc = {
			trigger = { 
				# Mirrormere
				has_building = wonder_mirrormere
			}
			desc = activity_ancestor_veneration_province_desc_wonder_mirrormere
		}
		triggered_desc = {
			trigger = { 
				# Throne of Durin
				has_building = wonder_durin_throne
			}
			desc = activity_ancestor_veneration_province_desc_wonder_durin_throne
		}
		triggered_desc = {
			trigger = { 
				# Dwarven Hoard level 1
				has_building = dwarven_hoard_01
			}
			desc = activity_ancestor_veneration_province_desc_dwarven_hoard_01
		}
		triggered_desc = {
			trigger = { 
				# Dwarven Hoard level 2
				has_building = dwarven_hoard_02
			}
			desc = activity_ancestor_veneration_province_desc_dwarven_hoard_02
		}
		triggered_desc = {
			trigger = { 
				# Dwarven Hoard level 3
				has_building = dwarven_hoard_03
			}
			desc = activity_ancestor_veneration_province_desc_dwarven_hoard_03
		}
		triggered_desc = {
			trigger = { 
				# Dwarven Hoard level 4
				has_building = dwarven_hoard_04
			}
			desc = activity_ancestor_veneration_province_desc_dwarven_hoard_04
		}
		triggered_desc = {
			trigger = { 
				# Dwarven Hoard level 5
				has_building = dwarven_hoard_05
			}
			desc = activity_ancestor_veneration_province_desc_dwarven_hoard_05
		}
		triggered_desc = {
			trigger = { 
				# Nogrod
				has_building = wonder_nogrod_reborn
			}
			desc = activity_ancestor_veneration_province_desc_wonder_nogrod_reborn
		}
		triggered_desc = {
			trigger = { 
				# Belegost
				has_building = wonder_belegost_reborn
			}
			desc = activity_ancestor_veneration_province_desc_wonder_belegost_reborn
		}
		triggered_desc = {
			trigger = { 
				# Zelemabkân
				has_building = wonder_zelemabkan
			}
			desc = activity_ancestor_veneration_province_desc_wonder_zelemabkan
		}
		triggered_desc = {
			trigger = { 
				# Azan-zâram
				has_building = wonder_azan_zaram_02
			}
			desc = activity_ancestor_veneration_province_desc_wonder_azan_zaram_02
		}
		triggered_desc = {
			trigger = { 
				# Narâgathol
				has_building = wonder_nar_agathol_3
			}
			desc = activity_ancestor_veneration_province_desc_wonder_nar_agathol_3
		}
		

		# ++ / double plus good
		triggered_desc = {
			trigger = { 
				# Gundabad
				has_building = wonder_gundabad_01
			}
			desc = activity_ancestor_veneration_province_desc_wonder_gundabad_01
		}
		triggered_desc = {
			trigger = { 
				# Endless Stairs
				has_building = wonder_endless_stairs
			}
			desc = activity_ancestor_veneration_province_desc_wonder_endless_stairs
		}
		triggered_desc = {
			trigger = { 
				# Nogrod
				has_building = wonder_nogrod_rebuilt
			}
			desc = activity_ancestor_veneration_province_desc_wonder_nogrod_rebuilt
		}
		triggered_desc = {
			trigger = { 
				# Belegost
				has_building = wonder_belegost_rebuilt
			}
			desc = activity_ancestor_veneration_province_desc_wonder_belegost_rebuilt
		}
		triggered_desc = {
			trigger = { 
				# Sunset Caverns
				has_building = wonder_sunset_caverns
			}
			desc = activity_ancestor_veneration_province_desc_wonder_sunset_caverns
		}
		triggered_desc = {
			trigger = { 
				# Troves of Linar
				has_building = wonder_linars_troves
			}
			desc = activity_ancestor_veneration_province_desc_wonder_linars_troves
		}
		triggered_desc = {
			trigger = { 
				# Azan-zâram
				has_building = wonder_azan_zaram_01
			}
			desc = activity_ancestor_veneration_province_desc_wonder_azan_zaram_01
		}
		triggered_desc = {
			trigger = { 
				# Narâgathol
				has_building = wonder_nar_agathol_2
			}
			desc = activity_ancestor_veneration_province_desc_wonder_nar_agathol_2
		}
		

		# + / plus good
		triggered_desc = {
			trigger = { 
				# Nogrod
				has_building = wonder_nogrod_broken
			}
			desc = activity_ancestor_veneration_province_desc_wonder_nogrod_broken
		}
		triggered_desc = {
			trigger = { 
				# Belegost
				has_building = wonder_belegost_broken
			}
			desc = activity_ancestor_veneration_province_desc_wonder_belegost_broken
		}
		triggered_desc = {
			trigger = { 
				# Narâgathol
				has_building = wonder_nar_agathol
			}
			desc = activity_ancestor_veneration_province_desc_wonder_nar_agathol
		}

		# Dwarven Ritual Significance
		triggered_desc = {
			trigger = {
				dwarven_ritual_significance_trigger = yes
			}
			desc = activity_ancestor_veneration_province_desc_ritual_significance
		}
		triggered_desc = {
			trigger = {
				dwarven_ritual_significance_trigger = no
			}
			desc = activity_ancestor_veneration_province_desc_realm
		}
	}
	
	max_province_icons = 10
	
	province_score = {
		value = 0
		# BUILDINGS
		# Triple good / +++
		if = {
			limit = { has_building = wonder_mazalabkan }
			add = 150
		}
		if = {
			limit = { has_building = wonder_gundabad_02 }
			add = 150
		}
		if = {
			limit = { has_building = wonder_mirrormere }
			add = 150
		}
		if = {
			limit = { has_building = wonder_durin_throne }
			add = 150
		}
		if = {
			limit = { has_building_or_higher = dwarven_hoard_01 }
			add = 150
		}
		if = {
			limit = { has_building = wonder_nogrod_reborn }
			add = 150
		}
		if = {
			limit = { has_building = wonder_belegost_reborn }
			add = 150
		}
		if = {
			limit = { has_building = wonder_zelemabkan }
			add = 150
		}
		if = {
			limit = { has_building = wonder_azan_zaram_02 }
			add = 150
		}
		if = {
			limit = { has_building = wonder_nar_agathol_3 }
			add = 150
		}


		# Double good / ++
		if = {
			limit = { has_building = wonder_gundabad_01 }
			add = 100
		}
		if = {
			limit = { has_building = wonder_endless_stairs }
			add = 100
		}
		if = {
			limit = { has_building = wonder_nogrod_rebuilt }
			add = 100
		}
		if = {
			limit = { has_building = wonder_belegost_rebuilt }
			add = 100
		}
		if = {
			limit = { has_building = wonder_sunset_caverns }
			add = 100
		}
		if = {
			limit = { has_building = wonder_linars_troves }
			add = 100
		}
		if = {
			limit = { has_building = wonder_azan_zaram_01 }
			add = 100
		}
		if = {
			limit = { has_building = wonder_nar_agathol_2 }
			add = 100
		}
		
		
		# Good / +
		if = {
			limit = { has_building = wonder_nogrod_broken }
			add = 25
		}
		if = {
			limit = { has_building = wonder_belegost_broken }
			add = 25
		}
		if = {
			limit = { has_building = wonder_nar_agathol }
			add = 25
		}
	}
	
	cooldown = { years = standard_ancestor_veneration_cooldown_time } #10 years
	
	# desc is only shown in debug AI watch window
	ai_will_do = {
		add = {
			value = 30
			desc = "Base"
		}
		add = {
            value = ai_greed
            multiply = -0.25
            desc = "ai_greed"
        }
        add = {
        	value = ai_sociability
        	multiply = -0.25
        	desc = "ai_sociability"
        }
		if = {
			limit = {
				ai_energy < 0
			}
			add = {
				add = ai_energy
				desc = "ai_energy"
			}
		}
		if = {
			limit = { has_trait = gregarious }
			add = {
				value = -10
				desc = "Is Gregarious"
			}
		}
		if = {
			limit = { has_trait = shy }
			add = {
				value = 30
				desc = "Is Shy"
			}
		}
		if = {
			limit = { has_trait = reclusive }
			add = {
				value = 30
				desc = "Is Reclusive"
			}
		}
		if = {
			limit = {
				short_term_gold >= ancestor_veneration_activity_base_cost
				short_term_gold >= major_gold_value
			}
			add = {
				value = 30
				desc = "Got gold to burn"
			}
		}
		if = {
			limit = { has_trait = lifestyle_archivist }
			add = {
				value = 20
				desc = "Is Archivist"
			}
		}
		if = {
			limit = {
				has_royal_court = yes 
				has_court_type = court_scholarly
				}
			add = {
				value = 10
				desc = "Learning court trait"
			}
		}
		if = {
			limit = { has_trait = diligent }
			add = {
				value = 30
				desc = "Is Diligent"
			}
		}
		if = {
			limit = { has_trait = lazy }
			add = {
				value = -30
				desc = "Is Lazy"
			}
		}
		if = {
			limit = { has_trait = journaller }
			add = {
				value = 30
				desc = "Is Journaller"
			}
		}
		if = {
			limit = { has_trait = calm }
			add = {
				value = 10
				desc = "Is Calm"
			}
		}
		if = {
			limit = { has_trait = patient }
			add = {
				value = 10
				desc = "Is Patient"
			}
		}
		if = {
			limit = { has_trait = impatient }
			add = {
				value = -10
				desc = "Is Impatient"
			}
		}
		if = {
			limit = { has_trait = scholar }
			add = {
				value = 30
				desc = "Is Scholar"
			}
		}
		# Stress
		if = { # Low Stress
            limit = {
				stress >= lower_than_baseline_stress
				NOT = { has_trait = impatient }
			}
            add = {
            	value = 10
            	desc = "lower_than_baseline_stress"
            }
        }
        if = { # High Stress
        	limit = {
				stress >= higher_than_baseline_stress
				NOT = { has_trait = impatient }
			}
        	add = {
        		value = 10
        		desc = "higher_than_baseline_stress"
        	}
        }
        if = { # Very High Stress
        	limit = {
				stress >= high_stress
				NOT = { has_trait = impatient }
			}
        	add = {
        		value = 10
        		desc = "high_stress"
        	}
        }
        if = {
        	limit = { ai_has_warlike_personality = yes }
        	add = {
            	value = -30
            	desc = "Warlike"
            }
        }
        # Economic Archetype
		if = { # Too busy booming the economy
            limit = {
                OR = {
                    ai_has_economical_boom_personality = yes
                    has_character_flag = ai_boom
                }
            }
            add = {
            	value = -200
            	desc = "Builder"
            }
        }
	}
	
	###################
	# GUEST HANDLING
	###################
	
	allow_zero_guest_invites = yes

	max_guests = 10
	
	guest_invite_rules = {
		rules = {
			# Misc landless.
			5 = activity_invite_rule_knights

			# MP 
			6 = activity_invite_mp
		}
		defaults = {
			1 = activity_invite_rule_scholars
			1 = activity_invite_rule_confederates
			2 = activity_invite_rule_close_family
			2 = activity_invite_spouses
		}
	}

	can_be_activity_guest = {
		is_healthy = yes
		is_dwarf = yes
		in_diplomatic_range = scope:host
		lotr_can_be_activity_guest = yes
	}

	host_intents = {
		intents = { reduce_stress_intent }
		default = reduce_stress_intent
	}

	guest_intents = {
		intents = { reduce_stress_intent }
		default = reduce_stress_intent
	}
	
	travel_entourage_selection = {
		weight = standard_travel_entourage_additions
		max = 10
		invite_rule_order = 1
	}
	
	###################
	# COSTS
	###################
	
	cost = {
		gold = {
			add = {
				add = {
					value = ancestor_veneration_activity_base_cost #Base level
					desc = ancestor_veneration_base_cost
				}
				add = {
					value = ancestor_veneration_activity_base_cost
					multiply = activity_cost_scale_by_era
					subtract = ancestor_veneration_activity_base_cost
					desc = activity_cost_scale_by_era_desc
				}
				if = {
					limit = {
						dynasty ?= {
							has_dynasty_perk = lotr_khazad_legacy_1
						}
					}
					subtract = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = law_legacy_cost_reduction_mult
						desc = lotr_khazad_legacy_1_name
					}
				}
				#Maximum cost reduction
				if = {
					limit = {
						scope:province ?= { has_building = wonder_mazalabkan }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_mazalabkan
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_gundabad_02 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_gundabad_02
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_mirrormere }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_mirromere
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_durin_throne }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_durin_throne
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building_or_higher = dwarven_hoard_01 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_dwarven_hoard_01
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building_or_higher = dwarven_hoard_02 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_dwarven_hoard_02
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building_or_higher = dwarven_hoard_03 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_dwarven_hoard_03
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building_or_higher = dwarven_hoard_04 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_dwarven_hoard_04
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building_or_higher = dwarven_hoard_05 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_dwarven_hoard_05
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_nogrod_reborn }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_nogrod_reborn
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_belegost_reborn }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_belegost_reborn
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_zelemabkan }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_zelemabkan
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_azan_zaram_02 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_azan_zaram_02
					}
				}
				if = {
					limit = {
						scope:province ?= { has_building = wonder_nar_agathol_3 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_max_value
						desc = ancestor_veneration_cost_discount_wonder_nar_agathol_3
					}
				}


				#Medium cost reduction
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_gundabad_01 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_gundabad_01
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_endless_stairs }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_endless_stairs
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_nogrod_rebuilt }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_nogrod_rebuilt
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_belegost_rebuilt }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_belegost_rebuilt
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_sunset_caverns }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_sunset_caverns
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_linars_troves }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_linars_troves
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_azan_zaram_01 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_azan_zaram_01
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_nar_agathol_2 }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_medium_value
						desc = ancestor_veneration_cost_discount_wonder_nar_agathol_2
					}
				}


				#Minimal cost reduction
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_nogrod_broken }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_min_value
						desc = ancestor_veneration_cost_discount_nogrod_broken
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_belegost_broken }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_min_value
						desc = ancestor_veneration_cost_discount_belegost_broken
					}
				}
				if = {
					limit = { 
						scope:province ?= { has_building = wonder_nar_agathol }
					}
					add = {
						value = 0
						add = {
							value = ancestor_veneration_activity_base_cost
							add = {
								value = ancestor_veneration_activity_base_cost
								multiply = activity_cost_scale_by_era
								subtract = ancestor_veneration_activity_base_cost
							}
						}
						multiply = ancestor_veneration_activity_cost_discount_min_value
						desc = ancestor_veneration_cost_discount_nar_agathol
					}
				}
				if = { # Reduces cost by 25%
					limit = { has_perk = archive_frequenter_perk }
					multiply = 0.75
				}
			}
		}
	}

	ui_predicted_cost = {
		# All costs are balanced on County/Early Era starting point
		gold = {
			add = { # Base cost, scaled by era
				value = ancestor_veneration_activity_base_cost
				multiply = activity_cost_scale_by_era
			}
			
			# Options 
			add = { # Scholars
				value = 0 # No Scholars Cost 
				add = 25 # Few Scholars Cost 
				add = 50 # Many Scholars Cost 
				# Scale option costs by tier and era
				multiply = activity_cost_scale_by_tier
				multiply = activity_cost_scale_by_era
				# Divide by the number of option levels to get an average option cost
				divide = 3
			}
			add = { # Funding
				value = 0 # Basic Funding Cost
				add = 50 # Extra Funding Cost
				# Scale option costs by tier and era
				multiply = activity_cost_scale_by_tier
				multiply = activity_cost_scale_by_era
				# Divide by the number of option levels to get an average option cost
				divide = 2
			}
			
			save_temporary_value_as = pre_discount_ancestor_veneration_cost_ui
			if = {
				limit = {
					dynasty ?= {
						has_dynasty_perk = lotr_khazad_legacy_1
					}
				}
				subtract = {
					value = scope:pre_discount_ancestor_veneration_cost_ui
					multiply = law_legacy_cost_reduction_mult
				}
			}
			
			# Make it a multiple of 5 (rounded up)
			divide = 5
			ceiling = yes
			multiply = 5
			
		}
	}
	
	###################
	# OPTIONS
	###################

	special_option_category = special_type

	options = {
		special_type = {
			ancestor_veneration_type_standard = {
				default = yes
				is_valid = {
					faith_is_good = yes
				}
			}
		}
		ancestor_veneration_scholars = {
			ancestor_veneration_no_scholars = {
				ai_will_do = {
					value = 0
					add = { #Base amount
						value = 30
					}
					if = {
						limit = {
							has_trait = greedy
						}
						add = 30
					}
					if = {
						limit = {
							OR = {
								has_trait = lazy
								has_trait = temperate
								has_trait = content
							}
						}
						add = 15
					}
					if = {
						limit = {
							has_trait = humble
						}
						add = 10
					}
					if = {
						limit = {
							gold <= major_gold_value
						}
						add = 100
					}
				}
			}
			ancestor_veneration_few_scholars = {
				default = yes
				travel_entourage_selection = {
					weight = ancestor_veneration_entourage_weight_value
					max = 5
					invite_rule_order = 1
				}

				on_start = {
					scope:host = {
						add_prestige = minor_prestige_gain
					}
				}
				is_valid = {
					custom_tooltip = {
						text = more_than_5_courtiers
						any_courtier_or_guest = { count > 5 }
					}
				}

				ai_will_do = {
					value = 50
				}

				cost = {
					gold = {
						add = {
							add = {
								value = 25
								desc = ancestor_veneration_few_scholars
							}
							add = {
								value = 25
								multiply = activity_cost_scale_by_era
								subtract = 25
								desc = activity_cost_scale_by_era_desc
							}
						}
					}
				}
			}
			ancestor_veneration_many_scholars = {
				is_valid = {
					custom_tooltip = {
						text = more_than_10_courtiers
						any_courtier_or_guest = { count > 10 }
					}
				}

				travel_entourage_selection = {
					weight = ancestor_veneration_entourage_weight_value
					max = 10
					invite_rule_order = 1
				}

				on_start = {
					scope:host = {
						add_prestige = medium_prestige_gain
					}
				}

				ai_will_do = {
					value = 0
					add = { #Base amount
						value = 30
					}
					if = {
						limit = {
							has_trait = generous
						}
						add = 30
					}
					if = {
						limit = {
							OR = {
								has_trait = diligent
								has_trait = gluttonous
								has_trait = ambitious
							}
						}
						add = 15
					}
					if = {
						limit = {
							has_trait = arrogant
						}
						add = 10
					}
				}

				cost = {
					gold = {	
						add = {
							add = {
								value = 50
								desc = ancestor_veneration_many_scholars
							}
							add = {
								value = 50
								multiply = activity_cost_scale_by_era
								subtract = 50
								desc = activity_cost_scale_by_era_desc
							}
							# Some people get one free.
							if = {
								limit = { factor_zero_if_entitled_to_freebie_activity_trigger = yes }
								multiply = 0
							}
						}
					}
				}
			}
		}
		ancestor_veneration_funding = {
			ancestor_veneration_basic_funding = {

				ai_will_do = {
					value = 0
					add = { #Base amount
						value = 30
					}
					if = {
						limit = {
							has_trait = greedy
						}
						add = 30
					}
					if = {
						limit = {
							OR = {
								has_trait = lazy
								has_trait = temperate
								has_trait = content
							}
						}
						add = 15
					}
					if = {
						limit = {
							has_trait = humble
						}
						add = 10
					}
					if = {
						limit = {
							gold <= major_gold_value
						}
						add = 100
					}
				}
			}
			ancestor_veneration_extra_funding = {
				default = yes
				cost = {
					gold = {
						add = {
							add = {
								value = 50
								desc = ancestor_veneration_extra_funding
							}
							add = {
								value = 50
								multiply = activity_cost_scale_by_era
								subtract = 50
								desc = activity_cost_scale_by_era_desc
							}
							# Some people get one free.
							if = {
								limit = { factor_zero_if_entitled_to_freebie_activity_trigger = yes }
								multiply = 0
							}
						}
					}
				}

				ai_will_do = {
					value = 0
					add = { #Base amount
						value = 30
					}
					if = {
						limit = {
							has_trait = generous
						}
						add = 30
					}
					if = {
						limit = {
							OR = {
								has_trait = diligent
								has_trait = scholar
								has_trait = ambitious
							}
						}
						add = 15
					}
					if = {
						limit = {
							has_trait = arrogant
						}
						add = 10
					}
				}
			}
		}
	}
	
	###################
	# PHASES
	###################

	max_guest_arrival_delay_time = { months = 3 }

	phases = {

		ancestor_veneration_phase_reading = {
			is_predefined = yes

			order = 1

			is_shown = {
				always = yes
			}

			on_phase_active = {
				# Fires the conclusion events for every attendee, and advance to next phase, with a delay
				if = {
					limit = {
						this = scope:host
						scope:activity = {
							AND = {
								has_activity_option = {
									category = special_type 
									option = ancestor_veneration_type_standard
								}
								has_activity_option = {
									category = ancestor_veneration_funding
									option = ancestor_veneration_extra_funding
								}
							}
						}
					}
					scope:activity = { progress_activity_phase_after = { weeks = 24 } }
				}
				else_if = {
					limit = { this = scope:host }
					scope:activity = { progress_activity_phase_after = { weeks = 12 } }
				}
				# Venerate the Ancestors
				scope:host = { 
					trigger_event = {
						id = ancestor_veneration.0001 
						days = 1
					}
				}
			}

			# on_weekly_pulse = {
			# 	# Fires for every attendee	
			# 	trigger_event = { on_action = ancestor_veneration_ongoing_event_pulse }
			# }			

			ai_will_do = {
				value = 100
			}
		}
	}

	ai_check_interval = 60
	
	###################
	# ACTIVITY-SPECIFIC PULSES
	###################

	pulse_actions = {
		entries = { guest_friendship guest_insulted impressed_zealot_vassal host_gains_learning_xp guest_impressed_by_court_artifact antiquarian_admires_artifact apa_overcome_with_emotion apa_sight_seeing_group apa_studying_scripture ancestor_veneration_scholar_protection spouse_skill_learning_improves host_gains_diplo_xp ancestor_veneration_host_shushes_knight }
		chance_of_no_event = 3
	}

	allow_zero_guest_invites = yes

	on_enter_passive_state = {
		scope:activity = {
			if = {
				limit = {
					NOT = { has_variable = progressed_to_active }
					# Everyone who accepted is here
					any_attending_character = {
						count = all
						location = scope:activity.activity_location
					}
					# There are no open invitations
					any_invited_character = {
						count = 0
					}
				}
				set_variable = progressed_to_active
				scope:activity = { progress_activity_phase_after = { days = 1 } }
			}
		}
		trigger_event = ancestor_veneration.0040
		if = {
			limit = {
				this = scope:host
				has_dlc_feature = legends
				NOT = { employs_court_position = chronicler_court_position }
				involved_activity = {
					any_attending_character = {
						location = root.location
						save_temporary_scope_as = potential_chronicler
						
					}
				}
				can_appoint_char_to_court_position = { CHAR = scope:potential_chronicler COURT_POS = chronicler_court_position }
			}
			trigger_event = {
				id = ancestor_veneration.0042
				days = 2
			}
		}
		else_if = {
			limit = {
				this = scope:host
				NOT = { has_dlc_feature = legends }
				NOT = { employs_court_position = antiquarian_court_position }
				involved_activity = {
					any_attending_character = {
						location = root.location
						save_temporary_scope_as = potential_antiquarian
						
					}
				}
				can_appoint_char_to_court_position = { CHAR = scope:potential_antiquarian COURT_POS = antiquarian_court_position }
			}
			trigger_event = {
				id = ancestor_veneration.0043
				days = 2
			}
		}
	}
	
	on_enter_active_state = {
		if = {
			limit = { this = scope:host }
			trigger_event = { id = ancestor_veneration.0071 }
		}
	}

	on_complete = {
		scope:activity.activity_location = {
			if = {
				limit = { exists = var:recent_ancestor_veneration_held }
				save_scope_value_as = {
					name = recent_ancestor_veneration_held_count
					value = var:recent_ancestor_veneration_held
				}
				set_variable = {
					name = recent_ancestor_veneration_held
					value = {
						value = scope:recent_ancestor_veneration_held_count
						add = 1
					}
					years = 10
				}
			}
			else = {
				set_variable = {
					name = recent_ancestor_veneration_held
					value = 1
					years = 10
				}
			}
		}
	}
	
	###################
	# GRAPHICS
	###################

	map_entity = {
		trigger = {
			activity_location.culture = {
				OR = {
					has_graphical_mena_culture_group_trigger = yes
					has_graphical_steppe_culture_group_trigger = yes
					has_graphical_african_culture_group_trigger = yes
				}
			}
		}
		reference = "building_mena_feast_01_entity"
	}

	map_entity = {
		trigger = {
			activity_location.culture = {
				has_graphical_india_culture_group_trigger = yes
			}
		}
		reference = "building_indian_feast_01_entity"
	}
	
	map_entity = "building_western_feast_01_entity"
	
	# Travel
	background = { # Bridge
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				is_riverside_province = yes
				geographical_region = middleearth_west
				OR = {
					terrain = farmlands
					terrain = plains
					terrain = mountains
					terrain = hills
				}
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_travel_bridge.dds"
		environment = "environment_travel_bridge"
		ambience = "event:/SFX/Events/Backgrounds/mountains_day"
	}
	
	background = { # Farmland, settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				terrain = farmlands
				exists = province_owner
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_travel_farm.dds"
		environment = "environment_travel_farmlands"
		ambience = "event:/SFX/Events/Backgrounds/fields_farms_day"
	}
	background = { # Farmland, unsettled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				terrain = farmlands
				NOT = { exists = province_owner }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/farms.dds"
		environment = "environment_event_farms"
		ambience = "event:/SFX/Events/Backgrounds/fields_farms_day"
	}

	background = { #Desert, settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_desert_trigger = yes
				exists = province_owner
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_travel_desert.dds"
		environment = "environment_travel_desert"
		ambience = "event:/SFX/Events/Backgrounds/desert_day"
	}
	background = { #LotR Rhûn desert
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_desert_rhun_trigger = yes
				exists = province_owner
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/rhun.dds"
		environment = "environment_event_desert"
		ambience = "event:/SFX/Events/Backgrounds/desert_day"
	}
	background = { #Desert, unsettled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_desert_trigger = yes
				NOT = { exists = province_owner }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/desert.dds"
		environment = "environment_event_bp1_desert"
		ambience = "event:/SFX/Events/Backgrounds/desert_day"
	}

	background = { #forest snowy
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location ?= { hunt_snowy_forest_trigger = yes }
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_hunt_snowy_forest.dds"
		environment = "environment_hunt_snowy_forest"
		ambience = "event:/SFX/Events/Backgrounds/mountains_day"
	}

	background = { #forest_pine
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_forest_pine_trigger = yes
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/forest_pine.dds"
		environment = "environment_event_forest_pine"
		ambience = "event:/SFX/Events/Backgrounds/coniferous_forest_day"
	}

	background = { #forest
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_forest_trigger = yes
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/forest.dds"
		environment = "environment_event_forest"
		ambience = "event:/SFX/Events/Backgrounds/deciduous_forest_day"
	}
	
	background = { #LotR forest deep
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = { graphical_wilderness_forest_deep_trigger = yes } 
		}
		texture = "gfx/interface/illustrations/event_scenes/forest_deep.dds"
		environment = "environment_event_forest"
		ambience = "event:/SFX/Events/Backgrounds/deciduous_forest_day"
	}

	background = { #LotR forest_mallorn unsettled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = { 
				graphical_wilderness_forest_mallorn_trigger = yes
				NOT = { exists = province_owner }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/forest_mallorn.dds"
		environment = "environment_event_forest"
		ambience = "event:/SFX/Events/Backgrounds/deciduous_forest_day"
	}
	background = { #LotR forest_mallorn settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = { 
				graphical_wilderness_forest_mallorn_trigger = yes
				exists = province_owner
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/lorien_day.dds"
		environment = "environment_event_forest"
		ambience = "event:/SFX/Events/Backgrounds/deciduous_forest_day"
	}

	background = { #mountains, settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_mountains_trigger = yes
				exists = province_owner
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_travel_mountains.dds"
		environment = "environment_travel_mountain_settlement"
		ambience = "event:/SFX/Events/Backgrounds/mountains_day"
	}
	background = { #mountains, dwarven settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_mountains_trigger = yes
				exists = province_owner
				NOT = { is_dwarf = yes }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/market_dwarven.dds"
		environment = "environment_travel_mountain_settlement"
		ambience = "event:/SFX/Events/Backgrounds/mountains_day"
	}
	background = { #mountains, unsettled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_mountains_trigger = yes
				NOT = { exists = province_owner }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/mountains.dds"
		environment = "environment_event_mountains"
		ambience = "event:/SFX/Events/Backgrounds/mountains_day"
	}

	background = { #steppe, settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_steppe_trigger = yes
				exists = province_owner
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_travel_steppe.dds"
		environment = "environment_travel_steppe_settlement"
		ambience = "event:/SFX/Events/Backgrounds/steppe_day"
	}
	background = { #steppe, unsettled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_steppe_trigger = yes
				NOT = { exists = province_owner }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/steppe.dds"
		environment = "environment_event_steppe"
		ambience = "event:/SFX/Events/Backgrounds/steppe_day"
	}

	background = { #drylands (formerly desert)
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_drylands_trigger = yes
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/drylands.dds"
		environment = "environment_event_desert"
		ambience = "event:/SFX/Events/Backgrounds/desert_day"
	}

	background = { #wetlands
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_wetlands_trigger = yes
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/bp1_wetlands.dds"
		environment = "environment_event_bp1_wetlands" 
		ambience = "event:/SFX/Events/Backgrounds/deciduous_forest_day"
	}

	background = { #jungle
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_wilderness_jungle_trigger = yes
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/bp1_jungle.dds"
		environment = "environment_event_bp1_jungle"
		ambience = "event:/SFX/Events/Backgrounds/deciduous_forest_day"
	}

	background = { #plains, settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_plains_trigger = yes
				exists = province_owner
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_travel_hills.dds"
		environment = "environment_travel_hills_settlement"
		ambience = "event:/SFX/Events/Backgrounds/fields_farms_day"
	}
	background = { #plains, unsettled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_plains_trigger = yes
				NOT = { exists = province_owner }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/bp1_plains.dds"
		environment = "environment_event_bp1_plains"
		ambience = "event:/SFX/Events/Backgrounds/fields_farms_day"
	}

	background = { #hills, settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_hills_trigger = yes
				exists = province_owner
				NOT = { is_dwarf = yes }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/ep2_travel_hills.dds"
		environment = "environment_travel_hills_settlement"
		ambience = "event:/SFX/Events/Backgrounds/fields_farms_day"
	}
	background = { #hills, dwarven settled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_hills_trigger = yes
				exists = province_owner
				is_dwarf = yes
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/market_dwarven.dds"
		environment = "environment_travel_mountain_settlement"
		ambience = "event:/SFX/Events/Backgrounds/mountains_day"
	}
	background = { #hills, unsettled
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				graphical_hills_trigger = yes
				NOT = { exists = province_owner }
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/bp1_hills.dds"
		environment = "environment_event_bp1_hills"
		ambience = "event:/SFX/Events/Backgrounds/fields_farms_day"
	}

	background = { #sea
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = {
				is_sea_province = yes
			}
		}
		texture = "gfx/interface/illustrations/event_scenes/fp1_ocean.dds"
		environment = "environment_event_fp1_ocean"
		ambience = "event:/DLC/FP1/SFX/Events/event_ocean_longship"
	}
	
	background = { #LotR volcanic_plains
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = { graphical_wilderness_volcanic_trigger = yes } 
		}
		texture = "gfx/interface/illustrations/event_scenes/volcanic_plains.dds"
		environment = "environment_event_feast" 
		ambience = "event:/SFX/Events/Backgrounds/burning_building"
	}

	background = { #LotR underground
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = { graphical_underground_caverns_trigger = yes } 
		}
		texture = "gfx/interface/illustrations/event_scenes/halls.dds"
		environment = "environment_event_alley"
		ambience = "event:/SFX/Events/Backgrounds/city_alley_night"
	}

	background = { #LotR saltflats
		trigger = {
			NOT = { scope:host.location = scope:activity.activity_location }
			scope:host.location = { graphical_wilderness_saltflats_trigger = yes } 
		}
		texture = "gfx/interface/illustrations/event_scenes/saltflats.dds"
		environment = "environment_event_bp1_desert"
		ambience = "event:/SFX/Events/Backgrounds/desert_day"
	}
	
	# End Travel
	#Unique sites
	background = {	#Study
		texture = "gfx/interface/illustrations/event_scenes/market_dwarven.dds"
		environment = "environment_event_study"
		ambience = "event:/SFX/Events/Backgrounds/office_workplace"
	}
	
	window_characters = {
		
		guest = {
			camera = camera_body
			
			effect = {
				if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						scope:player ?= {
							NOR = {
								this = scope:host
								AND = {
									exists = scope:host.court_position:chronicler_court_position
									this = scope:host.court_position:chronicler_court_position
								}
								AND = {
									exists = scope:host.cp:councillor_court_chaplain
									this = scope:host.cp:councillor_court_chaplain
								}
								AND = {
									exists = scope:host.court_position:antiquarian_court_position
									this = scope:host.court_position:antiquarian_court_position
								}
							}
						}
					}
					scope:player ?= { add_to_list = characters }
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							OR = {
								has_relation_lover = scope:host
								has_relation_friend = scope:host
							}
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							OR = {
								has_relation_lover = scope:host
								has_relation_friend = scope:host
							}
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							is_councillor_of = scope:host
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							is_councillor_of = scope:host
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_duchy
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_duchy
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_county
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_county
						}
						add_to_list = characters
					}
				}
				else = {
					if = {
						limit = {
							scope:host.location = scope:activity.activity_location
						}
						every_attending_character = {
							limit = {
								location = scope:activity.activity_location
								NOR = {
									this = scope:host
									has_court_position = chronicler_court_position
									has_court_position = antiquarian_court_position
								}
							}
							add_to_list = characters
						}
					}
				}
			}
			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character = {
							NOR = {
								this = scope:host
								has_court_position = chronicler_court_position
								has_council_position = councillor_court_chaplain
								has_court_position = antiquarian_court_position
							}
						}
					}
					animation = { idle happiness laugh admiration bored page_flipping personality_rational personality_cynical }
				}
				#Fallback
				animation = page_flipping
			}
		}

		guest = {
			camera = camera_body
			
			effect = {
				if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						scope:player ?= {
							NOR = {
								this = scope:host
								AND = {
									exists = scope:host.court_position:chronicler_court_position
									this = scope:host.court_position:chronicler_court_position
								}
								AND = {
									exists = scope:host.cp:councillor_court_chaplain
									this = scope:host.cp:councillor_court_chaplain
								}
								AND = {
									exists = scope:host.court_position:antiquarian_court_position
									this = scope:host.court_position:antiquarian_court_position
								}
							}
						}
					}
					scope:player ?= { add_to_list = characters }
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							OR = {
								has_relation_lover = scope:host
								has_relation_friend = scope:host
							}
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							OR = {
								has_relation_lover = scope:host
								has_relation_friend = scope:host
							}
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							is_councillor_of = scope:host
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							is_councillor_of = scope:host
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_duchy
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_duchy
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_county
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_county
						}
						add_to_list = characters
					}
				}
				else = {
					if = {
						limit = {
							scope:host.location = scope:activity.activity_location
						}
						every_attending_character = {
							limit = {
								location = scope:activity.activity_location
								NOR = {
									this = scope:host
									has_court_position = chronicler_court_position
									has_court_position = antiquarian_court_position
								}
							}
							add_to_list = characters
						}
					}
				}
			}
			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character = {
							NOR = {
								this = scope:host
								has_court_position = chronicler_court_position
								has_council_position = councillor_court_chaplain
								has_court_position = antiquarian_court_position
							}
						}
					}
					animation = { idle happiness laugh admiration bored page_flipping personality_rational personality_cynical }
				}
				#Fallback
				animation = personality_cynical
			}
		}

		guest = {
			camera = camera_body
			
			effect = {
				if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						scope:player ?= {
							NOR = {
								this = scope:host
								AND = {
									exists = scope:host.court_position:chronicler_court_position
									this = scope:host.court_position:chronicler_court_position
								}
								AND = {
									exists = scope:host.cp:councillor_court_chaplain
									this = scope:host.cp:councillor_court_chaplain
								}
								AND = {
									exists = scope:host.court_position:antiquarian_court_position
									this = scope:host.court_position:antiquarian_court_position
								}
							}
						}
					}
					scope:player ?= { add_to_list = characters }
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							OR = {
								has_relation_lover = scope:host
								has_relation_friend = scope:host
							}
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							OR = {
								has_relation_lover = scope:host
								has_relation_friend = scope:host
							}
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							is_councillor_of = scope:host
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							is_councillor_of = scope:host
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_duchy
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_duchy
						}
						add_to_list = characters
					}
				}
				else_if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_county
						}
					}
					every_attending_character = {
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
							highest_held_title_tier >= tier_county
						}
						add_to_list = characters
					}
				}
				else = {
					if = {
						limit = {
							scope:host.location = scope:activity.activity_location
						}
						every_attending_character = {
							limit = {
								location = scope:activity.activity_location
								NOR = {
									this = scope:host
									has_court_position = chronicler_court_position
									has_court_position = antiquarian_court_position
								}
							}
							add_to_list = characters
						}
					}
				}
			}
			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character = {
							NOR = {
								this = scope:host
								has_court_position = chronicler_court_position
								has_council_position = councillor_court_chaplain
								has_court_position = antiquarian_court_position
							}
						}
					}
					animation = { idle happiness laugh admiration bored page_flipping personality_rational personality_cynical }
				}
				#Fallback
				animation = bored
			}
		}
		
		host = {
			camera = camera_body
			
			effect = {
				if = {
					limit = {
						scope:host.location = scope:activity.activity_location
					}
					scope:host = {
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character = {
							OR = {
								has_court_position = chronicler_court_position
								has_council_position = councillor_court_chaplain
								has_court_position = antiquarian_court_position
							}
						}
					}
					animation = { chancellor }
				}
				#Fallback
				animation = chancellor
			}
		}
		
		travel_host = {
			camera = camera_body
			
			effect = {
				if = {
					limit = {
						NOT = {
							scope:host.location = scope:activity.activity_location
						}
					}
					scope:host = {
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character.location = { is_sea_province = yes }
					}
					animation = { idle }
				}
				triggered_animation = {
					trigger = { scope:character = { has_trait = impatient } }
					animation = { jockey_gallop }
				}
				animation = jockey_walk
			}
		}
		
		chronicler = {
			camera = camera_body
			
			effect = {
				scope:host.court_position:chronicler_court_position ?= {
					if = {
						limit = {
							scope:host.location = scope:activity.activity_location
							is_participant_in_activity = scope:activity
							location = scope:activity.activity_location
						}
						add_to_list = characters
					}
				}
			}
			scripted_animation = {
				animation = throne_room_writer
			}
		}
		
		antiquarian = {
			camera = camera_body
			
			effect = {
				scope:host.court_position:antiquarian_court_position ?= {
					if = {
						limit = {
							scope:host.location = scope:activity.activity_location
							is_participant_in_activity = scope:activity
							location = scope:activity.activity_location
						}
						add_to_list = characters
					}
				}
			}
			scripted_animation = {
				animation = throne_room_writer
			}
		}
		
		court_chaplain = {
			camera = camera_body
			
			effect = {
				scope:host.cp:councillor_court_chaplain ?= {
					if = {
						limit = {
							scope:host.location = scope:activity.activity_location
							is_participant_in_activity = scope:activity
							location = scope:activity.activity_location
						}
						add_to_list = characters
					}
				}
			}
			scripted_animation = {
				animation = chaplain
			}
		}					
	}
}
