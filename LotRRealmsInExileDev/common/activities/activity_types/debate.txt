activity_debate = {
	is_shown = {
		has_tgp_dlc_trigger = yes
		government_has_flag = government_has_merit
		any_character_situation = {
			situation_type = dynastic_cycle
		}
		#title:h_china.holder ?= { 
		#	this = root.top_liege
		#	this != root
		#	government_has_flag = government_has_merit
		#}
		trigger_if = {
			limit = { is_ai = yes }
			NOT = { exists = global_var:has_ai_debate_cooldown }
		}
	}
	
	can_start_showing_failures_only = {
		NOT = { is_activity_type_on_cooldown = activity_debate }
		is_at_war = no
		is_available_adult = yes
		any_character_situation = {
			situation_type = dynastic_cycle
			NOT = { situation_current_phase = situation_dynastic_cycle_phase_chaos }
		}
		# You are part of the Undecided Movement
		NOT = {
			top_participant_group:dynastic_cycle ?= { participant_group_type = undecided_movement }
		}
	}

	# Require that you belong to a movement to plan activity.
	can_always_plan = no

	is_valid = {
		# Debate target dying will invalidate
		trigger_if = {
			limit = {
				exists = scope:activity.special_guest:movement_leader
			}
			scope:activity.special_guest:movement_leader = {
				is_alive = yes
			}
		}
		scope:host = {
			is_physically_able = yes
		}
		# If no one shows up
		trigger_if = {
			limit = { is_current_phase_active = yes }
			has_attending_activity_guests = yes
		}
	}

	on_invalidated = {
		activity_type = { save_scope_as = activity_type }
		if = { # No one shows up
			limit = {
				has_attending_activity_guests = no
			}
			activity_location = { save_scope_as = location }
			scope:host = { trigger_event = activity_system.0100 }
		}
		if = {
			limit = {
				scope:activity.special_guest:movement_leader ?= { is_alive = no }
			}
			activity_location = { save_scope_as = location }
			scope:host = { trigger_event = debate_event.1100 }
		}
	}

	on_host_death = {
		# Make the player heir the new host
		if = {
			limit = { exists = scope:host.player_heir }
			scope:host.player_heir = { save_scope_as = new_host }
		}
		# Otherwise pass to any successor
		else = {
			scope:host.primary_heir = { save_scope_as = new_host }
		}
		set_activity_host = scope:new_host
		scope:new_host = {
			trigger_event = { id = activity_system.0080 days = 1 }
		}
	}

	province_description = {
		triggered_desc = {
			trigger = { this = scope:host.capital_province }
			desc = activity_chariot_race_province_capital
		}
		# + / plus good
		#triggered_desc = { # LotR
		#	trigger = { has_building_or_higher = kaifeng_palace_01 }
		#	desc = activity_imperial_examination_province_kaifeng_palace_desc
		#}
		triggered_desc = {
			trigger = {
				this = scope:host.top_participant_group:dynastic_cycle.var:movement_leader.capital_province
			}
			desc = activity_debate_province_desc_leader_capital_desc
		}
		triggered_desc = {
			trigger = {
				scope:host = {
					any_liege_or_above = {
						this != scope:host.top_liege
						capital_province = root
					}
				}
			}
			desc = activity_debate_province_desc_liege_capital_desc
		}
	}

	# desc is only shown in debug AI watch window
	ai_will_do = {
		value = 0
		add = {
			value = 20
			desc = "Base"
		}
		add = {
			value = ai_greed
			multiply = -0.25
			desc = "ai_greed"
		}
		add = {
			value = ai_sociability
			multiply = 0.75
			desc = "ai_sociability"
		}
		## Personality
		if = { # Is a bad confucian
			limit = {
				# Being diligent or ambitious should cancel out the effects of being lazy
				NOR = {
					has_trait = ambitious
					has_trait = diligent
				}
				has_trait = lazy
			}
			add = {
				value = -20
				desc = lazy
			}
		}
		if = { # Is a bad confucian
			limit = { has_trait = greedy }
			add = {
				value = -20
				desc = greedy
			}
		}
		if = { # Likes to socialize
			limit = { has_trait = gregarious }
			add = {
				value = 10
				desc = gregarious
			}
		}
		else_if = { # Does not like to socialize
			limit = { has_trait = shy }
			add = {
				value = -15
				desc = shy
			}
		}
		if = { # Really does not like socializing
			limit = { has_trait = reclusive }
			add = {
				value = -25
				desc = reclusive
			}
		}
		if = { # Is a good confucian
			limit = { has_trait = compassionate }
			add = {
				value = 10
				desc = compassionate
			}
		}
		if = { # Is a good confucian
			limit = { has_trait = just }
			add = {
				value = 10
				desc = just
			}
		}
		if = { # Is a good confucian
			limit = { has_trait = honest }
			add = {	
				value = 10
				desc = honest
			}
		}
		if = { # Is a confucian scholar
			limit = { has_trait = confucian_education }
			add = {
				value = 25
				desc = confucian_education
			}
		}
		if = {
			limit = {
				OR = {
					has_trait = scholarly_court_1
					has_trait = scholarly_court_2
				}
			}
			add = {
				value = 25
				desc = trait_scholarly_court_2
			}
		}
		if = {
			limit = { is_any_movement_leader = no }
			add = {
				value = 25
				desc = not_movement_leader
			}
		}

		#Religion
		#if = { # LotR
		#	limit = {	
		#		has_religion = religion:confucianism_religion
		#	}
		#	add = {
		#		value = 25
		#		desc = confucianism_religion
		#	}
		#}

		# Plague
		if = {
			limit = {
				any_held_title = {
					tier = tier_county
			   		any_county_province = {
			   			any_province_epidemic = {
			   				count >= 1
			   				outbreak_intensity < apocalyptic
			   			}
					}
				}
				would_follow_social_distancing_value >= -1
			}
			add = {
				value = -60
				desc = "Plague in Domain"
			}
		}
		else_if = {
			limit = {
				any_realm_county = {
			 		any_county_province = {
			 			any_province_epidemic = {
			 				count >= 1
			 				outbreak_intensity < apocalyptic
			 			}
			 		}
			 	}
			 	would_follow_social_distancing_value >= -1
			}
			add = {
				value = -20
				desc = "Plague in Top Realm"
			}
		}
		if = {
			limit = {
				any_held_title = {
					tier = tier_county
			 		any_county_province = {
			 			any_province_epidemic = {
							count >= 1
							outbreak_intensity = apocalyptic
			 			}
					}
				}
			}
			add = {
				value = -200
				desc = "Apocalyptic Plague in Domain"
			}
		}
		else_if = {
			limit = {
				any_held_title = {
					tier = tier_county
			 		any_county_province = {
			 			any_province_epidemic = {
							count >= 1
							outbreak_intensity = apocalyptic
			 			}
			 		}
				}
			}
			add = {
				value = -40
				desc = "Apocalyptic Plague in Top Realm"
			}
		}
		if = {
			limit = {
				short_term_gold >= debate_predicted_cost
			}
			add = {
				value = 30
				desc = "Got money to burn"
			}
		}
	}

	ai_check_interval_by_tier = {
		barony = 0
		county = 72
		duchy = 60
		kingdom = 60
		empire = 100
		hegemony = 0
	}

	ai_will_select_province = {
		# Base
		add = {
			value = 5
			desc = "base"
		}
		# Buildings
		#if = { # LotR
		#	limit = {
		#		has_building_or_higher = kaifeng_palace_01
		#	}
		#	add = {
		#		value = 1
		#		desc = activity_imperial_examination_province_kaifeng_palace_desc
		#	}
		#}
	}

	###################
	# PARAMETERS
	###################

	is_single_location = yes

	cooldown = { years = 5 }

	max_province_icons = 5

	max_route_deviation_mult = 3.0
	province_filter = top_realm
	ai_province_filter = domicile_domain

	is_location_valid = {
		custom_tooltip = {
			text = debate_location_validity_desc
			OR = {
				this = scope:host.capital_province
				this = scope:host.top_participant_group:dynastic_cycle.var:movement_leader.capital_province
				scope:host = {
					any_liege_or_above = {
						capital_province = root
					}
				}
			}
		}
	}

	province_score = {
		value = 0
		if = {
			limit = {
				this = scope:host.capital_province
			}
			add = 15
		}
		if = {
			limit = {
				scope:special_option = flag:debate_type_leadership
				exists = scope:host.top_participant_group:dynastic_cycle
				this = scope:host.top_participant_group:dynastic_cycle.var:movement_leader.capital_province
			}
			add = 5
		}
		if = {
			limit = {
				scope:host = {
					any_liege_or_above = {
						this != scope:host.top_liege
						capital_province = root
					}
				}
			}
			value = 5
		}
		#if = { # LotR
		#	limit = {
		#		has_building_or_higher = kaifeng_palace_01
		#	}
		#	value = 10
		#}
	}
	
	cost = {
		gold = {
			add = {
				add = {
					value = debate_activity_base_cost
					desc = debate_base_cost
					min = 50
				}
				# if = { # Lotr
					# limit = {
						# root.capital_province ?= { has_building_or_higher = kaifeng_palace_01 }
					# }
					# multiply = {
						# value = {
							# value = 1
							# subtract = kaifeng_examination_cost_value
						# }
						# desc = kaifeng_palace_name_desc
					# }
				# }
				# tgp_dynastic_cycle_events.0050
				if = {
					limit = {
						has_variable = tgp_debate_discount_var
					}
					multiply = {
						value = 0.75
						desc = tgp_debate_discount_var_desc
					}
				}
			}
		}
	}
	# Used to show a rough minimum or expected cost at all to plan this
	ui_predicted_cost = {
		gold = {
			add = debate_predicted_cost
			min = 50
		}
	}

	conclusion_description = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = debate_type_leadership
						}
					}
					this = scope:activity.var:debate_winner
				}
				desc = activity_debate_conclusion_desc_leadership_winner
			}
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = debate_type_leadership
						}
					}
					this = scope:activity.var:debate_loser
				}
				desc = activity_debate_conclusion_desc_leadership_loser
			}
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = debate_type_favor
						}
					}
					this = scope:activity.var:debate_winner
				}
				desc = activity_debate_conclusion_desc_favor_winner
			}
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = debate_type_favor
						}
					}
					this = scope:activity.var:debate_loser
				}
				desc = activity_debate_conclusion_desc_favor_loser
			}
			desc = debate_conclusion_fallback
		}
	}

	###################
	# OPTIONS
	###################

	options = {
		#What type of debate is this?
		special_type = {
			debate_type_leadership = {
				is_valid = {
					custom_tooltip = {
						text = is_already_a_movement_leader
						is_any_movement_leader = no
					}
					top_participant_group:dynastic_cycle.var:movement_leader = { is_available = yes }
				}
				ai_will_do = {
					value = 100
					# Do we have more movement power than the current leader? 
					if = {
						limit = {
							var:movement_power >= top_participant_group:dynastic_cycle.var:movement_leader.var:movement_power
						}
						add = 50
					}
					# Do we care about our personal prestige over that of the collective?
					if = {
						limit = {
							OR = {
								has_trait = ambitious
								has_trait = brave
								has_trait = greedy
								has_trait = zealous
								has_trait = arbitrary
								has_trait = stubborn
							}
							
						}
						add = 25
					}
					# Prestige lvl
					if = {
						limit = {
							prestige > high_prestige_level
						}
						add = 15
					}
					# Influence lvl
					if = {
						limit = {
							influence_level > high_influence_level
						}
						add = 25
					}
					# Do we think it is _our_ time?
					if = {
						limit = {
							age > 70
						}
						add = 25
					}
					if = {
						limit = {
							age > 50
						}
						add = 15
					}
					# Are we not allowed at the grown up table?
					if = {
						limit = {
							NOT = { has_character_flag = passed_metropolitan_exam }
						}
						subtract = 50
					}
				}
			}
			debate_type_favor = {
				is_valid = {
					custom_tooltip = {
						text = is_already_the_favored_movement
						exists = top_participant_group:dynastic_cycle
						situation:dynastic_cycle ?= {
							any_participant_group = {
								exists = var:movement_favored
								NOT = { participant_group_has_character = root }
							}
						}
					}
				}
				ai_will_do = {
					value = 100
					# You are already the leader of a movement
					if = {
						limit = { is_any_movement_leader = yes }
						add = 25
					}
				}
			}
		}

		# Choose the quality of research materials you've brought with you - affects success chance.
		debate_option_books = {
			debate_books_bad = {
				cost = {
					gold = {
						add = {
							desc = debate_books_bad
							subtract = {
								value = minor_gold_value_static_max
								desc = debate_books_bad
							}
							subtract = {
								value = minor_gold_value_static_max
								multiply = activity_cost_scale_by_era
								subtract = minor_gold_value_static_max
								desc = activity_cost_scale_by_era_desc 
							}
						}
					}
				}

				ai_will_do = {
					value = 100
					if = {
						limit = { has_trait = lazy }
						add = 50
					}
					if = {
						limit = { has_trait = greedy }
						add = 100
					}
					if = {
						limit = { has_trait = fickle }
						add = 25
					}
					if = {
						limit = { has_trait = impatient }
						add = 25
					}
					if = {
						limit = { has_trait = gregarious }
						add = 50
					}
					if = {
						limit = { has_trait = humble }
						add = 25
					}
				}
			}

			debate_books_normal = {
				default = yes

				cost = {
					gold = {
						add = {
							desc = debate_books_normal
							add = {
								value = medium_gold_value_static_max
								desc = debate_books_normal
								min = 50
							}
							add = {
								value = medium_gold_value_static_max
								multiply = activity_cost_scale_by_era
								subtract = medium_gold_value_static_max
								desc = activity_cost_scale_by_era_desc 
							}
						}
					}
				}

				ai_will_do = {
					# Default to this.
					value = 100
				}
			}

			debate_books_good = {
				cost = {
					gold = {
						add = {
							desc = debate_books_good
							add = {
								value = major_gold_value_static_max
								desc = adult_education_books_good
								min = 100
							}
							add = {
								value = major_gold_value_static_max
								multiply = activity_cost_scale_by_era
								subtract = major_gold_value_static_max
								desc = activity_cost_scale_by_era_desc 
							}
						}
					}
				}


				ai_will_do = {
					value = 0
					if = {
						limit = { has_trait = diligent }
						add = 50
					}
					if = {
						limit = { has_trait = generous }
						add = 50
					}
					if = {
						limit = { has_trait = stubborn }
						add = 25
					}
					if = {
						limit = { has_trait = patient }
						add = 25
					}
					if = {
						limit = { has_trait = shy }
						add = 50
					}
					if = {
						limit = { has_trait = arrogant }
						add = 50
					}
				}
			}
		}
	}

	special_option_category = special_type

	###################
	# PHASES
	###################

	phases = {
		# Discussion
		debate_phase_discussion = {
			order = 1
			is_predefined = yes

			on_phase_active = {
				if = {
					limit = { this = scope:host }
					set_debate_target_effect = yes
					trigger_event = { on_action = debate_prep_opening_on_action }
				}
				scope:activity = {
					progress_activity_phase_after = { months = 1 }
					every_attending_character = {
						set_variable = {
							name = tgp_debate_success_score
							value = tgp_debate_success_score_value
						}
					}
				}
			}

			on_weekly_pulse = {
				trigger_event = { on_action = debate_discussion_events }
			}
		}

		debate_phase_debate = {
			order = 2
			is_predefined = yes

			on_enter_phase = {
				scope:activity = { 
					progress_activity_phase_after = { days = 1 } 
				}		
			}

			on_phase_active = {
				scope:activity = { progress_activity_phase_after = { months = 1 } }
				if = {
					limit = { this = scope:host }
					trigger_event = { on_action = debate_opening_on_action }
				}
			}

			on_weekly_pulse = {
				trigger_event = { on_action = debate_events }
			}

			on_end = {
				scope:activity = {
					# Rewards for AI characters (not debating).
					every_attending_character = {
						if = {
							limit = {
								is_ai = yes
								NOR = {
									this = scope:activity.var:debate_contender
									this = scope:activity.var:challenged_movement_leader
									top_participant_group:dynastic_cycle ?= { participant_group_type = undecided_movement }
								}
							}
							debate_disburse_activity_ai_guest_rewards = yes
						}
					}
				}
				if = {
					limit = { this = scope:host }
					debate_disburse_activity_host_rewards = yes
				}
				if = {
					limit = {
						NOT = { this = scope:host }
						is_ai = no
					}
					debate_disburse_activity_guest_rewards = yes
				}
				if = {
					limit = {
						this != scope:host
						this != scope:activity.var:challenged_movement_leader
					}
					trigger_event = debate_event.5130
				}
				scope:activity = {
					every_attending_character = {
						debate_cleanup_effect = yes
					}
				}
			}
		}
	}

	###################
	# GUEST HANDLING
	###################

	open_invite = yes
	
	max_guests = { 
		value = 100
	}
	
	can_be_activity_guest = {
		government_has_flag = government_has_merit
		in_diplomatic_range = scope:host
		is_available_adult = yes
		#any_character_situation = { #LotR
		#	situation_type = dynastic_cycle
		#}
		#top_participant_group:dynastic_cycle ?= { #LotR
		#	NOR = {
		#		participant_group_type = hegemon_ruler
		#		participant_group_type = other_rulers
		#	}
		#}
		OR = {
			#you can always invite leader and your lieges
			is_any_movement_leader = yes
			is_liege_or_above_of = scope:host
			#Proximity checks
			#Same empire as host
			default_location.county.empire = {
				OR = {
					this = scope:host.capital_county.empire
					any_title_to_title_neighboring_kingdom = {
						this = scope:host.capital_county.kingdom
					}
				}
			}
		}
		trigger_if = {
			limit = {
				scope:host = {
					faith = { has_doctrine = doctrine_gender_female_dominated }
				}
			}
			is_female = yes
		}
		trigger_else_if = {
			limit = {
				scope:host = {
					faith = { has_doctrine = doctrine_gender_male_dominated }
				}
			}
			is_female = no
		}
		trigger_else = { always = yes }
	}

	host_intents = {
		intents = { debate_increase_movement_power_intent debate_gain_disciples_intent }

		default = debate_increase_movement_power_intent
	}

	guest_intents = {
		intents = { debate_increase_movement_power_intent debate_gain_elder_intent }

		default = debate_increase_movement_power_intent
	}

	guest_join_chance = {
		base = 5
		base_activity_modifier = yes

		# Scripted Modifiers
		activity_guest_shared_ai_accept_modifier = yes
		activity_guest_health_ai_accept_modifier = yes
		#Is Hegemon
		debate_activity_is_hegemon_modifier = yes
	}

	special_guests = {
		movement_leader = {
			is_required = yes

			is_shown = {
				scope:special_option = flag:debate_type_leadership
			}

			select_character = {
				top_participant_group:dynastic_cycle.var:movement_leader = {
					save_scope_as = character
				}
			}

			ai_will_do = {
				value = 10
			}
		}
	}

	wait_time_before_start = {
		# Fixed duration, because it is an open activity
		months = 2
	}
	
	max_guest_arrival_delay_time = { months = 1 }

	guest_invite_rules = {
		defaults = {
			2 = activity_invite_rule_close_family
			1 = activity_invite_rule_debate_movement_members
			1 = activity_invite_rule_debate_movement_other_members
		}
	}

	travel_entourage_selection = {
		weight = {
			value = standard_travel_entourage_additions
			if = {
				limit = {
					court_owner = scope:owner
					is_available_ai_adult = yes
					is_faith_dominant_gender = yes
					location = scope:owner.location
					OR = {
						is_spouse_of = scope:owner
						is_close_family_of = scope:owner
						has_relation_disciple = scope:owner
					}
					NOT = {
						top_participant_group:dynastic_cycle ?= { participant_group_type = undecided_movement }
					}
				}
				add = 50
			}
		}

		max = 15
		ai_max = 3
		invite_rule_order = 1
   	}
	
	###################
	# ON ACTIONS
	###################

	pulse_actions = {
		entries = {
			apa_friendly_discussions
			apa_brought_huangdi_gift
			apa_entrant_disagreement
			apa_found_disciple
			apa_fruitful_debate
			apa_studied_confucian_classics
			apa_movement_ridiculed

			#Re-used
			host_gains_diplo_xp
			host_gains_intrigue_xp
			hook_trusting_guest
		}
		chance_of_no_event = 5
	}

	on_start = {
		set_global_variable = { name = has_ai_debate_cooldown value = yes days = 365 }
		every_player = {
			if = {
				limit = {
					scope:activity.special_guest:movement_leader ?= this
				}
				trigger_event = activity_system.0554
			}
		}
	}

	on_enter_passive_state = { # Character scope
	}

	on_passive_state_pulse = { # Character scope
	}

	on_enter_active_state = { # Character scope
	}

	on_active_state_pulse = { # Character scope
	}

	on_complete = { # Character scope
	}

	###################
	# GRAPHICS
	###################
	background = {
		texture = "gfx/interface/illustrations/event_scenes/tgp_study_asia.dds"
		environment = "environment_tgp_study_asia"
		ambience = "event:/DLC/EP4/SFX/Events/Event_Backgrounds/tgp_study_asia"
	}

	### Plug in widgets
	activity_window_widgets = {
		debate_success_chance = "activity_plugin_widgets_summary"
	}

	window_characters = {
		guest = {
			camera = camera_body_right

			effect = {
				if = {
					# Find a player if they exist. 
					limit = {
						scope:host.location = scope:activity.activity_location
						OR = {
							NOT = { exists = scope:activity.special_guest:movement_leader }
							scope:activity.special_guest:movement_leader.location ?= scope:activity.activity_location
						}
						exists = scope:player
						scope:player = {
							location = scope:activity.activity_location
							NOR = {
								this = scope:host
								scope:activity.special_guest:movement_leader ?= this
							}
						}
					}
					scope:player ?= { add_to_list = characters }
				}
				else_if = {
					# Else we grab a character from the same movement as host
					limit = {
						scope:host.location = scope:activity.activity_location
						OR = {
							NOT = { exists = scope:activity.special_guest:movement_leader }
							scope:activity.special_guest:movement_leader.location ?= scope:activity.activity_location
						}
						any_attending_character = {
							location = scope:activity.activity_location
							NOR = {
								this = scope:host
								scope:activity.special_guest:movement_leader ?= this
							}
							top_participant_group:dynastic_cycle ?= scope:host.top_participant_group:dynastic_cycle
						}
					}
					every_attending_character = {
						limit = {
							scope:host.location = scope:activity.activity_location
							NOR = {
								this = scope:host
								scope:activity.special_guest:movement_leader ?= this
							}
							top_participant_group:dynastic_cycle ?= scope:host.top_participant_group:dynastic_cycle
						}
						add_to_list = characters
					}
				}
				else_if = {
					# Else we grab someone important
					limit = {
						scope:host.location = scope:activity.activity_location
						OR = {
							NOT = { exists = scope:activity.special_guest:movement_leader }
							scope:activity.special_guest:movement_leader.location ?= scope:activity.activity_location
						}
						any_attending_character = {
							location = scope:activity.activity_location
							NOR = {
								this = scope:host
								scope:activity.special_guest:movement_leader ?= this
							}
						}
					}
					ordered_attending_character = {
						order_by = movement_power_character_value
						limit = {
							location = scope:activity.activity_location
							location = scope:activity.activity_location
							NOR = {
								this = scope:host
								scope:activity.special_guest:movement_leader ?= this
							}
						}
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_discussion }
					}
					animation = { interested personality_honorable }
				}
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_debate }
					}
					animation = { debating storyteller }
				}
			}
		}
		# Host
		host = {
			camera = camera_body
			
			effect = {
				if = {
					limit = {
						scope:host.location = scope:activity.activity_location
					}
					scope:host = {
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_discussion }
					}
					animation = { pondering personality_bold }
				}
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_debate }
					}
					animation = { chancellor pondering }
				}
			}
		}
		
		travel_host = {
			camera = camera_event_horse_left
			
			effect = {
				if = {
					limit = {
						NOT = {
							scope:host.location = scope:activity.activity_location
						}
					}
					scope:host = {
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character.location = { is_sea_province = yes }
					}
					animation = { idle }
				}
				triggered_animation = {
					trigger = { scope:character = { has_trait = impatient } }
					animation = { jockey_gallop }
				}
				animation = jockey_walk
			}
		}

		# Find a family member/spouse/heir
		guest = {
			camera = camera_body_left_slight
			
			effect = {
				if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						scope:activity = { NOT = { has_current_phase = debate_phase_debate } }
					}
					ordered_attending_character = {
						order_by = {
							value = 1
							if = {
								limit = {
									is_close_family_of = scope:host
								}
								add = 25
							}
							if = {
								limit = {
									has_relation_friend = scope:host
								}
								add = 25
							}
							if = {
								limit = { 
									this = scope:host.primary_spouse
								}
								add = 50
							}
							if = {
								limit = {
									is_primary_heir_of = scope:host
								}
								add = 25
							}
						}
						limit = {
							location = scope:activity.activity_location
							NOT = { this = scope:host }
						}
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_discussion }
					}
					animation = { holding_scrolls happy_teacher }
				}
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_debate }
					}
					animation = { fanning page_flipping }
				}
			}
		}

		# Find an important guest
		guest = {
			camera = camera_body_left

			effect = {
				if = {
					# First we check if there's a guest from another movement than the host's movement.
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							location = scope:activity.activity_location
							NOT = {
								top_participant_group:dynastic_cycle ?= scope:host.top_participant_group:dynastic_cycle
							}
						}
					}
					every_attending_character = {
						limit = {
							scope:host.location = scope:activity.activity_location
							NOT = {
								top_participant_group:dynastic_cycle ?= scope:host.top_participant_group:dynastic_cycle
							}
						}
						add_to_list = characters
					}
				}
				else_if = {
					# Else we check for any important character.
					limit = {
						scope:host.location = scope:activity.activity_location
						any_attending_character = {
							count >= 3
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
						}
					}
					ordered_attending_character = {
						order_by = movement_power_character_value
						check_range_bounds = no
						position = 2
						limit = {
							location = scope:activity.activity_location
							NOT = {
								this = scope:host
							}
						}
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_discussion }
					}
					animation = { interested thinking }
				}
				triggered_animation = {
					trigger = {
						scope:character.involved_activity ?= { has_current_phase = debate_phase_debate }
					}
					animation = { storyteller personality_cynical }
				}
			}
		}

		honorary_guest_leader = {
			camera = camera_body

			effect = {
				if = {
					limit = {
						scope:host.location = scope:activity.activity_location
						OR = {
							scope:activity.special_guest:movement_leader.location ?= scope:activity.activity_location
							scope:activity.special_guest:movement_leader.location ?= { is_sea_province = yes }
						}
					}
					special_guest:movement_leader ?= {
						add_to_list = characters
					}
				}
			}

			scripted_animation = {
				triggered_animation = {
					trigger = {
						scope:activity.special_guest:movement_leader = { is_travelling = yes }
					}
					animation = { idle }
				}
				triggered_animation = {
					trigger = {
						always = yes
					}
					animation = { chancellor personality_honorable personality_bold }
				}
			}
		}
	}
}
