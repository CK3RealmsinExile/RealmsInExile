apa_boasting_calligraphy = {
	icon = positive
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			OR = {
				has_trait = gregarious
				has_trait = lifestyle_poet
			}
			trigger_if = {
				limit = {
					involved_activity = {
						has_activity_type = activity_imperial_examination
					}
				}
				has_activity_intent = imperial_exam_taker_intent
				NOT = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = imperial_examination_focus_martial
						}
					}
				}
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				is_ai = yes
				OR = {
					has_trait = gregarious
					has_trait = lifestyle_poet
				}
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = apa_boasting_calligraphy
			tags = { pulse_action }
			score = 15
			character = scope:first
	
			scope:first = {
				bp2_lifestyle_xp_gain_per_type_effect = { VALUE = minor }
			}	
		}
	}
}

apa_impressive_shot = {
	icon = positive
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			OR = {
				has_trait = gregarious
				has_trait = lifestyle_hunter
				martial > 15
			}
			trigger_if = {
				limit = {
					involved_activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = imperial_examination_focus_martial
					}
				}
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				is_ai = yes
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				OR = {
					has_trait = gregarious
					has_trait = lifestyle_hunter
					martial > 15
				}
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = apa_impressive_shot
			tags = { pulse_action }
			score = 15
			character = scope:first
	
			scope:first = {
				bp2_lifestyle_xp_gain_per_type_effect = { VALUE = minor }
			}	
		}
	}
}

apa_overcome_with_stress = {
	icon = stress_gain
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			trigger_if = {
				limit = {
					scope:activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
			is_ai = yes
			NOT = { has_personality_levelheaded_trigger = yes }
			stress_level >= 1
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
				NOT = { has_personality_levelheaded_trigger = yes }
				stress_level >= 1			
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = apa_overcome_with_emotion
			tags = { pulse_action }
			score = 15
			character = scope:first
			
			scope:first = {
				add_prestige = miniscule_prestige_loss
				stress_impact = {
					# I'm freaking out and now everyone is looking
					shy = minor_stress_impact_gain
				}
			}
		}
	}
}

apa_brought_huangdi_gift = {
	icon = positive
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			OR = {
				is_in_guest_subset = { name = entrants }
				is_in_guest_subset = { name = guests }
			}
			is_ai = yes
			short_term_gold >= minor_gold_value
			NOT = { has_trait = greedy }
			OR = {
				has_trait = generous
				has_trait = ambitious
			}
		}
	}

	weight = {
		value = 1
	}

	effect = {
		scope:host = {
			save_scope_as = second
		}

		random_attending_character = {
			limit = {
				OR = {
					is_in_guest_subset = { name = entrants }
					is_in_guest_subset = { name = guests }
				}
				is_ai = yes
				short_term_gold >= minor_gold_value
				NOT = { has_trait = greedy }
				OR = {
					has_trait = generous
					has_trait = ambitious
				}
			}
			save_scope_as = first
		}

		scope:first = {
			remove_short_term_gold = minor_gold_value
		}

		add_activity_log_entry = {
			key = apa_brought_huangdi_gift
			tags = { pulse_action }
			character = scope:first
			target = scope:second

			scope:first = {
				change_influence = minor_influence_gain
			}
		}
	}
}

apa_friendly_discussions = {
	icon = learning
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			this != scope:host
			is_physically_able_ai_adult = yes
			num_of_relation_friend < 2
			save_temporary_scope_as = temp_char
		}
		any_attending_character = {
			this != scope:temp_char
			this != scope:host
			is_physically_able_ai_adult = yes
			num_of_relation_friend < 2
			number_of_traits_in_common = {
				target = scope:temp_char
				value >= 1
			}
			can_set_relation_friend_trigger = { CHARACTER = scope:temp_char }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				this != scope:host
				is_physically_able_ai_adult = yes
				num_of_relation_friend < 2
			}
			save_scope_as = first
		}
		random_attending_character = {
			limit = {
				this != scope:first
				this != scope:host
				is_physically_able_ai_adult = yes
				num_of_relation_friend < 2
				number_of_traits_in_common = {
					target = scope:first
					value >= 1
				}
				can_set_relation_friend_trigger = { CHARACTER = scope:first }
			}
			save_scope_as = second
		}

		add_activity_log_entry = {
			key = apa_friendly_discussions
			tags = { pulse_action }
			character = scope:first
			target = scope:second

			scope:second = {
				scope:second = {
					progress_towards_friend_effect = {
						REASON = friend_bonded_over_exam_jitters
						CHARACTER = scope:first
						OPINION = default_friend_opinion
					}
				}			
			}
		}
	}
}

apa_high_tempers = {
	icon = social
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			is_ai = yes
			OR = {
				has_trait = arrogant
				has_trait = vengeful
				has_trait = zealous
			}
			# More spry and more to prove by throwing weight around
			age < 40
			trigger_if = {
				limit = {
					involved_activity = {
						has_activity_type = activity_imperial_examination
					}
				}
				has_activity_intent = imperial_exam_taker_intent
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = imperial_examination_focus_martial
					}
				}
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
		}
		any_attending_character = {
			is_in_guest_subset = { name = imperial_examiners }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
				OR = {
					has_trait = arrogant
					has_trait = vengeful
					has_trait = zealous
				}
				# More spry and more to prove by throwing weight around
				age < 40
			}
			save_scope_as = first
		}
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = imperial_examiners }
			}
			save_scope_as = second
		}

		add_activity_log_entry = {
			key = apa_high_tempers
			tags = { pulse_action }
			character = scope:first
			target = scope:second
			
			scope:second = {
				add_opinion = {
					target = scope:first
					modifier = annoyed_opinion
					opinion = -10
				}
			}
			scope:first = {
				add_stress = minor_stress_loss
			}	
		}
	}	
}

apa_impressed_examiner = {
	icon = social
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			trigger_if = {
				limit = {
					scope:activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
			is_ai = yes
			has_trait = diligent
		}
		any_attending_character = {
			is_in_guest_subset = { name = imperial_examiners }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
				has_trait = diligent
			}
			save_scope_as = first
		}
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = imperial_examiners }
			}
			save_scope_as = second
		}

		add_activity_log_entry = {
			key = apa_impressed_examiner
			tags = { pulse_action }
			character = scope:first
			target = scope:second
	
			scope:first = {
				change_merit = minor_merit_gain
				reverse_add_opinion = {
					target = scope:second
					modifier = proud_opinion
					opinion = 10
				}
			}	
		}
	}
}

apa_entrant_disagreement = {
	icon = social
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			trigger_if = {
				limit = {
					scope:activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
			is_ai = yes
			count = 2
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
			}
			save_scope_as = first
		}
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
				this != scope:first
			}
			save_scope_as = second
		}

		add_activity_log_entry = {
			key = apa_entrant_disagreement
			tags = { pulse_action }
			character = scope:first
			target = scope:second

			scope:first = {
				if = {
					limit = {
						can_set_relation_rival_trigger = { CHARACTER = scope:second }
					}
					progress_towards_rival_effect = {
						REASON = rival_at_university
						CHARACTER = scope:second
						OPINION = default_rival_opinion
					}
				}
				else_if = {
					limit = {
						is_ai = yes
					}
					add_opinion = {
						target = scope:second
						modifier = annoyed_opinion
						opinion = -10
					}
				}
				else = {
					scope:second = {
						add_opinion = {
							target = scope:first
							modifier = annoyed_opinion
							opinion = -10
						}
					}
				}
			}
		}
	}
}

apa_burning_midnight_oil = {
	icon = learning
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			is_ai = yes
			has_trait = ambitious
			trigger_if = {
				limit = {
					involved_activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
				scope:activity = {
					NOT = {
						has_activity_option = {
							category = special_type
							option = imperial_examination_focus_martial
						}
					}
				}
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				is_ai = yes
				has_trait = ambitious
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = apa_burning_midnight_oil
			tags = { pulse_action }
			character = scope:first
			
			scope:first = {
				add_stress = minor_stress_gain
			}
		}
	}
}

apa_found_disciple = {
	icon = social
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			trigger_if = {
				limit = {
					scope:activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
			is_ai = yes
	        trigger_if = {
	            limit = {
	                any_relation = { type = elder }
	            }
	            any_relation = {
	                type = elder
	                is_ai = yes
	            }
	        }
			save_temporary_scope_as = temp_char
		}
		any_attending_character = {
			is_in_guest_subset = { name = imperial_examiners }
	        eligible_for_elder_trigger = { DISCIPLE = scope:temp_char }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
		        trigger_if = {
		            limit = {
		                any_relation = { type = elder }
		            }
		            any_relation = {
		                type = elder
		                is_ai = yes
		            }
		        }
				save_temporary_scope_as = temp_char
				root = {
					any_attending_character = {
						is_in_guest_subset = { name = imperial_examiners }
						eligible_for_elder_trigger = { DISCIPLE = scope:temp_char }
					}
				}
			}
			save_scope_as = first
		}
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = imperial_examiners }
		        eligible_for_elder_trigger = { DISCIPLE = scope:first }
			}
			save_scope_as = second
		}

		add_activity_log_entry = {
			key = apa_found_disciple
			tags = { pulse_action }
			character = scope:first
			target = scope:second
			set_elder_relation_effect = {
				ELDER = scope:second
				DISCIPLE = scope:first
				MERIT = minor_merit_gain
			}
		}
	}
}

apa_fruitful_debate = {
	icon = learning
	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			trigger_if = {
				limit = {
					scope:activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
			count = 2
			is_ai = yes
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
			}
			save_scope_as = first
		}
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				is_ai = yes
				this != scope:first
			}
			save_scope_as = second
		}
		add_activity_log_entry = {
			key = apa_fruitful_debate
			tags = { pulse_action }
			character = scope:first
			target = scope:second

			scope:second = {
				bp2_lifestyle_xp_gain_per_type_effect = { VALUE = medium }
			}
		}
	}
}

apa_confucian_fervor = {
	icon = public

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
				trigger_if = {
				limit = {
					scope:activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
			is_ai = yes
			# has_religion = religion:confucianism_religion
			NOT = { has_personality_levelheaded_trigger = yes }	has_trait = zealous
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {	
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
				# has_religion = religion:confucianism_religion
				NOT = { has_personality_levelheaded_trigger = yes }	has_trait = zealous
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = apa_confucian_fervor
			tags = { pulse_action }
			character = scope:first
			scope:first = {
				add_piety = minor_piety_gain
				stress_impact = {
					base = minor_stress_impact_loss
				}
			}
		}
	}
}

apa_floating_poetry = {
	icon = public

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_in_guest_subset = { name = entrants }
			trigger_if = {
				limit = {
					scope:activity = { has_activity_type = activity_imperial_examination }
				}
				has_activity_intent = imperial_exam_taker_intent
			}
			trigger_else = { has_activity_intent = local_exam_taker_intent }
			is_ai = yes
			diplomacy > 15
		}
	}

	weight = {
		value = 1
	}

	effect = {
		random_attending_character = {
			limit = {
				is_in_guest_subset = { name = entrants }
				trigger_if = {
					limit = {
						scope:activity = { has_activity_type = activity_imperial_examination }
					}
					has_activity_intent = imperial_exam_taker_intent
				}
				trigger_else = { has_activity_intent = local_exam_taker_intent }
				is_ai = yes
				diplomacy > 15			
			}
			save_scope_as = first
		}
		add_activity_log_entry = {
			key = apa_floating_poetry
			tags = { pulse_action }
			character = scope:first
			scope:first = {
				change_influence = minor_influence_gain
			}
		}
	}
}
