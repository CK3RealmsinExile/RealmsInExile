
cloaks = {

	usage = game
	fallback = no_cloak

    ep2_western_era2_low_nobles_cloaks = { # Carolingian Cloak
        dna_modifiers = {
            accessory = {
                mode = add
                gene = cloaks
                template = ep2_cloak_western_era1_low_nobility
                range = { 0 1 } # For the randomness to work correctly
            }
        }   
        weight = {
            base = 0
            modifier = {
                add = 1000
                OR = { 
                	portrait_duchy_trigger = { 
	                    CULTURE_INPUT = dorwinion
	                }               
                }
				NAND = {
					is_ruler = yes
					government_has_flag = government_is_theocracy
				}
                has_ep2_dlc_trigger = yes   
                # portrait_era1_trigger = yes     
            }
			modifier = {
				factor = 0 
				portrait_wear_armor_trigger = yes
			}
        }
    }
    
    ep2_western_era2_high_nobles_cloaks = { # Noble Carolingian Cloak
        dna_modifiers = {
            accessory = {
                mode = add
                gene = cloaks
                template = ep2_cloak_western_era1_high_nobility
                range = { 0 1 } # For the randomness to work correctly
            }
        }   
        weight = {
            base = 0
            modifier = {
                add = 1000
                OR = {   
                	portrait_royalty_trigger = { 
	                    CULTURE_INPUT = dorwinion
	                }  
					portrait_imperial_trigger = { 
	                    CULTURE_INPUT = dorwinion
	                }              
                }
				NAND = {
					is_ruler = yes
					has_government = theocracy_government
				}
                has_ep2_dlc_trigger = yes   
                # portrait_era1_trigger = yes     
            }
			modifier = {
				factor = 0 
				portrait_wear_armor_trigger = yes
			}
        }
    }

	ep2_western_travel_cloak = { # Traveler's Cloak 1
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = ep2_cloak_western_travel
				range = { 0 1 }
			}
		}
		outfit_tags = { travel_cloak }
		weight = {
			base = 0
			modifier = {
				add = 2000
				has_ep2_dlc_trigger = yes
				OR = {
					portrait_travel_cloak_trigger = yes
					portrait_duel_trigger = yes
				}
				OR = {
					portrait_byzantine_proxy_clothing_trigger = yes
					portrait_western_proxy_clothing_trigger = yes
					portrait_northern_proxy_clothing_trigger = yes
				}
			}
			#modifier = {
			#	factor = 0 
			#	portrait_wear_armor_trigger = yes
			#}
		}
	}

	ep2_mena_travel_cloak = { # Traveler's Cloak 2
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = ep2_cloak_mena_travel
				range = { 0 1 }
			}
		}
		outfit_tags = { travel_cloak }
		weight = {
			base = 0
			modifier = {
				add = 2000
				has_ep2_dlc_trigger = yes
				OR = {
					portrait_travel_cloak_trigger = yes
					portrait_duel_trigger = yes
				}
				OR = {
					portrait_mena_proxy_clothing_trigger = yes
					portrait_african_proxy_clothing_trigger = yes
					portrait_indian_proxy_clothing_trigger = yes
					portrait_steppe_proxy_clothing_trigger = yes
				}
			}
			#modifier = {
			#	factor = 0 
			#	portrait_wear_armor_trigger = yes
			#}		
		}
	}

	western_kings = { # Royal Cloak
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = western_royalty
				range = { 0 1 }
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 1000
				highest_held_title_tier >= tier_kingdom
				OR = {
					portrait_elven_clothing_trigger = yes
					portrait_dalemen_clothing_trigger = yes
					AND = { # Northron and non-tribal Woodmen Vale
						portrait_northron_clothing_trigger = yes
						OR = {
							portrait_vale_woodmen_clothing_trigger = no
							AND = {
								portrait_vale_woodmen_clothing_trigger = yes
								NOT = {
									government_has_flag = government_is_tribal
								}
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				exists = this
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					government_has_flag = government_is_republic
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
					portrait_wear_armor_trigger = yes
					is_travelling = yes
					involved_activity ?= { has_activity_type = activity_hunt }
					has_trait = nazgul
					cannot_be_killed = yes
				}
			}
			modifier = { # For Sauruman and Sauron
				factor = 0
				OR = { 
					has_character_flag = is_saruman	
					has_character_flag = is_sauron
				}
			}		
		}
	}

	no_cloak = { # No Cloak
		dna_modifiers = {
			accessory = {
				mode = add
				
				gene = cloaks
				template = no_cloak
				range = { 0 1 }
			}
		}	
        outfit_tags = { no_clothes nightgown }
		weight = {
			base = 0
			modifier = {
				add = 30
				has_ep2_dlc_trigger = yes
				portrait_western_clothing_trigger = yes
				highest_held_title_tier < tier_kingdom
			}
			modifier = {
				add = 60
				portrait_gwathiurim_clothing_trigger = yes
			}	
			modifier = {
				add = -30
				portrait_gwathiurim_clothing_trigger = yes
				highest_held_title_tier >= tier_county
			}	
			modifier = {
				add = -15
				portrait_gwathiurim_clothing_trigger = yes
				exists = primary_spouse
				OR = {
					is_ruler = no
					highest_held_title_tier = tier_barony
				}
				primary_spouse = {
					highest_held_title_tier >= tier_county
				}
			}	
			modifier = {
				add = -30
				portrait_gwathiurim_clothing_trigger = yes
				highest_held_title_tier >= tier_duchy
			}	
			modifier = {
				add = -15
				portrait_gwathiurim_clothing_trigger = yes
				exists = primary_spouse
				OR = {
					is_ruler = no
					highest_held_title_tier = tier_barony
				}
				primary_spouse = {
					highest_held_title_tier >= tier_duchy
				}
			}	
			modifier = {
				add = -60
				portrait_gwathiurim_clothing_trigger = yes
				OR = {
					portrait_wear_armor_trigger = yes
					portrait_has_trait_trigger = { TRAIT = berserker }
				}
			}
			modifier = {
				add = 200
				OR = {
					portrait_wear_armor_trigger = yes
					activity_tournament_shirtless_trigger = yes
				}
			}
			modifier = { #LotR: Gondorian Kings wear not cloaks
				add = 1000
				OR = {
					has_primary_title = title:e_gondor
					has_primary_title = title:e_castamir
				}
                OR = {
                    portrait_gondorian_clothing_trigger = yes
                    portrait_harondorim_clothing_trigger = yes
                }
			}
			modifier = { # LotR: Sauruman, Sauron and Nazgul wear not cloaks
				add = 1000
				exists = this
				OR = { 
					has_character_flag = is_saruman	
					has_character_flag = is_sauron
					has_trait = nazgul
				}
			}			
		}
	}

	fp1_norse = { # FP1 Norse Cloak Set
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = fp1_cloak
				range = { 0 1 }
			}
			morph = {
				mode = add
				gene = gene_bs_cloak
				template = cloak
				value = 1.0
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 1000
				has_fp1_dlc_trigger = yes
				OR = {
					portrait_vale_woodmen_clothing_trigger = yes
					portrait_gwathiurim_clothing_trigger = yes
					portrait_northron_clothing_trigger = yes
					AND = { # Special case for tribal Rohirric to give them that more rustic edge - largely effects Leofrings and Framlings
						portrait_rohirrim_clothing_trigger = yes
						government_has_flag = government_is_tribal
					}
				}
				NOT = { portrait_has_trait_trigger = { TRAIT = berserker } }
			}
			modifier = {
				factor = 0
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					is_theocratic_lessee = yes
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
					portrait_wear_armor_trigger = yes
					has_trait = nazgul
					cannot_be_killed = yes
				}
			}			
		}
	}

	fp1_norse_berserker = { # Big Fur Cloak
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = fp1_cloak_berserker
				range = { 0 1 }
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 1000
				has_fp1_dlc_trigger = yes
				portrait_vale_woodmen_clothing_trigger = yes
				portrait_has_trait_trigger = { TRAIT = berserker }
			}
			modifier = {
				factor = 0
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					is_theocratic_lessee = yes
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
					has_trait = nazgul
					cannot_be_killed = yes
				}
			}			
		}
	}
	
	ep1_adventurer_cloak = { # Explorer's Cloak
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = ep1_cloak_adventurer
				range = { 0 1 }
			}
		}
		outfit_tags = { ep1_adventurer_cloak }
		weight = {
			base = 0
			modifier = {
				add = 100
				has_ep1_dlc_trigger = yes
				OR = {
					AND = {
						NOT =  {
							portrait_northern_proxy_clothing_trigger = yes
						}
						portrait_has_trait_trigger = { TRAIT = adventurer }
					}
					AND = {
						exists = inspiration
						inspiration = {
							has_inspiration_type = adventure_inspiration
						}
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					is_theocratic_lessee = yes
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
				}
			}			
		}
	}
	
	sp2_western_imperial = { # Coronation Cloak
        dna_modifiers = {
            accessory = {
                mode = add
                gene = cloaks
                template = sp2_cloak_imperial
                range = { 0 1 } # For the randomness to work correctly
            }
        }   
        weight = {
            base = 0
            modifier = {
                add = 1000
				highest_held_title_tier >= tier_kingdom
                OR = {   
					portrait_adunai_clothing_trigger = yes
					portrait_numenorean_clothing_trigger = yes             
                }
                # OR = {
                # 	portrait_era1_trigger = yes
                # 	portrait_era2_trigger = yes
                # }
				NAND = {
					is_ruler = yes
					has_government = theocracy_government
				} 
                has_dlc_feature = elegance_of_the_empire   
            }
            # modifier = {
            #     factor = 0
            #     has_ep2_dlc_trigger = yes  
            #     NOR = {
            #         portrait_era2_trigger = yes   
            #         portrait_era3_trigger = yes 
            #     }             
            # }
        }
    }
	
	######################## LotR: REALMS IN EXILE CONTENT BELOW HERE ########################
	
	rohirrim_nobility = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = rohirrim_nobility
				range = { 0 1 }
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 1000
				portrait_rohirrim_clothing_trigger = yes
				highest_held_title_tier >= tier_kingdom
			}
			modifier = {
				factor = 0
				exists = this
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					is_theocratic_lessee = yes
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
					portrait_wear_armor_trigger = yes
					has_trait = nazgul
					cannot_be_killed = yes
				}
			}			
		}
	}
	
	theoden_cloak = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = theoden_cloak
				range = { 0 1 }
			}
		}	
		weight = {
			base = 0
            modifier = {
                add = 2000
				exists = character:6000017 #Theoden
				this = character:6000017 #Theoden
            }
		}
	}
	
	bellakarean_emperor_cloaks = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = bellakar_imperial_cloaks
				range = { 0 1 }
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 200
				AND = {
					portrait_bellakari_clothing_trigger = yes
					highest_held_title_tier = tier_empire
				}
			}
			modifier = {
				factor = 0
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					is_theocratic_lessee = yes
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
					portrait_wear_armor_trigger = yes
					has_trait = nazgul
					cannot_be_killed = yes
				}
			}
		}
	}
	
	bellakarean_royal_cloaks = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = bellakar_royal_cloaks
				range = { 0 1 }
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 200
				AND = {
					portrait_bellakari_clothing_trigger = yes
					highest_held_title_tier = tier_kingdom
				}
			}
			modifier = {
				factor = 0
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					is_theocratic_lessee = yes
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
					portrait_wear_armor_trigger = yes
					has_trait = nazgul
					cannot_be_killed = yes
				}
			}
		}
	}

	gondorian_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = cloaks
				template = gondorian_royalty
				range = { 0 1 }
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 1000
				highest_held_title_tier >= tier_kingdom
                OR = {
                    portrait_gondorian_clothing_trigger = yes
                    portrait_harondorim_clothing_trigger = yes
                }
			}
			modifier = {
				factor = 0
				OR = {
					is_adult = no
					government_has_flag = government_is_theocracy
					is_theocratic_lessee = yes
					has_character_modifier = vow_of_poverty_modifier
					# Deliberately not the "fully naked" one since dropping your cloak's intended even if nudity is disabled
					should_be_naked_trigger = yes
					portrait_wear_armor_trigger = yes
					has_trait = nazgul
					has_primary_title = title:e_gondor
					has_primary_title = title:e_castamir
				}
			}			
		}
	}
	
}