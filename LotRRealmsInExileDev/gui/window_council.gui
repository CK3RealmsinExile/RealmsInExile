
######################################################
################## COUNCIL WINDOW ####################
######################################################

window = {
	name = "council_window"
	widgetid = "council_window"
	parentanchor = top|right
	layer = windows_layer
	movable = no

	using = Window_Size_MainTab

	state = {
		name = _show
		using = Animation_FadeIn_Quick
		using = Sound_WindowShow_Standard
		using = Window_Position_MainTab

		on_start = "[GetVariableSystem.Set( 'council_tabs', 'my_council' )]"
	}

	state = {
		name = _hide
		using = Animation_FadeOut_Quick
		using = Sound_WindowHide_Standard
		using = Window_Position_MainTab_Hide
	}

	margin_widget = {
		size = { 100% 100% }
		margin_top = 30
		margin_bottom = 25
		margin_right = 13

		widget = {
			size = { 100% 100% }

			vbox = {
				using = Window_Margins

				header_pattern = {
					layoutpolicy_horizontal = expanding

					blockoverride "header_text"
					{
						text = "COUNCIL_WINDOW_TITLE"
					}

					blockoverride "button_close"
					{
						onclick = "[CouncilWindow.Close]"
					}
				}

				hbox = {
					layoutpolicy_horizontal = expanding

					button_tab = {
						layoutpolicy_horizontal = expanding
						text = "COUNCIL_WINDOW_PLAYER_COUNCIL"

						down = "[And( CouncilWindow.IsPlayerCouncilShown, Not( GetVariableSystem.Exists( 'diarchy_tab' ) ) )]"
						onclick = "[CouncilWindow.SetPlayerCouncil]"
						onclick = "[GetVariableSystem.Clear( 'diarchy_tab' )]"

						# onclick = "[PdxGuiTriggerAllAnimations('council_refresh')]"

						# state = {
						# 	name = _mouse_click
						# 	delay = 0.2
						# 	on_finish = "[CouncilWindow.SetPlayerCouncil]"
						# }
					}

					button_tab = {
						visible = "[Not(GetPlayer.IsIndependentRuler)]"

						down = "[And( CouncilWindow.IsLiegeCouncilShown, Not( GetVariableSystem.Exists( 'diarchy_tab' ) ) )]"
						onclick = "[CouncilWindow.SetLiegeCouncil]"
						onclick = "[GetVariableSystem.Clear( 'diarchy_tab' )]"

						# onclick = "[PdxGuiTriggerAllAnimations('council_refresh')]"

						# state = {
						# 	name = _mouse_click
						# 	delay = 0.2
						# 	on_finish = "[CouncilWindow.SetLiegeCouncil]"
						# }

						text_single = {
							minimumsize = { 277 38 }
							margin = { 15 0 }
							text = "COUNCIL_WINDOW_LIEGE_COUNCIL"
							resizeparent = yes
							align = center|nobaseline
							default_format = "#low"
						}
					}
				}

				widget = {
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					vbox_council_layout = {
						name = "my_council"
						visible = "[And( CouncilWindow.IsPlayerCouncilShown, Not( GetVariableSystem.Exists( 'diarchy_tab' ) ) )]"

						using = Animation_Tab_Switch
					}


					vbox_council_layout = {
						name = "council_refresh"
						visible = "[And( CouncilWindow.IsLiegeCouncilShown, Not( GetVariableSystem.Exists( 'diarchy_tab' ) ) )]"

						using = Animation_Tab_Switch

						background = {
							using = Background_Frame
							margin = { -5 2 }
							using = Color_Grey

							spriteType = Corneredtiled
							spriteborder = { 7 7 }
							alpha = 0.7
						}
					}
				}
			}
		}
	}
}

widget = {
	name = "potential_task_location_window"
	size = { 100% 100% }

	state = {
		name = _show
		using = Animation_FadeIn_Standard
		# position_x = 0
	}

	state = {
		name = _hide
		using = Animation_FadeOut_Quick
		# position_x = -40
	}

	portrait_council = {
		datacontext = "[PotentialTaskLocationWindow.GetActiveTask.GetCouncillor]"
		datacontext = "[PotentialTaskLocationWindow.GetTaskType.GetCouncilPosition]"
		parentanchor = bottom|left
		scale = 2
		position = {-100 0}

		blockoverride "portrait_button"
		{
			intersectionmask = yes
		}

		blockoverride "mask" {
			mask = "gfx/portraits/portrait_mask_blank.dds"
		}


		widget = {
			parentanchor = bottom|left
			# position = { 70 -20}
			position = { 85 -5 }

			vbox = {
				set_parent_size_to_minimum = yes
				scale = 0.5
				minimumsize = { 190 0 }

				background = {
					texture = "gfx/interface/component_tiles/tile_title_bg_01.dds"
					spriteType = Corneredtiled
					spriteborder = { 40 8 }
					margin = { 10 0 }
					margin_right = 25
					texture_density = 2

					modify_texture = {
						name = "mask"
						texture = "gfx/interface/component_masks/mask_fade_horizontal_middle_thick.dds"
						blend_mode = alphamultiply
					}
				}

				text_label_left = {
					text = "COUNCIL_WINDOW_MAP_COUNCILLOR_TYPE"
					margin = { 5 5 }
					layoutpolicy_horizontal = expanding
					align = nobaseline
				}

				text_label_left = {
					text = "[PotentialTaskLocationWindow.GetActiveTask.GetCouncillor.GetUINameNoTooltip]"
					margin = { 5 5 }
					layoutpolicy_horizontal = expanding
					align = nobaseline
				}
			}
		}
	}

	flowcontainer = {
		parentanchor = top|hcenter
		direction = vertical
		scale = 1.2

		position = {0 100 }

		text_label_center = {
			text = "COUNCIL_WINDOW_MAP_TASK_NAME"
			parentanchor = hcenter
			align = nobaseline
			margin = { 10 4 }
		}

		text_label_center = {
			text = "[PotentialTaskLocationWindow.GetTaskType.GetName]"
			default_format = "#high"
			using = Font_Size_Medium
			parentanchor = hcenter
			align = nobaseline
			margin = { 10 4 }
		}

		text_label_center = {
			text = "COUNCIL_WINDOW_MAP_INSTRUCTION"
			parentanchor = hcenter
			align = nobaseline|hcenter
			margin = { 50 4 }
		}
	}


	icon = {
		using = Background_Label_Center
		parentanchor = bottom|hcenter
		size = { 400 85 }
		position = { 0 10 }

		button_primary_big = {
			name = "close_assignment_window"
			text = BACK_LABEL
			parentanchor = center

			onclick = "[PotentialTaskLocationWindow.Close]"
			tooltip = "COUNCIL_TASK_CANCEL_ASSIGNMENT"
			shortcut = "close_window"
		}
	}
}

######################################################
################ TYPES AND TEMPLATES #################
######################################################

types CouncilWindow
{

	type council_task_info = vbox
	{
		name = "task"
		datacontext = "[ActiveCouncilTask.GetTaskTypeOrDefault]"

		background = {
			using = Background_Area_Dark
			alpha = 0.7
		}

		vbox = {
			visible = "[CouncilTaskType.IsPercentageTask]"
			layoutpolicy_horizontal = expanding
			margin = { 5 3 }

			text_single = {
				name = "location"
				layoutpolicy_horizontal = expanding
				text = "[ActiveCouncilTask.GetTaskTarget]"
				default_format = "#high"
				autoresize = no
			}

			hbox = {
				layoutpolicy_horizontal = expanding
				margin = { 0 5 }

				progressbar_standard = {
					name = "progress"
					layoutpolicy_horizontal = expanding
					size = { 0 12 }
					value = "[ActiveCouncilTask.GetProgressFloat]"

					tooltipwidget = {
						council_task_progress_breakdown_widget = {}
					}

					text_single = {
						name = "eta"
						parentanchor = center
						text = "[ActiveCouncilTask.GetETA]"
						align = nobaseline
					}
				}
			}
		}

		vbox = {
			visible = "[And(And( CouncilTaskType.IsValueTask, Not( ActiveCouncilTask.IsFrozen ) ), Not(GuiCouncilPosition.ArePotentialTasksVisible))]"
			layoutpolicy_horizontal = expanding
			margin = { 5 3 }

			text_single = {
				name = "location"
				layoutpolicy_horizontal = expanding
				text = "[ActiveCouncilTask.GetTaskTarget]"
				default_format = "#high"
				autoresize = no
			}

			hbox = {
				layoutpolicy_horizontal = expanding
				margin = { 0 5 }

				progressbar_standard = {
					name = "progress"
					layoutpolicy_horizontal = expanding
					size = { 0 12 }
					value = "[ActiveCouncilTask.GetProgressFloat]"
					min = 0
					max = "[ActiveCouncilTask.GetProgressMaxFloat]"
					tooltipwidget = {
						council_task_progress_breakdown_widget = {}
					}
					using = tooltip_ws
					text_single = {
						name = "eta"
						parentanchor = center
						text = "[ActiveCouncilTask.GetETA]"
						align = nobaseline
					}
				}
			}
		}
	}

	type widget_councillor_item = widget {
		size = { 260 250 }

		state = {
			name = _mouse_hierarchy_enter
			on_start = "[PdxGuiWidget.FindChild('character_skills').TriggerAnimation('mouse_enter_panel')]"
		}

		state = {
			name = _mouse_hierarchy_leave
			on_start = "[PdxGuiWidget.FindChild('character_skills').TriggerAnimation('mouse_leave_panel')]"
		}

		### Required Datacontexts
		# A council position type
		# The councillor
		# The active council task
		widget = {
			block "visible"
			{
				visible = "[Not(GuiCouncilPosition.ArePotentialTasksVisible)]"
			}
			size = { 100% 100% }

			state = {
				name = _show
				using = Animation_FadeIn_Standard
			}

			state = {
				name = _hide
				using = Animation_FadeOut_Quick
			}

			portrait_council = {
				name = "councillor_portrait"
				datacontext = "[ActiveCouncilTask.GetCouncillor]"
				visible = "[Character.IsValid]"
				parentanchor = bottom
				position = { 15 4 }

				blockoverride "portrait_button_no_character_text"
				{
					text = "PORTRAIT_NO_COUNCILLOR"
				}

				blockoverride "portrait_button"
				{
					using = tooltip_ws
				}
			}

			block "missing_councillor"
			{
				portrait_council = {
					name = "councillor_portrait_blank"
					visible = "[And( Not(Character.IsValid), CouncilWindow.IsPlayerCouncilShown)]"
					parentanchor = center

					blockoverride "portrait_button_no_character_text"
					{
						text = "[SelectLocalization(IsNomad( GetPlayer ) , 'PORTRAIT_NO_KURULTAI', 'PORTRAIT_NO_COUNCILLOR' )]"
					}

					blockoverride "portrait_button_template_onclick"
					{
						onclick = "[GuiCouncilPosition.SelectCouncillor]"
					}

					text_label_center = {
						parentanchor = bottom|hcenter
						position = { 0 -10 }
						text = "COUNCILLOR_CLICK_TO_HIRE"
						default_format = "#low;italic"
						max_width = 235
					}

					blockoverride "onclick" {
						onclick = "[GuiCouncilPosition.SelectCouncillor]"

						button_icon = {
							parentanchor = center
							alwaystransparent = yes
							size = { 40 40 }
							position = { 0 70 }
							texture = "gfx/interface/icons/flat_icons/plus.dds"
						}
					}
					blockoverride "portrait_button"
					{
						using = tooltip_ws
					}
				}

				portrait_council = {
					name = "councillor_portrait_blank_liege"
					visible = "[And( Not(Character.IsValid), CouncilWindow.IsLiegeCouncilShown )]"
					parentanchor = center

					text_label_center = {
						parentanchor = bottom|hcenter
						position = { 0 -10 }
						text = "COUNCILLOR_BLANK_LIEGE"
						default_format = "#low;italic"
					}

					blockoverride "portrait_button"
					{
						using = tooltip_ws
					}
				}
			}
		}

		vbox = {
			hbox = {
				layoutpolicy_horizontal = expanding
				margin = { 0 5 }
				margin_right = 3

				background = {
					using = Background_Area_Dark
				}

				background = {
					visible = "[ObjectsEqual( Character.Self, GetPlayer )]"
					texture = "gfx/interface/component_masks/patterns/mask_pattern_02.dds"
					spriteType = Corneredtiled
					alpha = 0.4

					using = Color_Blue

					modify_texture = {
						texture = "gfx/interface/component_masks/mask_fade_horizontal.dds"
						blend_mode = alphamultiply
						alpha = 0.9
						mirror = horizontal
					}

					modify_texture = {
						texture = "gfx/interface/component_masks/mask_texture_01.dds"
						spriteType = Corneredtiled
						spriteborder = { 15 15 }
						blend_mode = alphamultiply
					}
				}

				background = {
					visible = "[ObjectsEqual( Character.Self, GetPlayer )]"
					texture = "gfx/interface/component_masks/mask_frame.dds"
					spriteType = Corneredstretched
					spriteborder = { 15 15 }
					alpha = 0.25

					using = Color_Blue

					modify_texture = {
						texture = "gfx/interface/component_masks/mask_fade_horizontal.dds"
						blend_mode = alphamultiply
						alpha = 0.9
						mirror = horizontal
					}
				}

				spacer = {
					visible = "[GuiCouncilPosition.CanPotentiallySelectCouncillor]"
					size = { 6 6 }
				}

				spacer = {
					visible = "[CouncilWindow.IsLiegeCouncilShown]"
					size = { 5 5 }
				}

				block "replace_councillor"
				{
					hbox = {

						button_round = {
							name = "replace"
							visible = "[GuiCouncilPosition.CanPotentiallySelectCouncillor]"
							onclick = "[GuiCouncilPosition.SelectCouncillor]"
							enabled = "[GuiCouncilPosition.CanSelectCouncillor]"
							tooltip = "[GuiCouncilPosition.GetSelectCouncillorTooltip]" #COUNCILWINDOW_TT_REPLACE
							using = tooltip_se

							button_change = {
								alwaystransparent = yes
								parentanchor = center
							}
						}

						button_round = {
							name = "leave"
							visible = "[ObjectsEqual( GetPlayer.Self, Character.Self )]"
							onclick = "[CouncilWindow.OnLeaveCouncil]"
							tooltip = "DECISIONS_VIEW_LEAVE_COUNCIL_TT"
							using = tooltip_se

							button_leave_council = {
								mirror = horizontal
								parentanchor = center
								alwaystransparent = yes
							}
						}
					}
				}

				vbox = {
					layoutpolicy_horizontal = expanding
					margin_left = 6

					text_single = {
						name = "title"
						layoutpolicy_horizontal = expanding
						text = "[ActiveCouncilTask.GetPositionName|E]"
						tooltip = "[ActiveCouncilTask.GetPositionTooltip]"
						autoresize = no
						fontsize_min = 13
					}

					text_single = {
						layoutpolicy_horizontal = expanding
						text = "[Character.GetShortUINameNoTooltip|U]"
						default_format = "#high"
						align = nobaseline
						autoresize = no
						fontsize_min = 13
					}
				}

				skill_icon_label = {
					datacontext = "[GuiCouncilPosition.GetMainSkillItem]"
					visible = "[ActiveCouncilTask.HasMainSkill]"

					blockoverride "icon_size"
					{
						size = { 35 35 }
					}

					blockoverride "font_size" {
						using = Font_Size_Medium
						visible = "[And( ActiveCouncilTask.HasMainSkill, ActiveCouncilTask.HasCouncillor )]"
						min_width = 13
					}

					blockoverride "tooltip"
					{
						tooltip_visible = "[And( ActiveCouncilTask.HasMainSkill, ActiveCouncilTask.HasCouncillor )]"
						tooltip = "[SkillItem.GetSkillBreakdownTooltip]"
					}
				}


				### Character Skills
				widget = {
					size = { 42 46 }
					allow_outside = yes

					block "skill_visible" {
						visible = "[And(Character.IsValid, Not(ActiveCouncilTask.HasMainSkill))]"
					}

					widget = {
						name = "character_skills"
						allow_outside = yes
						size = { 100% 100% }
						position = { 56 0 }
						alpha = 0

						state = {
							name = "mouse_enter_panel"
							position = { 0 0 }
							alpha = 1
							using = Animation_Curve_Default
							duration = 0.05
						}

						state = {
							name = "mouse_leave_panel"
							position = { 56 0 }
							alpha = 0
							using = Animation_Curve_Default
							duration = 0.05
						}

						vbox = {
							parentanchor = right|top
							layoutpolicy_vertical = expanding
							margin = { 8 4 }
							max_width = 48
							spacing = 2

							background = {
								using = Background_Area_Light
								using = Mask_Rough_Edges
							}

							hbox = {
								spacing = 4

								background = {
									texture = "gfx/interface/window_character/character_view_skills_bg.dds"
									frame = 1
									framesize = { 70 26 }
									margin = { 10 0 }
								}
								icon = {
									texture = "gfx/interface/icons/icon_skills.dds"
									size = { 24 24 }
									framesize = { 60 60 }
									frame = 1
								}
								text_single = {
									text = "[Character.GetSkill('diplomacy')]"
									align = nobaseline
								}
							}

							hbox = {
								spacing = 4

								background = {
									texture = "gfx/interface/window_character/character_view_skills_bg.dds"
									frame = 2
									framesize = { 70 26 }
									margin = { 10 0 }
								}

								icon = {
									texture = "gfx/interface/icons/icon_skills.dds"
									size = { 24 24 }
									framesize = { 60 60 }
									frame = 2
								}

								text_single = {
									text = "[Character.GetSkill('martial')]"
									align = nobaseline
								}
							}

							hbox = {
								spacing = 4

								background = {
									texture = "gfx/interface/window_character/character_view_skills_bg.dds"
									frame = 3
									framesize = { 70 26 }
									margin = { 10 0 }
								}

								icon = {
									texture = "gfx/interface/icons/icon_skills.dds"
									size = { 24 24 }
									framesize = { 60 60 }
									frame = 3
								}

								text_single = {
									text = "[Character.GetSkill('stewardship')]"
									align = nobaseline
								}
							}

							hbox = {
								spacing = 4

								background = {
									texture = "gfx/interface/window_character/character_view_skills_bg.dds"
									frame = 4
									framesize = { 70 26 }
									margin = { 10 0 }
								}

								icon = {
									texture = "gfx/interface/icons/icon_skills.dds"
									size = { 24 24 }
									framesize = { 60 60 }
									frame = 4
								}
								text_single = {
									text = "[Character.GetSkill('intrigue')]"
									align = nobaseline
								}
							}

							hbox = {
								spacing = 4

								background = {
									texture = "gfx/interface/window_character/character_view_skills_bg.dds"
									frame = 5
									framesize = { 70 26 }
									margin = { 10 0 }
								}

								icon = {
									texture = "gfx/interface/icons/icon_skills.dds"
									size = { 24 24 }
									framesize = { 60 60 }
									frame = 5
								}
								text_single = {
									text = "[Character.GetSkill('learning')]"
									align = nobaseline
								}
							}
						}
					}
				}
			}

			widget = {
				visible = "[GuiCouncilPosition.ArePotentialTasksVisible]"

				block "expanded_potential_tasks"
				{
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					state = {
						name = _show
						using = Animation_FadeIn_Quick
					}

					flowcontainer = {
						name = "council_position_tasks"
						datamodel = "[GuiCouncilPosition.GetPotentialCouncilTasks]"
						parentanchor = bottom|hcenter
						margin_bottom = 10
						direction = vertical
						spacing = 3
						alwaystransparent = no

						item = {
							button_standard = {
								name = "potential_task"
								datacontext = "[GuiPotentialCouncilTask.GetCouncilTaskType]"
								datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
								visible = "[GuiPotentialCouncilTask.IsVisible]"
								size = { 220 25 }

								enabled = "[GuiPotentialCouncilTask.CanSelect]"
								onclick = "[GuiPotentialCouncilTask.SelectTaskType]"

								tooltip = "[CouncilTaskType.GetEffectDesc( ActiveCouncilTask.GetScopes )]"

								text_single = {
									parentanchor = left|vcenter
									position = { 10 0 }
									text = "[CouncilTaskType.GetName]"
									align = nobaseline
									default_format = "#clickable"
								}

								container = {
									visible = "[CouncilTaskType.HasMainSkill]"
									parentanchor = right|vcenter

									skill_icon_label_vertical = {
										datacontext = "[GuiCouncilPosition.GetSkillItemForTask(CouncilTaskType.Self)]"

										blockoverride "font_size" {
											min_width = 13
										}

										blockoverride "value"
										{
											text = "[GuiCouncilPosition.GetSkillModifierForTask(CouncilTaskType.Self)|+=]"
										}

										blockoverride "tooltip"
										{
										}
									}
								}
							}
						}
					}
				}
			}

			widget = {
				visible = "[Not(GuiCouncilPosition.ArePotentialTasksVisible)]"
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding

				state = {
					name = _show
					using = Animation_FadeIn_Quick
				}

				icon = {
					size = { 40 40 }
					parentanchor = top|right
					position = { -4 8 }
					texture = "gfx/interface/icons/modifiers/council_positive.dds"
					tooltip = "ON_COUNCIL_EFFECTS"
					visible = "[Character.IsLocalPlayer]"
				}

				portrait_opinion = {
					visible = "[And(Character.IsValid, Not(Character.IsLocalPlayer) )]"
					parentanchor = bottom|hcenter
					position = { 0 -4 }

					blockoverride "opinion_text"
					{
						text = "[Character.GetOpinionOf( Character.GetLiege )|=]"
						fonttintcolor = "[Character.GetOpinionOfTint( Character.GetLiege )]"
					}

					blockoverride "ott_heading_text"
					{
						text = "[Character.GetOpinionHeadingText( Character.GetLiege )]"
					}

					blockoverride "ott_opinion_value_text"
					{
						text = "[Character.GetOpinionOf( Character.GetLiege )|=]"
						fonttintcolor = "[Character.GetOpinionOfTint( Character.GetLiege )]"
					}

					blockoverride "ott_opinion_breakdown_text"
					{
						text = "[Character.GetOpinionBreakdownText( Character.GetLiege )|=]"
					}
				}

				background = {
					texture = "gfx/interface/component_masks/mask_fade_corner.dds"
					color = { 0.12 0.12 0.12 1 }
					alpha = 0.5
					margin_top = -130
					margin_left = -150
				}

				flowcontainer = {
					parentanchor = bottom|right
					ignoreinvisible = yes
					margin_bottom = 3

					icon = {
						name = "church_approval_icon"
						visible = "[Character.IsTheocraticLesseeOf( GetPlayer )]"

						texture = "gfx/interface/icons/icon_bishop_approval.dds"
						framesize = { 120 120 }
						size = { 50 50 }
						frame = "[Select_int32( And( Character.TheocraticLesseeHasApprovalStatus, Character.TheocraticLesseeApprovesOfLiege ), '(int32)1', '(int32)2' )]"
						tooltip = "[Character.GetTheocraticLesseeApprovalTooltip]"
					}

					flowcontainer = {
						parentanchor = bottom
						margin_bottom = 4
						margin_right = 2

						portrait_status_icons = {
							background = {
								using = Background_Area_Dark
								margin = { 2 4 }
							}
						}
					}

					coa_realm_small_crown = {
						visible = "[Character.HasLandedTitles]"
						parentanchor = bottom
						name = "councillor_realm"
					}
				}

				block "regular_task"
				{
					fixedgridbox = {
						name = "council_position_tasks"
						visible = "[Not(CouncilWindow.IsLiegeCouncilShown)]"
						datamodel = "[GuiCouncilPosition.GetPotentialCouncilTasks]"

						addcolumn = 45
						addrow = 45
						datamodel_wrap = 4
						maxhorizontalslots = 2
						maxverticalslots = 4
						layoutanchor = bottomleft

						parentanchor = bottom|left
						position = { 5 -3 }

						background = {
							texture = "gfx/interface/hud/tab_bg.dds"
							mirror = horizontal
							margin_top = 15
							margin_bottom = 12
							margin_right = 15
							margin_left = 3

							using = Color_Black
							using = Mask_Rough_Edges
						}

						item = {
							container = {
								visible = "[GuiPotentialCouncilTask.IsVisible]"

								widget = {
									size = { 42 42 }

									icon = {
										visible = "[GuiPotentialCouncilTask.IsActive]"
										texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskGlow]"
										parentanchor = center
										size = { 58 58 }
										color = { 1 0.85 0.6 1 }
									}

									button_council_task = {
										visible = "[Or(And(GuiPotentialCouncilTask.CanSelect, Not(CouncilWindow.IsLiegeCouncilShown)), GuiPotentialCouncilTask.IsActive)]"
										parentanchor = center
										size = { 46 46 }
										gfxtype = togglepushbuttongfx
										effectname = "NoHighlight"

										onclick = "[GuiPotentialCouncilTask.SelectTaskType]"
										enabled = "[Not(CouncilWindow.IsLiegeCouncilShown)]"
										down = "[GuiPotentialCouncilTask.IsActive]"

										using = tooltip_ws

										tooltipwidget = {
											council_task_icon_tooltip_widget = {
												using = DefaultTooltipBackground
												using = GeneralTooltipSetup
												alwaystransparent = no
											}
										}

										upframe = 1
										downframe = 1
										uphoverframe = 2
										disableframe = 6

										button_normal = {
											name = "potential_task"
											parentanchor = center
											widgetanchor = center
											effectname = "NoHighlight"
											gfxtype = togglepushbuttongfx
											shaderfile = "gfx/FX/pdxgui_pushbutton.shader"
											texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
											alwaystransparent = yes
											size = { 38 38 }
										}
									}

									widget = {
										size = { 40 40 }
										visible = "[And(Not(GuiPotentialCouncilTask.CanSelect), Not(CouncilWindow.IsLiegeCouncilShown))]"

										icon = {
											parentanchor = center
											size = { 38 38 }
											alwaystransparent = yes

											texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
											alpha = 0.4

											tooltipwidget = {
												invalid_potential_council_task_icon_tooltip_widget = {
													using = DefaultTooltipBackground
													using = GeneralTooltipSetup
													alwaystransparent = no
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}

			vbox = {
				visible = "[Not(CouncilWindow.IsLiegeCouncilShown)]"
				layoutpolicy_horizontal = expanding
				margin = { 7 0 }

				background = {
					using = Background_Area_Dark
				}

				council_task_info = {
					layoutpolicy_horizontal = expanding
				}

				block "assist_task" {}
			}
		}
	}
}

types CouncilTaskTypes
{

	# Requires a GuiPotentialCouncilTask data context to be provided
	type invalid_potential_council_task_icon_tooltip_widget = widget
	{
		size = { 50 50 }

		vbox = {
			restrictparent_min = yes
			minimumsize = { 280 0 }

			margin = { 15 15 }
			spacing = 5

			datacontext = "[GuiPotentialCouncilTask.GetDummyTask]"

			text_single = {
				name = "task_info"
				text = "[GuiPotentialCouncilTask.GetCouncilTaskType.GetName]"
				default_format = "#T"
				layoutpolicy_horizontal = expanding
			}

			text_multi = {
				name = "cannot_select_text"
				text = "[GuiPotentialCouncilTask.GetCannotSelectTooltip]"
				layoutpolicy_horizontal = expanding
				autoresize = yes
				max_width = 280
				align = left
			}
		}
	}

	# Requires an ActiveCouncilTask data context to be provided
	type council_task_icon_tooltip_widget_base = widget
	{
		size = { 50 50 }

		vbox = {
			restrictparent_min = yes
			minimumsize = { 280 0 }
			maximumsize = { 400 0 }

			margin = { 15 15 }
			margin_top = 10
			spacing = 7

			text_multi = {
				name = "task_info"
				block "task_info_heading"
				{
					raw_text = "#D GIVE ME SOME TEXT#!"
				}
				layoutpolicy_horizontal = expanding
				autoresize = yes
				max_width = 380
				align = left
			}

			text_single = {
				name = "progress"
				layoutpolicy_horizontal = expanding

				block "progress_visiblity"
				{
					visible = "[Not( ActiveCouncilTask.GetTaskType.IsInfiniteTask )]"
				}

				text = COUNCIL_TASK_PROGRESSBAR_TOOLTIP_HEADER
				tooltipwidget = {
					council_task_progress_breakdown_widget = {}
				}
			}

			text_multi = {
				name = "effects"
				text = COUNCIL_TASK_EFFECTS
				layoutpolicy_horizontal = expanding
				autoresize = yes
				max_width = 380
				align = left
			}
		}
	}

	# Requires an ActiveCouncilTask data context to be provided
	type council_task_icon_tooltip_widget = council_task_icon_tooltip_widget_base
	{
		datacontext = "[GuiPotentialCouncilTask.GetDummyTaskOrActualIfActive]"
		blockoverride "task_info_heading"
		{
			text = COUNCIL_TASK_TT
		}
		blockoverride "progress_visiblity"
		{
			visible = "[And( Not( ActiveCouncilTask.GetTaskType.IsInfiniteTask ), GuiPotentialCouncilTask.IsActive ) ]"
		}
	}

	type council_task_map_icon_tooltip_widget = council_task_icon_tooltip_widget_base
	{
		blockoverride "task_info_heading"
		{
			text = COUNCIL_TASK_MAP_TT
		}
	}

	type vbox_council_layout = vbox {
		vbox = {
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding
			maximumsize = { -1 932 }
			spacing = 5

			hbox = { # Vizier/Spouse + Spymaster/Court Chaplain
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding
				margin = { 10 0 }
				spacing = 5

				widget_councillor_item = { # Vizier
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_vizier')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"
					visible = "[CouncilOwnerHasVizier]"

					blockoverride "skill_visible" {
						visible = no
					}

					background =  {
						texture = "gfx/interface/skinned/illustrations/council/bg_council_spouse.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.8
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}

					# make spouse portrait unique size, so it doesn't reuse
					# textures from other councilors during hide animation
					blockoverride "portrait_size"
					{
						size = { 260 286 }
					}

					blockoverride "regular_task" {}

					blockoverride "assist_task"
					{
						hbox = {
							visible = "[Character.IsValid]"
							layoutpolicy_horizontal = expanding
							margin = { 5 5 }
							spacing = 3

							button_standard = {
								size = { 190 25 }
								onclick = "[GuiCouncilPosition.ShowHideTasks]"
								tooltip = "[GuiCouncilPosition.GetShowHideTooltip]"
								down = "[GuiCouncilPosition.ArePotentialTasksVisible]"

								text_single = {
									datacontext = "[ActiveCouncilTask.GetTaskTypeOrDefault]"
									parentanchor = vcenter
									position = { 10 0 }
									text = "[CouncilTaskType.GetName]"
									align = nobaseline
								}

								button_change = {
									name = "show_tasks"
									parentanchor = right|vcenter
									position = { -5 0 }
									alwaystransparent = yes
									size = { 25 25 }
								}
							}
						}
					}

					blockoverride "missing_councillor"
					{
						text_label_center = {
							visible = "[And( Not(Character.IsValid), CouncilWindow.IsPlayerCouncilShown )]"
							parentanchor = bottom|hcenter
							position = { 0 -10 }
							text = "COUNCILLOR_MISSING_VIZIER"
							default_format = "#low;italic"
						}

						text_label_center = {
							visible = "[And( Not(Character.IsValid), CouncilWindow.IsLiegeCouncilShown )]"
							parentanchor = bottom|hcenter
							position = { 0 -10 }
							text = "COUNCILLOR_LIEGE_MISSING_VIZIER"
							default_format = "#low;italic"
							max_width = 250
							fontsize_min = 14
						}
					}
				}

				widget_councillor_item = { # Spouse (If you do not have a vizier)
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_spouse')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"
					visible = "[Not( CouncilOwnerHasVizier )]"

					blockoverride "skill_visible" {
						visible = no
					}

					background =  {
						#visible = "[Not( CouncilOwnerNomadic )]" #LotR
						visible = "[Not( Or(CouncilOwnerNomadic, CouncilOwnerOrcish) )]"
						texture = "gfx/interface/skinned/illustrations/council/bg_council_spouse.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.8
					}

					background =  {
						visible = "[CouncilOwnerNomadic]"
						texture = "gfx/interface/illustrations/event_scenes/mpo_tent_interior_mongol.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.8
					}

					background =  { #LotR
						texture = "gfx/interface/illustrations/event_scenes/temple_dwarven.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.7
						visible = "[CouncilOwnerOrcish]"
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}

					# make spouse portrait unique size, so it doesn't reuse
					# textures from other councilors during hide animation
					blockoverride "portrait_size"
					{
						size = { 260 286 }
					}

					blockoverride "replace_councillor"
					{
						spacer = {
							visible = "[Not(CouncilWindow.IsLiegeCouncilShown)]"
							size = { 5 5 }
						}
					}

					blockoverride "regular_task" {}

					blockoverride "assist_task"
					{
						hbox = {
							visible = "[Character.IsValid]"
							layoutpolicy_horizontal = expanding
							margin = { 5 5 }
							spacing = 3

							button_standard = {
								size = { 190 25 }
								onclick = "[GuiCouncilPosition.ShowHideTasks]"
								tooltip = "[GuiCouncilPosition.GetShowHideTooltip]"
								down = "[GuiCouncilPosition.ArePotentialTasksVisible]"

								text_single = {
									datacontext = "[ActiveCouncilTask.GetTaskTypeOrDefault]"
									parentanchor = vcenter
									position = { 10 0 }
									text = "[CouncilTaskType.GetName]"
									align = nobaseline
								}

								button_change = {
									name = "show_tasks"
									parentanchor = right|vcenter
									position = { -5 0 }
									alwaystransparent = yes
									size = { 25 25 }
								}
							}
						}
					}

					blockoverride "missing_councillor"
					{
						text_label_center = {
							visible = "[And( And( Not( CouncilOwnerCanUseVizier ), CouncilWindow.IsPlayerCouncilShown ), Not( Character.IsValid ) )]"
							parentanchor = bottom|hcenter
							position = { 0 -10 }
							text = "COUNCILLOR_MISSING_SPOUSE"
							default_format = "#low;italic"
						}

						text_label_center = {
							visible = "[And( And( CouncilOwnerCanUseVizier, CouncilWindow.IsPlayerCouncilShown ), Not( Character.IsValid ) )]"
							parentanchor = bottom|hcenter
							position = { 0 -10 }
							text = "COUNCILLOR_MISSING_VIZIER"
							default_format = "#low;italic"
						}

						text_label_center = {
							visible = "[And( And( Not( CouncilOwnerCanUseVizier ), CouncilWindow.IsLiegeCouncilShown ), Not( Character.IsValid ) )]"
							parentanchor = bottom|hcenter
							position = { 0 -10 }
							text = "COUNCILLOR_LIEGE_MISSING_SPOUSE"
							default_format = "#low;italic"
							max_width = 250
							fontsize_min = 14
						}

						text_label_center = {
							visible = "[And( And( CouncilOwnerCanUseVizier, CouncilWindow.IsLiegeCouncilShown ), Not( Character.IsValid ) )]"
							parentanchor = bottom|hcenter
							position = { 0 -10 }
							text = "COUNCILLOR_LIEGE_MISSING_VIZIER"
							default_format = "#low;italic"
							max_width = 250
							fontsize_min = 14
						}
					}
				}

				widget_councillor_item = { # Spymaster (If Nomadic it's moved up here)
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_spymaster')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"

					#visible = "[CouncilOwnerNomadic]" #LotR
					visible = "[Or(CouncilOwnerNomadic, CouncilOwnerOrcish)]"

					background =  {
						texture = "gfx/interface/illustrations/event_scenes/mpo_campfire_steppe.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.7
						visible = "[CouncilOwnerNomadic]"
					}
					background =  {
						texture = "gfx/interface/illustrations/event_scenes/throneroom_goblins.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.7
						visible = "[CouncilOwnerOrcish]"
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}
				}

				widget_councillor_item = { # Court Chaplain
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_court_chaplain')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"
					name = "tutorial_court_chaplain"

					#visible = "[Not( CouncilOwnerNomadic )]" #LotR
					visible = "[Not( Or(CouncilOwnerNomadic, CouncilOwnerOrcish) )]"

					datacontext = "[GetIllustration( 'character_religion_interior' )]"

					background =  {
						texture = "[Illustration.GetTexture( ActiveCouncilTask.GetCouncillor.MakeScope )]"
						fittype = centercrop
						alpha = 0.7
						using = Mask_Rough_Edges
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}
				}
			}

			hbox = { # Chancellor + Steward
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding
				margin = { 10 0 }
				spacing = 5

				# visible = "[Not( CouncilOwnerNomadic )]" #LotR
				visible = "[Not( Or(CouncilOwnerNomadic, CouncilOwnerOrcish) )]"

				widget_councillor_item = { # Chancellor
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_chancellor')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"
					
					# visible = "[Not( CouncilOwnerNomadic )]" #LotR
					visible = "[Not( Or(CouncilOwnerNomadic, CouncilOwnerOrcish) )]"

					background =  {
						texture = "gfx/interface/skinned/illustrations/council/bg_council_chancellor.dds"
						fittype = centercrop
						alpha = 0.6
						using = Mask_Rough_Edges
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}
				}

				widget_councillor_item = { # Steward
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_steward')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"

					background =  {
						texture = "gfx/interface/skinned/illustrations/council/bg_council_steward.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.7
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}
				}
			}

			hbox = { # Marshal + Spymaster
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding
				margin = { 10 0 }
				margin_bottom = 5
				spacing = 5

				#visible = "[Not( CouncilOwnerNomadic )]" #LotR
				visible = "[Not( Or(CouncilOwnerNomadic, CouncilOwnerOrcish) )]" #LotR

				widget_councillor_item = { # Marshal
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_marshal')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"

					background =  {
						texture = "gfx/interface/skinned/illustrations/council/bg_council_marshal.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.7
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}
				}

				widget_councillor_item = { # Spymaster
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					datacontext = "[CouncilWindow.GetCouncillor('councillor_spymaster')]"
					datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
					datacontext = "[ActiveCouncilTask.GetPositionType]"
					datacontext = "[ActiveCouncilTask.GetCouncillor]"

					background =  {
						texture = "gfx/interface/skinned/illustrations/council/bg_council_spymaster.dds"
						fittype = centercrop
						using = Mask_Rough_Edges
						alpha = 0.7
					}

					background = {
						texture = "gfx/interface/component_masks/mask_vignette.dds"
						color = { 0.15 0.15 0.15 1 }
						alpha = 0.3
					}
				}
			}

			vbox = {
				name = "kurultai_council_first"
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding

				visible = "[CouncilOwnerNomadic]" #LotR

				# Kurultai positions 1 & 2
				kurultai_hbox = {

					visible = "[CouncilOwnerNomadic]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding


					margin = { 10 0 }
					margin_bottom = 5
					spacing = 5
				}

				# Kurultai positions 3 & 4
				kurultai_hbox = {
					visible = "[CouncilOwnerNomadic]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					margin = { 10 0 }
					margin_bottom = 5
					spacing = 5

					blockoverride "kurultai_datamodel_first"
					{
						datacontext = "[CouncilWindow.GetCouncillor('councillor_kurultai_3')]"
					}
					blockoverride "kurultai_datamodel_second"
					{
						datacontext = "[CouncilWindow.GetCouncillor('councillor_kurultai_4')]"
					}
				}
			}

			vbox = { #LotR - Orc-Meet
				name = "orc_meet_council_first"
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding
				
				visible = "[CouncilOwnerOrcish]"

				# Orc-Meet positions 1 & 2
				orc_meet_hbox = {

					visible = "[CouncilOwnerOrcish]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding


					margin = { 10 0 }
					margin_bottom = 5
					spacing = 5
				}

				# Orc-Meet positions 3 & 4
				orc_meet_hbox = {
					visible = "[CouncilOwnerOrcish]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					margin = { 10 0 }
					margin_bottom = 5
					spacing = 5

					blockoverride "orc_meet_datamodel_first"
					{
						datacontext = "[CouncilWindow.GetCouncillor('councillor_orc_3')]"
					}
					blockoverride "orc_meet_datamodel_second"
					{
						datacontext = "[CouncilWindow.GetCouncillor('councillor_orc_4')]"
					}
				}
			}
			
		}

		expand = {
			layoutpolicy_vertical = growing
		}
	}


	type kurultai_hbox = hbox
	{
		widget_councillor_item = { # Kurultai
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding

			blockoverride "visible" {}

			block "kurultai_datamodel_first"
			{
				datacontext = "[CouncilWindow.GetCouncillor('councillor_kurultai_1')]"
			}

			datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
			datacontext = "[ActiveCouncilTask.GetPositionType]"
			datacontext = "[ActiveCouncilTask.GetCouncillor]"

			background = {
				texture = "gfx/interface/illustrations/event_scenes/mpo_camp_steppe.dds"
				fittype = centercrop
				using = Mask_Rough_Edges
				alpha = 0.7
			}

			background = {
				texture = "gfx/interface/component_masks/mask_vignette.dds"
				color = { 0.15 0.15 0.15 1 }
				alpha = 0.3
			}
		}

		widget_councillor_item = { # Kurultai
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding

			blockoverride "visible" {}

			block "kurultai_datamodel_second"
			{
				datacontext = "[CouncilWindow.GetCouncillor('councillor_kurultai_2')]"
			}

			datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
			datacontext = "[ActiveCouncilTask.GetPositionType]"
			datacontext = "[ActiveCouncilTask.GetCouncillor]"

			background = {
				texture = "gfx/interface/illustrations/event_scenes/mpo_camp_steppe.dds"
				fittype = centercrop
				using = Mask_Rough_Edges
				alpha = 0.7
			}

			background = {
				texture = "gfx/interface/component_masks/mask_vignette.dds"
				color = { 0.15 0.15 0.15 1 }
				alpha = 0.3
			}
		}

		blockoverride "regular_task" {
			flowcontainer = {
				name = "council_position_tasks"
				visible = "[Not(CouncilWindow.IsLiegeCouncilShown)]"
				datamodel = "[GuiCouncilPosition.GetPotentialCouncilTasks]"
				parentanchor = bottom|left
				position = { 2 -3 }
				ignoreinvisible = yes

				background = {
					texture = "gfx/interface/hud/tab_bg.dds"
					mirror = horizontal
					margin_top = 15
					margin_bottom = 8
					margin_right = 10
					margin_left = 3

					using = Color_Black
					using = Mask_Rough_Edges
				}

				item = {
					container = {
						ignoreinvisible = yes
						visible = "[GuiPotentialCouncilTask.IsActive]"

						widget = {
							size = { 50 50 }

							icon = {
								visible = "[GuiPotentialCouncilTask.IsActive]"
								texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskGlow]"
								parentanchor = center
								size = { 62 62 }
								color = { 1 0.85 0.6 1 }
							}

							button = {
								size = { 50 50 }
								parentanchor = center

								button_council_task = {
									visible = "[Or(And(GuiPotentialCouncilTask.CanSelect, Not(CouncilWindow.IsLiegeCouncilShown)), 	GuiPotentialCouncilTask.IsActive)]"
									parentanchor = center
									size = { 50 50 }
									gfxtype = togglepushbuttongfx
									effectname = "NoHighlight"
									onclick = "[GuiCouncilPosition.ShowHideTasks]"
									tooltip = "[GuiCouncilPosition.GetShowHideTooltip]"
									down = "[GuiCouncilPosition.ArePotentialTasksVisible]"

									using = tooltip_ws

									tooltipwidget = {
										council_task_icon_tooltip_widget = {
											using = DefaultTooltipBackground
											using = GeneralTooltipSetup
											alwaystransparent = no
										}
									}

									button_normal = {
										name = "potential_task"
										parentanchor = center
										widgetanchor = center
										effectname = "NoHighlight"
										gfxtype = togglepushbuttongfx
										shaderfile = "gfx/FX/pdxgui_pushbutton.shader"
										texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
										alwaystransparent = yes
										size = { 42 42 }
									}
								}

								widget = {
									size = { 40 40 }
									visible = "[And(Not(GuiPotentialCouncilTask.CanSelect), Not(CouncilWindow.IsLiegeCouncilShown))]"

									icon = {
										parentanchor = center
										size = { 42 42 }
										alwaystransparent = yes
										texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
										alpha = 0.4

										tooltipwidget = {
											invalid_potential_council_task_icon_tooltip_widget = {
												using = DefaultTooltipBackground
												using = GeneralTooltipSetup
												alwaystransparent = no
											}
										}
									}
								}

								button_round = {
									name = "show_tasks"
									parentanchor = bottom|right
									size = { 25 25 }
									position = { 5 0 }
									alwaystransparent = yes

									button_change = {
										size = { 19 19 }
										alwaystransparent = yes
										parentanchor = center
									}
								}
							}
						}
					}
				}
			}
		}

		blockoverride "assist_task" {}

		blockoverride "expanded_potential_tasks" {
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding

			flowcontainer = {
				name = "potential_council_position_tasks"
				parentanchor = bottom|left
				position = { 2 -3 }
				direction = vertical

				background = {
					mirror = horizontal
					margin_top = -10
					margin_bottom = 4
					margin_right = 5
					margin_left = 4

					using = Background_Area_Dark
					using = Mask_Rough_Edges
				}

				widget = {
					size = { 100 35 }

					icon = {
						texture = "gfx/interface/skins/nomad/component_decoration/decoration_frame_top.dds"
						spriteType = Corneredtiled
						spriteborder = { 100 0 }
						texture_density = 2
						size = { 150 22 }
						parentanchor = top|hcenter
						position = { 1 7 }
					}

					icon = {
						size = { 32 32 }
						texture = "gfx/interface/component_masks/mask_circle.dds"
						parentanchor = center
					}

					button_round = {
						parentanchor = center
						size = { 30 30 }

						onclick = "[GuiCouncilPosition.ShowHideTasks]"

						tooltip = "CLOSE_TOOLTIP"

						button_icon = {
							parentanchor = center
							alwaystransparent = yes
							texture = "gfx/interface/icons/flat_icons/arrow_vertical.dds"
							size = { 30 30 }
							position = { 0 7 }
							mirror = vertical
						}
					}
				}

				fixedgridbox = {
					name = "council_position_tasks"
					datamodel = "[GuiCouncilPosition.GetPotentialCouncilTasks]"
					addcolumn = 50
					addrow = 50
					datamodel_wrap = 4
					maxhorizontalslots = 2
					maxverticalslots = 4

					alwaystransparent = no

					item = {
						widget = {
							size = { 50 50 }

							icon = {
								visible = "[GuiPotentialCouncilTask.IsActive]"
								texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskGlow]"
								parentanchor = center
								size = { 62 62 }
								color = { 1 0.85 0.6 1 }
							}

							button_council_task = {
								name = "potential_task"
								datacontext = "[GuiPotentialCouncilTask.GetCouncilTaskType]"
								datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
								visible = "[Or(And(GuiPotentialCouncilTask.CanSelect, Not(CouncilWindow.IsLiegeCouncilShown)), 	GuiPotentialCouncilTask.IsActive)]"
								size = { 50 50 }

								enabled = "[GuiPotentialCouncilTask.CanSelect]"
								onclick = "[GuiPotentialCouncilTask.SelectTaskType]"

								button_normal = {
									name = "potential_task"
									parentanchor = center
									widgetanchor = center
									effectname = "NoHighlight"
									gfxtype = togglepushbuttongfx
									shaderfile = "gfx/FX/pdxgui_pushbutton.shader"
									texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
									alwaystransparent = yes
									size = { 42 42 }
								}

								using = tooltip_ws

								tooltipwidget = {
									council_task_icon_tooltip_widget = {
										using = DefaultTooltipBackground
										using = GeneralTooltipSetup
										alwaystransparent = no
									}
								}
							}

							widget = {
								size = { 50 50 }
								visible = "[And(Not(GuiPotentialCouncilTask.CanSelect), Not(CouncilWindow.IsLiegeCouncilShown))]"

								icon = {
									parentanchor = center
									size = { 42 42 }
									alwaystransparent = yes
									texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
									alpha = 0.4

									using = tooltip_ws

									tooltipwidget = {
										invalid_potential_council_task_icon_tooltip_widget = {
											using = DefaultTooltipBackground
											using = GeneralTooltipSetup
											alwaystransparent = no
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	
	type orc_meet_hbox = hbox
	{
		widget_councillor_item = { # Orc Councillor 1
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding

			blockoverride "visible" {}

			block "orc_meet_datamodel_first"
			{
				datacontext = "[CouncilWindow.GetCouncillor('councillor_orc_1')]"
			}

			datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
			datacontext = "[ActiveCouncilTask.GetPositionType]"
			datacontext = "[ActiveCouncilTask.GetCouncillor]"

			background = {
				texture = "gfx/interface/illustrations/event_scenes/throneroom_goblins.dds"
				fittype = centercrop
				using = Mask_Rough_Edges
				alpha = 0.7
			}
		}

		widget_councillor_item = { # Orc Councillor 2
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding

			blockoverride "visible" {}

			block "orc_meet_datamodel_second"
			{
				datacontext = "[CouncilWindow.GetCouncillor('councillor_orc_2')]"
			}

			datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
			datacontext = "[ActiveCouncilTask.GetPositionType]"
			datacontext = "[ActiveCouncilTask.GetCouncillor]"

			background = {
				texture = "gfx/interface/illustrations/event_scenes/throneroom_goblins.dds"
				fittype = centercrop
				using = Mask_Rough_Edges
				alpha = 0.7
			}
		}

		blockoverride "regular_task" {
			flowcontainer = {
				name = "council_position_tasks"
				visible = "[Not(CouncilWindow.IsLiegeCouncilShown)]"
				datamodel = "[GuiCouncilPosition.GetPotentialCouncilTasks]"
				parentanchor = bottom|left
				position = { 2 -3 }
				ignoreinvisible = yes

				background = {
					texture = "gfx/interface/hud/tab_bg.dds"
					mirror = horizontal
					margin_top = 15
					margin_bottom = 8
					margin_right = 10
					margin_left = 3

					using = Color_Black
					using = Mask_Rough_Edges
				}

				item = {
					container = {
						ignoreinvisible = yes
						visible = "[GuiPotentialCouncilTask.IsActive]"

						widget = {
							size = { 50 50 }

							icon = {
								visible = "[GuiPotentialCouncilTask.IsActive]"
								texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskGlow]"
								parentanchor = center
								size = { 62 62 }
								color = { 1 0.85 0.6 1 }
							}

							button = {
								size = { 50 50 }
								parentanchor = center

								button_council_task = {
									visible = "[Or(And(GuiPotentialCouncilTask.CanSelect, Not(CouncilWindow.IsLiegeCouncilShown)), 	GuiPotentialCouncilTask.IsActive)]"
									parentanchor = center
									size = { 50 50 }
									gfxtype = togglepushbuttongfx
									effectname = "NoHighlight"
									onclick = "[GuiCouncilPosition.ShowHideTasks]"
									tooltip = "[GuiCouncilPosition.GetShowHideTooltip]"
									down = "[GuiCouncilPosition.ArePotentialTasksVisible]"

									using = tooltip_ws

									tooltipwidget = {
										council_task_icon_tooltip_widget = {
											using = DefaultTooltipBackground
											using = GeneralTooltipSetup
											alwaystransparent = no
										}
									}

									button_normal = {
										name = "potential_task"
										parentanchor = center
										widgetanchor = center
										effectname = "NoHighlight"
										gfxtype = togglepushbuttongfx
										shaderfile = "gfx/FX/pdxgui_pushbutton.shader"
										texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
										alwaystransparent = yes
										size = { 42 42 }
									}
								}

								widget = {
									size = { 40 40 }
									visible = "[And(Not(GuiPotentialCouncilTask.CanSelect), Not(CouncilWindow.IsLiegeCouncilShown))]"

									icon = {
										parentanchor = center
										size = { 42 42 }
										alwaystransparent = yes
										texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
										alpha = 0.4

										tooltipwidget = {
											invalid_potential_council_task_icon_tooltip_widget = {
												using = DefaultTooltipBackground
												using = GeneralTooltipSetup
												alwaystransparent = no
											}
										}
									}
								}

								button_round = {
									name = "show_tasks"
									parentanchor = bottom|right
									size = { 25 25 }
									position = { 5 0 }
									alwaystransparent = yes

									button_change = {
										size = { 19 19 }
										alwaystransparent = yes
										parentanchor = center
									}
								}
							}
						}
					}
				}
			}
		}

		blockoverride "assist_task" {}

		blockoverride "expanded_potential_tasks" {
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding

			flowcontainer = {
				name = "potential_orc_council_position_tasks"
				parentanchor = bottom|left
				position = { 2 -3 }
				direction = vertical

				background = {
					mirror = horizontal
					margin_top = -10
					margin_bottom = 4
					margin_right = 5
					margin_left = 4

					using = Background_Area_Dark
					using = Mask_Rough_Edges
				}

				widget = {
					size = { 100 35 }

					icon = {
						texture = "gfx/interface/skins/nomad/component_decoration/decoration_frame_top.dds"
						spriteType = Corneredtiled
						spriteborder = { 100 0 }
						texture_density = 2
						size = { 150 22 }
						parentanchor = top|hcenter
						position = { 1 7 }
					}

					icon = {
						size = { 32 32 }
						texture = "gfx/interface/component_masks/mask_circle.dds"
						parentanchor = center
					}

					button_round = {
						parentanchor = center
						size = { 30 30 }

						onclick = "[GuiCouncilPosition.ShowHideTasks]"

						tooltip = "CLOSE_TOOLTIP"

						button_icon = {
							parentanchor = center
							alwaystransparent = yes
							texture = "gfx/interface/icons/flat_icons/arrow_vertical.dds"
							size = { 30 30 }
							position = { 0 7 }
							mirror = vertical
						}
					}
				}

				fixedgridbox = {
					name = "council_position_tasks"
					datamodel = "[GuiCouncilPosition.GetPotentialCouncilTasks]"
					addcolumn = 50
					addrow = 50
					datamodel_wrap = 4
					maxhorizontalslots = 2
					maxverticalslots = 4

					alwaystransparent = no

					item = {
						widget = {
							size = { 50 50 }

							icon = {
								visible = "[GuiPotentialCouncilTask.IsActive]"
								texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskGlow]"
								parentanchor = center
								size = { 62 62 }
								color = { 1 0.85 0.6 1 }
							}

							button_council_task = {
								name = "potential_task"
								datacontext = "[GuiPotentialCouncilTask.GetCouncilTaskType]"
								datacontext = "[GuiCouncilPosition.GetActiveCouncilTask]"
								visible = "[Or(And(GuiPotentialCouncilTask.CanSelect, Not(CouncilWindow.IsLiegeCouncilShown)), 	GuiPotentialCouncilTask.IsActive)]"
								size = { 50 50 }

								enabled = "[GuiPotentialCouncilTask.CanSelect]"
								onclick = "[GuiPotentialCouncilTask.SelectTaskType]"

								button_normal = {
									name = "potential_task"
									parentanchor = center
									widgetanchor = center
									effectname = "NoHighlight"
									gfxtype = togglepushbuttongfx
									shaderfile = "gfx/FX/pdxgui_pushbutton.shader"
									texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
									alwaystransparent = yes
									size = { 42 42 }
								}

								using = tooltip_ws

								tooltipwidget = {
									council_task_icon_tooltip_widget = {
										using = DefaultTooltipBackground
										using = GeneralTooltipSetup
										alwaystransparent = no
									}
								}
							}

							widget = {
								size = { 50 50 }
								visible = "[And(Not(GuiPotentialCouncilTask.CanSelect), Not(CouncilWindow.IsLiegeCouncilShown))]"

								icon = {
									parentanchor = center
									size = { 42 42 }
									alwaystransparent = yes
									texture = "[GuiPotentialCouncilTask.GetTaskAsset.GetTaskIcon]"
									alpha = 0.4

									using = tooltip_ws

									tooltipwidget = {
										invalid_potential_council_task_icon_tooltip_widget = {
											using = DefaultTooltipBackground
											using = GeneralTooltipSetup
											alwaystransparent = no
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}