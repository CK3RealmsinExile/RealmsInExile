############################
# FORCES OF EVIL: SORCERY
# by Gseg and ispanets
############################
# evil.0001 = Select Place of Ritual
# a) Temple
# b) The Wilds
# c) Home
############################
# evil.0010 & evil.0011 = Select Temple between available holy sites
# a) Temple 1 = Less cooldown after the spell
# b) Temple 2 = Reduced Piety cost.
# c) Temple 3 = Higher chance of Critical Succes.
# d) Temple 4 = The cost in Piety will be replaced by Gold.
# e) Temple 5 = Lower chance of Failure.
############################
# evil.0012 = Select kind of Sorcery
# a) Call the Horde (minor spells to recruit and reforce) - min cost: 250
# b) Summoning (Major spell to gain different modifiers) - min cost: 300
# c) Cast a Spell of Power (Spells of Destruction) - min cost: 600
# d) Malicious Artifacts (Permanent Modifiers in the futue with artifacts?) - min cost: 1000
# e) Houses of Lamentation (Nazgul Spells) - min cost: 300
# f) Piercing, Opening and Treachery (Deception spells) - min cost: 300
# g) Second Darkness (Great Spells) - min cost: 1000
############################
# evil.0014 = Options for Call the Horde
# Call the Horde, Mark of War, Assemble the Warchiefs.
# evil.0015 = Options for Summoning
# Rise the Dead, Invoke Watchers, Summon a being of Darkness.
# evil.0016 = Options for Spells
# Cracks of the Earth, Draw forth Dark Vitality, Words of Power.
# evil.0017 = Options for Malicious Artifacts
# Forge Morgul Weapons.
# evil.0018 = Options for Houses of Lamentation
# Pursue Them Relentlessly, Black Breath, Nazgul Restoration.
# evil.0019 = Options for Piercing, Opening and Treachery
# Ambassador of Darkness, Shapeshifting, Reveal the Secrets.
# evil.0020 = Options for Second Darkness
# Cast the Darkness, Abnormal Winter, The Plague.
############################
# evil.0021 = Critical Failure (Empty, needs to be added as negative effects related to the sorcery WIP)
# evil.0022 = Failure (The sorcery fails, nothing happens)
# evil.0023 = Success (The normal effect)
# evil.0024 = Critical Succes (Better effects for all the spells!)
############################
# ((W I P))
# - ADD TRAINING SORCERER CHAIN
# - ADD MORE SPELLS AND HAVE FUN GUYS :D
############################
# NOTES:
# - All the modifiers of this txt are in "01_magic_modifiers.txt"
# - This event is triggered by the decision "lotr_dark_ritual_decision.txt"
############################

namespace = evil

evil.0001 = {
	title = evil.0001.t
	desc = evil.0001.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = personality_dishonorable
	}
	override_background = { reference = throne_room_evil }

	immediate = {
		play_music_cue = "mx_cue_illness"

		#add_character_flag = {
		#	flag = planning_an_activity
		#	days = 30
		#}

		root.location = {
			save_scope_as = background_terrain_scope
			barony = { save_scope_as = home_location }
		}

		set_up_holy_sites_for_selection_effect = yes
	}

	option = { # Sacred Place
		trigger = {
			OR = {
				scope:holy_site_1 = {county.holder = root}
				scope:holy_site_2 = {county.holder = root}
				scope:holy_site_3 = {county.holder = root}
				scope:holy_site_4 = {county.holder = root}
				scope:holy_site_5 = {county.holder = root}
			}
		}

		name = evil.0001.a
		custom_tooltip = evil.0001.a.tt
		set_variable = {
			name = ritual_location 
			#value = 1
			value = flag:sacred_place
		}

		if = {
			limit = {
				OR = {
					scope:holy_site_1 = {county.holder = root}
					scope:holy_site_2 = {county.holder = root}
					scope:holy_site_3 = {county.holder = root}
				}
			}
			trigger_event = evil.0010
		}
		else = {
			trigger_event = evil.0011
		}

		ai_chance = {
			base = 100
		}
	}

	option = { # Wilds
		name = evil.0001.b
		custom_tooltip = evil.0001.b.tt
		set_variable = {
			name = ritual_location 
			# value = 2
			value = flag:wilds
		}
		remove_variable = temple

		# trigger_event = evil.0012

		ai_chance = {
			base = 1
		}
	}

	option = { # Home
		name = evil.0001.c
		custom_tooltip = evil.0001.c.tt

		set_variable = {
			name = ritual_location
			# value = 3
			value = flag:home
		}
		remove_variable = temple
		# trigger_event = evil.0012

		ai_chance = {
			base = 1
		}
	}

	option = { # Maybe not
		name = evil.0001.d
		custom_tooltip = evil.0001.d.tt

		ai_chance = {
			base = 0
		}
		# remove_character_flag = planning_an_activity
		remove_variable = ritual_location		
		remove_variable = selected_spell
		remove_variable = temple
	}

}
# RITUAL LOCATION - THE SACRED PLACES (Page 1)
evil.0010 = {	
	title = evil.0010.t
	desc = evil.0010.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = personality_dishonorable
	}

	override_background = { reference = throne_room_evil }

	immediate = {

		set_up_holy_sites_for_selection_effect = yes

		set_variable = {name = numtemp value = 0}
		faith = {
 			every_holy_site = {
    			root = {change_variable = {name = numtemp add = 1 }}
  			}
		}

	}

	option = { # Sacred Place 1
		trigger = {
			faith = {
				scope:holy_site_1 = {
					OR = {
						county.holder = root
						county.holder.top_liege = { this = root }
					}
				}
			}
		}
		name = evil.0010.a
		custom_tooltip = evil.0010.a.tt
		set_variable = {name = temple value = 1}
		# trigger_event = evil.0012
	}

	option = { # Sacred Place 2
		trigger = {
			var:numtemp >= 2
			faith = {
				scope:holy_site_2 = {
					OR = {
						county.holder = root
						county.holder.top_liege = { this = root }
					}
				}
			}
		}
		name = evil.0010.b
		custom_tooltip = evil.0010.b.tt
		set_variable = {name = temple value = 2}
		# trigger_event = evil.0012
	}

	option = { # Sacred Place 3
		trigger = {
			var:numtemp >= 3
			faith = {
				scope:holy_site_3 = {
					OR = {
						county.holder = root
						county.holder.top_liege = { this = root }
					}
				}
			}
		}
		name = evil.0010.c
		custom_tooltip = evil.0010.c.tt
		set_variable = {name = temple value = 3}
		# trigger_event = evil.0012
	}

	option = { # Switch to the next event
		trigger = {
			var:numtemp > 3
			OR = {
				scope:holy_site_4 = {county.holder = root}
				scope:holy_site_5 = {county.holder = root}
			}
		}
		name = evil.0010.d
		custom_tooltip = evil.0010.d.tt
		trigger_event = evil.0011
	}

	option = { # Maybe not...
		trigger = {
			NOT = {
				scope:holy_site_4 = {county.holder = root}
				scope:holy_site_5 = {county.holder = root}
			}
		}
		# remove_character_flag = planning_an_activity
		name = evil.0010.e
		custom_tooltip = evil.0010.e.tt
		remove_variable = ritual_location
	}

}

# THE SACRED PLACES (2nd Page)
evil.0011 = {	
	title = evil.0011.t
	desc = evil.0011.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = personality_dishonorable
	}

	override_background = { reference = throne_room_evil }

	immediate = {

		set_up_holy_sites_for_selection_effect = yes

	}

	option = { # Sacred Place 4
		trigger = {
			exists = var:numtemp
			var:numtemp >= 4
			faith = {
				scope:holy_site_4 = {
					OR = {
						county.holder = root
						county.holder.top_liege = { this = root }
					}
				}
			}
		}
		name = evil.0011.a
		custom_tooltip = evil.0011.a.tt
		set_variable = {name = temple value = 4}
		# trigger_event = evil.0012
	}

	option = { # Sacred Place 5
		trigger = {
			exists = var:numtemp
			var:numtemp >= 5
			faith = {
				scope:holy_site_5 = {
					OR = {
						county.holder = root
						county.holder.top_liege = { this = root }
					}
				}
			}
		}
		name = evil.0011.b
		custom_tooltip = evil.0011.b.tt
		set_variable = {name = temple value = 5}
		# trigger_event = evil.0012
	}

	option = { # Switch to the next event
		name = evil.0011.c
		custom_tooltip = evil.0011.c.tt
		trigger = {
			OR = {
				scope:holy_site_1 = {county.holder = root}
				scope:holy_site_2 = {county.holder = root}
				scope:holy_site_3 = {county.holder = root}
			}
		}
		trigger_event = evil.0010
	}

	option = { # Maybe not...
		name = evil.0011.d
		custom_tooltip = evil.0011.d.tt
		# remove_character_flag = planning_an_activity
		remove_variable = ritual_location
	}

}

#########GENERIC FAILURE #############
# GENERIC CRITICAL FAILURE
evil.0121 = {
	title =  evil.0021.t
	desc = evil.0021.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0021.a
	}
}

# GENERIC FAILURE
evil.0122 = {
	title =  evil.0022.t
	desc = evil.0022.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0022.a
	}
}

###########SPECIFIC SUCCESS ###############
########## Call the Hordes ################

# Call the Hordes success
evil.0123 = {
	title =  evil.0023.t
	desc = evil.0023.horde.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.horde.a
	}
}

# Call the Hordes critical success
evil.0124 = {
	title =  evil.0024.t
	desc = evil.0024.horde.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.horde.a
	}
}

############# MARK OF WAR ####################
# Mark of war success
evil.0223 = {
	title =  evil.0023.t
	desc = evil.0023.horde.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.horde.b
	}
}

# Mark of war critical success
evil.0224 = {
	title =  evil.0024.t
	desc = evil.0024.horde.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.horde.b
	}
}

############# CALL THE WARLORDS ####################
# Success
evil.0323 = {
	title =  evil.0023.t
	desc = evil.0023.horde.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.horde.c
	}
}
# Critical success
evil.0324 = {
	title =  evil.0024.t
	desc = evil.0024.horde.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.horde.c
	}
}

############# RAISE THE DEAD ####################
# Success
evil.0423 = {
	title =  evil.0023.t
	desc = evil.0023.summon.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.summon.a
	}
}

# Critical success
evil.0424 = {
	title =  evil.0024.t
	desc = evil.0024.summon.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.summon.a
	}
}

############# INVOKE WATCHERS ####################
# Success
evil.0523 = {
	title =  evil.0023.t
	desc = evil.0023.summon.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.summon.b
	}
}

# Critical success
evil.0524 = {
	title =  evil.0024.t
	desc = evil.0024.summon.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.summon.b
	}
}

############# INVOKE DARK BEING (FELL MOUNT) ####################
# Success
evil.0623 = {
	title =  evil.0023.t
	desc = evil.0023.summon.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.summon.c
	}
}

# Critical success
evil.0624 = {
	title =  evil.0024.t
	desc = evil.0024.summon.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.summon.c
	}
}

############# CRACKS OF EARTH ####################
# Success
evil.0723 = {
	title =  evil.0023.t
	desc = evil.0023.powerspell.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.powerspell.a
	}
}

# Critical success
evil.0724 = {
	title =  evil.0024.t
	desc = evil.0024.powerspell.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name = evil.0024.powerspell.a
	}
}


############# DARK VITALITY ####################
# Success
evil.0823 = {
	title =  evil.0023.t
	desc = evil.0023.powerspell.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.powerspell.b
	}
}

# Critical success
evil.0824 = {
	title =  evil.0024.t
	desc = evil.0024.powerspell.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name = evil.0024.powerspell.b
	}
}



############# WORDS OF POWER ####################
# Success
evil.0923 = {
	title =  evil.0023.t
	desc = evil.0023.powerspell.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.powerspell.c
	}
}

# Critical success
evil.0924 = {
	title =  evil.0024.t
	desc = evil.0024.powerspell.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name = evil.0024.powerspell.c
	}
}



############# MORGUL WEAPONS ####################
# Success
evil.1023 = {
	title =  evil.0023.t
	desc = evil.0023.craft.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.craft.a
	}
}

# Critical success
evil.1024 = {
	title =  evil.0024.t
	desc = evil.0024.craft.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.craft.a
	}
}



############# (NAZGUL) PURSUE THEM RELENTLESSLY ####################
# Success
evil.1123 = {
	title =  evil.0023.t
	desc = evil.0023.lamentation.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.lamentation.a
	}
}

# Critical success
evil.1124 = {
	title =  evil.0024.t
	desc = evil.0024.lamentation.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.lamentation.a
	}
}

############# DARK BREATH ####################
# Success
evil.1223 = {
	title =  evil.0023.t
	desc = evil.0023.lamentation.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.lamentation.b
	}
}

# Critical success
evil.1224 = {
	title =  evil.0024.t
	desc = evil.0024.lamentation.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.lamentation.b
	}
}


############# NAZGUL RESTORATION ####################
# Success
evil.1323 = {
	title =  evil.0023.t
	desc = evil.0023.lamentation.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.lamentation.b
	}
}

# Critical success
evil.1324 = {
	title =  evil.0024.t
	desc = evil.0024.lamentation.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.lamentation.c
	}
}




############# AMBASSADOR OF DARKNESS ####################
# Success
evil.1423 = {
	title =  evil.0023.t
	desc = evil.0023.treachery.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.treachery.a
	}
}

# Critical success
evil.1424 = {
	title =  evil.0024.t
	desc = evil.0024.treachery.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.treachery.a
	}
}




############# SHAPESHIFTING ####################
# Success
evil.1523 = {
	title =  evil.0023.t
	desc = evil.0023.treachery.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.treachery.b
	}
}

# Critical success
evil.1524 = {
	title =  evil.0024.t
	desc = evil.0024.treachery.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.treachery.b
	}
}



############# REVEAL THE SECRETS ####################
# Success
evil.1623 = {
	title =  evil.0023.t
	desc = evil.0023.treachery.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.treachery.c
	}
}

# Critical success
evil.1624 = {
	title =  evil.0024.t
	desc = evil.0024.treachery.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.treachery.c
	}
}



############# CAST THE DARKNESS ####################
# Success
evil.1723 = {
	title =  evil.0023.t
	desc = evil.0023.darkness.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.darkness.a
	}
}

# Critical success
evil.1724 = {
	title =  evil.0024.t
	desc = evil.0024.darkness.a.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.darkness.a
	}
}




############# ABNORMAL WINTER ####################
# Success
evil.1823 = {
	title =  evil.0023.t
	desc = evil.0023.darkness.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.darkness.b
	}
}

# Critical success
evil.1824 = {
	title =  evil.0024.t
	desc = evil.0024.darkness.b.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.darkness.b
	}
}




############# THE PLAGUE ####################
# Success
evil.1923 = {
	title =  evil.0023.t
	desc = evil.0023.darkness.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0023.darkness.c
	}
}

# Critical success
evil.1924 = {
	title =  evil.0024.t
	desc = evil.0024.darkness.c.desc
	theme = learning_theology_focus
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	override_background = {
        trigger = { var:ritual_location = flag:sacred_place }
        reference = temple
    }
    override_background = {
        trigger = { var:ritual_location = flag:wilds }
        reference = wilderness_mountains
    }
    override_background = {
        trigger = { var:ritual_location = flag:home }
        reference = sitting_room
    }
	option = {
		name =  evil.0024.darkness.c
	}
}

######################
##  Learn Sorcery    #
######################
evil.3100 = {
	type = character_event
	title = evil.3100.t
	desc = {
		desc = evil.3100.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					has_trait = sorcerer_1
				}
				desc = evil.3100.desc.b
			}
			triggered_desc = {
				trigger = {
					has_trait = sorcerer_2
				}
				desc = evil.3100.desc.c
			}
			desc = evil.3100.desc.a
		}
		desc = evil.3100.desc.end
	}

	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = {
		play_music_cue = "mx_cue_combat_stinger"
		add_character_flag = {
			flag = learning_sorcery
		}
		add_character_flag = {
			flag = planning_an_activity
			days = 30
		}
		capital_barony = {
			save_scope_as = capital_location
		}
		set_variable = {
			name = sorcery_quest
			value = 0
		}
	}
	
	option = { # Start the training
		name = evil.3100.a
		custom_tooltip = evil.3100.a.tt
		add_prestige = minor_prestige_gain
		trigger_event = {
			id = evil.3101
			days = 7
		}
		ai_chance = { base = 100 }
	}
	
	option = { # Back out
		name = evil.3100.b
		custom_tooltip = evil.3100.b.tt
		learn_sorcery_cancel_effect = yes
		remove_character_flag = learning_sorcery
		scope:activity = { complete_activity = yes }
		ai_chance = { base = 0 }
	}
	after = {
		remove_character_flag = planning_an_activity
	}
}

#### Phase 1: SORCERY TIER I: Search Dark Knowledge ######
evil.3101 = {
	type = character_event
	title = evil.3101.t
	desc = evil.3101.desc
	theme = learning_scholarship_focus
	override_background = {
      reference = study
	}
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	right_portrait = {
		character = scope:master
		animation = personality_callous
	}

	immediate = {
		every_close_or_extended_family_member = {
   			limit = {
   				OR = {
					has_trait = sorcerer_2
					has_trait = sorcerer_3
				}
   			}
			add_to_list = potential_master_sorcerers
			debug_log = "Adding potential master sorcerers"
   		}
   		every_consort = {
   			limit = {
   				OR = {
					has_trait = sorcerer_2
					has_trait = sorcerer_3
				}
   			}
			add_to_list = potential_master_sorcerers
			debug_log = "Adding potential master sorcerers"
   		}
   		house = { every_house_member = {
   			limit = {
   				OR = {
					has_trait = sorcerer_2
					has_trait = sorcerer_3
				}
   			}
			add_to_list = potential_master_sorcerers
			debug_log = "Adding potential master sorcerers"
   		}
		}
   		every_vassal_or_below = {
   			limit = {
   				OR = {
					has_trait = sorcerer_2
					has_trait = sorcerer_3
				}
   			}
			add_to_list = potential_master_sorcerers
			debug_log = "Adding potential master sorcerers"
   		}
   		every_courtier = {
   			limit = {
   				OR = {
					has_trait = sorcerer_2
					has_trait = sorcerer_3
				}
   			}
			add_to_list = potential_master_sorcerers
			debug_log = "Adding potential master sorcerers"
   		}
   		every_liege_or_above = {
   			limit = {
   				OR = {
					has_trait = sorcerer_2
					has_trait = sorcerer_3
				}
   			}
			add_to_list = potential_master_sorcerers
			debug_log = "Adding potential master sorcerers"
   		}
		every_prisoner = {
   			limit = {
   				OR = {
					has_trait = sorcerer_2
					has_trait = sorcerer_3
				}
   			}
			add_to_list = potential_master_sorcerers
			debug_log = "Adding potential master sorcerers"
   		}
		random_in_list = {
			list = potential_master_sorcerers
			limit = {
				religion = { is_in_family = rf_forcesofevil }
			}
			weight = {
				base = 1
				modifier = {
					has_trait = gregarious
					add = 1
				}
				modifier = {
					is_ruler = yes
					add = 2
				}
			}
			debug_log = "Finding master"
			save_scope_as = master
		}
	}

	option = { # Convince a Master Sorcerer to teach you
		name = evil.3101.a 
		custom_tooltip = evil.3101.a.tt
		trigger = {
			exists = scope:master
			NOT = {
				AND = {
					has_character_flag = master_refused
					has_character_flag = master_escaped
				}
			}
		}
		trigger_event = {
			id = evil.3110
#			days = { 10 20 }
		}
	}

	option = { # Scour the land for tomes of Dark Knowledge
		name = evil.3101.b
		custom_tooltip = evil.3101.b.tt
		set_variable = { name = method value = 1 }
		add_character_modifier = {
			modifier = searching_dark_knowledge_modifier
			years = 2
		}
		add_stress = medium_stress_gain
		hidden_effect = {
			random_list = {
				25 = {
					trigger_event = {
						id = evil.3120
#						days = { 90 120 }
					}
				}
				75 = {
					trigger_event = {
						id = evil.3121
#						days = { 90 120 }
					}
				}
			}
		}
	}

	option = { # Send scholars to scour the land for Dark Knowledge
		name = evil.3101.c
		custom_tooltip = evil.3101.c.tt
		set_variable = {name = method value = 2}
		remove_short_term_gold = {
			value = 250
		}
		hidden_effect = {
			random_list = {
				20 = {
					trigger_event = {
						id = evil.3120
#						days = { 90 120 }
					}
				}
				80 = {
					trigger_event = {
						id = evil.3121
#						days = { 90 120 }
					}
				}
			}
		}
	}

	option = { # Cancel activity
		name = evil.3101.d
		custom_tooltip = evil.3101.d.tt
		learn_sorcery_cancel_effect = yes
		remove_character_flag = learning_sorcery
		scope:activity = { complete_activity = yes }
	}
}

### Phase 1: Interaction with Master ###
evil.3110 = {
	type = character_event
	title = evil.3110.t
	desc = evil.3110.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = study
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:master
		animation = personality_callous
	}

	option = { # Befriend the master sorcerer
		name = evil.3110.a
		custom_tooltip = evil.3110.a.tt
		trigger = {
			NOT = { has_character_flag = master_refused }
		}
		learn_sorcery_befriend_master_effect = yes
	}

	option = { # Pay the master sorcerer
		name = evil.3110.b
		custom_tooltip = evil.3110.b.tt
		trigger = {
			NOT = { has_character_flag = master_refused }
		}
		learn_sorcery_bribe_master_effect = yes
	}

	option = {  # Abduct the Master (start kidnapping scheme)
		name = evil.3110.c
		custom_tooltip = evil.3110.c.tt
		trigger = {
			scope:master = {
				exists = yes
				NOR = {
					is_maiar = yes
					has_trait = istari
					has_trait = nazgul
				}
			}
			NOT = { has_character_flag = master_escaped }
		}
		learn_sorcery_abduct_master_effect = yes
	}

	option = {
		name = evil.3110.d # There must be other ways
		custom_tooltip = evil.3110.d.tt
		trigger_event = {
			id = evil.3101
		}
	}

}

### Phase 1: The Master Accepted ###
evil.3111 = {
	type = character_event
	title = evil.3111.t
	desc = { # Give Dark Knowledge Fragment
		desc = evil.3111.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 0
				}
				desc = evil.dark_knowledge_fragment
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 1
				}
				desc = evil.dark_knowledge_fragment.a
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 2
				}
				desc = evil.dark_knowledge_fragment.b
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 3
				}
				desc = evil.dark_knowledge_fragment.c
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 4
				}
				desc = evil.dark_knowledge_fragment.d
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 5
				}
				desc = evil.dark_knowledge_fragment.e
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 6
				}
				desc = evil.dark_knowledge_fragment.f
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 7
				}
				desc = evil.dark_knowledge_fragment.g
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 8
				}
				desc = evil.dark_knowledge_fragment.h
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 9
				}
				desc = evil.dark_knowledge_fragment.i
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 10
				}
				desc = evil.dark_knowledge_fragment.j
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest >= 11
				}
				desc = evil.dark_knowledge_fragment.k
			}
		}
	}
	theme = learning_scholarship_focus
	override_background = {     
      reference = study
	}
	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:master
		animation = schadenfreude
	}

	option = {
		name = evil.3111.a # Begin training from master
		custom_tooltip = evil.3111.a.tt
		add_character_modifier = {
			modifier = studying_dark_arts_modifier
			years = 5
		}
		scope:master = {
			add_character_modifier = {
				modifier = apprentice_sorcerer_modifier
				years = 5
			}
		}
	}

}

### Phase 1: The Master Refused ###
evil.3112 = {
	type = character_event
	title = evil.3112.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:mastermethod var:mastermethod = 1}
                desc = evil.3112.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:mastermethod var:mastermethod = 2}
                desc = evil.3112.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = study
	}
	left_portrait = {
		character = root
		animation = disapproval
	}
	right_portrait = {
		character = scope:master
		animation = dismissal
	}

	immediate = {
		add_character_flag = {
			flag = master_refused
			years = 10
		}
	}

	option = {
		name = evil.3112.a # Try again!
		custom_tooltip = evil.3112.a.tt
		trigger_event = {
			id = evil.3101
		}
	}

	option = {
		name = evil.3112.b # Give up!
		custom_tooltip = evil.3112.b.tt
		learn_sorcery_cancel_effect = yes
		remove_character_flag = learning_sorcery
		scope:activity = { complete_activity = yes }
	}

}

### Phase 1: The Master was Imprisoned ###
evil.3113 = {
	type = character_event
	title = evil.3113.t
	desc = evil.3113.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = dungeon
	}
	left_portrait = {
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:master
		animation = personality_vengeful
	}

	immediate = {
		every_prisoner = {
			if = {
				limit = {OR = { has_trait = sorcerer_2 has_trait = sorcerer_3 } }
				save_scope_as = master
			}
		}
	}

	option = {
		name = evil.3113.a
		custom_tooltip = evil.3113.a.tt
		abducted_sorcerer_effect = yes
	}
}

### Phase 1: The Master Escaped ###
evil.3114 = {
	type = character_event
	title = evil.3114.t
	desc = evil.3114.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = study
	}
	left_portrait = {
		character = root
		animation = stress
	}
	right_portrait = {
		character = scope:master
		animation = personality_vengeful
	}

	trigger = {
		NOT = {
			OR = {
				has_character_modifier = studying_dark_arts_modifier
				has_character_flag = abducted_sorcerer
			}
		}
	}

	immediate = {
	}

	option = { # Try again
		name = evil.3114.a
		custom_tooltip = evil.3114.a.tt
		learn_sorcery_abduct_master_failing_effect = yes
	}

	option = { # There must be other ways
		name = evil.3114.b
		custom_tooltip = evil.3114.b.tt
		add_character_flag = {
			flag = master_escaped
			years = 10
		}
		trigger_event = {
			id = evil.3101
		}
	}

	option = { # Give up
		name = evil.3114.b
		custom_tooltip = evil.3114.b.tt
		add_character_flag = {
			flag = master_escaped
			years = 10
		}
		learn_sorcery_cancel_effect = yes
		remove_character_flag = learning_sorcery
		scope:activity = { complete_activity = yes }
	}

}

### Phase 1: The Master is Tortured ###
evil.3115 = {
	type = character_event
	title = evil.3115.t
	desc = { # Give Dark Knowledge Fragment
		desc = evil.3115.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 0
				}
				desc = evil.dark_knowledge_fragment
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 1
				}
				desc = evil.dark_knowledge_fragment.a
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 2
				}
				desc = evil.dark_knowledge_fragment.b
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 3
				}
				desc = evil.dark_knowledge_fragment.c
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 4
				}
				desc = evil.dark_knowledge_fragment.d
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 5
				}
				desc = evil.dark_knowledge_fragment.e
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 6
				}
				desc = evil.dark_knowledge_fragment.f
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 7
				}
				desc = evil.dark_knowledge_fragment.g
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 8
				}
				desc = evil.dark_knowledge_fragment.h
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 9
				}
				desc = evil.dark_knowledge_fragment.i
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 10
				}
				desc = evil.dark_knowledge_fragment.j
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest >= 11
				}
				desc = evil.dark_knowledge_fragment.k
			}
		}
	}
	theme = learning_scholarship_focus
	override_background = {     
      reference = dungeon
	}
	left_portrait = {
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:master
		animation = personality_vengeful
	}

	immediate = {
		every_prisoner = {
			if = {
				limit = {
					has_character_flag = is_being_tortured
					OR = {
						has_trait = sorcerer_2
						has_trait = sorcerer_3
					}
				}
				save_scope_as = master
			}
		}
#			scope:recipient = { save_scope_as = master }
	}

	option = {
		name = evil.3115.a
		custom_tooltip = evil.3115.a.tt
		tortured_sorcerer_effect = yes
	}
}

### Phase 1: Black Market Success
evil.3120 = {	
	type = character_event
	title = evil.3120.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:method var:method = 1}
                desc = evil.3120.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:method var:method = 2}
                desc = evil.3120.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = market_east
	}
	left_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		if = {
			limit = {has_character_modifier = searching_dark_knowledge_modifier}
			remove_character_modifier = searching_dark_knowledge_modifier
		}
	}


	option = { 
		name = evil.3120.a # 
		custom_tooltip = evil.3120.a.tt
		add_character_modifier = {
			modifier = studying_dark_arts_modifier
			years = 2
		}
	}
	after = {
			hidden_effect = {
				random_list = {
					25 = {
						change_variable = {
							name = sorcery_quest
							add = 1
						}
					}
					10 = {
						change_variable = {
							name = sorcery_quest
							add = 2
						}
					}
					5 = {
						change_variable = {
							name = sorcery_quest
							add = 3
						}
					}
					1 = {
						change_variable = {
							name = sorcery_quest
							add = 4
						}
					}
				}
			}
		trigger_event = {
			id=evil.3190
			# years = 2
		}		
	}
}

# Phase 1: Black Market Fail
evil.3121 = {	
	type = character_event
	title = evil.3121.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:method var:method = 1}
                desc = evil.3121.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:method var:method = 2}
                desc = evil.3121.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = market_east
	}
	left_portrait = {
		character = root
		animation = anger
	}

	immediate = {
		if = {
			limit = {has_character_modifier = searching_dark_knowledge_modifier}
			remove_character_modifier = searching_dark_knowledge_modifier
		}
	}

	option = { 
		name = evil.3121.a # Try again!
		custom_tooltip = evil.3121.a.tt
		trigger_event = {
			id = evil.3101
		}
	}

	option = { 
		name = evil.3121.b # Give up!
		custom_tooltip = evil.3121.b.tt
		learn_sorcery_cancel_effect = yes
		remove_character_flag = learning_sorcery
		scope:activity = { complete_activity = yes }
	}

}

### Phase 1: Completion ###
evil.3190 = {
	type = character_event
	title = evil.3190.t
	desc = { # Give Dark Knowledge Fragment
		desc = evil.3190.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 0
				}
				desc = evil.dark_knowledge_fragment
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 1
				}
				desc = evil.dark_knowledge_fragment.a
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 2
				}
				desc = evil.dark_knowledge_fragment.b
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 3
				}
				desc = evil.dark_knowledge_fragment.c
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 4
				}
				desc = evil.dark_knowledge_fragment.d
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 5
				}
				desc = evil.dark_knowledge_fragment.e
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 6
				}
				desc = evil.dark_knowledge_fragment.f
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 7
				}
				desc = evil.dark_knowledge_fragment.g
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 8
				}
				desc = evil.dark_knowledge_fragment.h
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 9
				}
				desc = evil.dark_knowledge_fragment.i
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest = 10
				}
				desc = evil.dark_knowledge_fragment.j
			}
			triggered_desc = {
				trigger = {
					var:sorcery_quest >= 11
				}
				desc = evil.dark_knowledge_fragment.k
			}
		}
	}

	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	# trigger = { has_character_flag = sorcery_quest_riddle_attempt }

	immediate = {
		play_music_cue = "mx_cue_combat_stinger"
		add_character_flag = {
			flag = learning_sorcery
		}
		add_character_flag = {
			flag = planning_an_activity
			days = 30
		}
		capital_barony = {
			save_scope_as = capital_location
		}
	}

	option = { # Correct Answer
		name = evil.3190.a
		custom_tooltip = evil.3190.a.tt
		riddle_ritual_morgoths_ring_effect = yes
	}
	option = { # Misdirection
		name = evil.3190.b
		custom_tooltip = evil.3190.b.tt
		riddle_ritual_blood_offering_effect = yes
	}
	option = { # Misdirection
		name = evil.3190.c
		custom_tooltip = evil.3190.c.tt
		riddle_ritual_ritual_mutilation_effect = yes
	}
	option = { # Misdirection
		name = evil.3190.d
		custom_tooltip = evil.3190.d.tt
		riddle_ritual_into_darkness_effect = yes
	}
	option = { # Misdirection####
		name = evil.3190.e
		custom_tooltip = evil.3190.e.tt
		riddle_ritual_wild_dance_effect = yes
	}
	
	option = { # Give up
		name = evil.3190.f # Try again later!
		custom_tooltip = evil.3121.b.tt
		learn_sorcery_cancel_effect = yes
		remove_character_flag = learning_sorcery		
		scope:activity = { complete_activity = yes }
	}

	option = { # Give up
		name = evil.3190.g # Give up!
		custom_tooltip = evil.3121.b.tt
		learn_sorcery_cancel_effect = yes
		remove_character_flag = learning_sorcery		
		scope:activity = { complete_activity = yes }
	}

	#after = { 
	#	remove_character_flag = sorcery_quest_riddle_attempt 
	#}
}


## Phase 2: Travel to the Hidden Vale -> From Decision (Important).
evil.3200 = {	
	type = character_event
	title = evil.3200.t
	desc = evil.3200.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = study
	}
	left_portrait = {
		character = root
		animation = war_attacker
	}

	option = { 
		name = evil.3200.a # Start the Travel
		custom_tooltip = evil.3200.a.tt
		add_character_modifier = {
			modifier = searching_shadow_library_modifier
		}
		hidden_effect = {
		random_list = {
			5 = {	# An Accident
				trigger_event = {
					id = evil.3201
					#days = 100
				}
			}
			35 = {	# An Assault
				trigger_event = {
					id = evil.3202
					#days = 100
				}
			}
			#25 = {	# A Wild graug
			#	trigger_event = {
			#		id = evil.3208
			#		#days = 100
			#	}
			#}
			5 = {	# Arrive without problems
				trigger_event = {
					id = evil.3210
					#days = 183
				}
			}
		}
		}
	}

	option = {
		name = evil.3200.b # Give up!
		custom_tooltip = evil.3200.b.tt
	}

}

###### Phase 2: An Accident!
evil.3201 = {	
	type = character_event
	title = evil.3201.t
	desc = evil.3201.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_mountains
	}
	left_portrait = {
		character = root
		animation = pain
	}

	immediate = {
		if = {
			limit = {has_trait = wounded_2}
			hidden_effect = {remove_trait = wounded_2}
			add_trait = wounded_3
		}
		else_if = {
			limit = {has_trait = wounded_1}
			hidden_effect = {remove_trait = wounded_1}
			add_trait = wounded_2
		}
		else = {
			add_trait = wounded_1
		}
	}

	option = { 
		name = evil.3201.a # Ouch!
		custom_tooltip = evil.3201.a.tt
		trigger_event = {
			id = evil.3210
			#days = 100
		}
	}

}

########### Phase 2: An Assault!
evil.3202 = {	
	type = character_event
	title = evil.3202.t
	desc = evil.3202.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_forest_pine
	}
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:bandit
		animation = war_defender
	}

	immediate = {
		create_character = {
			template = orc_escaped_slave_character
			dynasty = none
			culture = culture:burgulhai
			faith = faith:sons_of_sauron
			prowess = {0 5}
			gender_female_chance = 0
			save_scope_as = bandit
		}
	}

	option = { 
		name = evil.3202.a # Fight
		custom_tooltip = evil.3202.a.tt
		add_internal_flag = dangerous
		random_list = {
			65 = {	# Duel with the leader
				configure_start_single_combat_effect = {
					SC_INITIATOR = scope:bandit
					SC_ATTACKER = scope:bandit
					SC_DEFENDER = root
					FATALITY = always
					FIXED = no
					LOCALE = wilderness_mountains
					OUTPUT_EVENT = evil.3203
					INVALIDATION_EVENT = evil.3203
				}
			}
			35 = {	# Fight against everyone
				random_list = {
					1 = {
						compare_modifier = {
            				value = root.prowess
       					}
						set_variable = {name = win value = 1}
					}
					25 = {
						set_variable = {name = win value = 0}
					}
				}
				trigger_event = {
					id = evil.3205
					#days = 30
				}
			}
			0 = {
				death = {	# Just for the skull icon
					killer = scope:bandit
					death_reason = death_murder
				}
			}
		}
	}

	option = { 
		name = evil.3202.b # Pay
		custom_tooltip = evil.3202.b.tt
		remove_short_term_gold = {
			value = massive_gold_value
		}
		random_list = {
			60 = {	# They Accept and go away
				set_variable = {name = payment value = 1}
			}
			40 = {	# They ask for more...
				set_variable = {name = payment value = 0}
			}
		}
		trigger_event = {
			id = evil.3206
			#days = 30
		}
	}

	option = { 
		name = evil.3202.c # Run!
		custom_tooltip = evil.3202.c.tt
		random_list = {
			1 = {	# Escape!
				set_variable = {name = escaped value = 1}
				compare_modifier = {
            		value = root.health
       			}
			}
			10 = {	# They catch you...
				set_variable = {name = escaped value = 0}
			}
		}
		trigger_event = {
			id = evil.3207
			#days = 30
		}
	}

}

########### Phase 2: An Assault! (hidden duel effect)
evil.3203 = {	
	hidden = yes

	immediate = {
		if = {
			limit = { scope:sc_victor = scope:bandit }
			set_variable = {name = win value = 0}
		}
		else_if = {
			limit = { scope:sc_victor = root}
			set_variable = {name = win value = 1}
		}
		trigger_event = {
			id = evil.3204
			days = 1
		}
	}

}

################ Phase 2: An Assault! (Duel Result)
evil.3204 = {	
	type = character_event
	title = evil.3204.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:win var:win = 0}
                desc = evil.3204.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:win var:win = 1}
                desc = evil.3204.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_forest_pine
	}
	left_portrait = {
		character = scope:winner
		animation = personality_bold
	}
	right_portrait = {
		character = scope:loser
		animation = shock
	}

	immediate = {
		if = {
			limit = {exists = var:win var:win = 0}
			root = {save_scope_as = loser}
			scope:bandit = {save_scope_as = winner}
		}
		else_if = {
			limit = {exists = var:win var:win = 1}
			root = {save_scope_as = winner}
			scope:bandit = {save_scope_as = loser}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:win var:win = 0}
						desc = evil.3204.1.a
					}
					triggered_desc ={
						trigger = {exists = var:win var:win = 1}
						desc = evil.3204.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3204.a.tt
		trigger_event = {
			id = evil.3210
		}
	}		
}

############ Phase 2: An Assault! (Fight against all the bandits!)
evil.3205 = {	
	type = character_event
	title = evil.3205.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:win var:win = 0}
                desc = evil.3205.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:win var:win = 1}
                desc = evil.3205.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_forest_pine
	}
	left_portrait = {
		character = scope:winner
		animation = anger
	}
	right_portrait = {
		character = scope:loser
		animation = shock
	}

	immediate = {
		if = {
			limit = {exists = var:win var:win = 0}
			root = {save_scope_as = loser}
			if = {
				limit = {has_trait = wounded_2}
				hidden_effect = {remove_trait = wounded_2}
				add_trait = wounded_3
			}
			else_if = {
				limit = {has_trait = wounded_1}
				hidden_effect = {remove_trait = wounded_1}
				add_trait = wounded_2
			}
			else = {
				add_trait = wounded_1
			}
			remove_short_term_gold = {
				value = massive_gold_value
			}
		}
		else_if = {
			limit = {exists = var:win var:win = 1}
			root = {save_scope_as = winner}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:win var:win = 0}
						desc = evil.3205.1.a
					}
					triggered_desc ={
						trigger = {exists = var:win var:win = 1}
						desc = evil.3205.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3205.a.tt
		trigger_event = {
			id = evil.3210
		}
	}	
}

################# Phase 2: An Assault! (Payment Result)
evil.3206 = {	
	type = character_event
	title = evil.3206.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:payment var:payment = 0}
                desc = evil.3206.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:payment var:payment = 1}
                desc = evil.3206.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_forest_pine
	}
	left_portrait = {
		character = scope:pass
		animation = flirtation
	}
	right_portrait = {
		character = scope:mauled
		animation = pain
	}

	immediate = {
		if = {
			limit = {exists = var:payment var:payment = 0}
			root = {save_scope_as = mauled}
			if = {
				limit = {has_trait = wounded_2}
				hidden_effect = {remove_trait = wounded_2}
				add_trait = wounded_3
			}
			else_if = {
				limit = {has_trait = wounded_1}
				hidden_effect = {remove_trait = wounded_1}
				add_trait = wounded_2
			}
			else = {
				add_trait = wounded_1
			}
			remove_short_term_gold = {
				value = major_gold_value
			}
		}
		else_if = {
			limit = {exists = var:payment var:payment = 1}
			root = {save_scope_as = pass}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:payment var:payment = 0}
						desc = evil.3206.1.a
					}
					triggered_desc ={
						trigger = {exists = var:payment var:payment = 1}
						desc = evil.3206.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3206.a.tt
		trigger_event = {
			id = evil.3210
		}
	}		
}

########## Phase 2: An Assault! (RUN Result)
evil.3207 = {	
	type = character_event
	title = evil.3207.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:escaped var:escaped = 0}
                desc = evil.3207.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:escaped var:escaped = 1}
                desc = evil.3207.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_forest_pine
	}
	left_portrait = {
		character = scope:pass
		animation = paranoia
	}
	right_portrait = {
		character = scope:mauled
		animation = pain
	}

	immediate = {
		if = {
			limit = {exists = var:escaped var:escaped = 0}
			root = {save_scope_as = mauled}
			if = {
				limit = {has_trait = wounded_2}
				hidden_effect = {remove_trait = wounded_2}
				add_trait = wounded_3
			}
			else_if = {
				limit = {has_trait = wounded_1}
				hidden_effect = {remove_trait = wounded_1}
				add_trait = wounded_2
			}
			else = {
				add_trait = wounded_1
			}
			remove_short_term_gold = {
				value = massive_gold_value
				add = major_gold_value
			}
		}
		else_if = {
			limit = {exists = var:escaped var:escaped = 1}
			root = {save_scope_as = pass}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:escaped var:escaped = 0}
						desc = evil.3207.1.a
					}
					triggered_desc ={
						trigger = {exists = var:escaped var:escaped = 1}
						desc = evil.3207.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3207.a.tt
		trigger_event = {
			id = evil.3210
		}
	}		
}

################## Phase 2: A graug!
evil.3208 = {	
	type = character_event
	title = evil.3208.t
	desc = evil.3208.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_mountains
	}
	left_portrait = {
		character = root
		animation = shock
	}

	option = { 
		name = evil.3208.a # Confront him
		custom_tooltip = evil.3208.a.tt
		skill = prowess
		add_internal_flag = dangerous
		hidden_effect = {
			random_list = {
				1 = {
					set_variable = {name = graug value = 2}
				}
				0 = {
					death = {	# Just for the skull icon
						killer = root
						death_reason = death_murder
					}
				}
			}
			trigger_event = {
				id = evil.3209
			}
		}
	}

	option = { 
		name = evil.3208.b # Wait
		custom_tooltip = evil.3208.b.tt
		hidden_effect = {
		random_list = {
			50 = {	# It goes away
				set_variable = {name = graug value = 1}
			}
			50 = {	# It saw you!
				set_variable = {name = graug value = 0}
			}
		}
		}
		trigger_event = {
			id = evil.3209
		}
	}

	option = { 
		name = evil.3208.c # Sneak
		custom_tooltip = evil.3208.c.tt
		trigger = {
			root.intrigue >= 10
		}
		skill = intrigue
		random_list = {
			40 = {	# It goes away
				set_variable = {name = graug value = 1}
				compare_modifier = {
            		value = root.intrigue
            		multiplier = 2
       			}
			}
			20 = {	# It saw you!
				set_variable = {name = graug value = 0}
			}
		}
		trigger_event = {
			id = evil.3209
		}
	}

}

################## Phase 2: A graug! (Results)
evil.3209 = {	
	type = character_event
	title = evil.3209.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:graug var:graug = 0}
                desc = evil.3209.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:graug var:graug = 1}
                desc = evil.3209.2.desc
            }
            triggered_desc = {
                trigger = {exists = var:graug var:graug = 2}
                desc = evil.3209.3.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_mountains
	}
	left_portrait = {
		character = scope:confront
		animation = anger
	}
	right_portrait = {
		character = scope:goaway
		animation = paranoia
	}

	immediate = {
		if = {
			limit = {exists = var:graug var:graug = 0}
			root = {save_scope_as = goaway}
			random_list = {
				50 = {
					if = {
						limit = {has_trait = wounded_2}
						hidden_effect = {remove_trait = wounded_2}
						add_trait = wounded_3
					}
					else_if = {
						limit = {has_trait = wounded_1}
						hidden_effect = {remove_trait = wounded_1}
						add_trait = wounded_3
					}
					else = {
						add_trait = wounded_2
					}
				}
				50 = {
					random_list = {
						1 = {add_trait = scarred}
						1 = {add_trait = one_eyed}
						1 = {add_trait = one_legged}
						1 = {add_trait = disfigured}
					}
				}
			}
		}
		else_if = {
			limit = {exists = var:graug var:graug = 1}
			root = {save_scope_as = goaway}
		}
		else_if = {
			limit = {exists = var:graug var:graug = 2}
			root = {save_scope_as = confront}
			random_list = {
				1 = {
					compare_modifier = {
						value = this.prowess
						multiplier = 2
					}
					add_character_modifier = {
						modifier = killed_a_graug_modifier
					}
				}
				20 = {
					add_trait = wounded_2
					random_list = {
						1 = {add_trait = scarred}
						1 = {add_trait = one_eyed}
						1 = {add_trait = one_legged}
						1 = {add_trait = disfigured}
					}
					add_character_modifier = {
						modifier = killed_a_graug_modifier
					}
				}
				10 = {
					root = {
						death = {
							death_reason = death_eaten
						}
					}
				}
			}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:graug var:graug = 0}
						desc = evil.3209.1.a
					}
					triggered_desc ={
						trigger = {exists = var:graug var:graug = 1}
						desc = evil.3209.2.a
					}
					triggered_desc ={
						trigger = {exists = var:graug var:graug = 2}
						desc = evil.3209.3.a
					}
				}
			}
		}
		custom_tooltip = evil.3209.a.tt
		trigger_event = {
			id = evil.3210
		}
	}		
}

################## Phase 2: Arriving!
evil.3210 = {	
	type = character_event
	title = evil.3210.t
	desc = evil.3210.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = {
		if = {
			limit = {
				OR = {
					NOT = {exists = scope:guard}
					scope:guard = {is_alive = no}
				}
			}
			create_character = {
				template = orc_champion_character
				dynasty = none
				culture = culture:luftutaumhai
				faith = faith:red_eye_cult
				gender_female_chance = 0
				save_scope_as = guard
			}
		}
	}

	option = { 
		name = evil.3210.a # Ask for permission
		custom_tooltip = evil.3210.a.tt
		trigger_event = {
			id = evil.3220
			#days = 30
		}
	}

	option = { 
		name = evil.3210.b # Approach the guard
		custom_tooltip = evil.3210.b.tt
		trigger_event = {
			id = evil.3230
			#days = 30
		}
	}

	option = { 
		name = evil.3210.c # Try to infiltrate
		custom_tooltip = evil.3210.c.tt
		trigger_event = {
			id = evil.3240
			#days = 30
		}
	}

}

################## Phase 2: The Shadow Library (Permission)
evil.3220 = {	
	type = character_event
	title = evil.3220.t
	desc = evil.3220.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = beg
	}
	right_portrait = {
		character = scope:lord
		animation = personality_dishonorable
	}

	immediate = {
		title:c_barad_dur.holder = {save_scope_as = lord}
	}

	option = { 
		name = evil.3220.a # Eternal Loyalty
		custom_tooltip = evil.3220.a.tt
		random_list = {
			1 = {
				set_variable = {name = lordaccept value = 1}
				scope:lord = {
					add_hook = {
		        	    type = loyalty_hook
		        	   	target = root
		        	}
		        }
		        if = {
		        	limit = {root.gold > 0}
		        	pay_short_term_gold = {
		        		target = scope:lord
		        		gold = root.gold
		        	}
		        }
		        add_prestige = -500
		        add_dread = -50
			}
			1 = {
				set_variable = {name = lordaccept value = 0}
			}
		}
		trigger_event = {
			id = evil.3221
			#days = 30
		}
	}

	option = { 
		name = evil.3220.b # Become his vassal
		custom_tooltip = evil.3220.b.tt
		trigger = {
			NOT = {root.top_liege = scope:lord}
		}
		set_variable = {name = lordaccept value = 1}
		#if = { #Removing this for now as it's causing Nazgul realms to jump under Sauron
		#	limit = {
		#		OR = {
		#			AND = {
		#				scope:lord.primary_title = {tier = 5}
		#				root.primary_title = {tier < 5}
		#			}
		#			AND = {
		#				scope:lord.primary_title = {tier = 4}
		#				root.primary_title = {tier < 4}
		#			}
		#		}
		#	}
		#	create_title_and_vassal_change = {
		#		type = swear_fealty
		#		save_scope_as = title_change
		#		add_claim_on_loss = no
		#	}
		#	root = {
		#		change_liege = {
		#			liege = scope:lord
		#			change = scope:title_change
		#		}
		#	}
		#	resolve_title_and_vassal_change = scope:title_change
		#}
		#else = {
		#	create_title_and_vassal_change = {
		#		type = swear_fealty
		#		save_scope_as = title_change
		#		add_claim_on_loss = no
		#	}
		#	change_liege = {
		#		liege = scope:lord
		#		change = scope:title_change
		#	}
		#	root.primary_title = {
		#		change_title_holder = {
        #        	holder = scope:lord
        #        	change = scope:title_change
        #    	}
        #    }
        #    resolve_title_and_vassal_change = scope:title_change
		#}
		trigger_event = {
			id = evil.3221
			#days = 30
		}
	}

	option = { 
		name = evil.3220.c # He is asking for too much
		custom_tooltip = evil.3220.c.tt
		random_list = {
			1 = {
				trigger_event = {
					id = evil.3210
					#days = 30
				}
			}
			1 = {
				set_variable = {name = lordaccept value = 0}
				trigger_event = {
					id = evil.3221
					#days = 30
				}
			}
		}
	}
}

################## Phase 2: The Shadow Library (Permission) Results
evil.3221 = {	
	type = character_event
	title = evil.3221.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:lordaccept var:lordaccept = 0}
                desc = evil.3221.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:lordaccept var:lordaccept = 1}
                desc = evil.3221.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = scope:free
		animation = happiness
	}
	right_portrait = {
		character = scope:prisoner
		animation = prisonhouse
	}

	immediate = {
		title:c_barad_dur.holder = {save_scope_as = lord}
		if = {
			limit = {exists = var:lordaccept var:lordaccept = 0}
			root = {save_scope_as = prisoner}
			if = {
		        limit = {root.gold > 0}
		        pay_short_term_gold = {
		        	target = scope:lord
		        	gold = root.gold
		        }
		    }
			scope:lord = {
				imprison = {
					target = root
					type = dungeon
				}
			}
		}
		else_if = {
			limit = {exists = var:lordaccept var:lordaccept = 1}
			root = {save_scope_as = free}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:lordaccept var:lordaccept = 0}
						desc = evil.3221.1.a
					}
					triggered_desc ={
						trigger = {exists = var:lordaccept var:lordaccept = 1}
						desc = evil.3221.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3221.a.tt
		if = {
			limit = {exists = var:lordaccept var:lordaccept = 1}
			trigger_event = {
				id = evil.3250
			}
		}
		if = {
			limit = {exists = var:lordaccept var:lordaccept = 0}
			remove_character_modifier = searching_shadow_library_modifier
		}
	}		
}

################## Phase 2: The Shadow Library (Approach the guard)
evil.3230 = {	
	type = character_event
	title = evil.3230.t
	desc = evil.3230.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = anger
	}
	right_portrait = {
		character = scope:guard
		animation = personality_callous
	}

	option = { 
		name = evil.3230.a # Fight
		custom_tooltip = evil.3230.a.tt
		add_internal_flag = dangerous
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = root
			SC_DEFENDER = scope:guard
			FATALITY = always
			FIXED = no
			LOCALE = corridor_night
			OUTPUT_EVENT = evil.3231
			INVALIDATION_EVENT = evil.3231
		}
	}

	option = { 
		name = evil.3230.b # 
		custom_tooltip = evil.3230.b.tt
		trigger = {
			root.gold >= 250
		}
		remove_short_term_gold = {
			value = 300
		}
		trigger_event = {
			id = evil.3250
		}
	}

	option = { 
		name = evil.3230.c # 
		custom_tooltip = evil.3230.c.tt
		trigger_event = {
			id = evil.3210
		}
	}

}

################## Phase 2: The Shadow Library (Approach the guard) hidden effect
evil.3231 = {	
	hidden = yes

	immediate = {
		if = {
			limit = { scope:sc_victor = scope:guard }
			set_variable = {name = win value = 0}
		}
		else_if = {
			limit = { scope:sc_victor = root}
			set_variable = {name = win value = 1}
		}
		trigger_event = {
			id = evil.3232
			days = 1
		}
	}

}

################## Phase 2: The Shadow Library (Approach the guard) (Duel Result)
evil.3232 = {	
	type = character_event
	title = evil.3232.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:win var:win = 0}
                desc = evil.3232.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:win var:win = 1}
                desc = evil.3232.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = scope:winner
		animation = personality_bold
	}
	right_portrait = {
		character = scope:loser
		animation = shock
	}

	immediate = {
		if = {
			limit = {exists = var:win var:win = 0}
			root = {save_scope_as = loser}
			scope:guard = {save_scope_as = winner}
		}
		else_if = {
			limit = {exists = var:win var:win = 1}
			root = {save_scope_as = winner}
			scope:guard = {save_scope_as = loser}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:win var:win = 0}
						desc = evil.3232.1.a
					}
					triggered_desc ={
						trigger = {exists = var:win var:win = 1}
						desc = evil.3232.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3232.a.tt
		if = {
			limit = {exists = var:win var:win = 1}
			trigger_event = {
				id = evil.3250
			}
		}
		else_if = {
			limit = {exists = var:win var:win = 0}
			clear_saved_scope = guard
			trigger_event = {
				id = evil.3210
			}
		}
	}		
}

################## Phase 2: The Shadow Library (Infiltrate)
evil.3240 = {	
	type = character_event
	title = evil.3240.t
	desc = evil.3240.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = personality_cynical
	}

	option = { 
		name = evil.3240.a # Wait
		custom_tooltip = evil.3240.a.tt
		trigger_event = {
			id = evil.3241
			#days = 7
		}
	}

	option = { 
		name = evil.3240.b # Disguise
		custom_tooltip = evil.3240.a.tt
		skill = intrigue
		#trigger = {root.intrigue >= 10}
		random_list = {
			10= {
				compare_modifier = {
					value = root.intrigue
					multiplier = 2
				}
				set_variable = {name = sneaky value = 1}
			}
			15 = {
				set_variable = {name = sneaky value = 0}
			}
		}
		trigger_event = {
			id = evil.3242
			#days = 1
		}
	}

	option = { 
		name = evil.3240.c # Impersonate a scribe
		custom_tooltip = evil.3240.a.tt
		skill = learning
		#trigger = {root.learning >= 20}
		random_list = {
			10= {
				compare_modifier = {
					value = root.learning
					multiplier = 2
				}
				set_variable = {name = impersonate value = 1}
			}
			20 = {
				set_variable = {name = impersonate value = 0}
			}
		}
		trigger_event = {
			id = evil.3243
		}
	}

}

################## Phase 2: The Shadow Library (Infiltrate) Wait
evil.3241 = {	
	type = character_event
	title = evil.3241.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:enter var:enter = 0}
                desc = evil.3241.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:enter var:enter = 1}
                desc = evil.3241.2.desc
            }
            triggered_desc = {
                trigger = {exists = var:enter var:enter = 2}
                desc = evil.3241.3.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = scope:bored
		animation = boredom
	}
	right_portrait = {
		character = scope:captured
		animation = prisonhouse
	}

	immediate = {
		title:c_barad_dur.holder = {save_scope_as = lord}
		random_list = {
			75 = {
				random_list = {
					65 = {set_variable = {name = enter value = 1}}
					35 = {set_variable = {name = enter value = 2}}
				}
			}
			25 = {
				set_variable = {name = enter value = 0}
			}
		}
		if = {
			limit = {exists = var:enter var:enter = 0}
			root = {save_scope_as = captured}
		}
		else_if = {
			limit = {exists = var:enter var:enter = 1}
			root = {save_scope_as = bored}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:enter var:enter = 0}
						desc = evil.3241.1.a
					}
					triggered_desc ={
						trigger = {exists = var:enter var:enter = 1}
						desc = evil.3241.2.a
					}
					triggered_desc ={
						trigger = {exists = var:enter var:enter = 2}
						desc = evil.3241.3.a
					}
				}
			}
		}
		custom_tooltip = evil.3241.a.tt
		if = {
			limit = {exists = var:enter var:enter = 0}
			if = {
		        limit = {root.gold > 0}
		        pay_short_term_gold = {
		        	target = scope:lord
		        	gold = root.gold
		        }
		    }
			scope:lord = {
				imprison = {
					target = root
					type = dungeon
				}
			}
			remove_character_modifier = searching_shadow_library_modifier
		}
		else_if = {
			limit = {exists = var:enter var:enter = 1}
			set_variable = {name = waiting value = 1}
			trigger_event = {
				id = evil.3241
				#days = 7
			}
		}
		else_if = {
			limit = {exists = var:enter var:enter = 2}
			trigger_event = {
				id = evil.3250
			}
		}
	}		

	option = {
		name = evil.3241.b # 
		custom_tooltip = evil.3241.b.tt
		trigger = {exists = var:enter var:enter = 1}
		trigger_event = {
			id = evil.3210
		}
	}

}

################## Phase 2: The Shadow Library (Infiltrate) Sneak as a Guard
evil.3242 = {	
	type = character_event
	title = evil.3242.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:sneaky var:sneaky = 0}
                desc = evil.3242.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:sneaky var:sneaky = 1}
                desc = evil.3242.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = scope:succeded
		animation = scheme
	}
	right_portrait = {
		character = scope:captured
		animation = prisonhouse
	}

	immediate = {
		title:c_barad_dur.holder = {save_scope_as = lord}
		if = {
			limit = {exists = var:sneaky var:sneaky = 0}
			root = {save_scope_as = captured}
		}
		else_if = {
			limit = {exists = var:sneaky var:sneaky = 1}
			root = {save_scope_as = succeded}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:sneaky var:sneaky = 0}
						desc = evil.3242.1.a
					}
					triggered_desc ={
						trigger = {exists = var:sneaky var:sneaky = 1}
						desc = evil.3242.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3242.a.tt
		if = {
			limit = {exists = var:sneaky var:sneaky = 0}
			if = {
		        limit = {root.gold > 0}
		        pay_short_term_gold = {
		        	target = scope:lord
		        	gold = root.gold
		        }
		    }
			scope:lord = {
				imprison = {
					target = root
					type = dungeon
				}
			}
			remove_character_modifier = searching_shadow_library_modifier
		}
		else_if = {
			limit = {exists = var:sneaky var:sneaky = 1}
			trigger_event = {
				id = evil.3250
			}
		}
	}		

}

################## Phase 2: The Shadow Library (Infiltrate) Impersonate
evil.3243 = {	
	type = character_event
	title = evil.3243.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:impersonate var:impersonate = 0}
                desc = evil.3243.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:impersonate var:impersonate = 1}
                desc = evil.3243.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = scope:succeded
		animation = scheme
	}
	right_portrait = {
		character = scope:captured
		animation = prisonhouse
	}

	immediate = {
		title:c_barad_dur.holder = {save_scope_as = lord}
		if = {
			limit = {exists = var:impersonate var:impersonate = 0}
			root = {save_scope_as = captured}
		}
		else_if = {
			limit = {exists = var:impersonate var:impersonate = 1}
			root = {save_scope_as = succeded}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:impersonate var:impersonate = 0}
						desc = evil.3243.1.a
					}
					triggered_desc ={
						trigger = {exists = var:impersonate var:impersonate = 1}
						desc = evil.3243.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3243.a.tt
		if = {
			limit = {exists = var:impersonate var:impersonate = 0}
			if = {
		        limit = {root.gold > 0}
		        pay_short_term_gold = {
		        	target = scope:lord
		        	gold = root.gold
		        }
		    }
			scope:lord = {
				imprison = {
					target = root
					type = dungeon
				}
			}
			remove_character_modifier = searching_shadow_library_modifier
		}
		else_if = {
			limit = {exists = var:impersonate var:impersonate = 1}
			trigger_event = {
				id = evil.3250
			}
		}
	}		

}

################## Phase 2: The Shadow Library (Interior)
evil.3250 = {	
	type = character_event
	title = evil.3250.t
	desc = evil.3250.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = temple
	}
	left_portrait = {
		character = root
		animation = happiness
	}

	immediate = {}

	option = { 
		name = evil.3250.a # 
		custom_tooltip = evil.3250.a.tt
		remove_character_modifier = searching_shadow_library_modifier
		add_character_modifier = {
			modifier = lost_shadow_library_modifier
		}
		trigger_event = {
			id = evil.3251
#			years = 5
		}
	}

}

################## Phase 2: The Shadow Library (More knowledge?)
evil.3251 = {	
	type = character_event
	title = evil.3251.t
	desc = evil.3251.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = temple
	}
	left_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		if = {
			limit = {NOT = {exists = var:librarycounter}}
			set_variable = {name = librarycounter value = 0}
		}
		else = {
			change_variable = {name = librarycounter add = 2}
		}
	}

	option = { 
		name = evil.3251.a # 
		custom_tooltip = evil.3251.a.tt
		add_learning_skill = 1
		add_stress = 25
		random_list = {
			10 = {}
			1 = {
				compare_modifier = {
					value = var:librarycounter
				}
				if = {
					limit = {AND = {has_trait = ill has_trait = lunatic}}
					death = {
						death_reason = death_vanished
					}
				}
				if = {
					limit = {has_trait = lunatic_1}
					add_trait = ill
					set_variable = {name = librarycounter value = 0}
				}
				if = {
					limit = {NOT = {has_trait = lunatic_1 }}
					add_trait = lunatic_1
				}
				set_variable = {name = librarycounter value = 0}
			}
		}
		trigger_event = {
			id = evil.3251
			days = 1
#			years = 1
		}
	}

	option = { 
		name = evil.3251.b # 
		custom_tooltip = evil.3251.b.tt
		trigger_event = {
			id = evil.3252
			days = 1
#			years = 1
		}
	}

}

################## Phase 2: The Shadow Library (LOST)
evil.3252 = {	
	type = character_event
	title = evil.3252.t
	desc = {
        first_valid = {
            triggered_desc = {
                trigger = {exists = var:exit var:exit = 0}
                desc = evil.3252.1.desc
            }
            triggered_desc = {
                trigger = {exists = var:exit var:exit = 1}
                desc = evil.3252.2.desc
            }
        }
    }
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = paranoia
	}

	immediate = {
		random_list = {
			25 = {
				set_variable = {name = exit value = 0}
				add_stress = 20
				random_list = {
					33 = {
						if = {
							limit = {NOT = {has_trait = lunatic}}
							add_trait = lunatic_1
						}
					}
					66 = {}
				}
			}
			75 = {set_variable = {name = exit value = 1}}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc ={
						trigger = {exists = var:exit var:exit = 0}
						desc = evil.3252.1.a
					}
					triggered_desc ={
						trigger = {exists = var:exit var:exit = 1}
						desc = evil.3252.2.a
					}
				}
			}
		}
		custom_tooltip = evil.3252.a.tt
		if = {
			limit = {exists = var:exit var:exit = 0}
			trigger_event = {
				id = evil.3252
				#days = 100
			}
		}
		else_if = {
			limit = {exists = var:exit var:exit = 1}
			trigger_event = {
				id = evil.3253
			}
		}
	}		

}

# Phase 2: The Shadow Library (OUT!)
evil.3253 = {	
	type = character_event
	title = evil.3253.t
	desc = evil.3253.desc
	theme = learning_scholarship_focus
	override_background = {     
      reference = wilderness_mountains
	}
	left_portrait = {
		character = root
		animation = happiness
	}

	option = { 
		name = evil.3253.a
		if = {
			limit = {
				has_trait = sorcerer_1
			}
			custom_tooltip = evil.3253.a.tt1
		}
		else_if = {
			limit = {
				has_trait = sorcerer_2
			}
			custom_tooltip = evil.3253.a.tt2
		}
		else = {
			custom_tooltip = evil.3253.a.tt
		}
		remove_character_modifier = lost_shadow_library_modifier
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_character_modifier = sorcery_connoisseur_modifier
					}
				}
				add_character_modifier = sorcery_connoisseur_modifier
			}
			if = {
				limit = {
					has_trait = sorcerer_1
				}
				random_list = {				
					50 = {
				
					}
				
					50 = {
						remove_trait = sorcerer_1
						add_trait = sorcerer_2
					}
				}
			}
			else_if = {
				limit = {
					has_trait = sorcerer_2
				}
				random_list = {
					25 = {
				
					}
				
					75 = {
						remove_trait = sorcerer_2
						add_trait = sorcerer_3
					}
				}
			}
		}
	}
	after = {
		remove_character_flag = planning_an_activity
	}
}