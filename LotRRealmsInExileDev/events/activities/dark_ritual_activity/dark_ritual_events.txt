########################################
# Sorcery
# by Gseg and ispanets
# recoded by Jaco_Daan (the Snail Guy)
########################################
namespace = lotr_sorcery_ritual

lotr_sorcery_ritual.0001 = { #You and your apprentice (if you have one) prepare several reagents
	type = activity_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	override_background = {  reference = corridor_night }
	title = lotr_sorcery_ritual.0001.t
	desc = {
		desc = lotr_sorcery_ritual.0001.desc.intro
		triggered_desc = {
			trigger = {
				any_relation = { type = apprentice_sorcerer }
			}
			desc = lotr_sorcery_ritual.0001.desc.apprentice
		}
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { # Start the ritual
		name = lotr_sorcery_ritual.0001.a
	}
}

lotr_sorcery_ritual.0002 = { #You/Your apprentice lead a prisoner to be sacrificed and stumble
	type = activity_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}

	title = lotr_sorcery_ritual.0002.t
	desc = {
		desc = lotr_sorcery_ritual.0002.desc.intro
		first_valid  = {
			triggered_desc = {
				trigger = {
					any_relation = { type = apprentice_sorcerer }
				}
				desc = lotr_sorcery_ritual.0002.desc.apprentice
			}
			desc = lotr_sorcery_ritual.0002.desc.no_apprentice
		}
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Chase after the prisoner
		name = lotr_sorcery_ritual.0002.a
	}
	
	option = { #Let them escape
		name = lotr_sorcery_ritual.0002.b
	}
}

lotr_sorcery_ritual.0003 = { #The Chase's End
	type = activity_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}

	title = lotr_sorcery_ritual.0003.t
	desc = {
		first_valid  = {
			triggered_desc = {
				trigger = { 
					any_relation = { type = apprentice_sorcerer }
					has_character_flag = captured_escaping_prisoner
				}
				desc = lotr_sorcery_ritual.0003.desc.apprentice
				desc = lotr_sorcery_ritual.0003.desc.apprentice.with_prisoner
			}
			triggered_desc = {
				trigger = { 
					any_relation = { type = apprentice_sorcerer }
					NOT = { has_character_flag = captured_escaping_prisoner }
				}
				desc = lotr_sorcery_ritual.0003.desc.apprentice
				desc = lotr_sorcery_ritual.0003.desc.apprentice.without_prisoner
			}
			triggered_desc = {
				trigger = { has_character_flag = captured_escaping_prisoner }
				desc = lotr_sorcery_ritual.0003.desc.no_apprentice.with_prisoner
			}
			triggered_desc = {
				trigger = { NOT = { has_character_flag = captured_escaping_prisoner } }
				desc = lotr_sorcery_ritual.0003.desc.no_apprentice.without_prisoner
			}
		}
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Chase after the prisoner
		name = lotr_sorcery_ritual.0003.a
	}
}

lotr_sorcery_ritual.0004 = { #Unseen Whispering
	type = activity_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}

	title = lotr_sorcery_ritual.0004.t
	desc = {
		desc = lotr_sorcery_ritual.0004.desc.intro
		first_valid  = {
			triggered_desc = {
				trigger = {
					any_relation = { type = apprentice_sorcerer }
				}
				desc = lotr_sorcery_ritual.0004.desc.apprentice
			}
		}
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Chase after the prisoner
		name = lotr_sorcery_ritual.0004.a
	}
}

lotr_sorcery_ritual.0005 = { #A Lingering Doubt
	type = activity_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}

	title = lotr_sorcery_ritual.0005.t
	desc = {
		desc = lotr_sorcery_ritual.0005.desc.intro
		first_valid  = {
			triggered_desc = {
				trigger = {
					any_relation = { type = apprentice_sorcerer }
				}
				desc = lotr_sorcery_ritual.0005.desc.apprentice
			}
			desc = lotr_sorcery_ritual.0005.desc.no_apprentice
		}
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Chase after the prisoner
		name = lotr_sorcery_ritual.0005.a
	}
}

lotr_sorcery_ritual.0006 = { #A Distant Cry
	type = activity_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}

	title = lotr_sorcery_ritual.0006.t
	desc = {
		desc = lotr_sorcery_ritual.0006.desc.intro
		first_valid  = {
			triggered_desc = {
				trigger = {
					any_relation = { type = apprentice_sorcerer }
				}
				desc = lotr_sorcery_ritual.0006.desc.apprentice
			}
			desc = lotr_sorcery_ritual.0006.desc.no_apprentice
		}
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Chase after the prisoner
		name = lotr_sorcery_ritual.0006.a
	}
}

lotr_sorcery_ritual.0100 = { #End Result
	type = activity_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	override_background = {     
      reference = corridor_night
	}

	title = {
		first_valid = {
			triggered_desc = { #Life Extension
				trigger = { 
					OR = {
						var:spell_selected = flag:life_extension_01
						var:spell_selected = flag:life_extension_02
						var:spell_selected = flag:life_extension_03
					}
				}
				desc =  lotr_sorcery_ritual.0100.t.life_extension
			}
			triggered_desc = { #Raise Undead Hordes
				trigger = {
					OR = {
						var:spell_selected = flag:raise_undead_hordes_01
						var:spell_selected = flag:raise_undead_hordes_02
						var:spell_selected = flag:raise_undead_hordes_03
					}
				}
				desc = lotr_sorcery_ritual.0100.t.raise_undead_hordes
			}
			triggered_desc = { #Pestilence
				trigger = {
					OR = {
						var:spell_selected = flag:pestilence_01
						var:spell_selected = flag:pestilence_02
						var:spell_selected = flag:pestilence_03
					}
				}
				desc = lotr_sorcery_ritual.0100.t.pestilence
			}
			triggered_desc = { #Blighting Lands
				trigger = {
					OR = {
						var:spell_selected = flag:blighting_lands_01
						var:spell_selected = flag:blighting_lands_02
						var:spell_selected = flag:blighting_lands_03
					}
				}
				desc = lotr_sorcery_ritual.0100.t.blighting_lands
			}
		}
	}

	desc = {
		first_valid  = { #Description of spell
			triggered_desc = { #Life Extension
				trigger = {
					OR = {
						var:spell_selected = flag:life_extension_01
						var:spell_selected = flag:life_extension_02
						var:spell_selected = flag:life_extension_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.life_extension
			}
			triggered_desc = { #Raise Undead Hordes
				trigger = {
					OR = {
						var:spell_selected = flag:raise_undead_hordes_01
						var:spell_selected = flag:raise_undead_hordes_02
						var:spell_selected = flag:raise_undead_hordes_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.raise_undead_hordes
			}
			triggered_desc = { #Pestilence
				trigger = {
					OR = {
						var:spell_selected = flag:pestilence_01
						var:spell_selected = flag:pestilence_02
						var:spell_selected = flag:pestilence_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.pestilence
			}
			triggered_desc = { #Blighting Lands
				trigger = {
					OR = {
						var:spell_selected = flag:blighting_lands_01
						var:spell_selected = flag:blighting_lands_02
						var:spell_selected = flag:blighting_lands_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.blighting_lands
			}
		}
		first_valid  = { #You have an apprentice
			triggered_desc = { #Life Extension
				trigger = {
					any_relation = { type = apprentice_sorcerer }
					OR = {
						var:spell_selected = flag:life_extension_01
						var:spell_selected = flag:life_extension_02
						var:spell_selected = flag:life_extension_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.life_extension.apprentice
			}
			triggered_desc = { #Raise Undead Hordes
				trigger = {
					any_relation = { type = apprentice_sorcerer }
					OR = {
						var:spell_selected = flag:raise_undead_hordes_01
						var:spell_selected = flag:raise_undead_hordes_02
						var:spell_selected = flag:raise_undead_hordes_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.raise_undead_hordes.apprentice
			}
			triggered_desc = { #Pestilence
				trigger = {
					any_relation = { type = apprentice_sorcerer }
					OR = {
						var:spell_selected = flag:pestilence_01
						var:spell_selected = flag:pestilence_02
						var:spell_selected = flag:pestilence_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.pestilence.apprentice
			}
			triggered_desc = { #Blighting Lands
				trigger = {
					any_relation = { type = apprentice_sorcerer }
					OR = {
						var:spell_selected = flag:blighting_lands_01
						var:spell_selected = flag:blighting_lands_02
						var:spell_selected = flag:blighting_lands_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.blighting_lands.apprentice
			}
		}
		first_valid  = { #Description of spell
			triggered_desc = { #Life Extension
				trigger = {
					has_character_flag = sacrified_someone
					OR = {
						var:spell_selected = flag:life_extension_01
						var:spell_selected = flag:life_extension_02
						var:spell_selected = flag:life_extension_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.life_extension.sacrifice
			}
			triggered_desc = { #Raise Undead Hordes
				trigger = {
					has_character_flag = sacrified_someone
					OR = {
						var:spell_selected = flag:raise_undead_hordes_01
						var:spell_selected = flag:raise_undead_hordes_02
						var:spell_selected = flag:raise_undead_hordes_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.raise_undead_hordes.sacrifice
			}
			triggered_desc = { #Pestilence
				trigger = {
					has_character_flag = sacrified_someone
					OR = {
						var:spell_selected = flag:pestilence_01
						var:spell_selected = flag:pestilence_02
						var:spell_selected = flag:pestilence_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.pestilence.sacrifice
			}
			triggered_desc = { #Blighting Lands
				trigger = {
					has_character_flag = sacrified_someone
					OR = {
						var:spell_selected = flag:blighting_lands_01
						var:spell_selected = flag:blighting_lands_02
						var:spell_selected = flag:blighting_lands_03
					}
				}
				desc = lotr_sorcery_ritual.0100.desc.blighting_lands.sacrifice
			}
		}
	}
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Chase after the prisoner
		name = {
			text = {
				first_valid  = { #Description of spell
					triggered_desc = { #Life Extension
						trigger = {
							has_character_flag = sacrified_someone
							OR = {
								var:spell_selected = flag:life_extension_01
								var:spell_selected = flag:life_extension_02
								var:spell_selected = flag:life_extension_03
							}
						}
						desc = lotr_sorcery_ritual.0100.a.life_extension
					}
					triggered_desc = { #Raise Undead Hordes
						trigger = {
							has_character_flag = sacrified_someone
							OR = {
								var:spell_selected = flag:raise_undead_hordes_01
								var:spell_selected = flag:raise_undead_hordes_02
								var:spell_selected = flag:raise_undead_hordes_03
							}
						}
						desc = lotr_sorcery_ritual.0100.a.raise_undead_hordes
					}
					triggered_desc = { #Pestilence
						trigger = {
							has_character_flag = sacrified_someone
							OR = {
								var:spell_selected = flag:pestilence_01
								var:spell_selected = flag:pestilence_02
								var:spell_selected = flag:pestilence_03
							}
						}
						desc = lotr_sorcery_ritual.0100.a.pestilence
					}
					triggered_desc = { #Blighting Lands
						trigger = {
							has_character_flag = sacrified_someone
							OR = {
								var:spell_selected = flag:blighting_lands_01
								var:spell_selected = flag:blighting_lands_02
								var:spell_selected = flag:blighting_lands_03
							}
						}
						desc = lotr_sorcery_ritual.0100.a.blighting_lands
					}
				}
			}
		}

		switch = {
			trigger = var:spell_selected
			
			### Death Spells ###
			flag:life_extension_01 = { add_character_modifier = life_extension_01_modifier }
			flag:life_extension_02 = { add_character_modifier = { modifier = life_extension_02_modifier years = 15 } }
			flag:life_extension_03 = { add_character_modifier = { modifier = life_extension_03_modifier years = 25 } }
			flag:raise_undead_hordes_01 = { }
			flag:raise_undead_hordes_02 = { }
			flag:raise_undead_hordes_03 = { }
			flag:pestilence_01 = { }
			flag:pestilence_02 = { }
			flag:pestilence_03 = { }
			flag:blighting_lands_01 = { }
			flag:blighting_lands_02 = { }
			flag:blighting_lands_03 = { }
			
			### Deception Spells ###
			flag:corruption_01 = { add_character_modifier = { modifier = corruption_01_modifier years = 10 } }
			flag:corruption_02 = { add_character_modifier = { modifier = corruption_02_modifier years = 15 } }
			flag:corruption_03 = { add_character_modifier = { modifier = corruption_03_modifier years = 25 } }
			flag:fair_visage_01 = { add_character_modifier = { modifier = fair_visage_01_modifier years = 10 } }
			flag:fair_visage_02 = { add_character_modifier = { modifier = fair_visage_02_modifier years = 15 } }
			flag:fair_visage_03 = { add_character_modifier = { modifier = fair_visage_03_modifier years = 25 } }
			flag:enfeeblement_01 = { }
			flag:enfeeblement_02 = { }
			flag:enfeeblement_03 = { }
			flag:dark_influence_01 = { add_hook = { type = sorcery_dark_influence_01 target = var:hook_target } }
			flag:dark_influence_02 = { add_hook = { type = sorcery_dark_influence_02 target = var:hook_target } }
			flag:dark_influence_03 = { add_hook = { type = sorcery_dark_influence_03 target = var:hook_target } }
			
			### Destruction Spells ###
			flag:dark_empowerment_01 = { }
			flag:dark_empowerment_02 = { }
			flag:dark_empowerment_03 = { }
			flag:invoke_watchers_01 = { }
			flag:invoke_watchers_02 = { }
			flag:invoke_watchers_03 = { }
			flag:endless_hordes_01 = { }
			flag:endless_hordes_02 = { }
			flag:endless_hordes_03 = { }
			flag:dark_beasts_01 = { }
			flag:dark_beasts_02 = { }
			flag:dark_beasts_03 = { }
		}
	}
}

#########################
### Apprentice Events ###
#########################

lotr_sorcery_ritual.0200 = { #Aiding in a Task
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0200.t
	desc = lotr_sorcery_ritual.0200.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Follow the task exactly as instructed.
		name = lotr_sorcery_ritual.0200.a
		#Duel code - easier learning
	}
	
	option = { #Attempt to understand the purpose behind the task.
		name = lotr_sorcery_ritual.0200.b 
		#Duel code - intrigue/learning
	}
}

lotr_sorcery_ritual.0201 = { #Reading What Was Forgotten
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0201.t
	desc = lotr_sorcery_ritual.0201.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Ignore the temptation and retrieve only what was asked.
		name = lotr_sorcery_ritual.0201.a
		#stress loss
	}
	
	option = { #Take the hidden tome for later study.
		name = lotr_sorcery_ritual.0201.b
		#gain XP + stress gain
	}
}

lotr_sorcery_ritual.0202 = { #Taking the First Step
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0202.t
	desc = lotr_sorcery_ritual.0202.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Hesitate and choose the least drastic action.
		name = lotr_sorcery_ritual.0202.a
		#Low Learning duel - Gain small XP
	}
	
	option = { #Embrace what must be done without flinching.
		name = lotr_sorcery_ritual.0202.b
		#Hard Learning duel - Gain big XP
	}
}

lotr_sorcery_ritual.0203 = { #A Lesson in Pain
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0203.t
	desc = lotr_sorcery_ritual.0203.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Endure in silence, showing discipline.
		name = lotr_sorcery_ritual.0203.a
		#Gain wounded_1, personality change - calllous
	}
	
	option = { #Embrace the pain, proving devotion.
		name = lotr_sorcery_ritual.0203.b
		#Gain wounded_1, personality change - sadistic
	}
}

lotr_sorcery_ritual.0204 = { #A Scar Earned
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0204.t
	desc = lotr_sorcery_ritual.0204.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Ignore the wound and continue working.
		name = lotr_sorcery_ritual.0204.a
		#Gain wounded_1 + small XP
	}
	
	option = { #Study the mark, risking further consequences.
		name = lotr_sorcery_ritual.0204.b
		#Do NOT gain wounded, no XP
	}
}

lotr_sorcery_ritual.0205 = { #A Warning Unheeded
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0205.t
	desc = lotr_sorcery_ritual.0205.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Leave before I am noticed.
		name = lotr_sorcery_ritual.0205.a
		#Nothing happens
	}
	
	option = { #Stay and observe, risking discovery.
		name = lotr_sorcery_ritual.0205.b
		#Risk being noticed - opinion loss + chance of getting injured
	}
}

lotr_sorcery_ritual.0206 = { #A Desperate Gamble
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0206.t
	desc = lotr_sorcery_ritual.0206.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Resist the temptation and step away.
		name = lotr_sorcery_ritual.0206.a
		#Minor XP gain
	}
	
	option = { #Seize the opportunity, no matter the risk.
		name = lotr_sorcery_ritual.0206.b
		#Intrigue/Learning duel - Gain medium amount of XP | Lose opinion + chance of getting flagelated
	}
}

lotr_sorcery_ritual.0207 = { #A Bitter Taste
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0207.t
	desc = lotr_sorcery_ritual.0207.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { #Wait for the feeling to fade.
		name = lotr_sorcery_ritual.0207.a
		#gain Ill trait + minor XP
	}
	
	option = { #Embrace the sensation and see where it leads.
		name = lotr_sorcery_ritual.0207.a
		#gain Ill trait + stress gain + small XP
	}
}

lotr_sorcery_ritual.0208 = {
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0208.t
	desc = lotr_sorcery_ritual.0208.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { 
		name = lotr_sorcery_ritual.0208.a
	}
	
	option = { 
		name = lotr_sorcery_ritual.0208.b
	}
}

lotr_sorcery_ritual.0209 = {
	type = character_event
	content_source = realms_dlc
	theme = learning_scholarship_focus
	title = lotr_sorcery_ritual.0209.t
	desc = lotr_sorcery_ritual.0209.desc
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = { 
		name = lotr_sorcery_ritual.0209.a
	}
	
	option = { 
		name = lotr_sorcery_ritual.0209.b
	}
}