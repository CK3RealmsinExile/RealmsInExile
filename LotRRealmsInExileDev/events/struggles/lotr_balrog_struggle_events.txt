namespace = balrog_struggle

# 0000-0999 - Maintenance
# 1000-1999 - Decision Events
# 2000-2999 - Minor Balrog Events
# 3000-3999 - Major Balrog Events
# 4000-4999 - Armageddon Balrog Events

## Decisions Events
# Serve the Balrog ending decision event - attmept
balrog_struggle.1001 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1001.t
	desc = balrog_struggle.1001.desc
	theme = faith
	override_background = {
		reference = mining_activity
	}

	right_portrait = {
		character = root
		animation = personality_honorable
	}
	
	option = {
		name = balrog_struggle.1001.a
		duel = {
			skill = learning
			value = 20
			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
				}
				trigger_event = balrog_struggle.1002
				show_as_tooltip = {
					get_title = title:e_servants_of_the_dark_flame
					give_nickname = nick_flamesworn
					custom_tooltip = {
						text = balrog_struggle.1002.effect3
					}
					custom_tooltip = {
						text = balrog_struggle.1002.effect
					}
					add_prestige = 1000
					add_piety = 750
					dynasty = { 
						add_dynasty_prestige = 750
						add_dynasty_prestige_level = 1
					}
					faith:faith_balrog_cult = {
						add_doctrine = doctrine_temporal_head
					}
				}
			}

			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				trigger_event = balrog_struggle.1003
				show_as_tooltip = {
					death = {
						death_reason = death_burned
					}
				}
			}
		}
	}
	
	option = {
		name = balrog_struggle.1001.b
		duel = {
			skill = diplomacy
			value = 20
			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
				}
				trigger_event = balrog_struggle.1002
				show_as_tooltip = {
					get_title = title:e_servants_of_the_dark_flame
					give_nickname = nick_flamesworn
					custom_tooltip = {
						text = balrog_struggle.1002.effect3
					}
					custom_tooltip = {
						text = balrog_struggle.1002.effect
					}
					add_prestige = 1000
					add_piety = 750
					dynasty = { 
						add_dynasty_prestige = 750
						add_dynasty_prestige_level = 1
					}
					faith:faith_balrog_cult = {
						add_doctrine = doctrine_temporal_head
					}
				}
			}

			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				trigger_event = balrog_struggle.1003
				show_as_tooltip = {
					death = {
						death_reason = death_burned
					}
				}
			}
		}
	}
	
	option = {
		name = balrog_struggle.1001.c
	}
}

# Serve the Balrog ending decision event - success
balrog_struggle.1002 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1002.t
	desc = balrog_struggle.1002.desc
	theme = faith
	override_background = {
		reference = mining_activity
	}

	right_portrait = {
		character = root
		animation = personality_bold
	}
	
	option = {
		name = balrog_struggle.1002.a
		get_title = title:e_servants_of_the_dark_flame
		give_nickname = nick_flamesworn
		custom_tooltip = {
			text = balrog_struggle.1002.effect3
		}
		custom_tooltip = {
			text = balrog_struggle.1002.effect
		}
		add_prestige = 1000
		add_piety = 750
		dynasty = { 
			add_dynasty_prestige = 750
			add_dynasty_prestige_level = 1
		}
		faith:faith_balrog_cult = {
			add_doctrine = doctrine_temporal_head
		}
	}

	after = {
		faith:faith_balrog_cult = {
			custom_tooltip = {
				text = balrog_struggle.1002.effect2
				set_religious_head_title = title:e_servants_of_the_dark_flame
			}
		}
	}
}

# Serve the Balrog ending decision event - failure
balrog_struggle.1003 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1003.t
	desc = balrog_struggle.1003.desc
	theme = faith
	override_background = {
		reference = mining_activity
	}

	right_portrait = {
		character = root
		animation = fear
	}
	
	option = {
		name = balrog_struggle.1003.a
		death = {
			death_reason = death_burned
		}
	}
}

## Minor Balrog Events

balrog_struggle.2001 = { # The Watching Darkness
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2001.t
	desc = balrog_struggle.2001.desc
	theme = crown
	override_background = {
		reference = mining_activity
	}

	right_portrait = {
		character = root
		animation = paranoia
	}
	
	option = {
		name = balrog_struggle.2001.a
		stress_impact = {
			base = 25
			paranoid = 15
			craven = 15
			brave = -10
		}
		if = {
			limit = {
				has_trait = trusting
			}
			random = {
				chance = 30
				hidden_effect = {
					remove_trait = trusting
				}
				send_interface_toast = {
					title = balrog_struggle.2001.a.paranoid
					left_icon = root
					add_trait = paranoid
				}
			}
		}
		else_if = {
			limit = {
				has_trait = brave
			}
			random = {
				chance = 30
				hidden_effect = {
					remove_trait = brave
				}
				send_interface_toast = {
					title = balrog_struggle.2001.a.craven
					left_icon = root
					add_trait = craven
				}
			}
		}
		else_if = {
			limit = {
				NOT = { has_trait = lunatic_1 }
			}
			random = {
				chance = 10
				send_interface_toast = {
					title = balrog_struggle.2001.a.lunatic
					left_icon = root
					add_trait = lunatic_1
				}
			}
		}
	}
}

balrog_struggle.2011 = { # A Narrow Escape
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2011.t
	desc = balrog_struggle.2011.desc
	theme = crown
	override_background = {
		reference = mining_activity
	}

	right_portrait = {
		character = root
		animation = pain
	}
	
	option = {
		name = balrog_struggle.2011.a
		stress_impact = {
			base = 25
			craven = 15
			brave = -10
		}
		random = {
			chance = 35
			send_interface_toast = {
				title = balrog_struggle.2011.a.wounds
				left_icon = root
				increase_wounds_no_death_effect = { REASON = wounds }
			}
		}
	}
}

balrog_struggle.2021 = { # Path of Destruction
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2021.t
	desc = balrog_struggle.2021.desc
	theme = crown
	override_background = {
		reference = mining_activity
	}

	right_portrait = {
		character = root
		animation = stress
	}

	trigger = {
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			kingdom = title:k_khazad_dum
		}
	}

	immediate = {
		add_stress = 10
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				kingdom = title:k_khazad_dum
			}
			save_scope_as = selected_county
		}
	}
	
	option = {
		name = balrog_struggle.2021.a
		remove_short_term_gold = major_gold_value
	}

	option = {
		name = balrog_struggle.2021.b
		remove_random_building_underground = { COUNTY = scope:selected_county }
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_path_of_destruction_county_modifier
				years = 5
			}
		}
	}
}

balrog_struggle.2031 = { # A New Life
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2031.t
	desc = balrog_struggle.2031.desc
	theme = crown
	override_background = {
		reference = mining_activity
	}

	left_portrait = {
		character = root
		animation = disapproval
	}

	right_portrait = {
		character = scope:leaver
		animation = beg
	}

	lower_center_portrait = {
		character = scope:new_employer
	}

	immediate = {
		if = {
			limit = {
				any_councillor = {
					is_landed = no
					is_landless_ruler = no
				}
			}
			random_councillor = {
				limit = {
					is_landed = no
					is_landless_ruler = no
				}
				save_scope_as = leaver
			}
		}
		else = {
			random_courtier = {
				limit = {
					is_landed = no
					is_landless_ruler = no
				}
				save_scope_as = leaver
			}
		}
		if = {
			limit = {
				is_orc = yes
			}
			random_ruler = {
				limit = {
					is_orc = yes
					NOT = { this = root }
					NOT = {
						any_held_title = {
							tier = tier_county
							kingdom = title:k_khazad_dum
						}
					}
					NOT = {
						any_held_title = {
							OR = {
								is_mercenary_company = yes
								is_holy_order = yes
							}
						}
					}
				}
				weight = {
					base = 1
					modifier = {
						add = 10
						has_same_culture_as = scope:leaver
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = -2000
						has_relation_rival = scope:leaver
					}
				}
				save_scope_as = new_employer
			}
		}
		else_if = {
			limit = {
				is_orc = no
			}
			random_ruler = {
				limit = {
					is_dwarf = yes
					NOT = { this = root }
					NOT = {
						any_held_title = {
							tier = tier_county
							kingdom = title:k_khazad_dum
						}
					}
					NOT = {
						any_held_title = {
							OR = {
								is_mercenary_company = yes
								is_holy_order = yes
							}
						}
					}
				}
				weight = {
					base = 1
					modifier = {
						add = 10
						has_same_culture_as = scope:leaver
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = -2000
						has_relation_rival = scope:leaver
					}
				}
				save_scope_as = new_employer
			}
		}
	}
	
	option = { # Convince them to stay
		name = balrog_struggle.2031.a
		duel = {
			skill = diplomacy
			value = decent_skill_rating
			50 = {
				desc = balrog_struggle.2031.a.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3
				}
				send_interface_toast = {
					title = balrog_struggle.2031.a.success
					left_icon = root
					right_icon = scope:leaver
					add_prestige = 50
				}
			}
			50 = {
				desc = balrog_struggle.2031.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3
				}
				send_interface_toast = {
					title = balrog_struggle.2031.a.failure
					left_icon = scope:new_employer
					right_icon = scope:leaver
					scope:leaver = {
						set_employer = scope:new_employer
					}
					add_prestige = -100
				}
			}
		}
	}

	option = { # Give them my blessing to leave
		name = balrog_struggle.2031.b
		send_interface_toast = {
			title = balrog_struggle.2031.a.failure
			left_icon = scope:new_employer
			right_icon = scope:leaver
			scope:leaver = {
				set_employer = scope:new_employer
			}
		}
		if = {
			limit = {
				has_trait = callous
			}
			random = {
				chance = 20
				hidden_effect = {
					remove_trait = callous
				}
				send_interface_toast = {
					title = balrog_struggle.2031.b.compassionate
					left_icon = root
					add_trait = compassionate
				}
			}
		}
		else_if = {
			limit = {
				has_trait = sadistic
			}
			random = {
				chance = 20
				hidden_effect = {
					remove_trait = sadistic
				}
				send_interface_toast = {
					title = balrog_struggle.2031.b.compassionate
					left_icon = root
					add_trait = compassionate
				}
			}
		}
	}
}

balrog_struggle.2041 = { # Crisis of Faith
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2041.t
	desc = balrog_struggle.2041.desc
	theme = crown
	override_background = {
		reference = mining_activity
	}

	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:concerned_subject
		animation = personality_zealous
	}

	trigger = {
		NOT = { has_faith = faith:faith_balrog_cult }
	}

	immediate = {
		if = {
			limit = {
				any_councillor = {
					count > 0
					NOT = { has_faith = faith:faith_balrog_cult }
				}
			}
			random_councillor = {
				limit = {
					NOT = { has_faith = faith:faith_balrog_cult }
				}
				weight = {
					base = 1
					modifier = {
						add = 1000
						has_council_position = councillor_court_chaplain
					}
				}
				save_scope_as = concerned_subject
			}
		}
		else = {
			random_courtier = {
				limit = {
					NOT = { has_faith = faith:faith_balrog_cult }
				}
				save_scope_as = concerned_subject
			}
		}
	}
	
	option = { # Restore their faith
		name = balrog_struggle.2041.a
		duel = {
			skill = learning
			value = decent_skill_rating
			50 = {
				desc = balrog_struggle.2041.a.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3
				}
				send_interface_toast = {
					title = balrog_struggle.2041.a.success
					left_icon = root
					add_piety = 100
					add_character_modifier = {
						modifier = lotr_faith_restored_character_modifier
						years = 5
					}
					progress_towards_friend_effect = {
						REASON = friend_matters_of_faith
						CHARACTER = scope:concerned_subject
						OPINION = default_friend_opinion
					}
				}
			}
			50 = {
				desc = balrog_struggle.2041.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3
				}
				send_interface_toast = {
					title = balrog_struggle.2041.a.failure
					left_icon = root
					add_character_modifier = {
						modifier = lotr_overzealous_leader_character_modifier
						years = 5
					}
				}
			}
		}
	}

	option = { # Arrange for religious ceremonies
		name = balrog_struggle.2041.b
		remove_short_term_gold = medium_gold_value
		add_piety = 75
		add_character_modifier = {
			modifier = lotr_faith_restored_character_modifier
			years = 5
		}
	}

	option = { # Silence dissenting voices
		name = balrog_struggle.2041.c
		add_tyranny = 50
		progress_towards_rival_effect = {
			REASON = rival_religious_secrets
			CHARACTER = scope:concerned_subject
			OPINION = -15
		}
	}

	option = { # Let them fret
		name = balrog_struggle.2041.d
		add_piety = -100
		add_character_modifier = {
			modifier = lotr_failed_to_restore_faith_character_modifier
			years = 5
		}
		progress_towards_rival_effect = {
			REASON = rival_religious_secrets
			CHARACTER = scope:concerned_subject
			OPINION = -30
		}
	}
}

balrog_struggle.2051 = { # Movement in the Dark
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2051.t
	desc = balrog_struggle.2051.desc
	theme = crown
	override_background = {
		reference = mining_activity
	}

	left_portrait = {
		character = root
		animation = personality_callous
	}

	right_portrait = {
		character = scope:courtier
		animation = fear
	}

	trigger = {
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			kingdom = title:k_khazad_dum
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				kingdom = title:k_khazad_dum
			}
			save_scope_as = selected_county
		}
		random_courtier = {
			save_scope_as = courtier
		}
	}
	
	option = {
		name = balrog_struggle.2051.a
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_lower_activity_county_modifier
				years = 10
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm
				character = root
			}
		}
	}

	option = {
		name = balrog_struggle.2051.b
		add_stress = 15
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger
				character = root
			}
		}
	}
}

balrog_struggle.2171 = { # Conflagration
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2171.t
	desc = balrog_struggle.2171.desc
	theme = crown
	override_background = {
		reference = mining_activity
	}

	right_portrait = {
		character = root
		animation = worry
	}

	trigger = {
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			kingdom = title:k_khazad_dum
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				kingdom = title:k_khazad_dum
			}
			save_scope_as = selected_county
		}
	}
	
	option = { # try and save it
		name = balrog_struggle.2171.a
		duel = {
			skill = stewardship
			skill = learning
			value = 10
			
			20 = { # Win
				desc = balrog_struggle.2171.tt.win
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
				}
				remove_short_term_gold = minor_gold_value
				add_prestige = 50
				send_interface_toast = {
					title = balrog_struggle.2171.tt.1
					left_icon = root
				}
			}

			20 = { # Lose
				desc = balrog_struggle.2171.tt.lost
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				custom_tooltip = balrog_struggle.2171.tt.lost_building
				send_interface_toast = {
					title = balrog_struggle.2171.tt.2
					left_icon = root
					remove_random_building_underground = { COUNTY = scope:selected_county }
				}
			}
		}
	}

	option = { # Let it burn
		name = balrog_struggle.2171.b
		custom_tooltip = balrog_struggle.2171.tt.lost_building
		
		send_interface_toast = {
			title = balrog_struggle.2171.tt.2
			left_icon = root
			remove_random_building_underground = { COUNTY = scope:selected_county }
		}
	}
}