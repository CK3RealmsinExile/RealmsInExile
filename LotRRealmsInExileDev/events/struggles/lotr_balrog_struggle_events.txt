namespace = balrog_struggle

# 0000-0999 - Maintenance
# 1000-1999 - Decision Events
# 2000-2999 - Minor Balrog Events
# 3000-3999 - Major Balrog Events
# 4000-4999 - Armageddon Balrog Events

## Maintenance
# Struggle Introduction
balrog_struggle.0001 = {
	content_source = realms_dlc
	type = character_event
	window = fullscreen_event
	title = balrog_struggle.0001.t

	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { game_start_date >= 6023.1.1 }
				desc = balrog_struggle.0001.desc
			}
			triggered_desc = {
				trigger = { game_start_date < 6023.1.1 }
				desc = balrog_struggle.0001.desc_before_balrog
			}
		}
	}

	theme = balrog
	override_background = { reference = balrog_struggle_start }

	trigger = {
		is_ai = no
 	}

	# widgets = {
	# 	widget = {
 	# 		gui = "event_window_widget_struggle_info"
 	# 		container = "dynamic_content_widget"
 	# 		controller = struggle_info
 	# 		setup_scope = { struggle:balrog_struggle = { save_scope_as = struggle } }
	# 	}
	# }
	
	option = {
		name = balrog_struggle.0001.a
		trigger = {
			faith_is_good = yes
			game_start_date >= 6023.1.1
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
	option = {
		name = balrog_struggle.0001.b
		trigger = {
			faith_is_neutral = yes
			game_start_date >= 6023.1.1
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
	option = {
		name = balrog_struggle.0001.c
		trigger = {
			faith_is_evil = yes
			game_start_date >= 6023.1.1
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
	option = {
		name = balrog_struggle.0001.d
		trigger = {
			game_start_date < 6023.1.1
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
}

balrog_struggle.0002 = {
	content_source = realms_dlc
	type = character_event
	window = fullscreen_event
	title = balrog_struggle.0002.t
	desc = {
		desc = balrog_struggle.0002.desc
		triggered_desc = {
			trigger = { scope:balrog_contender = character:linefinwe11 }
			desc = balrog_struggle.0002.desc.maglor
		}
		triggered_desc = {
			trigger = {
				exists = global_var:balrog_slayer_dead
				NOT = { scope:balrog_contender = character:linefinwe11 }
			}
			desc = balrog_struggle.0002.desc.dead
		}
		triggered_desc = {
			trigger = {
				NOT = { exists = global_var:balrog_slayer_dead }
				NOT = { scope:balrog_contender = character:linefinwe11 }
			}
			desc = balrog_struggle.0002.desc.alive
		}
	}
	theme = balrog
	override_background = { reference = balrog_struggle_start }

	trigger = {
		is_ai = no
 	}
	
	option = {
		name = balrog_struggle.0002.a
		trigger = {
			faith_is_good = yes
		}
	}
	option = {
		name = balrog_struggle.0002.b
		trigger = {
			faith_is_neutral = yes
		}
	}
	option = {
		name = balrog_struggle.0002.c
		trigger = {
			faith_is_evil = yes
		}
	}
}

balrog_struggle.0003 = {
	content_source = realms_dlc
	type = character_event
	window = fullscreen_event
	title = balrog_struggle.0003.t
	desc = balrog_struggle.0003.desc
	theme = balrog
	override_background = { reference = balrog_struggle_start }

	trigger = {
		is_ai = no
 	}
	
	option = {
		name = balrog_struggle.0003.a
		trigger = {
			faith_is_good = yes
		}
	}
	option = {
		name = balrog_struggle.0003.b
		trigger = {
			faith_is_neutral = yes
		}
	}
	option = {
		name = balrog_struggle.0003.c
		trigger = {
			faith_is_evil = yes
		}
	}
}

balrog_struggle.0004 = {
	content_source = realms_dlc
	type = character_event
	window = fullscreen_event
	title = balrog_struggle.0004.t
	desc = balrog_struggle.0004.desc
	theme = balrog
	override_background = { reference = balrog_struggle_start }

	trigger = {
		is_ai = no
		any_character_struggle = {
			is_struggle_type = balrog_struggle
			is_struggle_phase = struggle_balrog_phase_armageddon
		}
 	}
	
	option = {
		name = balrog_struggle.0004.a
		trigger = {
			faith_is_good = yes
		}
	}
	option = {
		name = balrog_struggle.0004.b
		trigger = {
			faith_is_neutral = yes
		}
	}
	option = {
		name = balrog_struggle.0004.c
		trigger = {
			faith_is_evil = yes
		}
	}
}

## Decisions Events
# Serve the Balrog ending decision event - attempt
balrog_struggle.1001 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1001.t
	desc = balrog_struggle.1001.desc
	theme = balrog

	override_background = {
		reference = durins_bane
	}

	right_portrait = {
		character = root
		animation = personality_honorable
	}
	
	immediate = {
		play_music_cue = lotr_cue_balrog
	}
	
	option = {
		name = balrog_struggle.1001.a
		duel = {
			skill = learning
			value = 20
			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
				}
				trigger_event = balrog_struggle.1002
				show_as_tooltip = {
					serve_balrog_decision_effect = yes
				}
			}

			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				trigger_event = balrog_struggle.1003
				show_as_tooltip = {
					death = {
						death_reason = death_burned
					}
				}
			}
		}
	}
	
	option = {
		name = balrog_struggle.1001.b
		duel = {
			skill = diplomacy
			value = 20
			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
				}
				trigger_event = balrog_struggle.1002
				show_as_tooltip = {
					serve_balrog_decision_effect = yes
				}
			}

			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				trigger_event = balrog_struggle.1003
				show_as_tooltip = {
					death = {
						death_reason = death_burned
					}
				}
			}
		}
	}
	
	option = {
		name = balrog_struggle.1001.c
	}
}

# Serve the Balrog ending decision event - success
balrog_struggle.1002 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1002.t
	desc = balrog_struggle.1002.desc
	theme = balrog
	
	override_background = {
		reference = durins_bane
	}

	right_portrait = {
		character = root
		animation = personality_bold
	}
	
	immediate = {
		play_music_cue = lotr_cue_balrog
	}
	
	option = {
		name = balrog_struggle.1002.a
		serve_balrog_decision_effect = yes
		if = {
			limit = { # Major News
				NOT = { has_game_rule = no_news }
			}
			every_player = { # Global News Announcement
				trigger_event = balrog_struggle.0003
			}
		}
	}

	after = {
		faith:faith_balrog_cult = {
			custom_tooltip = {
				text = balrog_struggle.1002.effect2
				set_religious_head_title = title:e_servants_of_the_dark_flame
			}
		}
	}
}

# Serve the Balrog ending decision event - failure
balrog_struggle.1003 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1003.t
	desc = balrog_struggle.1003.desc
	theme = balrog

	override_background = {
		reference = durins_bane
	}

	right_portrait = {
		character = root
		animation = fear
	}
	
	immediate = {
		play_music_cue = lotr_cue_balrog
	}
	
	option = {
		name = balrog_struggle.1003.a
		death = {
			death_reason = death_burned
		}
	}
}

balrog_struggle.1011 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1011.t
	desc = balrog_struggle.1011.desc

	theme = balrog
	override_background = { reference = durins_bane }
	
	right_portrait = {
		character = root
		animation = celebrate_axe
	}

	immediate = {
		save_scope_as = balrog_contender
	}

	option = { # Stand and fight
		name = balrog_struggle.1011.a
		skill = prowess

		random_list = {
			# You survive.
			0 = {
				modifier = { add = held_counties_value }
				modifier = { add = friends_with_elves } # Works
				modifier = { add = prowess_martial_value } # Works
				modifier = { add = durins_helm_value } # Works
				
				desc = balrog_struggle.1011.tt.success
				kill_balrog_decision_effect = yes
				random = {
					chance = 65
					death = { death_reason = death_durins_bane }
					set_global_variable = {
						name = balrog_slayer_dead
						value = yes
					}
				}
				if = {
					limit = { # Major News
						NOT = { has_game_rule = no_news }
					}
					every_player = { # Global News Announcement
						trigger_event = balrog_struggle.0002
					}
				}
			}
			# You perish.
			100 = {	
				modifier = { add = held_counties_value.neg }
				modifier = { add = friends_with_elves.neg } # Works
				modifier = { add = prowess_martial_value.neg } # Works
				modifier = { add = durins_helm_value.neg } # Works
				
				death = { death_reason = death_durins_bane }
				
				struggle:balrog_struggle = {
					every_involved_ruler = { trigger_event = balrog_struggle.1012 }
					change_struggle_phase = struggle_balrog_phase_active
				}
			}
		}
	}
	option = { # Nevermind, lets not do it
		name = balrog_struggle.1011.b
	}
}

balrog_struggle.1012 = {
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.1012.t
	desc = balrog_struggle.1012.desc

	theme = balrog
	override_background = { reference = durins_bane }
	
	right_portrait = {
		character = root
		animation = celebrate_axe
	}

	option = {
		name = balrog_struggle.1012.a
	}
}

## Minor Balrog Events

balrog_struggle.2001 = { # The Watching Darkness
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2001.t
	desc = balrog_struggle.2001.desc
	theme = balrog

	right_portrait = {
		character = root
		animation = paranoia
	}
	
	trigger = { is_wastelands = no }
	
	option = {
		name = balrog_struggle.2001.a
		stress_impact = {
			base = 25
			paranoid = 15
			craven = 15
			brave = -10
		}
		if = {
			limit = {
				has_trait = trusting
			}
			random = {
				chance = 30
				hidden_effect = {
					remove_trait = trusting
				}
				send_interface_toast = {
					title = balrog_struggle.2001.a.paranoid
					left_icon = root
					add_trait = paranoid
				}
			}
		}
		else_if = {
			limit = {
				has_trait = brave
			}
			random = {
				chance = 30
				hidden_effect = {
					remove_trait = brave
				}
				send_interface_toast = {
					title = balrog_struggle.2001.a.craven
					left_icon = root
					add_trait = craven
				}
			}
		}
		else_if = {
			limit = {
				NOT = { has_trait = lunatic_1 }
			}
			random = {
				chance = 10
				send_interface_toast = {
					title = balrog_struggle.2001.a.lunatic
					left_icon = root
					add_trait = lunatic_1
				}
			}
		}
	}
}

balrog_struggle.2011 = { # A Narrow Escape
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2011.t
	desc = balrog_struggle.2011.desc
	theme = balrog
	override_background = {
		reference = market_dwarven
	}

	right_portrait = {
		character = root
		animation = pain
	}
	
	trigger = { is_wastelands = no }
	
	option = {
		name = balrog_struggle.2011.a
		stress_impact = {
			base = 25
			craven = 15
			brave = -10
		}
		random = {
			chance = 35
			send_interface_toast = {
				title = balrog_struggle.2011.a.wounds
				left_icon = root
				increase_wounds_no_death_effect = { REASON = wounds }
			}
		}
	}
}

balrog_struggle.2021 = { # Path of Destruction
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2021.t
	desc = balrog_struggle.2021.desc
	theme = balrog
	override_background = {
		reference = market_dwarven
	}

	right_portrait = {
		character = root
		animation = stress
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
		}
	}

	immediate = {
		add_stress = 10
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
	}
	
	option = {
		name = balrog_struggle.2021.a
		remove_short_term_gold = major_gold_value
	}

	option = {
		name = balrog_struggle.2021.b
		remove_random_building_underground = { COUNTY = scope:selected_county }
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_path_of_destruction_county_modifier
				years = 5
			}
		}
	}
}

balrog_struggle.2031 = { # A New Life
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2031.t
	desc = balrog_struggle.2031.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = disapproval
	}

	right_portrait = {
		character = scope:leaver
		animation = beg
	}

	lower_center_portrait = {
		character = scope:new_employer
	}
	
	trigger = { is_wastelands = no }

	immediate = {
		if = {
			limit = {
				any_councillor = {
					is_landed = no
					is_landless_ruler = no
				}
			}
			random_councillor = {
				limit = {
					is_landed = no
					is_landless_ruler = no
				}
				save_scope_as = leaver
			}
		}
		else = {
			random_courtier = {
				limit = {
					is_landed = no
					is_landless_ruler = no
				}
				save_scope_as = leaver
			}
		}
		if = {
			limit = {
				is_orc = yes
			}
			random_ruler = {
				limit = {
					is_orc = yes
					NOT = { this = root }
					NOT = {
						any_held_title = {
							tier = tier_county
							title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
						}
					}
					NOT = {
						any_held_title = {
							OR = {
								is_mercenary_company = yes
								is_holy_order = yes
							}
						}
					}
				}
				weight = {
					base = 1
					modifier = {
						add = 10
						has_same_culture_as = scope:leaver
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = -2000
						has_relation_rival = scope:leaver
					}
				}
				save_scope_as = new_employer
			}
		}
		else_if = {
			limit = {
				is_orc = no
			}
			random_ruler = {
				limit = {
					is_dwarf = yes
					NOT = { this = root }
					NOT = {
						any_held_title = {
							tier = tier_county
							title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
						}
					}
					NOT = {
						any_held_title = {
							OR = {
								is_mercenary_company = yes
								is_holy_order = yes
							}
						}
					}
				}
				weight = {
					base = 1
					modifier = {
						add = 10
						has_same_culture_as = scope:leaver
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = -2000
						has_relation_rival = scope:leaver
					}
				}
				save_scope_as = new_employer
			}
		}
	}
	
	option = { # Convince them to stay
		name = balrog_struggle.2031.a
		duel = {
			skill = diplomacy
			value = decent_skill_rating
			50 = {
				desc = balrog_struggle.2031.a.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3
				}
				send_interface_toast = {
					title = balrog_struggle.2031.a.success
					left_icon = root
					right_icon = scope:leaver
					add_prestige = 50
				}
			}
			50 = {
				desc = balrog_struggle.2031.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3
				}
				send_interface_toast = {
					title = balrog_struggle.2031.a.failure
					left_icon = scope:new_employer
					right_icon = scope:leaver
					scope:leaver = {
						set_employer = scope:new_employer
					}
					add_prestige = -100
				}
			}
		}
	}

	option = { # Give them my blessing to leave
		name = balrog_struggle.2031.b
		send_interface_toast = {
			title = balrog_struggle.2031.a.failure
			left_icon = scope:new_employer
			right_icon = scope:leaver
			scope:leaver = {
				set_employer = scope:new_employer
			}
		}
		if = {
			limit = {
				has_trait = callous
			}
			random = {
				chance = 20
				hidden_effect = {
					remove_trait = callous
				}
				send_interface_toast = {
					title = balrog_struggle.2031.b.compassionate
					left_icon = root
					add_trait = compassionate
				}
			}
		}
		else_if = {
			limit = {
				has_trait = sadistic
			}
			random = {
				chance = 20
				hidden_effect = {
					remove_trait = sadistic
				}
				send_interface_toast = {
					title = balrog_struggle.2031.b.compassionate
					left_icon = root
					add_trait = compassionate
				}
			}
		}
	}
}

balrog_struggle.2041 = { # Crisis of Faith
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2041.t
	desc = balrog_struggle.2041.desc
	theme = balrog
	override_background = {
		reference = kitchen_dwarven
	}

	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:concerned_subject
		animation = personality_zealous
	}

	trigger = {
		NOT = { has_faith = faith:faith_balrog_cult }
		is_wastelands = no
	}

	immediate = {
		if = {
			limit = {
				any_councillor = {
					count > 0
					NOT = { has_faith = faith:faith_balrog_cult }
				}
			}
			random_councillor = {
				limit = {
					NOT = { has_faith = faith:faith_balrog_cult }
				}
				weight = {
					base = 1
					modifier = {
						add = 1000
						has_council_position = councillor_court_chaplain
					}
				}
				save_scope_as = concerned_subject
			}
		}
		else = {
			random_courtier = {
				limit = {
					NOT = { has_faith = faith:faith_balrog_cult }
				}
				save_scope_as = concerned_subject
			}
		}
	}
	
	option = { # Restore their faith
		name = balrog_struggle.2041.a
		duel = {
			skill = learning
			value = decent_skill_rating
			50 = {
				desc = balrog_struggle.2041.a.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3
				}
				send_interface_toast = {
					title = balrog_struggle.2041.a.success
					left_icon = root
					add_piety = 100
					add_character_modifier = {
						modifier = lotr_faith_restored_character_modifier
						years = 5
					}
					progress_towards_friend_effect = {
						REASON = friend_matters_of_faith
						CHARACTER = scope:concerned_subject
						OPINION = default_friend_opinion
					}
				}
			}
			50 = {
				desc = balrog_struggle.2041.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3
				}
				send_interface_toast = {
					title = balrog_struggle.2041.a.failure
					left_icon = root
					add_character_modifier = {
						modifier = lotr_overzealous_leader_character_modifier
						years = 5
					}
				}
			}
		}
	}

	option = { # Arrange for religious ceremonies
		name = balrog_struggle.2041.b
		remove_short_term_gold = medium_gold_value
		add_piety = 75
		add_character_modifier = {
			modifier = lotr_faith_restored_character_modifier
			years = 5
		}
	}

	option = { # Silence dissenting voices
		name = balrog_struggle.2041.c
		add_tyranny = 50
		progress_towards_rival_effect = {
			REASON = rival_religious_secrets
			CHARACTER = scope:concerned_subject
			OPINION = -15
		}
	}

	option = { # Let them fret
		name = balrog_struggle.2041.d
		add_piety = -100
		add_character_modifier = {
			modifier = lotr_failed_to_restore_faith_character_modifier
			years = 5
		}
		progress_towards_rival_effect = {
			REASON = rival_religious_secrets
			CHARACTER = scope:concerned_subject
			OPINION = -30
		}
	}
}

balrog_struggle.2051 = { # Movement in the Dark
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2051.t
	desc = balrog_struggle.2051.desc
	theme = balrog

	left_portrait = {
		character = root
		animation = personality_callous
	}

	right_portrait = {
		character = scope:courtier
		animation = fear
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
		random_courtier = {
			save_scope_as = courtier
		}
	}
	
	option = {
		name = balrog_struggle.2051.a
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_lower_activity_county_modifier
				years = 10
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm
				character = root
			}
		}
	}

	option = {
		name = balrog_struggle.2051.b
		add_stress = 15
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger
				character = root
			}
		}
	}
}

balrog_struggle.2061 = { # The Shuddering Earth
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2061.t
	desc = balrog_struggle.2061.desc
	theme = balrog
	override_background = {
		reference = market_dwarven
	}

	right_portrait = {
		character = root
		animation = personality_bold
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			title_province = { NOT = { has_holding_type = settlement_holding } }
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			NOT = {
				has_county_modifier = lotr_balrog_stronger_foundations_county_modifier
			}
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
				NOT = {
					has_county_modifier = lotr_balrog_stronger_foundations_county_modifier
				}
			}
			save_scope_as = selected_county
		}
		add_character_flag = {
			flag = immune_from_balrog_building_anger
			days = 2
		}
		remove_random_building_underground = { COUNTY = scope:selected_county }
	}
	
	option = {
		name = balrog_struggle.2061.a
		remove_short_term_gold = major_gold_value
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_stronger_foundations_county_modifier
				years = 25
			}
		}
	}

	option = {
		name = balrog_struggle.2061.b
		if = {
			limit = {
				scope:selected_county = {
					exists = this
					title_province = {
						num_buildings > 1
						terrain = halls
					}
				}
			}
			random = {
				chance = 60
				# custom_tooltip = balrog_struggle.2061.b.more_collapse
				send_interface_toast = {
					title = balrog_struggle.2061.b.more_collapse
					left_icon = root
					remove_random_building_underground = { COUNTY = scope:selected_county }
				}
			}
		}
	}
}

balrog_struggle.2071 = { # Enigmatic Scrawl
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2071.t
	desc = balrog_struggle.2071.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	right_portrait = {
		character = root
		animation = worry
	}

	left_portrait = {
		character = scope:random_courtier_1
		animation = paranoia
	}

	lower_center_portrait = {
		character = scope:random_courtier_2
	}

	lower_left_portrait = {
		character = scope:random_courtier_3
	}

	trigger = { 
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } } 
		is_dwarf = yes
		any_courtier_or_guest = { count > 0 }
	}

	immediate = {
		random_courtier_or_guest = {
			limit = { is_lotr_adult = yes }
			save_scope_as = random_courtier_1
		}
		random_courtier_or_guest = {
			limit = {
				is_lotr_adult = yes
				NOT = { this = scope:random_courtier_1 }
			}
			save_scope_as = random_courtier_2
		}
		random_courtier_or_guest = {
			limit = {
				is_lotr_adult = yes
				NOR = {
					this = scope:random_courtier_1
					this = scope:random_courtier_2
				}
			}
			save_scope_as = random_courtier_3
		}
	}

	option = { # Get them cleared
		name = balrog_struggle.2071.a

		remove_short_term_gold = 25

		add_character_modifier = {
			modifier = lotr_cryptic_messages_cleared_modifier
			years = 1
		}
		scope:random_courtier_1 = {
			add_character_modifier = {
				modifier = lotr_cryptic_messages_cleared_modifier
				years = 1
			}
		}
		scope:random_courtier_2 = {
			add_character_modifier = {
				modifier = lotr_cryptic_messages_cleared_modifier
				years = 1
			}
		}
		scope:random_courtier_3 = {
			add_character_modifier = {
				modifier = lotr_cryptic_messages_cleared_modifier
				years = 1
			}
		}

		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger     
				character = root
			}
		}

		ai_chance = {
			base = 50
		}
	}

	option = { # leave them
		name = balrog_struggle.2071.b

		if = {
			limit = { has_trait = paranoid }
			add_stress = major_stress_gain
		}
		else = {
			add_stress = minor_stress_gain
		}

		add_character_modifier = {
			modifier = lotr_terrified_courtiers_modifier
			years = 1
		}
		scope:random_courtier_1 = {
			add_character_modifier = {
				modifier = lotr_terrified_courtiers_modifier
				years = 1
			}
		}
		scope:random_courtier_2 = {
			add_character_modifier = {
				modifier = lotr_terrified_courtiers_modifier
				years = 1
			}
		}
		scope:random_courtier_3 = {
			add_character_modifier = {
				modifier = lotr_terrified_courtiers_modifier
				years = 1
			}
		}

		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm    
				character = root
			}
		}

		ai_chance = {
			base = 50
		}
	}
}

balrog_struggle.2081 = { # Refusal to Work
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2081.t
	desc = balrog_struggle.2081.desc
	theme = balrog
	override_background = {
		reference = market_dwarven
	}

	left_portrait = {
		character = root
		animation = steward
	}

	right_portrait = {
		character = scope:random_courtier_1
		animation = worry
	}

	trigger = { 
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } } 
		is_dwarf = yes
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = { terrain = halls }
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
		random_courtier_or_guest = {
			limit = { is_lotr_adult = yes }
			save_scope_as = random_courtier_1
		}
	}

	option = { # Force them to work
		name = balrog_struggle.2081.a
		
		add_tyranny = medium_tyranny_gain

		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger     
				character = root
			}
		}

		ai_chance = {
			base = 50
			modifier = {
				add = 15
				has_trait = callous
			}
		}
	}

	option = { # Sympathise and reassign
		name = balrog_struggle.2081.b

		if = {
			limit = { has_trait = compassionate }
			add_stress = -30
		}

		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_fear_of_the_depths_modifier
				years = 3
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm    
				character = root
			}
		}

		ai_chance = {
			base = 50
			modifier = {
				add = 5
				has_trait = compassionate
			}
		}
	}
}

balrog_struggle.2091 = { # Distant Roaring
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2091.t
	desc = balrog_struggle.2091.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	right_portrait = {
		character = root
		animation = paranoia
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
	}
	
	option = { # Pay for extra garrisons
		name = balrog_struggle.2091.a
		remove_short_term_gold = medium_gold_value
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_increased_garrisons_county_modifier
				years = 10
			}
		}
	}

	option = { # Ignore their pleas
		name = balrog_struggle.2091.b
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_terrified_inhabitants_county_modifier
				years = 10
			}
		}
	}
}

balrog_struggle.2101 = { # Nightly Disappearances
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2101.t
	desc = balrog_struggle.2101.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	right_portrait = {
		character = root
		animation = worry
	}

	trigger = { 
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } } 
		is_dwarf = yes
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {terrain = halls}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
	}

	option = { # Implement a curfew
		name = balrog_struggle.2101.a
		remove_short_term_gold = 20
		add_prestige = -100
		random = {
			chance = 10
			add_trait = reclusive
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm    
				character = root
			}
		}
	}

	option = { # Tell them to stop whining
		name = balrog_struggle.2101.b
	
		random = {
			chance = 35
			add_trait = callous
			remove_trait = compassionate
		}
		add_stress = 25
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_nightly_dissapearances_modifier
				years = 5
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger  
				character = root
			}
		}
	}
}

balrog_struggle.2111 = { # Choked Water Supply
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2111.t
	desc = balrog_struggle.2111.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	right_portrait = {
		character = root
		animation = worry
	}

	left_portrait = {
		character = scope:random_courtier_1
		animation = sick
	}

	lower_center_portrait = {
		character = scope:random_courtier_2
	}
	lower_right_portrait = {
		character = scope:random_courtier_3
	}

	trigger = { 
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } }
		any_courtier_or_guest = { count > 0 }
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {terrain = halls}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
		random_courtier_or_guest = {
			limit = { is_lotr_adult = yes }
			save_scope_as = random_courtier_1
		}
		random_courtier_or_guest = {
			limit = {
				is_lotr_adult = yes
				NOT = { this = scope:random_courtier_1 }
			}
			save_scope_as = random_courtier_2
		}
		random_courtier_or_guest = {
			limit = {
				is_lotr_adult = yes
				NOR = {
					this = scope:random_courtier_1
					this = scope:random_courtier_2
				}
			}
			save_scope_as = random_courtier_3
		}
	}

	option = { # Pay to restore the flow of clean water
		name = balrog_struggle.2111.a
		add_prestige = -125
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_no_clean_water_modifier
				years = 5
			}
		}

		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger  
				character = root
			}
		}
	}

	option = { # Tell them to drink from more questionable supplies
		name = balrog_struggle.2111.b
		
		add_tyranny = minor_tyranny_gain

		scope:random_courtier_1 = {
			add_character_modifier = {
				modifier = lotr_drank_unclean_water_modifier
			}
		}
		scope:random_courtier_2 = {
			add_character_modifier = {
				modifier = lotr_drank_unclean_water_modifier
			}
		}
		scope:random_courtier_3 = {
			add_character_modifier = {
				modifier = lotr_drank_unclean_water_modifier
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm   
				character = root
			}
		}
	}
}

balrog_struggle.2121 = { # Clandestine Cult
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2121.t
	desc = balrog_struggle.2121.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	right_portrait = {
		character = root
		animation = worry
	}

	trigger = { 
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } } 
		is_dwarf = yes
		NOT = { faith = faith:faith_balrog_cult }
		any_courtier_or_guest = { count > 0 }
	}

	option = { # Investigate and supress the cult
		name = balrog_struggle.2121.a

		duel = {
			skill = intrigue
			value = 10
			
			20 = { # Win
				desc = balrog_struggle.2121.tt.win
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
				}
				remove_short_term_gold = 25
			}

			20 = { # Lose
				desc = balrog_struggle.2121.tt.lost
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				custom_tooltip = {
					text = balrog_struggle.2121.tt
					random_courtier_or_guest = {
						limit = { is_lotr_adult = yes }
						make_character_crypto_religionist_effect = { CRYPTO_RELIGION = faith:faith_dwarven_balrog_cult }
					}
					random_courtier_or_guest = {
						limit = { is_lotr_adult = yes }
						make_character_crypto_religionist_effect = { CRYPTO_RELIGION = faith:faith_dwarven_balrog_cult }
					}
				}
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}

	option = { # Allow it to operate discreetly 
		name = balrog_struggle.2121.b
	
		custom_tooltip = {
			text = balrog_struggle.2121.tt
			random_courtier_or_guest = {
				limit = { is_lotr_adult = yes }
				make_character_crypto_religionist_effect = { CRYPTO_RELIGION = faith:faith_dwarven_balrog_cult }
			}
			random_courtier_or_guest = {
				limit = { is_lotr_adult = yes }
				make_character_crypto_religionist_effect = { CRYPTO_RELIGION = faith:faith_dwarven_balrog_cult }
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger  
				character = root
			}
		}
	}
}

balrog_struggle.2131 = { # Broken Artifacts
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2131.t
	desc = balrog_struggle.2131.desc
	theme = balrog
	override_background = {
		reference = market_dwarven
	}

	right_portrait = {
		character = root
		animation = steward
	}

	left_portrait = {
		character = scope:random_courtier_1
		animation =shock
	}

	trigger = { 
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } } 
		is_dwarf = yes
		any_courtier_or_guest = { count > 0 }
	}

	immediate = {
		random_courtier_or_guest = {
			limit = { is_available_adult = yes }
			save_scope_as = random_courtier_1
		}
	}

	option = { # Pay to restore court artifacts
		name = balrog_struggle.2131.a
		remove_short_term_gold = 40
		custom_tooltip = {
			text = balrog_struggle.2131.tt
			create_artifact_bowl_effect = {
				OWNER = root
				SMITH = scope:random_courtier_1
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}

	option = { # Lose them
		name = balrog_struggle.2131.b
		add_prestige = -50
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger  
				character = root
			}
		}
	}
}

balrog_struggle.2141 = { # Shattered Statues
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2141.t
	desc = balrog_struggle.2141.desc
	theme = balrog
	override_background = {
		reference = market_dwarven
	}

	right_portrait = {
		character = root
		animation = worry
	}

	trigger = { 
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } } 
		is_dwarf = yes
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {terrain = halls}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
	}

	option = { # Pay to rebuild them
		name = balrog_struggle.2141.a

		remove_short_term_gold = 20
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}

	option = { # Leave them broken as a reminder
		name = balrog_struggle.2141.b

		send_interface_toast = {
			title = balrog_struggle.2141.tt.1
			left_icon = root
			scope:selected_county = {
				add_county_modifier = {
					modifier = lotr_broken_dwarven_statues_modifier
					years = 5
				}
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger
				character = root
			}
		}
	}
}

balrog_struggle.2151 = { # Lost Expedition
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2151.t
	desc = balrog_struggle.2151.desc
	theme = balrog

	right_portrait = {
		character = root
		animation = worry
	}

	trigger = {
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } }
		is_dwarf = yes
	}


	option = { # Call halt to mining activity for a time
		name = balrog_struggle.2151.a

		set_variable = {
			name = not_allowed_mining_activity
			years = 1
		}

		add_gold = 15

		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}

	option = { # Allow similar small scale expeditions
		name = balrog_struggle.2151.b

		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger
				character = root
			}
		}
	}
}

balrog_struggle.2161 = { # Eerie Dreams 
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2161.t
	desc = balrog_struggle.2161.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	right_portrait = {
		character = root
		animation = worry
	}

	left_portrait = {
		trigger = { exists = scope:random_courtier_1 }
		character = scope:random_courtier_1
		animation = paranoia
	}

	lower_center_portrait = {
		trigger = { exists = scope:random_courtier_2 }
		character = scope:random_courtier_2
	}

	trigger = {
		is_wastelands = no
		any_held_county = { title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region } }
		any_courtier_or_guest = { count > 0 }
	}

	immediate = {
		random_courtier_or_guest = {
			limit = { is_lotr_adult = yes }
			save_scope_as = random_courtier_1
		}
		random_courtier_or_guest = {
			limit = {
				is_lotr_adult = yes 
				NOT = { this = scope:random_courtier_1 }
			}
			save_scope_as = random_courtier_2
		}
	}

	option = { # Try and comfort the courtiers
		name = balrog_struggle.2161.a

		duel = {
			skill = diplomacy 
			value = 10
			
			20 = { # Win
				desc = balrog_struggle.2161.tt.win
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
				}
				send_interface_toast = {
					title = balrog_struggle.2161.tt.1
					left_icon = root
					scope:random_courtier_1 ?= {
						add_opinion = {
							modifier = relieved_opinion
							opinion = 20
							target = root
						}
					}
					scope:random_courtier_2 ?= {
						add_opinion = {
							modifier = relieved_opinion
							opinion = 20
							target = root
						}
					}
				}
			}

			20 = { # Lose
				desc = balrog_struggle.2161.tt.lost
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				send_interface_toast = {
					title = balrog_struggle.2161.tt.2
					left_icon = root
					scope:random_courtier_1 ?= {
						add_opinion = {
							modifier = disappointed_opinion
							opinion = -20
							target = root
						}
					}
					scope:random_courtier_2 ?= {
						add_opinion = {
							modifier = disappointed_opinion
							opinion = -20
							target = root
						}
					}
				}
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}

	option = { # Dismiss their concerns
		name = balrog_struggle.2161.b

		scope:random_courtier_1 ?= {
			add_opinion = {
				modifier = disappointed_opinion
				opinion = -20
				target = root
			}
		}
		scope:random_courtier_2 ?= {
			add_opinion = {
				modifier = disappointed_opinion
				opinion = -20
				target = root
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger
				character = root
			}
		}
	}
}

balrog_struggle.2171 = { # Conflagration
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.2171.t
	desc = balrog_struggle.2171.desc
	theme = balrog

	right_portrait = {
		character = root
		animation = worry
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
		add_character_flag = {
			flag = immune_from_balrog_building_anger
			days = 2
		}
	}
	
	option = { # try and save it
		name = balrog_struggle.2171.a
		duel = {
			skill = stewardship
			skill = learning
			value = 10
			
			20 = { # Win
				desc = balrog_struggle.2171.tt.win
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
				}
				remove_short_term_gold = minor_gold_value
				add_prestige = 50
				send_interface_toast = {
					title = balrog_struggle.2171.tt.1
					left_icon = root
				}
			}

			20 = { # Lose
				desc = balrog_struggle.2171.tt.lost
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				custom_tooltip = balrog_struggle.2171.tt.lost_building
				send_interface_toast = {
					title = balrog_struggle.2171.tt.2
					left_icon = root
					remove_random_building_underground = { COUNTY = scope:selected_county }
				}
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_anger
				character = root
			}
		}
	}

	option = { # Let it burn
		name = balrog_struggle.2171.b
		custom_tooltip = balrog_struggle.2171.tt.lost_building
		
		send_interface_toast = {
			title = balrog_struggle.2171.tt.2
			left_icon = root
			remove_random_building_underground = { COUNTY = scope:selected_county }
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}
}

## Major Balrog Events

balrog_struggle.3001 = { # Lost to Fire and Flame
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3001.t
	desc = balrog_struggle.3001.desc
	theme = balrog

	left_portrait = {
		character = root
		animation = shock
	}

	right_portrait = {
		character = scope:victim
		animation = fear
	}

	trigger = {
		is_wastelands = no
		OR = {
			any_councillor = {
				count > 0
				is_ai = yes
				is_landed = no
				is_landless_ruler = no
				location = {
					terrain = halls
					geographical_region = middleearth_misty_mountains_balrog_struggle_region
				}
			}
			any_close_or_extended_family_member = {
				is_ai = yes
				is_landed = no
				is_landless_ruler = no
				location = {
					terrain = halls
					geographical_region = middleearth_misty_mountains_balrog_struggle_region
				}
			}
			any_knight = {
				count > 0
				is_ai = yes
				is_landed = no
				is_landless_ruler = no
				location = {
					terrain = halls
					geographical_region = middleearth_misty_mountains_balrog_struggle_region
				}
			}
		}
	}

	immediate = {
		play_music_cue = lotr_cue_balrog
		random_list = {
			1 = { # Counsellor
				trigger = {
					any_councillor = {
						count > 0
						is_ai = yes
						is_landed = no
						is_landless_ruler = no
						location = {
							terrain = halls
							geographical_region = middleearth_misty_mountains_balrog_struggle_region
						}
					}
				}
				random_councillor = {
					limit = { 
						is_ai = yes
						is_landed = no
						is_landless_ruler = no
						location = {
							terrain = halls
							geographical_region = middleearth_misty_mountains_balrog_struggle_region
						}
					}
					weight = {
						base = 1
						modifier = { add = diplomacy }
						modifier = { add = martial }
						modifier = { add = stewardship }
						modifier = { add = intrigue }
						modifier = { add = learning }
					}
					save_scope_as = victim
				}
			}
			1 = { # Extended Family Member
				trigger = {
					any_close_or_extended_family_member = {
						is_ai = yes
						is_landed = no
						is_landless_ruler = no
						location = {
							terrain = halls
							geographical_region = middleearth_misty_mountains_balrog_struggle_region
						}
					}
				}	
				random_close_or_extended_family_member = {
					limit = {
						is_ai = yes
						is_landed = no
						is_landless_ruler = no
						location = {
							terrain = halls
							geographical_region = middleearth_misty_mountains_balrog_struggle_region
						}
					}
					save_scope_as = victim
				}
			}
			1 = { # Knight
				trigger = {
					any_knight = {
						count > 0
						is_ai = yes
						is_landed = no
						is_landless_ruler = no
						location = {
							terrain = halls
							geographical_region = middleearth_misty_mountains_balrog_struggle_region
						}
					}
				}
				random_knight = {
					limit = { 
						is_ai = yes
						is_landed = no
						is_landless_ruler = no
					}
					weight = {
						base = 1
						modifier = { add = prowess }
					}
					save_scope_as = victim
				}
			}
		}
	}
	
	option = {
		name = balrog_struggle.3001.a
		scope:victim = {
			death = {
				death_reason = death_burned
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}
}

balrog_struggle.3011 = { # The Exodus
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3011.t
	desc = balrog_struggle.3011.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = disapproval
	}

	right_portrait = {
		character = scope:leaver
		animation = fear
	}

	lower_center_portrait = {
		character = scope:new_employer
	}

	trigger = { is_wastelands = no }

	immediate = {
		if = {
			limit = {
				any_councillor = {
					is_landed = no
					is_landless_ruler = no
				}
			}
			random_councillor = {
				limit = {
					is_landed = no
					is_landless_ruler = no
				}
				save_scope_as = leaver
			}
		}
		else = {
			random_courtier = {
				limit = {
					is_landed = no
					is_landless_ruler = no
				}
				save_scope_as = leaver
			}
		}
		if = {
			limit = {
				is_orc = yes
			}
			random_ruler = {
				limit = {
					is_orc = yes
					NOT = { this = root }
					NOT = {
						any_held_title = {
							tier = tier_county
							title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
						}
					}
					NOT = {
						any_held_title = {
							OR = {
								is_mercenary_company = yes
								is_holy_order = yes
							}
						}
					}
				}
				weight = {
					base = 1
					modifier = {
						add = 10
						has_same_culture_as = scope:leaver
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = -2000
						has_relation_rival = scope:leaver
					}
				}
				save_scope_as = new_employer
			}
		}
		else_if = {
			limit = {
				is_orc = no
			}
			random_ruler = {
				limit = {
					is_dwarf = yes
					NOT = { this = root }
					NOT = {
						any_held_title = {
							tier = tier_county
							title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
						}
					}
					NOT = {
						any_held_title = {
							OR = {
								is_mercenary_company = yes
								is_holy_order = yes
							}
						}
					}
				}
				weight = {
					base = 1
					modifier = {
						add = 10
						has_same_culture_as = scope:leaver
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = 1000
						dynasty = scope:leaver.dynasty
					}
					modifier = {
						add = -2000
						has_relation_rival = scope:leaver
					}
				}
				save_scope_as = new_employer
			}
		}
		if = {
			limit = {
				any_held_title = {
					tier = tier_county
					title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
					development_level > 1
				}
			}
			random_held_title = {
				limit = {
					tier = tier_county
					title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
					development_level > 1
				}
				change_development_level = -1
				save_scope_as = plundered_county
			}
		}
	}
	
	option = { # What? Get back here!
		name = balrog_struggle.3011.a
		pay_short_term_income = {
			target = scope:leaver
			years = 1
		}
		scope:leaver = {
			set_employer = scope:new_employer
			add_prestige = -200
		}
		#### Add event for receiver - potentially giving some of gold as bonus
	}
}

balrog_struggle.3021 = { # Cult Takes Hold
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3021.t
	desc = balrog_struggle.3021.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = personality_cynical
	}

	right_portrait = {
		character = scope:cultist
		animation = personality_zealous
	}

	trigger = { is_wastelands = no }

	immediate = {
		if = {
			limit = {
				any_vassal_or_below = {
					NOT = {
						has_faith = faith:faith_dwarven_balrog_cult
					}
					is_ai = yes
				}
			}
			random_vassal_or_below = {
				limit = {
					NOT = {
						has_faith = faith:faith_dwarven_balrog_cult
					}
					is_ai = yes
				}
				weight = {
					base = 1
					modifier = { add = max_military_strength }
				}
				save_scope_as = cultist
			}
		}
		else_if = {
			limit = {
				any_councillor = {
					NOT = {
						has_faith = faith:faith_dwarven_balrog_cult
					}
					is_ai = yes
				}
			}
			random_councillor = {
				limit = {
					NOT = {
						has_faith = faith:faith_dwarven_balrog_cult
					}
					is_ai = yes
				}
				weight = {
					base = 1
					modifier = { add = diplomacy }
					modifier = { add = learning }
				}
				save_scope_as = cultist
			}
		}
		else = {
			random_courtier_or_guest = {
				limit = {
					NOT = {
						has_faith = faith:faith_dwarven_balrog_cult
					}
					is_ai = yes
				}
				save_scope_as = cultist
			}
		}
		scope:cultist = {
			set_character_faith_with_conversion = faith:faith_dwarven_balrog_cult
		}
		if = {
			limit = {
				any_held_county = {
					NOT = { faith = faith:faith_dwarven_balrog_cult }
				}
			}
			random_held_title = {
				limit = {
					tier = tier_county
					NOT = { faith = faith:faith_dwarven_balrog_cult }
				}
				save_scope_as = cultist_county
			}
		}
	}
	
	option = { # Heathens! We should not turn from the light of Mahal!
		name = balrog_struggle.3021.a
		add_piety = 100
		if = {
			limit = {
				exists = scope:cultist_county
			}
			random = {
				chance = 30
				send_interface_toast = {
					title = balrog_struggle.3021.a.spread
					left_icon = root
					scope:cultist_county = {
						set_county_faith = faith:faith_dwarven_balrog_cult
					}
				}
			}
		}
	}

	option = { # If you can't beat them...
		name = balrog_struggle.3021.b
		add_prestige = -500
		set_character_faith_with_conversion = faith:faith_dwarven_balrog_cult
	}
}

balrog_struggle.3031 = { # Wanton Destruction
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3031.t
	desc = balrog_struggle.3031.desc
	theme = balrog
	override_background = {
		reference = durins_bane
	}

	left_portrait = {
		character = root
		animation = anger
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				num_buildings > 1
				terrain = halls
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			NOT = {
				has_county_modifier = lotr_balrog_stronger_foundations_county_modifier
			}
		}
	}

	immediate = {
		play_music_cue = lotr_cue_balrog
		random_held_county = {
			limit = { 
				title_province = {
					num_buildings > 1
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
				NOT = {
					has_county_modifier = lotr_balrog_stronger_foundations_county_modifier
				}
			}
			save_scope_as = selected_county
		}
	}
	
	option = {
		name = balrog_struggle.3031.a
		destroy_random_building_underground = { COUNTY = scope:selected_county }
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}
}

balrog_struggle.3041 = { # Preying on the Weak
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3041.t
	desc = balrog_struggle.3041.desc
	theme = balrog
	override_background = {
		reference = durins_bane
	}

	left_portrait = {
		character = root
		animation = anger
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				has_holding_type = settlement_holding
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
		}
	}

	immediate = {
		play_music_cue = lotr_cue_balrog
		random_held_county = {
			limit = { 
				title_province = {
					has_holding_type = settlement_holding
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
	}
	
	option = {
		name = balrog_struggle.3041.a
		make_settlement_county_wilderness = { COUNTY = scope:selected_county }
		scope:selected_county.title_province = {
			if = {
				limit = {
					NOT = {
						has_building = collapsed_ceiling
					}
				}
				add_building = collapsed_ceiling
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}
}

balrog_struggle.3051 = { # Under Attack
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3051.t
	desc = balrog_struggle.3051.desc
	theme = balrog
	override_background = {
		reference = durins_bane
	}

	left_portrait = {
		character = root
		animation = anger
	}

	trigger = {
		any_held_county = { 
			title_province = {
				terrain = halls
				has_building_or_higher = dwarven_depths_02
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
		}
	}

	immediate = {
		play_music_cue = lotr_cue_balrog
		random_held_county = {
			limit = { 
				title_province = {
					terrain = halls
					has_building_or_higher = dwarven_depths_02
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
		add_character_flag = {
			flag = immune_from_balrog_building_anger
			days = 2
		}
	}
	
	option = {
		name = balrog_struggle.3051.a
		scope:selected_county = {
			title_province = { downgrade_tier_ten_holding = { HOLDING = dwarven_depths } }
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}
}

balrog_struggle.3061 = { # Economic Shutdown
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3061.t
	desc = balrog_struggle.3061.desc
	theme = balrog
	override_background = {
		reference = market_dwarven
	}

	left_portrait = {
		character = root
		animation = stress
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				terrain = halls
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			NOT = {
				has_county_modifier = lotr_balrog_economic_shutdown_county_modifier
			}
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				title_province = {
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
				NOT = {
					has_county_modifier = lotr_balrog_economic_shutdown_county_modifier
				}
			}
			save_scope_as = selected_county
		}
	}
	
	option = {
		name = balrog_struggle.3061.a
		scope:selected_county = {
			add_county_modifier = {
				modifier = lotr_balrog_economic_shutdown_county_modifier
				years = 5
			}
		}
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
	}
}

balrog_struggle.3071 = { # Panicked Vassals
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.3071.t
	desc = balrog_struggle.3071.desc
	theme = balrog
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = war_defender
	}

	right_portrait = {
		character = scope:leader
		animation = war_attacker
	}

	trigger = {
		is_wastelands = no
		any_vassal = {
			count > 0
			opinion = {
				target = prev
				value < 0
			}
			is_ai = yes
		}
	}

	immediate = {
		ordered_vassal = {
			limit = {
				opinion = {
					target = prev
					value < 0
				}
				is_ai = yes
			}
			order_by = max_military_strength
			save_scope_as = leader
		}
		hidden_effect = {
			scope:leader = {
				create_faction = {
					type = independence_faction
					target = root
				}
			}
			random_targeting_faction = {
				limit = {
					faction_is_type = independence_faction
					any_faction_member = {
						this = scope:leader
					}
				}
				save_scope_as = ind_faction
			}
			every_vassal = {
				limit = {
					opinion = {
						target = prev
						value < 0
					}
					is_ai = yes
				}
				join_faction = scope:ind_faction
			}
		}
	}
	
	option = {
		name = balrog_struggle.3071.a
		custom_tooltip = {
			text = balrog_struggle.3071.a.effect
			random_targeting_faction = {
				limit = {
					faction_is_type = independence_faction
				}
				faction_start_war = {}
			}
		}
	}
}

## Armageddon Balrog Events

balrog_struggle.4001 = { # The End is Nigh!
	content_source = realms_dlc
	type = character_event
	title = balrog_struggle.4001.t
	desc = balrog_struggle.4001.desc
	theme = balrog
	override_background = {
		reference = durins_bane
	}

	left_portrait = {
		character = root
		animation = fear
	}

	trigger = {
		is_wastelands = no
		any_held_county = { 
			title_province = {
				terrain = halls
			}
			title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
		}
	}

	immediate = {
		play_music_cue = lotr_cue_balrog
		random_held_county = {
			limit = { 
				title_province = {
					terrain = halls
				}
				title_province = { geographical_region = middleearth_misty_mountains_balrog_struggle_region }
			}
			save_scope_as = selected_county
		}
	}
	
	option = {
		name = balrog_struggle.4001.a
		every_character_struggle = {
			involvement = involved
			activate_struggle_catalyst = {
				catalyst = catalyst_balrog_event_calm 
				character = root
			}
		}
		make_settlement_county_wilderness = { COUNTY = scope:selected_county }
		scope:selected_county.title_province = {
			if = {
				limit = {
					NOT = {
						has_building = collapsed_ceiling
					}
				}
				add_building = collapsed_ceiling
			}
		}
	}
}