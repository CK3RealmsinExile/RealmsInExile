namespace = bountig_event_chain

#	bountig_event_chain.0001 - 4999 ~ Bountig's events
#	bountig_event_chain.5000 - 5100 ~ Khand & Ovatha
# 	bountig_event_chain.9000 - 9999 ~ Management events

scripted_effect set_contract_scopes_effect = {
	scope:task_contract.task_contract_taker ?= { save_scope_as = task_contract_taker }
	scope:task_contract.task_contract_employer ?= { save_scope_as = task_contract_employer }
	if = {
		limit = { exists = scope:task_contract.task_contract_destination }
		scope:task_contract.task_contract_destination = { save_scope_as = task_contract_destination }
	}
	else = {
		scope:task_contract.var:task_contract_destination ?= { save_scope_as = task_contract_destination }
	}
	if = {
		limit = { exists = scope:task_contract.task_contract_target }
		scope:task_contract.task_contract_target ?= { save_scope_as = task_contract_target }
	}
	else = {
		scope:task_contract.var:task_contract_target ?= { save_scope_as = task_contract_target }
	}
	scope:task_contract.var:task_contract_war ?= { save_scope_as = task_contract_war }
	if = {
		limit = { exists = scope:task_contract.var:task_contract_object }
		scope:task_contract.var:task_contract_object = { save_scope_as = task_contract_object }
	}
	if = {
		limit = { exists = scope:task_contract.var:escorted_artifact }
		scope:task_contract.var:escorted_artifact = { save_scope_as = escorted_artifact }
	}
	if = {
		limit = { exists = scope:task_contract.var:escorted_gold }
		scope:task_contract.var:escorted_gold = { save_scope_as = escorted_gold }
	}
	if = {
		limit = { exists = scope:task_contract.var:escorted_story }
		scope:task_contract.var:escorted_story = { save_scope_as = escorted_story }
	}
}

scripted_effect set_laamp_variables_for_contracts_to_spawn_effect = {
	set_variable = {
		name = contract_passive_spawn_location
		value = location.empire
	}
	set_variable = {
		name = contract_passive_spawn_tally
		value = 0
	}
}

scripted_effect build_or_upgrade_domicile_building_effect = {
	if = {
		limit = { has_domicile_building_or_higher = $BUILDING$_01 }
		switch = {
			trigger = has_domicile_building
			$BUILDING$_01 = { add_domicile_building = $BUILDING$_02 }
			$BUILDING$_02 = { add_domicile_building = $BUILDING$_03 }
			$BUILDING$_03 = { add_domicile_building = $BUILDING$_04 }
			$BUILDING$_04 = { add_domicile_building = $BUILDING$_05 }
			$BUILDING$_05 = { add_domicile_building = $BUILDING$_06 }
		}
	} else = { add_domicile_building = $BUILDING$_01 }
}

scripted_effect fill_provisions_effect = {
	domicile = {
		if = {
			limit = { provisions < max_provisions }
			change_provisions = max_provisions
		}
	}
}

scripted_effect visiting_lore_city_reward_effect = {
	random_list = {
		25 = { #Gain/Upgrade domicile building
			trigger = { domicile = { free_external_domicile_building_slots >= 1 } }
			custom_tooltip = {
				text = "bountig_gain_random_domicile_building_effect"
				if = {
					limit = { domicile = { free_external_domicile_building_slots >= 1 } }
					domicile = {
						random_list = {
							1 = {
								trigger = { NOT = { has_domicile_building = supply_tent_06 } }
								build_or_upgrade_domicile_building_effect = { BUILDING = supply_tent }
							}
							1 = {
								trigger = { NOT = { has_domicile_building = barber_tent_06 } }
								build_or_upgrade_domicile_building_effect = { BUILDING = barber_tent }
							}
							1 = {
								trigger = { NOT = { has_domicile_building = baggage_train_06 } }
								build_or_upgrade_domicile_building_effect = { BUILDING = baggage_train }
							}
							1 = {
								trigger = { NOT = { has_domicile_building = mess_tent_06 } }
								build_or_upgrade_domicile_building_effect = { BUILDING = mess_tent }
							}
							1 = {
								trigger = { NOT = { has_domicile_building = camp_fire_06 } }
								build_or_upgrade_domicile_building_effect = { BUILDING = camp_fire }
							}
							1 = {
								trigger = { NOT = { has_domicile_building = proving_grounds_06 } }
								build_or_upgrade_domicile_building_effect = { BUILDING = proving_grounds }
							}
							1 = {
								trigger = { NOT = { has_domicile_building = camp_perimeter_06 } }
								build_or_upgrade_domicile_building_effect = { BUILDING = camp_perimeter }
							}
						}
					}
				}
			}
		}
		25 = { #Gain additional XP in trait tracks
			trigger = {
				trigger_if = { #Gondor
					limit = { title:c_minas_tirith.empire = { is_de_jure_liege_or_above_target = root.domicile.domicile_location.county } }
					NOT = {
						has_trait_xp = {
							trait = bountig_story_trait
							track = gondor_cities
							value >= 100
						}
					}
				}
				trigger_if = { #Haruzan
					limit = { title:c_amrun.empire = { is_de_jure_liege_or_above_target = root.domicile.domicile_location.county } }
					NOT = {
						has_trait_xp = {
							trait = bountig_story_trait
							track = haruzan_cities
							value >= 100
						}
					}
				}
				trigger_if = { #Umbar
					limit = { title:c_umbar.kingdom = { is_de_jure_liege_or_above_target = root.domicile.domicile_location.county } }
					NOT = {
						has_trait_xp = {
							trait = bountig_story_trait
							track = umbar_cities
							value >= 100
						}
					}
				}
			}
			if = { #Gondor
				limit = {
					title:c_minas_tirith.empire = { is_de_jure_liege_or_above_target = root.domicile.domicile_location.county }
				}
				root = { save_scope_as = bountig }
				send_interface_message = {
					type = event_generic_good_with_text
					title = bountig_gains_xp_in_special_trait.t
					desc = bountig_gains_xp_in_special_trait.desc
					add_trait_xp = {
						trait = bountig_story_trait
						track = gondor_cities
						value = 15
					}
				}
			} 
			else_if = { #Harwan
				limit = {
					title:c_amrun.empire = { is_de_jure_liege_or_above_target = root.domicile.domicile_location.county }
				}
				root = { save_scope_as = bountig }
				send_interface_message = {
					type = event_generic_good_with_text
					title = bountig_gains_xp_in_special_trait.t
					desc = bountig_gains_xp_in_special_trait.desc
					add_trait_xp = {
						trait = bountig_story_trait
						track = haruzan_cities
						value = 15
					}
				}
			} 
			else_if = { #umbar
				limit = {
					title:c_umbar.kingdom = { is_de_jure_liege_or_above_target = root.domicile.domicile_location.county }
				}
				root = { save_scope_as = bountig }
				send_interface_message = {
					type = event_generic_good_with_text
					title = bountig_gains_xp_in_special_trait.t
					desc = bountig_gains_xp_in_special_trait.desc
					add_trait_xp = {
						trait = bountig_story_trait
						track = umbar_cities
						value = 15
					}
				}
			}
		}
		25 = { #Gain a random knight courtier
			create_character = {
				template = old_knight_teacher
				culture = root.location.culture
				faith = root.location.faith
				gender_female_chance = root_soldier_female_chance
				location = root.location
				save_scope_as = soldier_character
				after_creation = {
					add_trait_xp = {
						trait = lifestyle_blademaster
						value = 100
					}
					set_employer = root
				}
			}
			custom_tooltip = {
				text = bountig_gain_random_follower_effect
			}
			send_interface_message = {				
				type = event_generic_good_with_text
				title = bountig_knight_joins_entourage
				desc = bountig_knight_joins_entourage_desc
				left_icon = scope:soldier_character
			}
		}
		25 = {
			trigger = {
				any_character_artifact = {
					count < 4
					artifact_slot_type = miscellaneous
				}
			}
			root = { save_scope_as = bountig }
			custom_tooltip = {
				text = bountig_gain_random_trinket_artifact_effect
				generate_trinket_effect = {
					TRINKET_RECEIVER = root
					TRINKET_GIVER = root
					GRAB_ALL_TRINKETS = yes
					HISTORY_TYPE = discovered
				}
			}
			send_interface_message = {				
				type = event_generic_good_with_text
				title = bountig_gains_random_trinket
				desc = bountig_gains_random_trinket_desc
				left_icon = scope:new_trinket
			}
		}
	}
}

scripted_effect bountig_convince_easterling_lord_effect = {
	duel = {
		skill = $SKILL$
		value = very_high_skill_rating
		10 = {
			compare_modifier = {
				value = scope:duel_value
				multiplier = 3.5
				min = 2
			}
			desc = bountig_event_chain.0050.duel_win
			send_interface_toast = {
				type = event_toast_effect_good
				title = bountig_event_chain.0050.duel_win_effect
				var:selected_character = { add_character_modifier = { modifier = lotr_bountig_convinced_easterling_lord years = 8 } }
				var:selected_character = { create_story = story_cycle_convinced_easterling_lord }
			}
		}
		10 = {
			compare_modifier = {
				value = scope:duel_value
				multiplier = -3.5
				min = 2
			}
			desc = bountig_event_chain.0050.duel_fail
			send_interface_toast = {
				type = event_toast_effect_bad
				title = bountig_event_chain.0050.duel_fail_effect
				var:selected_character = { add_character_modifier = { modifier = lotr_bountig_failed_to_convince_easterling_lord years = 8 } }
			}
		}
	}
}
### BOUNTIG EVENTS ###

bountig_event_chain.0002 = {
	hidden = yes 

	trigger = {
		is_available = yes
	}

	on_trigger_fail = { #Trigger invitation again if it was blocked because the character was handling another invitation
		trigger_event = { id = bountig_event_chain.0002 days = 1 }
	}

	immediate = {
		pan_camera_to_province = title:c_minas_tirith.title_province
		scope:task_contract = { open_view_data = task_contract }
	}
}

bountig_event_chain.0003 = { #Bountig accepts the contract in the East
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0003.t
	desc = bountig_event_chain.0003.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = {
		set_contract_scopes_effect = yes 
	}

	option = { # Travel with full domicile
		name = bountig_event_chain.0003.a
		set_variable = cannot_cancel_travel
		custom_tooltip = bountig_event_chain.0003.a.tt
		hidden_effect = { #Provisions so Bountig doesn't insta-die
			domicile = { add_domicile_building = supply_tent_01 }
		}
		start_travel_plan = {
			destination = scope:task_contract_destination
			travel_with_domicile = yes
			return_trip = no
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0004
			on_arrival_destinations = all
		}
	}
	after = { hidden_effect = { fill_provisions_effect = yes } }
}

bountig_event_chain.0004 = {
	hidden = yes
	# Saved scopes:
	## employer
	## task_contract_taker
	## task_contract_destination
	## task_contract
	immediate = {
		remove_variable = cannot_cancel_travel
		save_scope_as = bountig
		title:k_rohan.holder ?= { save_scope_as = war_target }

		if = {
			limit = { exists = scope:war_target }
			scope:employer = {
				start_war = {
					casus_belli = bountig_special_raid_for_captives_cb
					target = scope:war_target
					target_title = scope:war_target.primary_title
				}
			}
		} else = {
			title:k_south_rhovanion = { # Start a war between a Ioriag duke and Rohan
				random_de_jure_county = {
					limit = {
						is_wastelands = no
						culture = { has_cultural_pillar = heritage_ioriag }
						holder = { highest_held_title_tier > tier_county }
						holder = { is_at_war = no }
						NOT = { holder = scope:employer }
					}
					alternative_limit = {
						is_wastelands = no
						culture = { has_cultural_pillar = heritage_ioriag }
						holder = { highest_held_title_tier > tier_barony }
						holder = { is_at_war = no }
						NOT = { holder = scope:employer }
					}
					alternative_limit = {
						is_wastelands = no
						culture = { has_cultural_pillar = heritage_ioriag }
						holder = { highest_held_title_tier > tier_county }
						NOT = { holder = scope:employer }
					}
					holder = { save_scope_as = war_target }
				}
			}
			scope:employer = {
				start_war = {
					casus_belli = bountig_special_raid_for_captives_cb
					target = scope:war_target
					target_title = scope:war_target.primary_title
				}
			}
		}

		scope:employer = {
			random_character_war = {
				limit = { primary_defender = scope:war_target }
				set_called_to = scope:bountig
				add_attacker = scope:bountig
				save_scope_as = story_war
			}
			set_variable = {
				name = bountig
				value = scope:bountig 
			}
		}
		scope:war_target = {
			every_vassal = {
				limit = { culture = top_liege.culture } # Avoid dunlendings joining in
				trigger_event = bountig_event_chain.0010
			}
		}
	}
}

bountig_event_chain.0005 = { # Bountig gets offered land or gold, either ending or boosting his story line
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0005.t
	desc = bountig_event_chain.0005.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	left_portrait = {
		character = scope:attacker
		animation = personality_rational
	}

	immediate = { save_scope_as = bountigmedlokan }

	option = { # Travel with full domicile
		name = bountig_event_chain.0005.a
		custom_tooltip = bountig_event_chain.0005.a.tt
		set_variable = cannot_cancel_travel
		title:c_minas_tirith.empire.holder ?= { save_scope_as = gondor_ruler }
		add_gold = 500
		add_prestige = 500
		set_laamp_variables_for_contracts_to_spawn_effect = yes
		start_travel_plan = {
			destination = title:b_pelannor.title_province
			travel_with_domicile = yes
			return_trip = no
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0012
			on_arrival_destinations = all
		}
		hidden_effect = { fill_provisions_effect = yes }
	}

	option = { #Decide to end story line, stay in Rhun
		name = bountig_event_chain.0005.b
		custom_tooltip = bountig_event_chain.0005.b.tt

		trigger = {
			scope:attacker = {
				any_held_county = { count > 1 }
			}
		}
		random_owned_story = {
			limit = { story_type = story_cycle_bountig_medlokan }
			end_story = yes
		}
		scope:attacker = {
			random_held_county = {
				limit = { NOT = { this = scope:attacker.capital_county } }
				save_scope_as = handed_out_county
			}
		}
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
			add_claim_on_loss = no
		}
		scope:handed_out_county = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change

		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
			add_claim_on_loss = no
		}
		change_liege = {
			liege = scope:attacker
			change = scope:change
		}
		resolve_title_and_vassal_change = scope:change
	}
}

bountig_event_chain.0010 = { # Eastern Rohan vassals get opportunity to join war
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0010.t
	desc = bountig_event_chain.0010.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = {
		any_held_county = {
			any_neighboring_county = {
				exists = holder
				OR = {
					holder = { is_wastelands = yes }
					holder = { faith_is_good = no }
				}
			}
		}
	}
	
	option = {
		name = bountig_event_chain.0010.a
		trigger = {
			NOT = {
				any_character_war = {
					is_defender = scope:war_target
					is_attacker = root
				}
			}
		}

		if = {
			limit = {
				NOT = { any_character_war = { this = scope:story_war } }
			}
			scope:story_war = { add_defender = root }
		}
		ai_chance = {
 			base = 90
			ai_value_modifier = {
				ai_boldness = 0.5
			}
 			modifier = {
 				add = 100
 				OR = {
 					has_trait = ambitious
					has_trait = honest
 				}
 			}
			modifier = {
				factor = 0.5
				OR = {
					has_any_bad_relationship_with_character_trigger = { CHARACTER = scope:war_target }
				}
			}
		}
	}

	option = {
		name = bountig_event_chain.0010.b
		
		ai_chance = {
 			base = 0
 			modifier = {
 				add = 100
 				has_trait = craven
 			}
		}
	}
}

bountig_event_chain.0011 = { #Bountig is forced to travel southwards
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0011.t
	desc = bountig_event_chain.0011.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = { title:c_minas_tirith.empire.holder ?= { save_scope_as = gondor_ruler } }

	option = { # Travel with full domicile
		name = bountig_event_chain.0011.a
		set_variable = cannot_cancel_travel
		custom_tooltip = bountig_event_chain.0011.a.tt
		set_laamp_variables_for_contracts_to_spawn_effect = yes
		start_travel_plan = {
			destination = title:b_pelannor.title_province
			travel_with_domicile = yes
			return_trip = no
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0012
			on_arrival_destinations = all
		}
		hidden_effect = { fill_provisions_effect = yes }
	}
}

bountig_event_chain.0012 = { #Bountig arrives in Pelennor
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0012.t
	desc = bountig_event_chain.0012.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = bountig_event_chain.0012.a
		add_trait = bountig_story_trait
		add_character_flag = gondor_amrun_flag
		custom_tooltip = bountig_event_chain.0012.a.tt.1
		custom_tooltip = bountig_event_chain.0012.a.tt.2
		custom_tooltip = bountig_event_chain.0012.a.tt.3
		remove_variable = cannot_cancel_travel
	}
}

bountig_event_chain.0013 = { #Generic Event for Bountig choosing to visit a special building in Gondor
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0013.t
	desc = bountig_event_chain.0013.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = bountig_event_chain.0013.a
		custom_tooltip = bountig_event_chain.0013.a.tt
		set_variable = cannot_cancel_travel
		location = { save_scope_as = curr_domicile_location }
		start_travel_plan = {
			destination = root.var:gondor_target_province
			travel_with_domicile = no
			return_trip = yes
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0014
			on_arrival_destinations = all_but_last
		}
	}
}

bountig_event_chain.0014 = { #Arrives in a Gondor city
	content_source = realms_dlc
	type = character_event
	theme = martial
	title = {
		first_valid = {
			triggered_desc = { #Minas Tirith
				trigger = { location = title:c_minas_tirith.title_province }
				desc =  bountig_event_chain.0014.t_minas_tirith
			}
			triggered_desc = { #Dol Amroth
				trigger = { location = title:c_dol_amroth.title_province }
				desc =  bountig_event_chain.0014.t_dol_amroth
			}
			triggered_desc = { #Pelargir
				trigger = { location = title:c_pelargir.title_province }
				desc =  bountig_event_chain.0014.t_pelargir
			}
			triggered_desc = { #Linhir
				trigger = { location = title:c_linhir.title_province }
				desc =  bountig_event_chain.0014.t_linhir
			}
			triggered_desc = { #Serelond
				trigger = { location = title:c_serelond.title_province }
				desc =  bountig_event_chain.0014.t_serelond
			}
			triggered_desc = { #Cair Andros
				trigger = { location = title:c_aranelaith.title_province }
				desc =  bountig_event_chain.0014.t_cair_andros
			}
			triggered_desc = { #Hyarpendë
				trigger = { location = title:c_alagdor.title_province }
				desc =  bountig_event_chain.0014.t_hyarpende
			}
			triggered_desc = { #Edhellond
				trigger = { location = title:c_edhellond.title_province }
				desc =  bountig_event_chain.0014.t_edhellond
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = { #Minas Tirith
				trigger = { location = title:c_minas_tirith.title_province }
				desc =  bountig_event_chain.0014.desc_minas_tirith
			}
			triggered_desc = { #Dol Amroth
				trigger = { location = title:c_dol_amroth.title_province }
				desc =  bountig_event_chain.0014.desc_dol_amroth
			}
			triggered_desc = { #Pelargir
				trigger = { location = title:c_pelargir.title_province }
				desc =  bountig_event_chain.0014.desc_pelargir
			}
			triggered_desc = { #Linhir
				trigger = { location = title:c_linhir.title_province }
				desc =  bountig_event_chain.0014.desc_linhir
			}
			triggered_desc = { #Serelond
				trigger = { location = title:c_serelond.title_province }
				desc =  bountig_event_chain.0014.desc_serelond
			}
			triggered_desc = { #Cair Andros
				trigger = { location = title:c_aranelaith.title_province }
				desc =  bountig_event_chain.0014.desc_cair_andros
			}
			triggered_desc = { #Hyarpendë
				trigger = { location = title:c_alagdor.title_province }
				desc =  bountig_event_chain.0014.desc_hyarpende
			}
			triggered_desc = { #Edhellond
				trigger = { location = title:c_edhellond.title_province }
				desc =  bountig_event_chain.0014.desc_edhellond
			}
		}
	}
	override_background = { #Minas Tirith
        trigger = { location = title:c_minas_tirith.title_province }
        reference = minas_tirith
    }
	override_background = { #Dol Amroth
        trigger = { location = title:c_dol_amroth.title_province }
        reference = dol_amroth
    }
	override_background = { #Pelargir/Serelond/Hyarpende
        trigger = {
			OR = {
				location = title:c_alagdor.title_province
				location = title:c_pelargir.title_province
				location = title:c_serelond.title_province
			}
		}
        reference = docks_dunedain
    }
	override_background = { #Linhir
        trigger = { location = title:c_linhir.title_province }
		reference = market_dunedain
	}
	override_background = { #Cair Andros
        trigger = { location = title:c_aranelaith.title_province }
		reference = on_river
	}
	override_background = { #Edhellond
        trigger = { location = title:c_edhellond.title_province }
		reference = fornost
	}
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = { location = scope:employer.capital_province }

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = { #Minas Tirith
						trigger = { location = title:c_minas_tirith.title_province }
						desc =  bountig_event_chain.0014.a_minas_tirith
					}
					triggered_desc = { #Dol Amroth
						trigger = { location = title:c_dol_amroth.title_province }
						desc =  bountig_event_chain.0014.a_dol_amroth
					}
					triggered_desc = { #Pelargir
						trigger = { location = title:c_pelargir.title_province }
						desc =  bountig_event_chain.0014.a_pelargir
					}
					triggered_desc = { #Linhir
						trigger = { location = title:c_linhir.title_province }
						desc =  bountig_event_chain.0014.a_linhir
					}
					triggered_desc = { #Serelond
						trigger = { location = title:c_serelond.title_province }
						desc =  bountig_event_chain.0014.a_serelond
					}
					triggered_desc = { #Cair Andros
						trigger = { location = title:c_aranelaith.title_province }
						desc =  bountig_event_chain.0014.a_cair_andros
					}
					triggered_desc = { #Hyarpendë
						trigger = { location = title:c_alagdor.title_province }
						desc =  bountig_event_chain.0014.a_hyarpende
					}
					triggered_desc = { #Edhellond
						trigger = { location = title:c_edhellond.title_province }
						desc =  bountig_event_chain.0014.a_edhellond
					}
				}
			}
		}
		if = {
			limit = { NOT = { has_trait = bountig_story_trait } }
			add_trait = bountig_story_trait
		}
		custom_tooltip = bountig_event_chain.0014.a.tt
		remove_variable = cannot_cancel_travel
		visiting_lore_city_reward_effect = yes
		random_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_gondor_cities }
			complete_task_contract = success_standard
		}
	}
}

bountig_event_chain.0020 = { #Bountig heads for Amrun
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0020.t
	desc = bountig_event_chain.0020.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = { #Head for Amrun
		name = bountig_event_chain.0020.a
		set_variable = cannot_cancel_travel
		custom_tooltip = bountig_event_chain.0020.a.tt
		start_travel_plan = {
			destination = title:c_harnen.title_province
			travel_with_domicile = yes
			return_trip = no
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0021
			on_arrival_destinations = all
		}
		every_task_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_gondor_cities }
			complete_task_contract = failure_standard
		}
		hidden_effect = { fill_provisions_effect = yes }
	}

	option = { #Stay in Gondor a while longer
		name = bountig_event_chain.0020.b
		custom_tooltip = bountig_event_chain.0020.b.tt
		if = { #Allow contract to be re-generated on Amrun
			limit = {
				is_target_in_variable_list = {
					name = harwan_cities_visited
					target = title:c_amrun.title_province
				}
			}
			remove_list_variable = {
				name = harwan_cities_visited
				target = title:c_amrun.title_province
			}
		}
		every_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_harwan_cities }
			invalidate_contract = yes
		}
	}
}

bountig_event_chain.0021 = { #Bountig arrives in Amrun
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0021.t
	desc = bountig_event_chain.0021.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = bountig_event_chain.0021.a
		remove_variable = cannot_cancel_travel
		random_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_harwan_cities }
			complete_task_contract = success_standard
		}
	}
}

bountig_event_chain.0022 = { #Generic Event for Bountig choosing to visit a special building in Harwan
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0022.t
	desc = bountig_event_chain.0022.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = bountig_event_chain.0022.a
		custom_tooltip = bountig_event_chain.0022.a.tt
		set_variable = cannot_cancel_travel
		location = { save_scope_as = curr_domicile_location }
		start_travel_plan = {
			destination = var:harwan_target_province
			travel_with_domicile = no
			return_trip = yes
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0023
			on_arrival_destinations = all_but_last
		}
	}
}

bountig_event_chain.0023 = { #Arrives in a Harwan city
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0023.t
	desc = bountig_event_chain.0023.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = { location = scope:employer.capital_province }

	option = {
		name = bountig_event_chain.0023.a
		custom_tooltip = bountig_event_chain.0023.a.tt
		remove_variable = cannot_cancel_travel
		visiting_lore_city_reward_effect = yes
		random_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_harwan_cities }
			complete_task_contract = success_standard
		}
	}
}

bountig_event_chain.0030 = { #Bountig heads for Umbar
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0030.t
	desc = bountig_event_chain.0030.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = { #Head for Umbar
		name = bountig_event_chain.0030.a
		set_variable = cannot_cancel_travel
		custom_tooltip = bountig_event_chain.0030.a.tt
		start_travel_plan = {
			destination = title:b_minasthalion.title_province
			travel_with_domicile = yes
			return_trip = no
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0031
			on_arrival_destinations = all
		}

		every_task_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_harwan_cities }
			complete_task_contract = failure_standard
		}
		hidden_effect = { fill_provisions_effect = yes }
	}

	option = { #Stay in Harwan a while longer
		name = bountig_event_chain.0030.b
		custom_tooltip = bountig_event_chain.0030.b.tt
		if = { #Allow contract to be re-generated on Umbar
			limit = {
				is_target_in_variable_list = {
					name = umbar_cities_visited
					target = title:c_umbar.title_province
				}
			}
			remove_list_variable = { name = umbar_cities_visited target = title:c_umbar.title_province }
		}
		every_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_umbar_cities }
			invalidate_contract = yes
		}
	}
}

bountig_event_chain.0031 = { #Bountig arrives in Umbar
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0031.t
	desc = bountig_event_chain.0031.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = bountig_event_chain.0031.a
		remove_variable = cannot_cancel_travel
		random_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_umbar_cities }
			complete_task_contract = success_standard
		}
	}
}

bountig_event_chain.0032 = { #Generic Event for Bountig choosing to visit a special building in Umbar
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0032.t
	desc = bountig_event_chain.0032.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = bountig_event_chain.0032.a
		custom_tooltip = bountig_event_chain.0032.a.tt
		set_variable = cannot_cancel_travel
		location = { save_scope_as = curr_domicile_location }
		start_travel_plan = {
			destination = var:umbar_target_province
			travel_with_domicile = no
			return_trip = yes
			players_use_planner = no
			on_arrival_event = bountig_event_chain.0033
			on_arrival_destinations = all_but_last
		}
	}
}

bountig_event_chain.0033 = { #Arrives in a Umbar city
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0033.t
	desc = bountig_event_chain.0033.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = { location = scope:employer.capital_province }

	option = {
		name = bountig_event_chain.0033.a
		custom_tooltip = bountig_event_chain.0033.a.tt
		remove_variable = cannot_cancel_travel
		visiting_lore_city_reward_effect = yes
		random_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_umbar_cities }
			complete_task_contract = success_standard
		}
	}
}

bountig_event_chain.0040 = { #Bountig arrives in Mistrand
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0040.t
	desc = bountig_event_chain.0040.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = bountig_event_chain.0040.a
		remove_variable = cannot_cancel_travel
		custom_tooltip = bountig_event_chain.0040.a.tt
		trigger_event = bountig_event_chain.5000 #Triggers Khand uniting

		every_task_contract = {
			limit = {
				OR = {
					has_task_contract_type = lotr_bountig_story_gondor_cities
					has_task_contract_type = lotr_bountig_story_harwan_cities
					has_task_contract_type = lotr_bountig_story_umbar_cities
				}
			}
			complete_task_contract = failure_standard
		}
	}
}

bountig_event_chain.0050 = { #Bountig arrives at court of an Easterling lord he wants to convince
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0050.t
	desc = bountig_event_chain.0050.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}
	
	left_portrait = {
		character = var:selected_character
		animation = personality_rational
	}
	 
	trigger = {
		has_variable = selected_character
		location.county.holder = var:selected_character
	}

	immediate = {
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = { #Diplomacy
						trigger = { var:selected_character = { has_trait = education_diplomacy } }
						desc =  bountig_event_chain.0050.a
					}
					triggered_desc = { #Martial
						trigger = { var:selected_character = { has_trait = education_martial } }
						desc =  bountig_event_chain.0050.b
					}
					triggered_desc = { #Learning
						trigger = { var:selected_character = { has_trait = education_learning } }
						desc =  bountig_event_chain.0050.c
					}
					triggered_desc = { #Intrigue
						trigger = { var:selected_character = { has_trait = education_intrigue } }
						desc =  bountig_event_chain.0050.d
					}
					triggered_desc = { #Stewardship
						trigger = { var:selected_character = { has_trait = education_stewardship } }
						desc =  bountig_event_chain.0050.e
					}
				}
			}
		}
		if = {
			limit = { var:selected_character = { has_trait = education_diplomacy } }
			bountig_convince_easterling_lord_effect = { SKILL = diplomacy }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_martial } }
			bountig_convince_easterling_lord_effect = { SKILL = martial }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_learning } }
			bountig_convince_easterling_lord_effect = { SKILL = learning }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_intrigue } }
			bountig_convince_easterling_lord_effect = { SKILL = intrigue }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_stewardship } }
			bountig_convince_easterling_lord_effect = { SKILL = stewardship }
		}
	}
}

bountig_event_chain.0054 = { #Bountig arrives at court of an Easterling lord he wants to convince - last trip
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0054.t
	desc = bountig_event_chain.0054.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}
	
	left_portrait = {
		character = var:selected_character
		animation = personality_rational
	}
	 
	trigger = {
		# OR = {
		# 	exists = scope:easterling_ruler_1
		# 	exists = scope:easterling_ruler_2
		# 	exists = scope:easterling_ruler_3
		# }
	}

	immediate = {
		if = {
			limit = {
				exists = scope:easterling_ruler_1
				root.location.county.holder = scope:easterling_ruler_1
			}
			set_variable = {
				name = selected_character
				value = scope:easterling_ruler_1
			}
		}
		if = {
			limit = {
				exists = scope:easterling_ruler_2
				root.location.county.holder = scope:easterling_ruler_2
			}
			set_variable = {
				name = selected_character
				value = scope:easterling_ruler_2
			}
		}
		if = {
			limit = {
				exists = scope:easterling_ruler_3
				root.location.county.holder = scope:easterling_ruler_3
			}
			set_variable = {
				name = selected_character
				value = scope:easterling_ruler_3
			}
		}
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = { #Diplomacy
						trigger = { var:selected_character = { has_trait = education_diplomacy } }
						desc =  bountig_event_chain.0054.a
					}
					triggered_desc = { #Martial
						trigger = { var:selected_character = { has_trait = education_martial } }
						desc =  bountig_event_chain.0054.b
					}
					triggered_desc = { #Learning
						trigger = { var:selected_character = { has_trait = education_learning } }
						desc =  bountig_event_chain.0054.c
					}
					triggered_desc = { #Intrigue
						trigger = { var:selected_character = { has_trait = education_intrigue } }
						desc =  bountig_event_chain.0054.d
					}
					triggered_desc = { #Stewardship
						trigger = { var:selected_character = { has_trait = education_stewardship } }
						desc =  bountig_event_chain.0054.e
					}
				}
			}
		}
		if = {
			limit = { var:selected_character = { has_trait = education_diplomacy } }
			bountig_convince_easterling_lord_effect = { SKILL = diplomacy }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_martial } }
			bountig_convince_easterling_lord_effect = { SKILL = martial }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_learning } }
			bountig_convince_easterling_lord_effect = { SKILL = learning }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_intrigue } }
			bountig_convince_easterling_lord_effect = { SKILL = intrigue }
		} else_if = {
			limit = { var:selected_character = { has_trait = education_stewardship } }
			bountig_convince_easterling_lord_effect = { SKILL = stewardship }
		}
	}
}

bountig_event_chain.0051 = { #Bountig gets one last chance to convince any remaining easterling lords
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0051.t
	desc = bountig_event_chain.0051.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = {
		title:e_rhovanion = {
			ordered_de_jure_county_holder = {
				limit = {
					is_independent_ruler = yes
					NOT = { has_character_modifier = lotr_bountig_convinced_easterling_lord }
					OR = {
						culture = culture:igath
						culture = culture:asdriag
						culture = culture:odhriag
						culture = culture:magriag
					}
					NOT = { capital_province.county = root.domicile.domicile_location.county }
				}
				order_by = max_military_strength
				check_range_bounds = no
				min = 0
				save_scope_as = easterling_ruler
				root = {
					add_to_variable_list = {
						name = temporary_list
						target = scope:easterling_ruler
					}
				}
			}
		}
		title:e_rhun = {
			ordered_de_jure_county_holder = {
				limit = {
					is_independent_ruler = yes
					NOT = { has_character_modifier = lotr_bountig_convinced_easterling_lord }
					OR = {
						culture = culture:igath
						culture = culture:asdriag
						culture = culture:odhriag
						culture = culture:magriag
					}
					NOT = { capital_province.county = root.domicile.domicile_location.county }
				}
				order_by = max_military_strength
				check_range_bounds = no
				min = 0
				save_scope_as = easterling_ruler
				root = {
					add_to_variable_list = {
						name = temporary_list
						target = scope:easterling_ruler
					}
				}
			}
		}

		ordered_in_list = {
			variable = temporary_list
			order_by = max_military_strength
			check_range_bounds = no
			min = 0
			save_scope_as = easterling_ruler
			root = {
				add_to_variable_list = {
					name = independent_easterlings
					target = scope:easterling_ruler
				}
			}
		}
		clear_variable_list = temporary_list

		
		ordered_in_list = {
			variable = independent_easterlings
			order_by = max_military_strength
			check_range_bounds = no
			max = 1
			save_scope_as = easterling_ruler_1
		}
		if = {
			limit = { exists = scope:easterling_ruler_1 }
			remove_list_variable = {
				name = independent_easterlings
				target = scope:easterling_ruler_1
			}
		}
		ordered_in_list = {
			variable = independent_easterlings
			order_by = max_military_strength
			check_range_bounds = no
			max = 1
			save_scope_as = easterling_ruler_2
		}
		if = {
			limit = { exists = scope:easterling_ruler_2 }
			remove_list_variable = {
				name = independent_easterlings
				target = scope:easterling_ruler_2
			}
		}
		ordered_in_list = {
			variable = independent_easterlings
			order_by = max_military_strength
			check_range_bounds = no
			max = 1
			save_scope_as = easterling_ruler_3
		}
		if = {
			limit = { exists = scope:easterling_ruler_3 }
			remove_list_variable = {
				name = independent_easterlings
				target = scope:easterling_ruler_3
			}
		}
		set_variable = last_trip_for_easterling_lords
		clear_variable_list = independent_easterlings
	}

	option = {
		name = bountig_event_chain.0051.a
		if = {
			limit = {
				exists = scope:easterling_ruler_1
				exists = scope:easterling_ruler_2
				exists = scope:easterling_ruler_3
			}
			start_travel_plan = {
				destination = scope:easterling_ruler_1.capital_province
				destination = scope:easterling_ruler_2.capital_province
				destination = scope:easterling_ruler_3.capital_province
				travel_with_domicile = no
				return_trip = yes
				players_use_planner = no
				on_arrival_event = bountig_event_chain.0054
				on_arrival_destinations = all_but_last
			}
		} else_if = {
			limit = {
				NOT = { exists = scope:easterling_ruler_2 }
				exists = scope:easterling_ruler_1
				exists = scope:easterling_ruler_3
			}
			start_travel_plan = {
				destination = scope:easterling_ruler_1.capital_province
				destination = scope:easterling_ruler_3.capital_province
				travel_with_domicile = no
				return_trip = yes
				players_use_planner = no
				on_arrival_event = bountig_event_chain.0054
				on_arrival_destinations = all_but_last
			}
		} else_if = {
			limit = {
				NOT = { exists = scope:easterling_ruler_3 }
				exists = scope:easterling_ruler_1
				exists = scope:easterling_ruler_2
			}
			start_travel_plan = {
				destination = scope:easterling_ruler_1.capital_province
				destination = scope:easterling_ruler_2.capital_province
				travel_with_domicile = no
				return_trip = yes
				players_use_planner = no
				on_arrival_event = bountig_event_chain.0054
				on_arrival_destinations = all_but_last
			}
		} else_if = {
			limit = {
				NOT = { exists = scope:easterling_ruler_1 }
				exists = scope:easterling_ruler_2
				exists = scope:easterling_ruler_3
			}
			start_travel_plan = {
				destination = scope:easterling_ruler_2.capital_province
				destination = scope:easterling_ruler_3.capital_province
				travel_with_domicile = no
				return_trip = yes
				players_use_planner = no
				on_arrival_event = bountig_event_chain.0054
				on_arrival_destinations = all_but_last
			} 
		} else_if = {
			limit = {
				NOT = { exists = scope:easterling_ruler_3 }
				NOT = { exists = scope:easterling_ruler_2 }
				exists = scope:easterling_ruler_1
			}
			start_travel_plan = {
				destination = scope:easterling_ruler_1.capital_province
				travel_with_domicile = no
				return_trip = yes
				players_use_planner = no
				on_arrival_event = bountig_event_chain.0054
				on_arrival_destinations = all_but_last
			}
		} else_if = {
			limit = {
				NOT = { exists = scope:easterling_ruler_3 }
				NOT = { exists = scope:easterling_ruler_1 }
				exists = scope:easterling_ruler_2
			}
			start_travel_plan = {
				destination = scope:easterling_ruler_2.capital_province
				travel_with_domicile = no
				return_trip = yes
				players_use_planner = no
				on_arrival_event = bountig_event_chain.0054
				on_arrival_destinations = all_but_last
			}
		} else_if = {
			limit = {
				NOT = { exists = scope:easterling_ruler_1 }
				NOT = { exists = scope:easterling_ruler_2 }
				exists = scope:easterling_ruler_3
			}
			start_travel_plan = {
				destination = scope:easterling_ruler_3.capital_province
				travel_with_domicile = no
				return_trip = yes
				players_use_planner = no
				on_arrival_event = bountig_event_chain.0054
				on_arrival_destinations = all_but_last
			} 
		}
	}

	option = {
		name = bountig_event_chain.0051.b
	}

	after = { 
		title:e_khand = {
			random_de_jure_county_holder = {
				limit = { has_title = title:k_upper_khand }
				trigger_event = {
					id = bountig_event_chain.5007
					days = 14
				}
				trigger_event = {
					id = bountig_event_chain.9998
					years = 3
				}
				trigger_event = {
					id = bountig_event_chain.9997
					years = 6
				}
			}
		}	
	}
}

bountig_event_chain.0052 = { #Bountig gets a titular empire title to wage war against Khand
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0052.t
	desc = bountig_event_chain.0052.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = war_defender
	}
	
	left_portrait = {
		character = title:e_khand.holder
		animation = war_attacker
	}

	immediate = {
		title:e_rhun = {
			every_de_jure_county_holder = {
				limit = {
					has_character_modifier = lotr_bountig_convinced_easterling_lord
					highest_held_title_tier < tier_kingdom
				}
				add_to_list = rulers_to_vassalise
				hidden_effect = { every_character_war = { end_war = invalidated } }
			}
		}
		title:e_rhovanion = {
			every_de_jure_county_holder = {
				limit = {
					has_character_modifier = lotr_bountig_convinced_easterling_lord
					highest_held_title_tier < tier_kingdom
				}
				add_to_list = rulers_to_vassalise
				hidden_effect = { every_character_war = { end_war = invalidated } }
			}
		}
		title:e_rhun = {
			every_de_jure_county_holder = {
				limit = {
					is_independent_ruler = yes
					OR = {
						culture = culture:igath
						culture = culture:asdriag
						culture = culture:odhriag
						culture = culture:magriag
					}
					OR = {
						NOT = { has_character_modifier = lotr_bountig_convinced_easterling_lord }
						highest_held_title_tier > tier_duchy
					}
				}
				add_to_list = rulers_who_are_allies
				hidden_effect = { every_character_war = { end_war = invalidated } }
			}
		}
		title:e_rhovanion = {
			every_de_jure_county_holder = {
				limit = {
					is_independent_ruler = yes
					OR = {
						culture = culture:igath
						culture = culture:asdriag
						culture = culture:odhriag
						culture = culture:magriag
					}
					OR = {
						NOT = { has_character_modifier = lotr_bountig_convinced_easterling_lord }
						highest_held_title_tier > tier_duchy
					}
				}
				add_to_list = rulers_who_are_allies
				hidden_effect = { every_character_war = { end_war = invalidated } }
			}
		}
		random_character_war = {
			limit = { using_cb = bountig_and_khand_invasion_war }
			save_scope_as = special_war
		}
	}

	option = {
		name = bountig_event_chain.0052.a
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
			add_claim_on_loss = no
		}
		title:c_mistrand = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change

		get_title = title:k_grand_alliance

		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
			add_claim_on_loss = no
		}
		every_in_list = {
			list = rulers_to_vassalise 
			change_liege = {
				liege = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
		
		every_in_list = {
			list = rulers_who_are_allies
			limit = { scope:special_war = { NOT = { is_attacker = prev } } }
			scope:special_war = { set_called_to = prev }
			scope:special_war = { add_defender = prev }
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = { any_maa_regiment = { count < 3 } }
				every_maa_regiment = { destroy_maa_regiment = yes }
				create_maa_regiment = {
					type = easterling_kataphrakt
					check_can_recruit = no
					size = 1
				}
				create_maa_regiment = {
					type = easterling_swordsmen
					check_can_recruit = no
					size = 1
				}
				create_maa_regiment = {
					type = easterling_pikemen
					check_can_recruit = no
					size = 1
				}
				every_maa_regiment = {
					change_maa_regiment_size = {
						size = 5
						reinforce = yes
					}
				}
			}
		}
	}
}

bountig_event_chain.0053 = { #Bountig kills Ovatha in duel
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.0053.t
	desc = bountig_event_chain.0053.desc
	theme = realm
	window = duel_event

	left_portrait = {
		character = scope:defender
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = scope:attacker
		scripted_animation = duel_wield_weapon
	}

	override_background = { reference = wilderness_steppe }
	
	widgets = {
		widget = {
			gui = "lotr_shader_event_sparks"
			container = "lotr_shader_event_foreground"
		}
	}

	option = {
		name = bountig_event_chain.0053.a

		scope:attacker = {
			death = {
				death_reason = death_duel
				killer = scope:defender
			}
		}
	}
}

bountig_event_chain.4000 = {
	hidden = yes

	trigger = {
		var:contract_passive_spawn_location ?= location.empire
		trigger_if = {
			limit = { has_variable = contract_passive_spawn_tally }
			var:contract_passive_spawn_tally < 3
		}
		# Make sure we don't do this if we've got lots of contracts already spawned here.
		any_character_task_contract = {
			count <= 6
			task_contract_location = {
				"squared_distance(root.location)" <= squared_distance_medium
			}
		}
	}

	on_trigger_fail = {
		if = {
			limit = { var:contract_passive_spawn_location ?= location.empire }
			trigger_event = {
				id = bountig_event_chain.4000
				months = { 8 12 }
			}
		}
	}

	immediate = {
		# spawn a contract
		contract_passive_spawn_effect = {
			SPAWN_CONTRACTS = 1
		}
		# And fire us again in a bit.
		if = {
			limit = { 
				var:contract_passive_spawn_tally < 2
			}
			trigger_event = {
				id = bountig_event_chain.4000
				months = 1
			}
		}
		else = {
			trigger_event = {
				id = bountig_event_chain.4000
				months = 2
			}
		}
	}
}

bountig_event_chain.4010 = {
	hidden = yes

	immediate = { fill_provisions_effect = yes }
}

#############################
### KHAND & OVATHA EVENTS ###
#############################

# Check if Bountig is alive and has returned to Mistrand
bountig_event_chain.5000 = {  
	hidden = yes #Triggered by Bountig's return to Rhûn
	immediate = {
		#Event fires on Bountig, so ROOT scope is Bountig
		save_scope_as = bountigmedlokan
		title:c_ubesesh.holder.top_liege = { # Make sure this is Ovatha!
			trigger_event = bountig_event_chain.5001 
		}
	}
}

# Receive news of a rhunnic adventurer on the rise, serving as an important advisor to the quarreling easterlings
bountig_event_chain.5001 = {
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.5001.t
	desc = bountig_event_chain.5001.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = {
		reference = council_chamber
	}
	
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = { # Let us investigate this new threat
		name = bountig_event_chain.5001.a
		custom_tooltip = bountig_event_chain.5001.a.tt # Send spies to Mistrand
		remove_short_term_gold = tiny_gold_value
		trigger_event = {
			id = bountig_event_chain.5002
			days = { 60 90 }
		}
		ai_chance = { base = 100 }
	}
	
	option = { # I'll ignore this fool.
		name = bountig_event_chain.5001.b
		custom_tooltip = bountig_event_chain.5001.b.tt # Do nothing
		# Trigger the next event once Bountig unites Rhûn
		ai_chance = { base = 0 }
	}
}

# Spies return from Mistrand with more details
bountig_event_chain.5002 = {
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.5002.t
	desc = bountig_event_chain.5002.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = {
		reference = council_chamber
	}
	
	left_portrait = {
		character = root
		animation = worry
	}
	
	right_portrait = {
		character = scope:bountigmedlokan
		animation = marshal_shield
	}

	option = { # It is time to unite
		name = bountig_event_chain.5002.a
		custom_tooltip = bountig_event_chain.5002.a.tt # Unlock the decision to unite Upper Khand
		add_character_flag = { flag = ovatha_unite_upper_khand }
		if = {
			limit = { is_ai = yes } #AI buff
			add_character_modifier = {
				modifier = lotr_ovatha_VIII_uniting_khand
				years = 5
			}
			add_prestige = 2500
			spawn_army = {
				levies = 1000
				men_at_arms = {
					type = variag_horse_archers
					stacks = 2
				}
				men_at_arms = {
					type = windriders_of_khand
					stacks = 2
				}
				men_at_arms = {
					type = variag_axemen
					stacks = 2
				}
				men_at_arms = {
					type = variag_pikemen
					stacks = 2
				}
				men_at_arms = {
					type = onager
					stacks = 10
				}
				location = capital_province
				uses_supply = no
				inheritable = no
				name = bountig_event_chain.5002.event_troops
			}
		}
	}

	after = {
		trigger_event = {
			id = bountig_event_chain.9998
			years = 3
		}
		trigger_event = {
			id = bountig_event_chain.9996
			years = 6
		}
	}
}

# Uniting the Kingdom of Upper Khand (triggered by decision)
bountig_event_chain.5003 = {
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.5003.t
	desc = bountig_event_chain.5003.desc
	theme = realm
	override_background = {
		reference = throne_room
	}
	
	left_portrait = {
		character = root
		animation = personality_bold
	}
	
	lower_right_portrait = {
		character = scope:bountigmedlokan
		animation = marshal_shield
	}
	
	immediate = {
		character:bountigmedlokan = { save_scope_as = bountigmedlokan }
		show_as_tooltip = {
			get_title = title:k_upper_khand
		}
	}

	option = { # Let the Lords of Upper Khand bend the knee before me!
		name = bountig_event_chain.5003.a
		custom_tooltip = bountig_event_chain.5003.a.tt
		title:k_upper_khand = {
			every_de_jure_county_holder = {
            	limit = {
					is_independent_ruler = yes
					is_landed = yes
					NOT = { is_orc = yes }
				}
				trigger_event = {
					id = bountig_event_chain.5004
					days = { 2 7 }
				}
			}
		}
	}
	after = { scope:bountigmedlokan = { trigger_event = { id = bountig_event_chain.0051 days = 21 } } }

}

bountig_event_chain.5004 = { # Receive the order to submit to Ovatha
	type = letter_event
	sender = scope:sender
	opening = bountig_event_chain.5004.opening
	desc = bountig_event_chain.5004.desc

	trigger = {
		NOT = { is_at_war_with = title:k_upper_khand.holder }
		NOT = { root = title:k_upper_khand.holder }
		NOT = { is_vassal_or_below_of = title:k_upper_khand.holder }
	}

	on_trigger_fail = { #Trigger invitation again if it was blocked because the character was handling another invitation
		trigger_event = {
			id = bountig_event_chain.5004
			days = 1
		}
	}

	immediate = {
		title:k_upper_khand.holder = {
			save_scope_as = sender
		}
		ROOT = {
			save_scope_as = recipient
		}
	}

	option = { # It would be best to submit...
		name = bountig_event_chain.5004.a 
		show_as_tooltip = {
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
				add_claim_on_loss = no
			}
			change_liege = {
				liege = scope:sender
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}
		hidden_effect = {
			scope:sender = { trigger_event = bountig_event_chain.5005 }
		}

		ai_chance = { # Canonically they do bend the knee out of fear 
			base = 100
		}
	}

	option = { # I will remain independent
		name = bountig_event_chain.5004.b
		trigger = { is_ai = no }
		show_as_tooltip = {
			if = {
				limit = {
					scope:recipient.primary_title.kingdom ?= title:k_upper_khand
				}
				scope:sender = {
					add_unpressed_claim = scope:recipient.primary_title
				}
			}
			add_prestige = medium_prestige_gain
		}
		hidden_effect = {
			scope:sender = { trigger_event = bountig_event_chain.5006 }
		}
	}
}

bountig_event_chain.5005 = { # Subjugation accepted
	type = letter_event
	opening = bountig_event_chain.5005.opening
	desc = bountig_event_chain.5005.desc
	sender = scope:recipient

	immediate = {
		scope:recipient = {
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
				add_claim_on_loss = no
			}
			change_liege = {
				liege = scope:sender
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}
	}

	option = { # Wise choice
		name = bountig_event_chain.5005.a
	}
}

bountig_event_chain.5006 = { # Subjugation refused
	type = letter_event
	opening = bountig_event_chain.5006.opening
	desc = bountig_event_chain.5006.desc
	sender = {
		character = scope:recipient
		animation = personality_bold
	}

	immediate = {
		if = {
			limit = {
				scope:recipient.primary_title.kingdom ?= title:k_upper_khand
			}
			scope:sender = {
				add_unpressed_claim = scope:recipient.primary_title
			}
		}
		scope:recipient = { add_prestige = 75 }
	}

	option = { # I must use force...
		name = bountig_event_chain.5006.a
		start_war = {
			casus_belli = claim_cb
			target = scope:recipient
			claimant = root
			target_title = scope:recipient.primary_title
		}
		ai_chance = {
			base = 100 
		}
	}
	
	option =  { # I'll ignore them
		name = bountig_event_chain.5006.b 
		add_pressed_claim = scope:recipient.primary_title
	}
}

# Second phase of Ovatha events ~ triggered when Bountig starts to unite Rhûn
bountig_event_chain.5007 = { # Our fears have come to pass
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.5007.t
	desc = bountig_event_chain.5007.desc
	theme = martial
	override_background = {
		reference = throne_room
	}
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:bountigmedlokan
		animation = marshal_shield
	}
	immediate = {
		character:bountigmedlokan = { save_scope_as = bountigmedlokan }
	}
	option = { # We have to unite ALL of Khand under a single banner
		name = bountig_event_chain.5007.a
		custom_tooltip = bountig_event_chain.5007.a.tt 
		add_character_flag = ovatha_unite_empire_khand
		if = {
			limit = { is_ai = yes }
			add_prestige = 4000
		}
		ai_chance = { base = 100 }
	}
}

bountig_event_chain.5008 = { # I am Ovatha reborn!
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.5008.t
	desc = bountig_event_chain.5008.desc
	theme = realm
	window = visit_settlement_window
	override_background = {
		reference = throne_room
	}
	left_portrait = {
		character = root
		animation = celebrate_sword
	}
	override_effect_2d = {
		reference = rain
	}
	immediate = {
		show_as_tooltip = {
			get_title = title:e_khand
			change_first_name = O_O_vatha
			give_nickname = nick_the_uniter_khand
		}
		add_prestige = major_prestige_gain
		title:e_khand.holder = { # Get your bling chair
			create_artifact_throne_ovatha_effect = { OWNER = this }
		}
		character:bountigmedlokan = { save_scope_as = bountigmedlokan }
	}
	option = { # Let all of Khand bow before me!
		name = bountig_event_chain.5008.a
		custom_tooltip = bountig_event_chain.5008.a.tt
		title:e_khand = {
			every_de_jure_county_holder = {
            	limit = {
					is_independent_ruler = yes
					is_landed = yes
					NOT = { is_orc = yes }
				}
				trigger_event = {
					id = bountig_event_chain.5009
					days = { 2 7 }
				}
			}
		}
	}
	after = {
		add_character_flag = ovatha_ready_for_war 
	}
}

bountig_event_chain.5009 = { # All khandish rulers receive Ovatha's demand
	type = letter_event
	sender = scope:sender
	opening = bountig_event_chain.5009.opening
	desc = bountig_event_chain.5009.desc

	trigger = {
		NOT = { is_at_war_with = title:e_khand.holder }
		NOT = { root = title:e_khand.holder }
		NOT = { is_vassal_or_below_of = title:e_khand.holder }
	}

	on_trigger_fail = { #Trigger invitation again if it was blocked because the character was handling another invitation
		trigger_event = {
			id = bountig_event_chain.5009
			days = 1
		}
	}

	immediate = {
		title:e_khand.holder = {
			save_scope_as = sender
		}
		ROOT = {
			save_scope_as = recipient
		}
	}

	option = { # It would be best to submit...
		name = bountig_event_chain.5009.a 
		show_as_tooltip = {
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
				add_claim_on_loss = no
			}
			change_liege = {
				liege = scope:sender
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}
		hidden_effect = {
			scope:sender = { trigger_event = bountig_event_chain.5010 }
		}

		ai_chance = { # Canonically they do bend the knee out of fear 
			base = 100
		}
	}

	option = { # I will remain independent
		name = bountig_event_chain.5009.b
		trigger = { is_ai = no }
		show_as_tooltip = {
			if = {
				limit = {
					scope:recipient.primary_title.kingdom ?= title:e_khand
				}
				scope:sender = {
					add_unpressed_claim = scope:recipient.primary_title
				}
			}
			add_prestige = medium_prestige_gain
		}
		hidden_effect = {
			scope:sender = { trigger_event = bountig_event_chain.5011 }
		}
	}
}

bountig_event_chain.5010 = { # Subjugation accepted
	type = letter_event
	opening = bountig_event_chain.5010.opening
	desc = bountig_event_chain.5010.desc
	sender = scope:recipient

	immediate = {
		scope:recipient = {
			scope:recipient = { every_character_war = { end_war = invalidated } }
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
				add_claim_on_loss = no
			}
			change_liege = {
				liege = scope:sender
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}
	}

	option = { # Wise choice
		name = bountig_event_chain.5010.a
	}
}

bountig_event_chain.5011 = { # Subjugation refused
	type = letter_event
	opening = bountig_event_chain.5011.opening
	desc = bountig_event_chain.5011.desc
	sender = {
		character = scope:recipient
		animation = personality_bold
	}

	immediate = {
		if = {
			limit = {
				scope:recipient.primary_title.kingdom ?= title:e_khand
			}
			scope:sender = {
				add_unpressed_claim = scope:recipient.primary_title
			}
		}
		scope:recipient = { add_prestige = 75 }
	}

	option = { # I must use force...
		name = bountig_event_chain.5011.a
		start_war = {
			casus_belli = claim_cb
			target = scope:recipient
			claimant = root
			target_title = scope:recipient.primary_title
		}
		ai_chance = {
			base = 100 
		}
	}
	
	option =  { # I'll ignore them
		name = bountig_event_chain.5011.b 
		add_pressed_claim = scope:recipient.primary_title
	}
}

#Final event, triggered by decision ~ Go to war against Bountig
bountig_event_chain.5012 = { # We must strike now while they're still consolidating
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.5012.t
	desc = bountig_event_chain.5012.desc
	theme = war
	override_background = {
		reference = battlefield
	}
	left_portrait = {
		character = root
		animation = war_attacker
	}
	right_portrait = {
		character = scope:bountigmedlokan
		animation = war_defender
	}
	immediate = { 
		character:bountigmedlokan = { save_scope_as = bountigmedlokan }
	}
	option = { # We must be as lions tearing their prey apart.
		name = bountig_event_chain.5012.a 
		start_war = {
			cb = bountig_and_khand_invasion_war
			target = scope:bountigmedlokan
			target_title = title:e_rhun
		}
		random_character_war = { 
			limit = { using_cb = bountig_and_khand_invasion_war }
			save_scope_as = special_war
		}
		every_vassal = {
			limit = {
				highest_held_title_tier > tier_county 
				scope:special_war = { NOT = { is_defender = prev } }
			}
			scope:special_war = { set_called_to = prev }
			scope:special_war = { add_attacker = prev }
		}
		scope:bountigmedlokan = {
			trigger_event = bountig_event_chain.0052
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = { any_maa_regiment = { count < 3 } }
				every_maa_regiment = { destroy_maa_regiment = yes }
				create_maa_regiment = {
					type = variag_axemen
					check_can_recruit = no
					size = 1
				}
				create_maa_regiment = {
					type = variag_pikemen
					check_can_recruit = no
					size = 1
				}
				create_maa_regiment = {
					type = windriders_of_khand
					check_can_recruit = no
					size = 1
				}
				every_maa_regiment = {
					change_maa_regiment_size = {
						size = 7
						reinforce = yes
					}
				}
			}
		}
	}
}

bountig_event_chain.5013 = { #Ovatha kills Bountig in duel
	content_source = realms_dlc
	type = character_event
	title = bountig_event_chain.5013.t
	desc = bountig_event_chain.5013.desc
	theme = realm
	window = duel_event

	left_portrait = {
		character = scope:defender
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = scope:attacker
		scripted_animation = duel_wield_weapon
	}

	override_background = { reference = wilderness_steppe }
	
	widgets = {
		widget = {
			gui = "lotr_shader_event_sparks"
			container = "lotr_shader_event_foreground"
		}
	}

	option = {
		name = bountig_event_chain.5013.a

		scope:defender = {
			death = {
				death_reason = death_duel
				killer = scope:attacker
			}
		}
	}
}

### MANAGEMENT EVENTS ###

bountig_event_chain.9996 = {
	hidden = yes
	trigger = { is_ai = yes }
	immediate = {
		execute_decision = decision_unite_upper_khand_ovatha
	}
}

bountig_event_chain.9997 = {
	hidden = yes
	trigger = { is_ai = yes }
	immediate = {
		execute_decision = decision_ovatha_unite_empire_khand
	}
}

bountig_event_chain.9998 = {
	hidden = yes
	trigger = { is_ai = yes }
	immediate = { add_character_flag = bypass_normal_requirements }
}

bountig_event_chain.9999 = {
	hidden = yes
	orphan = yes
	immediate = {
		random_character_active_contract = {
			limit = { has_task_contract_type = lotr_bountig_story_umbar_cities }
			complete_task_contract = success_standard
		}
	}
}