namespace = bountig_event_chain


bountig_event_chain.0001 = {
	hidden = yes 

	on_trigger_fail = { #Trigger invitation again if it was blocked because the character was handling another invitation
		trigger_event = { id = bountig_event_chain.0001 days = 1 }
	}

	immediate = {
		pan_camera_to_province = scope:rhun_attacker.location
		trigger_event = {
			id = bountig_event_chain.9999
			days = 1
		}
	}
}

bountig_event_chain.0002 = {
	hidden = yes 

	trigger = {
		is_available = yes
	}

	on_trigger_fail = { #Trigger invitation again if it was blocked because the character was handling another invitation
		trigger_event = { id = bountig_event_chain.0002 days = 1 }
	}

	immediate = {
		pan_camera_to_province = title:c_minas_tirith.title_province
		scope:task_contract = { open_view_data = task_contract }
	}
}

bountig_event_chain.0010 = { # Eastern Rohan vassals get opportunity to join war
	type = character_event
	title = bountig_event_chain.0010.t
	desc = bountig_event_chain.0010.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = {
		name = bountig_event_chain.0010.a
		if = {
			limit = {
				NOT = { any_character_war = { this = scope:story_war } }
			}
			scope:story_war = { add_defender = root }
			set_variable = joined_war
		}
		ai_chance = {
 			base = 90
			ai_value_modifier = {
				ai_boldness = 0.5
			}
 			modifier = {
 				add = 100
 				OR = {
 					has_trait = ambitious
					has_trait = honest
 				}
 			}
		}
	}

	option = {
		name = bountig_event_chain.0010.b
		
		ai_chance = {
 			base = 0
 			modifier = {
 				add = 100
 				has_trait = craven
 			}
		}
	}

	after = {
		if = {
			limit = { has_variable = joined_war }
			trigger_event = {
				id = bountig_event_chain.0011
				days = 30
			}
			remove_variable = joined_war
		}
		
	}
}

bountig_event_chain.0011 = {
	hidden = yes

	immediate = {
		ordered_army = {
			order_by = army_size
			assign_commander = root
			set_army_location = scope:employer.location
		}

		scope:bountig = {
			trigger_event = {
				id = bountig_event_chain.0015
				days = 15
			}
		}
	}
}

bountig_event_chain.0015 = {
	type = character_event
	title = bountig_event_chain.0015.t
	desc = bountig_event_chain.0015.desc
	theme = martial
	
	right_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = {
		NOT = { has_character_flag = abandon_easterling_war }
	}

	immediate = { add_character_flag = { flag = abandon_easterling_war } }

	option = {
		name = bountig_event_chain.0015.a
		custom_tooltip = {
			text = bountig_event_chain.0015.a.tt
			random_character_war = {
				limit = {
					primary_defender = title:k_rohan.holder
				}
				remove_participant = root
			}
		}
		set_variable = bountig_story_visit_minas_tirith
	}
}

bountig_event_chain.9999 = { #Open the contract 
	hidden = yes
	immediate = {
		add_prestige = 10000
		random_task_contract = {
			limit = { has_task_contract_type = lotr_story }
			save_scope_as = task_contract
		}
		scope:task_contract = { open_view_data = task_contract }
	}
}