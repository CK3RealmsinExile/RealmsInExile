namespace = ray_story

##############################
### Mardat Storyline Act 1 ###
##############################

### Intro ###

ray_story.0001 = { # Mardat Makes His Choice
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0001.t
	desc = ray_story.0001.desc
	override_background = corridor_night
	
	left_portrait = {
		character = root
		animation = scheme
		}
	
	right_portrait = {
		character = scope:ray_king
		animation = paranoia
		}
	
	option = { # Fabricate a claim on Ray
		name = ray_story.0001.a
		custom_tooltip = ray_story.0001.a.effects
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -40
		}
		remove_short_term_gold = 100
		add_prestige = 750
		add_character_flag = mardat_is_plotting
		if = {
			limit = {
				is_ai = yes
			}
			trigger_event = {
				id = ray_story.0002
				days = 3650
			}
		}
		if = {
			limit = {
				title:e_thon_an_kharlokh.holder = {
					is_ai = yes
				}
			}
			trigger_event = {
				id = ray_story.0112
				days = 365
			}
		}
		scope:ray_king = {
			trigger_event = ray_story.402
		}
		ai_chance = {
			base = 100 
		}
	}
	option = { # Chicken out and end content
		name = ray_story.0001.b
		custom_tooltip = opt_out_of_story_content
		add_stress = 300
		add_trait = craven
		ai_chance = {
			base = 0 
		}
	}

}

ray_story.0002{#AI check for coup code
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_haruzan.holder = { save_scope_as = haruzan_king }
		if = {
			limit = {
				title:e_bozisha_miraz = { is_title_created = no }
			}
			add_character_flag = mardat_coup_transition
		}		
	}
	theme = intrigue
	title =	ray_story.0103.t
	desc = ray_story.0103.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = chancellor
	}

	right_portrait = {
		character = scope:haruzan_king
		animation = interested
	}

	option = {
		name = ray_story.0103.a
		trigger_event = {
			id = ray_story.0163
		}		
		ai_chance = {
			base = 100
		}
	}
}


### Haruzan Story Branch ###

ray_story.0103{#Sending off the envoy to Haruzan
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_haruzan.holder = { save_scope_as = haruzan_king }
	}
	theme = intrigue
	title =	ray_story.0103.t
	desc = ray_story.0103.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = chancellor
	}

	right_portrait = {
		character = scope:haruzan_king
		animation = interested
	}

	option = {
		name = ray_story.0103.a
		title:k_haruzan.holder = {
			trigger_event = {
				id = ray_story.0105
				days = 200
			}
		}	
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0104{#Suladan says yes
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_haruzan.holder = { save_scope_as = haruzan_king }
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0104.t
	desc = ray_story.0104.desc
	override_background = {
		reference = ep2_holy_site_mena
	}
	
	left_portrait = {
		character = root
		animation = idle
	}

	right_portrait = {
		character = scope:haruzan_king
		animation = admiration
	}

	option = {
		name = ray_story.0104.a
		remove_character_flag = mardat_schemes_blocked
		spawn_army = {
			uses_supply = no
			inheritable = yes
			name = haruzan_troops_mardat
			men_at_arms = {
				type = serpent_guard
				stacks = 10
			}
			location = capital_province
		}
		add_piety = 800
		add_prestige = 1000
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -30
		}		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0105{#Suladan POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0105.t
	desc = ray_story.0105.desc
	override_background = {
		reference = ep2_holy_site_mena
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = chancellor
	}

	option = {#yes
		name = ray_story.0105.a
		custom_tooltip = ray_story.0105.a.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0104
				days = 160
				}
		}	
		ai_chance = {
			base = 100
		}
	}

	option = {#no
		name = ray_story.0105.b
		custom_tooltip = ray_story.0105.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0106
				days = 160
				}
		}	
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0106{#Suladan says no
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_haruzan.holder = { save_scope_as = haruzan_king }
	}
	theme = intrigue
	title =	ray_story.0106.t
	desc = ray_story.0106.desc
	override_background = {
		reference = ep2_holy_site_mena
	}
	
	left_portrait = {
		character = root
		animation = anger
	}

	right_portrait = {
		character = scope:haruzan_king
		animation = dismissal
	}

	option = {
		name = ray_story.0106.a
		remove_character_flag = mardat_schemes_blocked
		set_relation_rival = {
            target = scope:haruzan_king
            reason = rival_grave_insult
            involved_character = root
		}
		add_opinion = {
			modifier = angry_opinion
			target = scope:haruzan_king
			opinion = -50
		}
		ai_chance = {
			base = 100
		}
	}
}

### Stormhost Story Branch ###

ray_story.0107{#Leaving for the Stormhost
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
		hidden_effect = { #give free caravan master
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				create_character = {
					template = soldier_friend_character
					employer = root
					gender_female_chance = 25
					save_scope_as = caravan_master
				}
				appoint_court_position = {
					recipient = scope:caravan_master
					court_position = travel_leader_court_position
				}
			}
		}
	}
	theme = intrigue
	title =	ray_story.0107.t
	desc = ray_story.0107.desc
	override_background = {
		reference = black_ship
	}
	
	left_portrait = {
		character = root
		animation = chancellor
	}

	right_portrait = {
		character = scope:stormhost_emperor
		animation = war_defender
	}

	option = {
		name = ray_story.0107.a
		custom_tooltip = ray_story.0107.a.effects
		set_variable = cannot_cancel_travel		
		add_character_flag = { # Make temporarily immune to disease
			flag = immune_to_disease
			years = 1
		}
		add_character_modifier = {	#Make travelling less tedious
			modifier = mardat_travels
			years = 1
		}
		start_travel_plan = { #Travel to Khorsâj
			destination = title:c_khorsaj.title_province
			on_arrival_event = ray_story.0108
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0108{#Dealing with the Stormhost
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
	}
	theme = intrigue
	title =	ray_story.0108.t
	desc = ray_story.0108.desc
	override_background = {
		reference = throne_room_mediterranean
	}
	
	left_portrait = {
		character = root
		animation = bribing
	}

	right_portrait = {
		character = scope:stormhost_emperor
		animation = interested
	}

	option = { #Ally to invade Bellakar
		name = ray_story.0108.a
		custom_tooltip = ray_story.0108.a.effects
		add_character_flag = mardat_stormhost_ally
		if = {
			limit = {
				scope:stormhost_emperor = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:stormhost_emperor	
				85 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					custom_tooltip = ray_story.0108.a.success
					trigger_event = ray_story.0112
				}
				15 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					custom_tooltip = ray_story.0108.a.fail
					trigger_event = ray_story.0113
				}
			}
		}
		else = {
			random_list = {
				90 = { #Fake success
					custom_tooltip = ray_story.0108.a.success
					title:e_thon_an_kharlokh.holder = {
						trigger_event = {
							id = ray_story.0109
						}
					}	
				}
				10 = { #Fake failure
					custom_tooltip = ray_story.0108.a.fail
					title:e_thon_an_kharlokh.holder = {
						trigger_event = {
							id = ray_story.0109
						}
					}	
				}
			}
		}
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		ai_chance = {
			base = 100
		}
	}
	option = { #Become the Stormhost's tributary
		name = ray_story.0108.b
		custom_tooltip = ray_story.0108.b.effects
		add_character_flag = mardat_stormhost_tributary
		add_prestige = -500
		add_stress = 50
		if = {
			limit = {
				scope:stormhost_emperor = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:stormhost_emperor	
				80 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					custom_tooltip = ray_story.0108.a.success
					trigger_event = ray_story.0112
				}
				20 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					custom_tooltip = ray_story.0108.a.fail
					trigger_event = ray_story.0113
				}
			}
		}
		else = {
			random_list = {
				90 = { #Fake success
					custom_tooltip = ray_story.0108.a.success
					title:e_thon_an_kharlokh.holder = {
						trigger_event = {
							id = ray_story.0110
						}
					}	
				}
				10 = { #Fake failure
					custom_tooltip = ray_story.0108.a.fail
					title:e_thon_an_kharlokh.holder = {
						trigger_event = {
							id = ray_story.0110
						}
					}	
				}
			}
		}
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
			}
		ai_chance = {
			base = 0
		}
 	}
	
	option = { #Actually no
		name = ray_story.0108.c
		custom_tooltip = ray_story.0108.c.effects
		# add_character_flag = mardat_stormhost_rejected # Error squash, Zeltron restore when ready
		add_prestige = 500
		title:e_thon_an_kharlokh.holder = {
			trigger_event = {
				id = ray_story.0111
				}
			}
		set_relation_rival = {
            target = scope:stormhost_emperor
            reason = rival_grave_insult
            involved_character = root
		}
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:stormhost_emperor
			opinion = -75
		}
		add_stress = -50
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
			}
		ai_chance = {
			base = 0
		}
	}	
}

ray_story.0109{#Stormhost POV alliance
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0109.t
	desc = ray_story.0109.desc
	override_background = {
		reference = throne_room_mediterranean
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = bribing
	}

	option = {#yes
		name = ray_story.0109.a
		custom_tooltip = ray_story.0109.a.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0112
				}
		}	
		ai_chance = {
			base = 90
		}
	}

	option = {#no
		name = ray_story.0109.b
		custom_tooltip = ray_story.0109.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0113
				}
		}	
		ai_chance = {
			base = 10		
		}
	}
}

ray_story.0110{#Stormhost POV tributary
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0110.t
	desc = ray_story.0110.desc
	override_background = {
		reference = throne_room_mediterranean
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = bribing
	}

	option = {#yes
		name = ray_story.0110.a
		custom_tooltip = ray_story.0110.a.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0112
				}
		}	
		ai_chance = {
			base = 90
		}
	}

	option = {#no
		name = ray_story.0110.b
		custom_tooltip = ray_story.0110.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0113
				}
		}	
		ai_chance = {
			base = 10
		}
	}
}

ray_story.0111{#Stormhost POV Mardat snaps
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0111.t
	desc = ray_story.0111.desc
	override_background = {
		reference = throne_room_mediterranean
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = disapproval
	}

	option = {#What just happened????
		name = ray_story.0111.a
		custom_tooltip = ray_story.0111.a.effects	
		ai_chance = {
			base = 100
		}
	}

}

ray_story.0112{#Stormhost agrees to the terms
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
	}
	theme = intrigue
	title =	ray_story.0112.t
	desc = ray_story.0112.desc
	override_background = {
		reference = throne_room_mediterranean
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:stormhost_emperor
		animation = celebrate_sword
	}

	option = {
		remove_character_flag = mardat_schemes_blocked
		#add_character_flag = stormhost_completion
		add_character_flag = stormhost_support
		name = ray_story.0112.a
		custom_tooltip = ray_story.0112.a.effects
		ai_chance = {
			base = 100
		}
	}

}

ray_story.0113{#Stormhost says no to the terms
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
	}
	theme = intrigue
	title =	ray_story.0113.t
	desc = ray_story.0113.desc
	override_background = {
		reference = throne_room_mediterranean
	}
	
	left_portrait = {
		character = root
		animation = disappointed
	}

	right_portrait = {
		character = scope:stormhost_emperor
		animation = war_defender
	}

	option = {
		name = ray_story.0113.a
		remove_character_flag = mardat_schemes_blocked
		#add_character_flag = stormhost_completion
		remove_character_flag = mardat_stormhost_ally
		remove_character_flag = mardat_stormhost_tributary
		# add_character_flag = mardat_stormhost_rejected # Error squash, Zeltron restore when ready
		set_relation_rival = {
            target = scope:stormhost_emperor
            reason = rival_grave_insult
            involved_character = root
		}
		ai_chance = {
			base = 100
		}
	}
}

### Powan Story Branch ###

ray_story.0114{#Leaving for Powa
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader }
		hidden_effect = { #give free caravan master
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				create_character = {
					template = soldier_friend_character
					employer = root
					save_scope_as = caravan_master
				}
				appoint_court_position = {
					recipient = scope:caravan_master
					court_position = travel_leader_court_position
				}
			}
		}
	}
	theme = intrigue
	title =	ray_story.0114.t
	desc = ray_story.0114.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = chancellor
	}

	right_portrait = {
		character = scope:powan_leader
		animation = idle
	}

	option = {
		name = ray_story.0114.a
		custom_tooltip = ray_story.0114.a.effects
		set_variable = cannot_cancel_travel		
		add_character_flag = { # Make temporarily immune to disease
			flag = immune_to_disease
			years = 1
		}
		add_character_modifier = {	#Make travelling less tedious
			modifier = mardat_travels
			years = 1
		}
		start_travel_plan = { #Travel to Beghom / Fejaraz
			destination = title:c_fejaraz.title_province
			on_arrival_event = ray_story.0115
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0115{#Dealing with the Powans
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader }
	}
	theme = intrigue
	title =	ray_story.0115.t
	desc = ray_story.0115.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = debating
	}

	right_portrait = {
		character = scope:powan_leader
		animation = interested
	}

	option = { #Give trade privileges
		name = ray_story.0115.a
		custom_tooltip = ray_story.0115.a.effects
		add_prestige = -500
		add_character_flag = mardat_powa_trade
		if = {
			limit = {
				scope:powan_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:powan_leader	
				75 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					trigger_event = ray_story.0119
					custom_tooltip = ray_story.0115.a.success
					custom_tooltip = powa_modifiers_later
				}
				25 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					custom_tooltip = ray_story.0115.a.fail
					trigger_event = ray_story.0120
				}
			}
		}
		else = {
			random_list = {
				75 = { #Fake success
					custom_tooltip = ray_story.0115.a.success
					scope:powan_leader = {
						trigger_event = {
							id = ray_story.0116
						}
					}	
				}
				25 = { #Fake failure
					custom_tooltip = ray_story.0115.a.fail
					scope:powan_leader = {
						trigger_event = {
							id = ray_story.0116
						}
					}	
				}
			}
		}
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		ai_chance = {
			base = 45
		}
	}
	option = { #Give lots of gold
		name = ray_story.0115.b
		custom_tooltip = ray_story.0115.b.effects
		add_character_flag = mardat_powa_gold
		if = {
			limit = {
				scope:powan_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:powan_leader	
				75 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					custom_tooltip = ray_story.0115.a.success
					trigger_event = ray_story.0119
				}
				25 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					custom_tooltip = ray_story.0115.a.fail
					trigger_event = ray_story.0120
				}
			}
		}
		else = {
			random_list = {
				75 = { #Fake success
					custom_tooltip = ray_story.0115.a.success
					scope:powan_leader = {
						trigger_event = {
							id = ray_story.0117
						}
					}	
				}
				25 = { #Fake failure
					custom_tooltip = ray_story.0115.a.fail
					scope:powan_leader = {
						trigger_event = {
							id = ray_story.0117
						}
					}	
				}
			}
		}
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
			}
		ai_chance = {
			base = 45
		}
 	}
	
	option = { #Pay in exposure
		name = ray_story.0115.c
		custom_tooltip = ray_story.0115.c.effects
		add_prestige = 500
		add_character_flag = mardat_powa_free
		if = {
			limit = {
				scope:powan_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:powan_leader	
				10 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					custom_tooltip = ray_story.0115.a.success
					trigger_event = ray_story.0119
				}
				90 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					custom_tooltip = ray_story.0115.a.fail
					trigger_event = ray_story.0120
				}
			}
		}
		else = {
			random_list = {
				10 = { #Fake success
					custom_tooltip = ray_story.0115.a.success
					scope:powan_leader = {
						trigger_event = {
							id = ray_story.0118
						}
					}	
				}
				90 = { #Fake failure
					custom_tooltip = ray_story.0115.a.fail
					scope:powan_leader = {
						trigger_event = {
							id = ray_story.0118
						}
					}	
				}
			}
		}
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
			}
		ai_chance = {
			base = 10
		}
	}
	
}

ray_story.0116{#Powan POV trade
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0116.t
	desc = ray_story.0116.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = debating
	}

	option = {#yes
		name = ray_story.0116.a
		custom_tooltip = ray_story.0116.a.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0119
				}
		}	
		ai_chance = {
			base = 75
		}
	}

	option = {#no
		name = ray_story.0116.b
		custom_tooltip = ray_story.0116.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0120
				}
		}	
		ai_chance = {
			base = 25
		}
	}
}

ray_story.0117{#Powan POV gold
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0117.t
	desc = ray_story.0117.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = debating
	}

	option = {#yes
		name = ray_story.0117.a
		custom_tooltip = ray_story.0117.a.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0119
				}
		}	
		ai_chance = {
			base = 75
		}
	}

	option = {#no
		name = ray_story.0117.b
		custom_tooltip = ray_story.0117.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0120
				}
		}	
		ai_chance = {
			base = 25
		}
	}
}

ray_story.0118{#Powan POV Mardat pays in exposure
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0118.t
	desc = ray_story.0118.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = disapproval
	}

	option = {#yes, I can eat exposure
		name = ray_story.0118.a
		custom_tooltip = ray_story.0118.a.effects	
		add_character_flag = mardat_powa_free
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0119
				}
		}	
		ai_chance = {
			base = 10
		}
	}

	option = {#no, I want real money
		name = ray_story.0118.b
		custom_tooltip = ray_story.0118.b.effects	
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0120
				}
		}	
		ai_chance = {
			base = 90
		}
	}

}

ray_story.0119{#Powans yes
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader }
	}
	theme = intrigue
	title =	ray_story.0119.t
	desc = ray_story.0119.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:powan_leader
		animation = celebrate_sword
	}

	option = {
		remove_character_flag = mardat_schemes_blocked
		#add_character_flag = powa_completion
		add_character_flag = powan_support
		name = ray_story.0119.a
		custom_tooltip = ray_story.0119.a.effects
		add_prestige = 200
		ai_chance = {
			base = 100
		}
	}

}

ray_story.0120{#Powans no
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader }
	}
	theme = intrigue
	title =	ray_story.0120.t
	desc = ray_story.0120.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = disappointed
	}

	right_portrait = {
		character = scope:powan_leader
		animation = war_defender
	}

	option = {
		name = ray_story.0120.a
		remove_character_flag = mardat_schemes_blocked
		#add_character_flag = powa_completion
		remove_character_flag = mardat_powa_trade
		remove_character_flag = mardat_powa_gold
		remove_character_flag = mardat_powa_free
		add_prestige = -200
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:powan_leader
			opinion = -50
		}
		ai_chance = {
			base = 100
		}
	}
}

### Nafarati Story Branch ###

ray_story.0121{#Leaving for Delritha 
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_delritha.holder = { save_scope_as = nafarati_leader }
		hidden_effect = { #give free caravan master
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				create_character = {
					template = soldier_friend_character
					employer = root
					save_scope_as = caravan_master
				}
				appoint_court_position = {
					recipient = scope:caravan_master
					court_position = travel_leader_court_position
				}
			}
		}
	}
	theme = intrigue
	title =	ray_story.0121.t
	desc = ray_story.0121.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = chancellor
	}

	right_portrait = {
		character = scope:nafarati_leader
		animation = interested
	}

	option = {
		name = ray_story.0121.a
		custom_tooltip = ray_story.0121.a.effects
		set_variable = cannot_cancel_travel		
		add_character_flag = { # Make temporarily immune to disease
			flag = immune_to_disease
			years = 1
		}
		add_character_modifier = {	#Make travelling less tedious
			modifier = mardat_travels
			years = 1
		}
		start_travel_plan = { #Travel to Junrik
			destination = title:c_junrik.title_province
			on_arrival_event = ray_story.0122
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0122{#Dealing with the Nafarati
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_delritha.holder = { save_scope_as = nafarati_leader }
	}
	theme = intrigue
	title =	ray_story.0122.t
	desc = ray_story.0122.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = bribing
	}

	right_portrait = {
		character = scope:nafarati_leader
		animation = debating
	}

	option = { #Pay in gold
		name = ray_story.0122.a
		custom_tooltip = ray_story.0122.a.effects
		trigger_event = {
				id = ray_story.0124
			}
			
		ai_chance = {
			base = 58
		}
	}
	option = { #Pay in land
		name = ray_story.0122.b
		custom_tooltip = ray_story.0122.b.effects
		trigger_event = {
				id = ray_story.0128
			}
		ai_chance = {
			base = 40
		}
 	}
	
	option = { #Pay nothing
		name = ray_story.0122.c
		custom_tooltip = ray_story.0122.c.effects
		add_character_flag = mardat_nafarati_free
		if = {
			limit = {
				scope:nafarati_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:nafarati_leader	
				10 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0122.a.success
				}
				90 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					custom_tooltip = ray_story.0122.a.fail
					trigger_event = ray_story.0132
				}
			}
		}
		else = {
			random_list = {
				10 = { #Fake success
					custom_tooltip = ray_story.0122.a.success
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0123
						}
					}	
				}
				90 = { #Fake failure
					custom_tooltip = ray_story.0122.a.fail
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0123
						}
					}	
				}
			}
		}
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
			}
		ai_chance = {
			base = 2
		}
	}
	
}

ray_story.0123{#Nafarati POV Mardat pays nothing
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0123.t
	desc = ray_story.0123.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = disapproval
	}

	right_portrait = {
		character = scope:mardat
		animation = interested
	}

	option = {#yes
		name = ray_story.0123.a
		custom_tooltip = ray_story.0123.a.effects	
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0131
				}
		}	
		ai_chance = {
			base = 10
		}
	}

	option = {#no
		name = ray_story.0123.b
		custom_tooltip = ray_story.0123.b.effects	
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0132
				}
		}	
		ai_chance = {
			base = 90
		}
	}

}

ray_story.0124{#Mardat pays gold choice
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_delritha.holder = { save_scope_as = nafarati_leader }
	}
	theme = intrigue
	title =	ray_story.0124.t
	desc = ray_story.0124.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = bribing
	}

	right_portrait = {
		character = scope:nafarati_leader
		animation = debating
	}

	option = { #1k gold
		name = ray_story.0124.a
		custom_tooltip = ray_story.0124.a.effects
		add_character_flag = mardat_nafarati_1k
		if = {
			limit = {
				scope:nafarati_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:nafarati_leader	
				70 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0124.a.success
				}
				30 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					custom_tooltip = ray_story.0124.a.fail
					trigger_event = ray_story.0132
				}
			}
		}
		else = {
			random_list = {
				70 = { #Fake success
					custom_tooltip = ray_story.0124.a.success
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0125
						}
					}	
				}
				30 = { #Fake failure
					custom_tooltip = ray_story.0124.a.fail
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0125
						}
					}	
				}
			}
		}			
		ai_chance = {
			base = 40
		}
	}
	option = { #2k gold
		name = ray_story.0124.b
		custom_tooltip = ray_story.0124.b.effects
		add_character_flag = mardat_nafarati_2k
		if = {
			limit = {
				scope:nafarati_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:nafarati_leader	
				35 = { # success crit
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2
						min = -29
					}
					spawn_army = {
						uses_supply = no
						inheritable = yes
						name = nafarati_troops_mardat
						men_at_arms = {
							type = mahud_headhunters
							stacks = 10
						}
						men_at_arms = {
							type =  nafarati_marauders
							stacks = 10
						}
						levies = 1000
						location = capital_province
					}					
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0124.b.success.crit
				}				
				60 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = -29
					}						
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0124.b.success
				}
				5 = { # failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = -29
					}						
					custom_tooltip = ray_story.0124.b.fail
					trigger_event = ray_story.0132
				}
			}
		}
		else = {
			random_list = {
				35 = { #Fake success crit
					custom_tooltip = ray_story.0124.b.success.crit
					show_as_tooltip = {
						spawn_army = {
							uses_supply = no
							inheritable = yes
							name = nafarati_troops_mardat
							men_at_arms = {
								type = mahud_headhunters
								stacks = 10
							}
							men_at_arms = {
								type =  nafarati_marauders
								stacks = 10
							}
							levies = 1000
							location = capital_province
						}
					}
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0125
						}
					}	
				}				
				60 = { #Fake success
					custom_tooltip = ray_story.0124.b.success
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0126
						}
					}	
				}
				5 = { #Fake failure
					custom_tooltip = ray_story.0124.b.fail
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0126
						}
					}	
				}
			}
		}
		ai_chance = {
			base = 60
		}
 	}
	
	option = { #3k gold
		name = ray_story.0124.c
		custom_tooltip = ray_story.0124.c.effects
		add_character_flag = mardat_nafarati_3k
		if = {
			limit = {
				scope:nafarati_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:nafarati_leader	
				80 = { # success crit
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2
						min = -29
					}
					spawn_army = {
						uses_supply = no
						inheritable = yes
						name = nafarati_troops_mardat
						men_at_arms = {
							type = mahud_headhunters
							stacks = 10
						}
						men_at_arms = {
							type =  nafarati_marauders
							stacks = 10
						}
						levies = 1000
						location = capital_province
					}					
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0124.b.success.crit
				}				
				20 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = -29
					}						
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0124.b.success
				}
				0 = { # failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = -29
					}						
					custom_tooltip = ray_story.0124.b.fail
					trigger_event = ray_story.0132
				}
			}
		}
		else = {
			random_list = {
				80 = { #Fake success crit
					custom_tooltip = ray_story.0124.c.success.crit
					show_as_tooltip = {
						spawn_army = {
							uses_supply = no
							inheritable = yes
							name = nafarati_troops_mardat
							men_at_arms = {
								type = mahud_headhunters
								stacks = 10
							}
							men_at_arms = {
								type =  nafarati_marauders
								stacks = 10
							}
							levies = 1000
							location = capital_province
						}
					}
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0125
						}
					}	
				}				
				20 = { #Fake success
					custom_tooltip = ray_story.0124.c.success
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0127
						}
					}	
				}
				0 = { #Fake failure
					custom_tooltip = ray_story.0124.c.fail
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0127
						}
					}	
				}
			}
		}
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
			}
		ai_chance = {
			base = 0
		}
	}

	option = { #Go back
		name = ray_story.0124.d
		custom_tooltip = ray_story.0124.d.effects
		trigger_event = {
			id = ray_story.0122
			}
		ai_chance = {
			base = 0
		}
	}
	
}

ray_story.0125{ #Nafarati POV 1k gold
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0125.t
	desc = ray_story.0125.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = debating
	}

	option = {#yes
		name = ray_story.0125.a
		custom_tooltip = ray_story.0125.a.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0131
			}
		}	
		ai_chance = {
			base = 70
		}
	}

	option = {#no
		name = ray_story.0125.b
		custom_tooltip = ray_story.0125.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0132
				}
		}	
		ai_chance = {
			base = 30
		}
	}
}

ray_story.0126{ #Nafarati POV 2k gold
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0126.t
	desc = ray_story.0126.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = debating
	}

	option = {#yes + MaA
		name = ray_story.0126.a
		custom_tooltip = ray_story.0126.a.effects
		title:d_suza_riy.holder = {
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = nafarati_troops_mardat
				men_at_arms = {
					type = mahud_headhunters
					stacks = 10
				}
				men_at_arms = {
					type =  nafarati_marauders
					stacks = 10
				}
				levies = 1000
				location = capital_province
			}
			trigger_event = {
				id = ray_story.0131
			}
		}	
		ai_chance = {
			base = 35
		}
	}
	
	option = {#yes
		name = ray_story.0126.b
		custom_tooltip = ray_story.0126.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0131
			}
		}	
		ai_chance = {
			base = 60
		}
	}

	option = {#no
		name = ray_story.0126.c
		custom_tooltip = ray_story.0126.c.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0132
			}
		}	
		ai_chance = {
			base = 5
		}
	}
}

ray_story.0127{ #Nafarati POV 3k gold
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0127.t
	desc = ray_story.0127.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = debating
	}

	option = {#yes + MaA
		name = ray_story.0127.a
		custom_tooltip = ray_story.0127.a.effects
		title:d_suza_riy.holder = {
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = nafarati_troops_mardat
				men_at_arms = {
					type = mahud_headhunters
					stacks = 10
				}
				men_at_arms = {
					type =  nafarati_marauders
					stacks = 10
				}
				levies = 1000
				location = capital_province
			}
			trigger_event = {
				id = ray_story.0131
				}
		}	
		ai_chance = {
			base = 80
		}
	}
	
	option = {#yes
		name = ray_story.0127.b
		custom_tooltip = ray_story.0127.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0131
				}
		}	
		ai_chance = {
			base = 20
		}
	}

	option = {#no
		name = ray_story.0127.c
		custom_tooltip = ray_story.0127.c.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0132
				}
		}	
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0128{#Mardat pays military choice
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_delritha.holder = { save_scope_as = nafarati_leader }
	}
	theme = intrigue
	title =	ray_story.0128.t
	desc = ray_story.0128.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = debating
	}

	right_portrait = {
		character = scope:nafarati_leader
		animation = debating
	}

	option = { # 1 duchy
		name = ray_story.0128.a
		custom_tooltip = ray_story.0128.a.effects
		add_character_flag = mardat_nafarati_duchy
		if = {
			limit = {
				scope:nafarati_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:nafarati_leader					
				80 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = -29
					}						
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0128.a.success
				}
				20 = { # failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = -29
					}						
					custom_tooltip = ray_story.0128.a.fail
					trigger_event = ray_story.0132
				}
			}
		}
		else = {
			random_list = {				
				80 = { #Fake success
					custom_tooltip = ray_story.0124.b.success
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0129
						}
					}	
				}
				20 = { #Fake failure
					custom_tooltip = ray_story.0124.b.fail
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0129
						}
					}	
				}
			}
		}
		ai_chance = {
			base = 60
		}
	}
	option = { # Chennacatt
		name = ray_story.0128.b
		custom_tooltip = ray_story.0128.b.effects
		add_character_flag = mardat_nafarati_kingdom
		if = {
			limit = {
				scope:nafarati_leader = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:nafarati_leader	
				35 = { # success crit
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2
						min = -29
					}
					spawn_army = {
						uses_supply = no
						inheritable = yes
						name = nafarati_troops_mardat
						men_at_arms = {
							type = mahud_headhunters
							stacks = 10
						}
						men_at_arms = {
							type =  nafarati_marauders
							stacks = 10
						}
						levies = 1000
						location = capital_province
					}					
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0128.b.success.crit
				}				
				60 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = -29
					}						
					trigger_event = ray_story.0131
					custom_tooltip = ray_story.0128.b.success
				}
				5 = { # failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = -29
					}						
					custom_tooltip = ray_story.0128.b.fail
					trigger_event = ray_story.0132
				}
			}
		}
		else = {
			random_list = {
				35 = { #Fake success crit
					custom_tooltip = ray_story.0128.b.success.crit
					show_as_tooltip = {
						spawn_army = {
							uses_supply = no
							inheritable = yes
							name = nafarati_troops_mardat
							men_at_arms = {
								type = mahud_headhunters
								stacks = 10
							}
							men_at_arms = {
								type =  nafarati_marauders
								stacks = 10
							}
							levies = 1000
							location = capital_province
						}
					}
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0125
						}
					}	
				}				
				60 = { #Fake success
					custom_tooltip = ray_story.0128.b.success
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0130
						}
					}	
				}
				5 = { #Fake failure
					custom_tooltip = ray_story.0128.b.fail
					scope:nafarati_leader = {
						trigger_event = {
							id = ray_story.0130
						}
					}	
				}
			}
		}
		ai_chance = {
			base = 40
		}
 	}	

	option = { #Go back
		name = ray_story.0128.c
		custom_tooltip = ray_story.0128.c.effects
		trigger_event = {
			id = ray_story.0122
			}
		ai_chance = {
			base = 0
		}
	}
	
}

ray_story.0129{ #Nafarati POV duchy
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0129.t
	desc = ray_story.0129.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = debating
	}

	option = {#yes
		name = ray_story.0129.a
		custom_tooltip = ray_story.0129.a.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0131
				}
		}	
		ai_chance = {
			base = 80
		}
	}

	option = {#no
		name = ray_story.0129.b
		custom_tooltip = ray_story.0129.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0132
				}
		}	
		ai_chance = {
			base = 20
		}
	}
}

ray_story.0130{ #Nafarati POV Chennacatt
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0130.t
	desc = ray_story.0130.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = interested
	}

	right_portrait = {
		character = scope:mardat
		animation = debating
	}

	option = {#yes + MaA
		name = ray_story.0130.a
		custom_tooltip = ray_story.0130.a.effects
		title:d_suza_riy.holder = {
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = nafarati_troops_mardat
				men_at_arms = {
					type = mahud_headhunters
					stacks = 10
				}
				men_at_arms = {
					type =  nafarati_marauders
					stacks = 10
				}
				levies = 1000
				location = capital_province
			}
			trigger_event = {
				id = ray_story.0131
				}
		}	
		ai_chance = {
			base = 35
		}
	}
	
	option = {#yes
		name = ray_story.0130.b
		custom_tooltip = ray_story.0130.b.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0131
				}
		}	
		ai_chance = {
			base = 60
		}
	}

	option = {#no
		name = ray_story.0130.c
		custom_tooltip = ray_story.0130.c.effects
		title:d_suza_riy.holder = {
			trigger_event = {
				id = ray_story.0132
				}
		}	
		ai_chance = {
			base = 5
		}
	}
}

ray_story.0131{#Nafarati yes
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_delritha.holder = { save_scope_as = nafarati_leader }
	}
	theme = intrigue
	title =	ray_story.0131.t
	desc = ray_story.0131.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:nafarati_leader
		animation = celebrate_sword
	}

	option = {
		remove_character_flag = mardat_schemes_blocked
		#add_character_flag = nafarati_completion
		add_character_flag = nafarati_support
		name = ray_story.0131.a
		add_prestige = 200
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		ai_chance = {
			base = 100
		}
	}

}

ray_story.0132{#Nafarati no
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_delritha.holder = { save_scope_as = nafarati_leader }
	}
	theme = intrigue
	title =	ray_story.0132.t
	desc = ray_story.0132.desc
	override_background = {
		reference = harad_drylands	
	}
	
	left_portrait = {
		character = root
		animation = disappointed
	}

	right_portrait = {
		character = scope:nafarati_leader
		animation = war_defender
	}

	option = {
		name = ray_story.0132.a
		start_travel_plan = { #Return home
			destination = title:c_suza_riy.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		remove_character_flag = mardat_schemes_blocked
		#add_character_flag = nafarati_completion
		remove_character_flag = mardat_nafarati_free
		remove_character_flag = mardat_nafarati_1k
		remove_character_flag = mardat_nafarati_2k
		remove_character_flag = mardat_nafarati_3k
		remove_character_flag = mardat_nafarati_duchy
		remove_character_flag = mardat_nafarati_kingdom
		add_prestige = -200
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:nafarati_leader
			opinion = -50
		}
		ai_chance = {
			base = 100
		}
	}
}

### Intrigue Branch ###

ray_story.0133{#Mardat spies event
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0133.t
	desc = ray_story.0133.desc
	override_background = {
		reference = fp3_courtyard_night
	}
	
	left_portrait = {
		character = root
		animation = scheme
	}

	right_portrait = {
		character = scope:ray_king
		animation = paranoia
	}

	option = { # Quick infiltration
		name = ray_story.0133.a
		custom_tooltip = ray_story.0133.a.effects
		duel = {
			skill = intrigue
			value = high_skill_rating
			70 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0133.a.success
				trigger_event = {
					id = ray_story.0134
					days = 180
				}
					
			}
			30 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				desc = ray_story.0133.a.failure
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0135
						days = 300
					}
				}

			}
		}
		ai_chance = {
			base = 20
		}
	}
	
	option = { # Slow infiltration
		name = ray_story.0133.b
		custom_tooltip = ray_story.0133.b.effects
		duel = {
			skill = intrigue
			value = high_skill_rating
			99 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 0
					 min = -29
				}
				desc = ray_story.0133.b.success
				trigger_event = {
					id = ray_story.0134
					days = 1080
				}
					
			}
			1 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0
					min = -49
				}
				desc = ray_story.0133.b.failure
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0135
						days = 500
					}
				}

			}
		}

		ai_chance = {
			base = 80
		}
 	}	
}

ray_story.0134{#Mardat spies success
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0134.t
	desc = ray_story.0134.desc
	override_background = {
		reference = fp3_courtyard_night
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:ray_king
		animation = idle
	}

	option = {
		name = ray_story.0134.a
		custom_tooltip = ray_story.0134.a.effects
		add_character_flag = mardat_capital_spies
		remove_character_flag = mardat_schemes_blocked
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0135{#Mardat spies failure Ray POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		add_character_flag = vatalinar_discovered_mardat
	}
	theme = intrigue
	title =	ray_story.0135.t
	desc = ray_story.0135.desc
	override_background = {
		reference = fp3_courtyard_night
	}
	
	left_portrait = {
		character = root
		animation = stunned
	}

	right_portrait = {
		character = scope:mardat
		animation = personality_dishonorable
	}

	option = {
		name = ray_story.0135.a
		custom_tooltip = ray_story.0135.a.effects
		scope:mardat = {
			trigger_event = ray_story.0162
		}
		trigger_event = {
			id = ray_story.0420
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0135.b
		custom_tooltip = ray_story.0135.b.effects
		scope:mardat = {
			trigger_event = ray_story.0162
		}
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0162{#Mardat spies fail (don't mind the weird ID, I had forgotten about this one until way later)
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0162.t
	desc = ray_story.0162.desc
	override_background = {
		reference = fp3_courtyard_night
	}
	
	left_portrait = {
		character = root
		animation = stunned
	}

	right_portrait = {
		character = scope:ray_king
		animation = idle
	}

	option = {
		name = ray_story.0162.a
		custom_tooltip = ray_story.0162.a.effects
		remove_character_flag = mardat_schemes_blocked
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0136{#Mardat deals with the guard
	content_source = realms_dlc
	type = character_event
	immediate = {
		debug_log = "Mardat: Capital Guard Leader"
		create_character = {
			name = Pravak
			gender = male
			age = 29
			culture = culture:bozishnarud
			faith = faith:faith_vatra
			trait = ambitious
			trait = cynical
			trait = brave
			trait = education_martial_3
			trait = disloyal
			trait = logistician
			trait = strong
			location = capital_province
			
			save_scope_as = guard_leader
		}
	}
	theme = intrigue
	title =	ray_story.0136.t
	desc = ray_story.0136.desc
	override_background = {
		reference = corridor_night
	}
	
	left_portrait = {
		character = root
		animation = bribing
	}

	right_portrait = {
		character = scope:guard_leader
		animation = debating
	}

	
	option = { # Gold
		name = ray_story.0136.a
		custom_tooltip = ray_story.0136.a.effects
		duel = {
			skill = intrigue
			target = scope:guard_leader
			70 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0136.a.success
				pay_short_term_gold = {
					gold = 1000
					target = scope:guard_leader
				}	
				trigger_event = {
					id = ray_story.0137
					days = 180
				}
					
			}
			30 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				desc = ray_story.0136.a.failure
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0135
						days = 10
					}
				}

			}
		}
		ai_chance = {
			base = 30
		}
	}
	option = { # Titles
		name = ray_story.0136.b
		custom_tooltip = ray_story.0136.b.effects
		duel = {
			skill = diplomacy
			target = scope:guard_leader
			85 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0136.b.success
				add_character_flag = mardat_guard_land
				trigger_event = {
					id = ray_story.0137
					days = 180
				}
					
			}
			15 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				remove_character_flag = mardat_guard_land
				desc = ray_story.0136.b.failure
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0135
						days = 10
					}
				}

			}
		}
		ai_chance = {
			base = 30
		}
 	}	

	option = { # Conversion
		name = ray_story.0136.c
		custom_tooltip = ray_story.0136.c.effects
		duel = {
			skill = learning
			target = scope:guard_leader
			50 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0136.c.success
				add_character_flag = mardat_guard_conversion
				scope:guard_leader = {
					set_character_faith_with_conversion = faith:faith_haruze
				}
				trigger_event = {
					id = ray_story.0137
					days = 180
				}
					
			}
			50 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				remove_character_flag = mardat_guard_conversion
				desc = ray_story.0136.c.failure
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0135
						days = 10
					}
				}

			}
		}
		ai_chance = {
			base = 40
		}
	}
	
}

ray_story.0137{#Mardat guard success
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0137.t
	desc = ray_story.0137.desc
	override_background = {
		reference = corridor_night
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:guard_leader
		animation = scheme
	}

	option = { 
		name = ray_story.0137.a
		custom_tooltip = ray_story.0137.a.effects
		add_character_flag = mardat_guard
		remove_character_flag = mardat_schemes_blocked
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0138{#Mardat robs merchants
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0138.t
	desc = ray_story.0138.desc
	override_background = {
		reference = wilderness_jungle
	}
	
	left_portrait = {
		character = root
		animation = scheme
	}

	right_portrait = {
		character = scope:ray_king
		animation = idle
	}

	
	option = {#Robbing merchants
		name = ray_story.0138.a
		custom_tooltip = ray_story.0138.a.effects
		duel = {
			skill = intrigue
			value = high_skill_rating
			80 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 0.5
					 min = -29
				}
				desc = ray_story.0138.a.success
				trigger_event = {
					id = ray_story.0139
					days = 80
				}
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0142
						days = 80
					}
				}	
			}
			20 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -0.5
					min = -49
				}
				desc = ray_story.0138.a.failure
				scope:ray_king = {
					trigger_event = {
						id = ray_story.0141
						days = 80
					}					
				}
			}
		}
		ai_chance = {
			base = 100
		}
	}

	option = {#No actually
		name = ray_story.0138.b
		custom_tooltip = ray_story.0138.b.effects
		remove_character_flag = mardat_schemes_blocked
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0139{#Mardat rob success
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0139.t
	desc = ray_story.0139.desc
	override_background = {
		reference = wilderness_jungle
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:ray_king
		animation = anger
	}

	option = { 
		name = ray_story.0139.a
		custom_tooltip = ray_story.0139.a.effects
		remove_character_flag = mardat_schemes_blocked
		add_character_modifier = {
			modifier = mardat_rob_merchants
			years = 5
		}
		add_gold = 1000
		add_prestige = -500
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0140{#Mardat rob fail
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
		add_character_flag = mardat_discovered_rob
	}
	theme = intrigue
	title =	ray_story.0140.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = rob_merchants_pay_option
				}
				desc = ray_story.0140.pay_option
			}
			triggered_desc = {
				trigger = {
					NOT = { has_character_flag = rob_merchants_pay_option }
				}
				desc = ray_story.0140.forced_rebellion
			}						
		}				
	}
	override_background = {
		reference = wilderness_jungle
	}
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:ray_king
		animation = anger
	}

	option = {#Give in
		name = ray_story.0140.a
		trigger = {
			has_character_flag = rob_merchants_pay_option			
		}
		custom_tooltip = ray_story.0140.a.effects
		add_prestige = -2500
		add_prestige_level = -1
		pay_short_term_gold = {
			gold = 2000
			target = scope:ray_king
		}
		remove_character_flag = mardat_schemes_blocked
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -75
		}
		ai_chance = {
			base = 60
		}
	}

	option = {#Rebel
		name = ray_story.0140.b
		custom_tooltip = ray_story.0140.b.effects
		add_prestige = -500
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -100
		}
		remove_character_flag = mardat_schemes_blocked
		scope:ray_king = {
			trigger_event = ray_story.0420
		}
		ai_chance = {
			base = 40
		}
	}
}

ray_story.0141{#Mardat rob fail Ray POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0141.t
	desc = ray_story.0141.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = disapproval
	}

	right_portrait = {
		character = scope:mardat
		animation = personality_dishonorable
	}

	option = { 
		name = ray_story.0141.a
		custom_tooltip = ray_story.0141.a.effects
		random_list = {
			60 = {
				custom_tooltip = ray_story.0141.a.success
				show_as_tooltip = {
					scope:mardat = {
						pay_short_term_gold = {
							gold = 2000
							target = root
						}
					}
				}				
			}
			40 = {
				custom_tooltip = ray_story.0141.a.fail
			}
		}
		scope:mardat = {
			add_character_flag = rob_merchants_pay_option
			trigger_event = ray_story.0140
		}
		ai_chance = {
			base = 100
		}
	}

	option = { 
		name = ray_story.0141.b
		custom_tooltip = ray_story.0141.b.effects
		add_character_flag = vatalinar_discovered_mardat
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0142{#Mardat rob success Ray POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0142.t
	desc = ray_story.0142.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = anger
	}

	right_portrait = {
		character = scope:mardat
		animation = idle
	}

	option = { 
		name = ray_story.0142.a
		custom_tooltip = ray_story.0142.a.effects
		add_prestige = -500
		add_character_modifier = {
			modifier = ray_robbed_merchants
			years = 5
		}
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0143{#Mardat converts capital
	content_source = realms_dlc
	type = character_event
	immediate = {
		debug_log = "Mardat: Preacher"
		create_character = {
			name = Akuba_a_r
			gender = male
			age = 56
			culture = culture:bozishnarud
			faith = faith:faith_haruze
			trait = stubborn
			trait = zealous
			trait = brave
			trait = education_learning_4
			trait = loyal
			trait = theologian
			location = capital_province
			save_scope_as = preacher
		}
	}
	theme = intrigue
	title =	ray_story.0143.t
	desc = ray_story.0143.desc
	override_background = {
		reference = corridor_night
	}
	
	left_portrait = {
		character = root
		animation = scheme
	}

	right_portrait = {
		character = scope:preacher
		animation = prayer
	}

	
	option = { # fair debate
		name = ray_story.0143.a
		custom_tooltip = ray_story.0143.a.effects
		duel = {
			skill = learning
			value = high_skill_rating
			5 = { # Succeed crit
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 2
					 min = -29
				}
				desc = ray_story.0143.a.success_crit
				add_character_flag = mardat_capital_conversion
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0146
						days = 180
					}
				}
				trigger_event = {
					id = ray_story.0144
					days = 180
				}
					
			}
			
			25 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0143.a.success
				add_character_flag = mardat_capital_conversion
				trigger_event = {
					id = ray_story.0144
					days = 180
				}
					
			}
			70 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				remove_character_flag = mardat_capital_conversion
				desc = ray_story.0143.a.failure
				trigger_event = {
					id = ray_story.0145
					days = 180
					}
			}
		}
		ai_chance = {
			base = 30
		}
	}
	option = { # gold
		name = ray_story.0143.b
		custom_tooltip = ray_story.0143.b.effects
		remove_short_term_gold = 800
		duel = {
			skill = intrigue
			value = high_skill_rating
			15 = { # Succeed crit
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 2
					 min = -29
				}
				desc = ray_story.0143.b.success_crit
				add_character_flag = mardat_capital_conversion
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0146
						days = 180
					}
				}
				trigger_event = {
					id = ray_story.0144
					days = 180
				}
					
			}
			
			70 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0143.b.success
				add_character_flag = mardat_capital_conversion
				trigger_event = {
					id = ray_story.0144
					days = 180
				}
					
			}
			15 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				remove_character_flag = mardat_capital_conversion
				desc = ray_story.0143.b.failure
				trigger_event = {
					id = ray_story.0145
					days = 180
				}
				}
		}
		
		ai_chance = {
			base = 30
		}
 	}	

	option = { # terror
		name = ray_story.0143.c
		custom_tooltip = ray_story.0143.c.effects
		duel = {
			skill = intrigue
			value = high_skill_rating
			70 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 0.5
					 min = -29
				}
				desc = ray_story.0143.c.success
				add_character_flag = mardat_capital_conversion
				trigger_event = {
					id = ray_story.0137
					days = 180
				}
					
			}
			20 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -0.5
					min = -49
				}
				remove_character_flag = mardat_capital_conversion
				desc = ray_story.0143.c.failure
				trigger_event = {
					id = ray_story.0145
					days = 180
				}
			}

			10 = { # Fail crit
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				remove_character_flag = mardat_capital_conversion
				#add_character_flag = mardat_conversion_crit_fail  #To avoid an error since its not used yet
				desc = ray_story.0143.c.failure_crit
				title:k_ray.holder = {
					trigger_event = {
						id = ray_story.0147
						days = 180
					}
				}
				trigger_event = {
					id = ray_story.0148
					days = 180
				}
			}
		}
		ai_chance = {
			base = 40
		}
	}
	
}

ray_story.0144{#Mardat conversion success
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0144.t
	desc = ray_story.0144.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:ray_king
		animation = anger
	}

	option = { 
		name = ray_story.0144.a
		remove_character_flag = mardat_schemes_blocked
		custom_tooltip = ray_story.0144.a.effects
		add_piety = 500
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0145{#Mardat conversion fail
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0145.t
	desc = ray_story.0145.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:ray_king
		animation = idle
	}

	option = { 
		name = ray_story.0145.a
		remove_character_flag = mardat_schemes_blocked
		custom_tooltip = ray_story.0145.a.effects
		add_piety = -100
		add_prestige = -100
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0146{#Mardat conversion crit success Ray POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		title:c_bozisha_dar = {
			set_county_faith = faith:faith_haruze
		}
	}
	theme = intrigue
	title =	ray_story.0146.t
	desc = ray_story.0146.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:mardat
		animation = prayer
	}

	option = { 
		name = ray_story.0146.a
		add_piety = -500
		add_prestige = -200
		add_opinion = {
			modifier = angry_opinion
			target = scope:mardat
			opinion = -40
		}
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0147{#Mardat conversion crit fail Ray POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		title:c_bozisha_dar = {
			set_county_faith = faith:faith_haruze
		}
	}
	theme = intrigue
	title =	ray_story.0147.t
	desc = ray_story.0147.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = anger
	}

	right_portrait = {
		character = scope:mardat
		animation = scheme
	}

	option = { 
		name = ray_story.0147.a
		custom_tooltip = ray_story.0147.a.effects
		add_character_flag = vatalinar_discovered_mardat
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0148{#Mardat conversion crit fail
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0148.t
	desc = ray_story.0148.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:ray_king
		animation = anger
	}

	option = { 
		name = ray_story.0148.a
		remove_character_flag = mardat_schemes_blocked
		custom_tooltip = ray_story.0148.a.effects
		add_piety = -100
		add_prestige = -500
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -50
		}
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0149{#Mardat gets a fleet
	content_source = realms_dlc
	type = character_event
	immediate = {
	debug_log = "Mardat: Captain"
		create_character = {
			name = Trayze_e_n
			gender = male
			age = 32
			culture = culture:bozishnarud
			faith = faith:faith_vatra
			trait = greedy
			trait = lustful
			trait = ambitious
			trait = education_martial_2
			trait = lifestyle_mariner
			location = capital_province
			save_scope_as = captain
		}
	}
	theme = intrigue
	title =	ray_story.0149.t
	desc = ray_story.0149.desc
	override_background = {
		reference = black_ship
	}
	
	left_portrait = {
		character = root
		animation = bribing
	}

	right_portrait = {
		character = scope:captain
		animation = toast_goblet
	}

	
	option = { # Blackmail
		name = ray_story.0149.a
		custom_tooltip = ray_story.0149.a.effects
		duel = {
			skill = intrigue
			target = scope:captain
			75 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0149.a.success
				add_character_flag = mardat_navy
				trigger_event = {
					id = ray_story.0150
					days = 180
				}
					
			}
			25 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				remove_character_flag = mardat_navy
				desc = ray_story.0149.a.failure
				trigger_event = {
					id = ray_story.0151
					days = 180
					}
			}
		}
		ai_chance = {
			base = 40
		}
	}
	option = { # Bribe
		name = ray_story.0149.b
		custom_tooltip = ray_story.01439.b.effects
		remove_short_term_gold = 300
		duel = {
			skill = intrigue
			target = scope:captain			
			90 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 2
					 min = -29
				}
				desc = ray_story.0149.b.success
				add_character_flag = mardat_navy
				trigger_event = {
					id = ray_story.0150
					days = 180
				}
					
			}
			10 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -0.5
					min = -49
				}
				remove_character_flag = mardat_navy
				desc = ray_story.0149.b.failure
				trigger_event = {
					id = ray_story.0151
					days = 180
				}
			}
		}
		
		ai_chance = {
			base = 50
		}
 	}	

	option = { # Convince
		name = ray_story.0149.c
		custom_tooltip = ray_story.0149.c.effects
		duel = {
			skill = diplomacy
			target = scope:captain
			30 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}
				desc = ray_story.0149.c.success
				add_character_flag = mardat_navy
				trigger_event = {
					id = ray_story.0150
					days = 180
				}
					
			}
			70 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -49
				}
				remove_character_flag = mardat_navy
				desc = ray_story.0149.c.failure
				trigger_event = {
					id = ray_story.0151
					days = 180
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}
	
}

ray_story.0150{#Mardat navy success
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0150.t
	desc = ray_story.0150.desc
	override_background = {
		reference = black_ship
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:captain
		animation = celebrate_sword
	}

	option = { 
		name = ray_story.0150.a
		custom_tooltip = ray_story.0150.a.effects
		remove_character_flag = mardat_schemes_blocked
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0151{#Mardat navy fail
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	theme = intrigue
	title =	ray_story.0151.t
	desc = ray_story.0151.desc
	override_background = {
		reference = black_ship
	}
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:ray_king
		animation = anger
	}

	option = { 
		name = ray_story.0151.a
		custom_tooltip = ray_story.0151.a.effects
		remove_character_flag = mardat_schemes_blocked
		add_prestige = -200
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -20
		}
		title:k_ray.holder = {
			trigger_event = {
				id = ray_story.0152
				}
		}
		ai_chance = {
			base = 100
		}
	}
	
}

ray_story.0152{#Mardat navy fail Ray POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	theme = intrigue
	title =	ray_story.0152.t
	desc = ray_story.0152.desc
	override_background = {
		reference = black_ship
	}
	
	left_portrait = {
		character = root
		animation = anger
	}

	right_portrait = {
		character = scope:mardat
		animation = scheme
	}

	option = { 		
		name = ray_story.0152.a
		add_character_flag = vatalinar_discovered_mardat
		custom_tooltip = ray_story.0152.a.effects
		ai_chance = {
			base = 100
		}
	}
}

### Civil War Events ###

ray_story.0153{#Mardat start of the civil war
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	title =	ray_story.0153.t
	desc = ray_story.0153.desc
	override_background = {
		reference = ep3_military_tent
	}
	
	left_portrait = {
		character = root
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:ray_king
		animation = anger
	}

	option = { 
		name = ray_story.0153.a
		set_relation_rival = {
            target = scope:ray_king
            reason = rival_claimed_my_title
            involved_character = root
		}
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -100
		}
		title:k_ray.holder = {
			trigger_event = {
				id = ray_story.0154
				}
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0154{#Start of the civil war Rây POV
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	title =	ray_story.0154.t
	desc = ray_story.0154.desc
	theme = war
	override_background = {
		reference = ep3_military_tent
	}
	
	left_portrait = {
		character = root
		animation = anger
	}

	right_portrait = {
		character = scope:mardat
		animation = celebrate_sword
	}

	option = { 
		name = ray_story.0154.a
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0155 = { # Stormhost joins the war
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0155.t
	desc =  ray_story.0155.desc
	theme = war
	override_background = {
		reference = ep3_military_tent
	}
	left_portrait = {
		character = scope:attacker
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:defender
		animation = anger
	}

	lower_center_portrait = root

	trigger = {
		scope:attacker = {
			any_character_war = {
				primary_defender = title:k_ray.holder
			}
		}
	}

	option = {
		name = ray_story.0155.a
		custom_tooltip = ray_story.0155.a.effects
		scope:war = {
			add_attacker = root
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0156 = { # Nafarati join the war
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0156.t
	desc =  ray_story.0156.desc
	theme = war
	override_background = {
		reference = ep3_military_tent
	}
	left_portrait = {
		character = scope:attacker
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:defender
		animation = anger
	}

	lower_center_portrait = root

	trigger = {
		scope:attacker = {
			any_character_war = {
				primary_defender = title:k_ray.holder
			}
		}
	}

	option = {
		name = ray_story.0156.a
		custom_tooltip = ray_story.0156.a.effects
		scope:war = {
			add_attacker = root
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0157 = { # Powans join the war
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0157.t
	desc =  ray_story.0157.desc
	theme = war
	override_background = {
		reference = ep3_military_tent
	}
	left_portrait = {
		character = scope:attacker
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:defender
		animation = anger
	}

	lower_center_portrait = root

	trigger = {
		scope:attacker = {
			any_character_war = {
				primary_defender = title:k_ray.holder
			}
		}
	}

	option = {
		name = ray_story.0157.a
		custom_tooltip = ray_story.0157.a.effects
		scope:war = {
			add_attacker = root
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0158 = {#Mardat wins the civil war
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:d_dar.holder = { save_scope_as = ray_king_lost }
		title:d_iunastiy.holder = { save_scope_as = revolutionary }	
		hidden_effect = {
			scope:ray_king_lost = {				
				get_title = title:e_bozisha_miraz
				create_title_and_vassal_change = {
					type = usurped
					save_scope_as = title_change
					add_claim_on_loss = no
				}			
				every_held_title = {
					change_title_holder_include_vassals = {
						holder = root
						change = scope:title_change
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
			if = {
				limit = {
					has_character_flag = mardat_coup_transition
				}
				destroy_title = title:e_bozisha_miraz
			}			
		}		
		set_realm_capital = title:c_bozisha_dar
	}
	
	theme = intrigue
	title =	ray_story.0158.t
	desc = ray_story.0158.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:ray_king_lost
		animation = prisondungeon
	}

	option = { # Execute the Kralyi
		name = ray_story.0158.a
		custom_tooltip = ray_story.0158.a.effects
		get_title = title:d_dar
		get_title = title:c_sanma
		scope:revolutionary = {
			trigger_event = {
				id = ray_story.0210
				days = 10
			}
		}		
		if = {
			limit = {
				NOT = {
					scope:ray_king_lost = root
				}
			}
			scope:ray_king_lost = {
				death = {
					death_reason = death_torture
					killer = root
				}
			}			
		}

		if = {
			limit = {
				OR = {
					has_character_flag = powan_support
					has_character_flag = nafarati_support
					has_character_flag = stormhost_support
				}
			}
			trigger_event = {
				id = ray_story.0201
			}
		}			
		ai_chance = {
			base = 10
		}
	}

	option = { # Purge the capital
		name = ray_story.0158.b
		custom_tooltip = ray_story.0158.b.effects
		get_title = title:d_dar
		get_title = title:c_sanma	
		scope:revolutionary = {
			trigger_event = {
				id = ray_story.0210
				days = 10
			}
		}		
		if = {
			limit = {
				NOT = {
					scope:ray_king_lost = root
				}
			}
			scope:ray_king_lost = {
				death = {
					death_reason = death_torture
					killer = root
				}
			}			
		}
		
		title:c_bozisha_dar = {
			set_county_faith = faith:faith_haruze
		}
		title:c_bozisha_dar = { 
			add_county_modifier = {
				modifier = mardat_purge_county_modifier 
				years = 50
				}
			}
		add_legitimacy = -50
		add_stress = -100
		if = {
			limit = {
				OR = {
					has_character_flag = powan_support
					has_character_flag = nafarati_support
					has_character_flag = stormhost_support
				}
			}
			trigger_event = {
				id = ray_story.0201
			}
		}			
		ai_chance = {
			base = 90
		}
	}

	option = { # Mercy
		name = ray_story.0158.c
		custom_tooltip = ray_story.0158.c.effects
		get_title = title:d_dar
		get_title = title:c_sanma	
		scope:revolutionary = {
			trigger_event = {
				id = ray_story.0210
				days = 10
			}
		}				
		show_as_tooltip = {
			imprison = {
				target = scope:ray_king_lost
				type = dungeon
			}
		}
		add_stress = 200
		if = {
			limit = {
				OR = {
					has_character_flag = powan_support
					has_character_flag = nafarati_support
					has_character_flag = stormhost_support
				}
			}
			trigger_event = {
				id = ray_story.0201
			}
		}		
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0159 = {# Mardat wins the civil war Ray POV
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		root.player_heir = { save_scope_as = heir }
		set_realm_capital = title:c_bozisha_dar
	}
	title =	ray_story.0159.t
	desc = ray_story.0159.desc
	override_background = {
		reference = dungeon
	}
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:mardat
		animation = happiness
	}

	option = { # Become a LAAMP if you have RtP
		name = ray_story.0159.a		
		trigger = {
			has_dlc_feature = roads_to_power
		}		
		if = {
			limit = {
				scope:heir = {
					NOT = {
						is_ruler = yes
					}
				}
			}
			scope:heir = {
				create_landless_adventurer_title_effect = {
					REASON = flag:exile
					FLAVOR_CHAR = scope:heir
				}
				trigger_event = {
					id = ray_story.0401
					days = 1
				}
			}
		}
		set_player_character = scope:heir		
		scope:mardat = {
			trigger_event = {
				id = ray_story.0158
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = { # If you don't, GG
		name = ray_story.0159.a	
		trigger = {
			NOT = {has_dlc_feature = roads_to_power}
		}		
		scope:mardat = {
			trigger_event = {
				id = ray_story.0158
			}
		}
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0160 = {# Mardat loses the civil war Ray POV
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	title =	ray_story.0160.t
	desc = ray_story.0160.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:mardat
		animation = prisondungeon
	}

	option = { 
		name = ray_story.0160.a
		scope:mardat = {
			trigger_event = ray_story.0161
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0161 = {# Mardat loses the civil war
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
	}
	title =	ray_story.0161.t
	desc = ray_story.0161.desc
	override_background = {
		reference = dungeon
	}
	
	left_portrait = {
		character = root
		animation = prisondungeon
	}

	right_portrait = {
		character = scope:ray_king
		animation = happiness
	}

	option = { 
		name = ray_story.0161.a
		add_prestige = -2000
		add_prestige_level = -2
		ai_chance = {
			base = 100
		}
	}
}

#Reminder that 0362 is earlier in the storyline because I had forgotten a necessary event

ray_story.0163 = {#Mardat begins the coup
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }
		title:d_dar.holder = { save_scope_as = ray_king_lost}
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	title =	ray_story.0163.t
	desc = ray_story.0163.desc
	override_background = {
		reference = corridor_night
	}
	
	left_portrait = {
		character = root
		animation = scheme
	}

	right_portrait = {
		character = scope:ray_king
		animation = paranoia
	}

	option = { 
		name = ray_story.0163.a
		random_list = {
			1 = { #Success
				modifier = {
					add = 99
					is_ai = yes
					scope:ray_king = {is_ai = yes}
					has_game_rule = default_ai_behavior
				}
				modifier = {
					add = 74
					is_ai = yes
					scope:ray_king = {is_ai = yes}
					has_game_rule = weighted_ai_behavior
				}
				modifier = {
					add = 49
					is_ai = yes
					scope:ray_king = {is_ai = yes}
					has_game_rule = random_ai_behavior
				}
				modifier = {
					add = 33
					is_ai = yes
					scope:ray_king = {NOT = {is_ai = yes}}
				}
				modifier = {
					add = 99
					is_ai = yes
					scope:ray_king = {
						is_ai = yes
						any_vassal = {
							NOT = {
								is_ai = yes
							}
						}
					}
				}																
				modifier = {
					add = 33
					has_character_flag = mardat_capital_conversion
				}
				modifier = {
					add = 33
					has_character_flag = mardat_navy
				}
				modifier = {
					add = 33
					has_character_flag = mardat_guard
				}
				modifier = {
					add = 60
					has_character_flag = mardat_chaos_coup
				}				
				custom_tooltip = ray_story.0163.a.success
				scope:ray_king = {
					trigger_event = {
						id = ray_story.0159
					}
				}				
				imprison = {
					target = scope:ray_king
					type = dungeon
				}
				scope:ray_king = {
					create_title_and_vassal_change = {
						type = usurped
						save_scope_as = title_change
						add_claim_on_loss = no
					}			
					every_held_title = {
						change_title_holder_include_vassals = {
							holder = root
							change = scope:title_change
						}
					}
					resolve_title_and_vassal_change = scope:title_change		
				}		
			}	
		
			99 = { #Failure
				custom_tooltip = ray_story.0163.a.fail
				modifier = {
					add = -99
					is_ai = yes
					scope:ray_king = {is_ai = yes}
					has_game_rule = default_ai_behavior
				}
				modifier = {
					add = -74
					is_ai = yes
					scope:ray_king = {is_ai = yes}
					has_game_rule = weighted_ai_behavior
				}
				modifier = {
					add = -49
					is_ai = yes
					scope:ray_king = {is_ai = yes}
					has_game_rule = random_ai_behavior
				}
				modifier = {
					add = -33
					is_ai = yes
					scope:ray_king = {NOT = {is_ai = yes}}
				}
				modifier = {
					add = -99
					is_ai = yes
					scope:ray_king = {
						is_ai = yes
						any_vassal = {
							NOT = {
								is_ai = yes
							}
						}
					}
				}				
				modifier = {
					add = -33
					has_character_flag = mardat_capital_conversion
				}
				modifier = {
					add = -33
					has_character_flag = mardat_navy
				}
				modifier = {
					add = -33
					has_character_flag = mardat_guard
				}				
				modifier = {
					add = -60
					has_character_flag = mardat_chaos_coup
				}					
				start_war = {
					cb = mardat_ray_claim_cb
					target = title:k_ray.holder
					claimant = root
					target_title = title:k_ray
					target_title = title:c_bozisha_dar
					target_title = title:c_aziya
					target_title = title:c_hartas
				}
				trigger_event = {
					id = ray_story.0162
				}
				scope:ray_king = {
					trigger_event = ray_story.0154
				}
			}
		}
		set_relation_rival = {
            target = scope:ray_king
            reason = rival_claimed_my_title
            involved_character = root
		}
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:ray_king
			opinion = -100
		}
		ai_chance = {
			base = 100
		}
	}
}

##############################
### Mardat Storyline Act 2 ###
##############################

ray_story.0201 = {# Mardat has to pay up
	content_source = realms_dlc
	type = character_event
	theme = diplomacy
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader}
		title:d_delritha.holder = { save_scope_as = nafarati_leader}	
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor}	
	}
	title =	ray_story.0201.t
	desc = ray_story.0201.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = idle
	}

	option = { 
		name = ray_story.0201.a
		custom_tooltip = ray_story.0201.a.effects
		if = {
			limit = {
				has_character_flag = powan_support
				title:d_ne_sargoa = { is_title_created = yes }
				NOT = {
					has_character_flag = mardat_powa_free
				}
			}
			scope:powan_leader = {
				trigger_event = {
					id = ray_story.0205
					days = 1
				}
			}
			trigger_event = {
				id = ray_story.0202
				days = 1
			}
		}
		if = {
			limit = {
				has_character_flag = nafarati_support
				title:d_delritha = { is_title_created = yes }
				NOT = {
					has_character_flag = mardat_nafarati_free
				}
			}
			trigger_event = {
				id = ray_story.0203
				days = 2
			}			
			scope:nafarati_leader = {
				trigger_event = {
					id = ray_story.0206
					days = 3
				}
			}			

		}
		if = {
			limit = {
				has_character_flag = stormhost_support
				title:e_thon_an_kharlokh= { is_title_created = yes }
			}
			scope:stormhost_emperor = {
				trigger_event = {
					id = ray_story.0207
					days = 3
				}
			}			
			trigger_event = {
				id = ray_story.0204
				days = 3
			}
		}
		if = {
			limit = {
				has_character_flag = mardat_guard
			}		
			trigger_event = {
				id = ray_story.0208
				days = 4
			}
		}					
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0202 = {# Mardat pays Powa
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader}
	}
	title =	ray_story.0202.t
	desc = ray_story.0202.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:powan_leader
		animation = celebrate_sword
	}

	option = { 
		name = ray_story.0202.a
		custom_tooltip = ray_story.0202.a.effects
		reverse_add_opinion = {
			modifier = happy_opinion
			target = scope:powan_leader
			opinion = 50
		}
		scope:powan_leader = {
			create_alliance = root
			root = {
				add_opinion = {
					target = scope:powan_leader
					modifier = event_negotiated_alliance_opinion
				}
			}		
		}	
		if = {
			limit = {
				has_character_flag = mardat_powa_gold
			}
			pay_short_term_gold = {
				gold = 500
				target = scope:powan_leader
			}			
		}
		else_if = {
			limit = {
				has_character_flag = mardat_powa_trade
			}
			add_character_modifier = mardat_powa_trade_modifier
			scope:powan_leader = {
				add_character_modifier = powa_ray_trade_monopoly
			}	
		}

		ai_chance = {
			base = 100
		}
	}
}

ray_story.0203 = {# Mardat pays Nafarati
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:d_delritha.holder = { save_scope_as = nafarati_leader}
	}
	title =	ray_story.0203.t
	desc = ray_story.0203.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:nafarati_leader
		animation = celebrate_sword
	}

	option = { 
		name = ray_story.0203.a
		custom_tooltip = ray_story.0203.a.effects
		reverse_add_opinion = {
			modifier = happy_opinion
			target = scope:nafarati_leader
			opinion = 50
		}
		scope:nafarati_leader = {
			create_alliance = root
			root = {
				add_opinion = {
					target = scope:nafarati_leader
					modifier = event_negotiated_alliance_opinion
				}
			}				
		}		
		if = {
			limit = {
				has_character_flag = mardat_nafarati_1k
			}
			pay_short_term_gold = {
				gold = 300
				target = scope:nafarati_leader
			}			
		}
		if = {
			limit = {
				has_character_flag = mardat_nafarati_2k
			}
			pay_short_term_gold = {
				gold = 600
				target = scope:nafarati_leader
			}			
		}
		if = {
			limit = {
				has_character_flag = mardat_nafarati_3k
			}
			pay_short_term_gold = {
				gold = 1000
				target = scope:nafarati_leader
			}			
		}
		if = {
			limit = {
				has_character_flag = mardat_nafarati_duchy
			}
			scope:nafarati_leader = {
				start_war = {
					cb = mardat_nafarati_duchy_cb
					target = title:d_silvesa.holder
					claimant = scope:nafarati_leader
					target_title = title:d_silvesa
				}
			}			
		}
		if = {
			limit = {
				has_character_flag = mardat_nafarati_kingdom
			}
			scope:nafarati_leader = {
				add_character_flag = mardat_nafarati_invader
				hidden_effect = {
				if = {
					limit = {
						title:c_tartaust.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_tartaust.holder
						target_title = title:k_chennacatt
					}
					title:c_tartaust.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_moruneth.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_moruneth.holder
						target_title = title:k_chennacatt
					}
					title:c_moruneth.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_bashriska.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_bashriska.holder
						target_title = title:k_chennacatt
					}
					title:c_bashriska.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_junvar.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_junvar.holder
						target_title = title:k_chennacatt
					}
					title:c_junvar.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_arnel.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_arnel.holder
						target_title = title:k_chennacatt
					}
					title:c_arnel.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_junrik.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_junrik.holder
						target_title = title:k_chennacatt
					}
					title:c_junrik.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_arnkest.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_arnkest.holder
						target_title = title:k_chennacatt
					}
					title:c_arnkest.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_fhul.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_fhul.holder
						target_title = title:k_chennacatt
					}
					title:c_fhul.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_delkar.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_delkar.holder
						target_title = title:k_chennacatt
					}
					title:c_delkar.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_kelen.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_kelen.holder
						target_title = title:k_chennacatt
					}
					title:c_kelen.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_kharvan.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_kharvan.holder
						target_title = title:k_chennacatt
					}
					title:c_kharvan.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_sivren.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_sivren.holder
						target_title = title:k_chennacatt
					}
					title:c_sivren.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_kinthar.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_kinthar.holder
						target_title = title:k_chennacatt
					}
					title:c_kinthar.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_selena.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_selena.holder
						target_title = title:k_chennacatt
					}
					title:c_selena.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				if = {
					limit = {
						title:c_aylra.holder = {
							NOT = {has_character_flag = mardat_nafarati_invader}
							NOT = {has_character_flag = mardat_nafarati_target}
							is_independent_ruler = yes	
						}					
					}
					start_war = {
						cb = mardat_nafarati_kingdom_cb
						target = title:c_aylra.holder
						target_title = title:k_chennacatt
					}
					title:c_aylra.holder = {
						add_character_flag = mardat_nafarati_target
					}					
				}
				}																																																														
			}		
		}		
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0204 = {# Mardat Stormhost Promise
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor}
	}
	title =	ray_story.0204.t
	desc = ray_story.0204.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = chancellor
	}

	right_portrait = {
		character = scope:stormhost_emperor
		animation = schadenfreude
	}

	option = { 
		name = ray_story.0204.a		
		custom_tooltip = ray_story.0204.a.effects
		spawn_army = {
			uses_supply = yes
			inheritable = yes
			name = stormhost_auxiliairies
			men_at_arms = {
				type = indentured_conscripts
				stacks = 5
			}
			men_at_arms = {
				type = zagar_an_adunai
				stacks = 5
			}
			men_at_arms = {
				type = ephalzagar_an_adunai
				stacks = 5
			}
			levies = 1500
			location = capital_province
		}		
		reverse_add_opinion = {
			modifier = happy_opinion
			target = scope:stormhost_emperor
			opinion = 50
		}
		scope:stormhost_emperor = {
			create_alliance = root
			root = {
				add_opinion = {
					target = scope:stormhost_emperor
					modifier = event_negotiated_alliance_opinion
				}
			}			
		}	
		if = {
			limit = {
				has_character_flag = mardat_stormhost_ally
			}
			# add_character_flag = mardat_invade_bellakar_stormhost # Commented out to avoid an error
		}
		else_if = {
			limit = {
				has_character_flag = mardat_stormhost_tributary
			}
			start_tributary = {
				contract_group = tributary_subjugated
				suzerain = scope:stormhost_emperor
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

ray_story.0205 = {# Mardat pays Powan POV
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}
	title =	ray_story.0205.t
	desc = ray_story.0205.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = debating
	}

	right_portrait = {
		character = scope:ray_king
		animation = idle
	}

	option = { 
		name = ray_story.0205.a
		custom_tooltip = ray_story.0205.a.effects		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0206 = {# Mardat pays Nafarati POV
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}
	title =	ray_story.0206.t
	desc = ray_story.0206.desc
	override_background = {
		reference = corridor_day
	}
	
	trigger = {
		scope:attacker = {
			any_character_war = {
				primary_attacker = root
			}
		}
	}

	left_portrait = {
		character = root
		animation = debating
	}

	right_portrait = {
		character = scope:ray_king
		animation = idle
	}

	option = { 
		name = ray_story.0206.a
		custom_tooltip = ray_story.0206.a.effects		
		scope:war = {
			add_attacker = scope:mardat
		}		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0207 = {# Mardat pays Stormhost POV
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}
	title =	ray_story.0207.t
	desc = ray_story.0207.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = schadenfreude
	}

	right_portrait = {
		character = scope:ray_king
		animation = chancellor
	}

	option = { 
		name = ray_story.0207.a
		custom_tooltip = ray_story.0207.a.effects
		if = {
			limit = {
				scope:mardat = {
					NOT = {
						has_character_flag = mardat_stormhost_tributary
					}
				}
			}
			add_character_flag = mardat_stormhost_promise
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0208 = {# Mardat gives Suza-Riy away to the guard leader
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		hidden_effect = {
			create_character = {
				name = Pravak
				gender = male
				age = 29
				culture = culture:bozishnarud
				faith = faith:faith_vatra
				trait = ambitious
				trait = cynical
				trait = brave
				trait = education_martial_3
				trait = disloyal
				trait = logistician
				trait = strong
				location = capital_province
				save_scope_as = guard_leader
			}
		}
	}
	title =	ray_story.0208.t
	desc = ray_story.0208.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:guard_leader
		animation = happiness
	}

	option = { 
		name = ray_story.0208.a
		custom_tooltip = ray_story.0208.a.effects
		reverse_add_opinion = {
			modifier = happy_opinion
			target = scope:guard_leader
			opinion = 150
		}
		add_hook = {
			type = loyalty_hook
			target = scope:guard_leader
		}
		scope:guard_leader = {	
			set_character_faith_with_conversion = faith:faith_haruze
			get_title = title:c_suza_riy			
			get_title = title:c_nariyar
			get_title = title:c_ilam
			get_title = title:d_suza_riy			
		}
		ai_chance = {
			base = 40
		}
	}

	option = { 
		name = ray_story.0208.b
		custom_tooltip = ray_story.0208.b.effects
		reverse_add_opinion = {
			modifier = angry_opinion
			target = scope:guard_leader
			opinion = -100
		}
		set_relation_rival = {
            target = scope:guard_leader
            reason = rival_grave_insult
            involved_character = root
		}
		add_legitimacy = -10
		scope:guard_leader = {
			create_landless_adventurer_title_effect = {
				REASON = flag:wanderer
				FLAVOR_CHAR = scope:guard_leader
			}
		}
		ai_chance = {
			base = 60
		}
	}	
}

ray_story.0209 = {# The dukes rise up
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:d_iunastiy.holder = { save_scope_as = revolutionary }
		title:d_riyeshara.holder = { save_scope_as = reactionary }
	}
	title =	ray_story.0209.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = mardat_reactionary
					has_character_flag = mardat_revolutionary
				}
				desc = ray_story.0209.desc1
			}
			triggered_desc = {
				trigger = {
					has_character_flag = mardat_reactionary
					NOT = { has_character_flag = mardat_revolutionary }
				}
				desc = ray_story.0209.desc2
			}
			triggered_desc = {
				trigger = {
					NOT = { has_character_flag = mardat_reactionary }
					has_character_flag = mardat_revolutionary 
				}
				desc = ray_story.0209.desc3
			}
		}
	}
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = anger
	}

	right_portrait = {
		character = scope:revolutionary
		animation = prayer
	}

	lower_center_portrait = scope:reactionary

	option = { 
		name = ray_story.0209.a
		add_character_modifier = {
			modifier = ep3_the_conqueror_modifier
			years = 15
		}		
		add_character_flag = mardat_ongoing_purge
		create_story = lotr_story_cycle_purge_of_ray
		custom_tooltip = ray_story.0209.a.effects			
		every_ruler = {
			limit = {
				capital_province = {
					geographical_region = middleearth_harad_far_ray
				}
			}
			trigger_event = purge_of_ray.0120
					}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0210 = {# Revolutionary intro
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
		title:d_riyeshara.holder = { save_scope_as = reactionary }
	}
	title =	ray_story.0210.t
	desc = ray_story.0210.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = prayer
	}

	right_portrait = {
		character = scope:mardat
		animation = anger
	}

	option = { 
		name = ray_story.0210.a
		custom_tooltip = ray_story.0210.a.effects		
		add_pressed_claim = title:k_ray
		scope:mardat = {
			add_character_flag = mardat_revolutionary			
		}
		scope:reactionary = {
			trigger_event = ray_story.0211			
		}
		set_relation_rival = {
            target = scope:mardat
            reason = rival_claimed_my_title
            involved_character = root
		}			
		add_opinion = {
			modifier = angry_opinion
			target = scope:mardat
			opinion = -300
		}		
		ai_chance = {
			base = 100
		}
	}
	option = { 
		name = ray_story.0210.b
		custom_tooltip = ray_story.0210.b.effects		
		custom_tooltip = opt_out_of_story_content
		scope:reactionary = {
			trigger_event = ray_story.0211			
		}		
		add_stress = 50
		set_character_faith_with_conversion = faith:faith_haruze
		ai_chance = {
			base = 0
		}
	}
	
}

ray_story.0211 = {# Reactionary intro
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
		title:d_iunastiy.holder = { save_scope_as = revolutionary }
		title:d_riyeshara.holder = { save_scope_as = reactionary }				
	}
	title =	ray_story.0211.t
	desc = ray_story.0211.desc
	override_background = {
		reference = corridor_day
	}
	
	left_portrait = {
		character = root
		animation = personality_vengeful
	}

	right_portrait = {
		character = scope:mardat
		animation = anger
	}

	lower_center_portrait = scope:revolutionary

	option = { 
		name = ray_story.0211.a
		custom_tooltip = ray_story.0211.a.effects		
		add_pressed_claim = title:k_ray	
		scope:mardat = {
			add_character_flag = mardat_reactionary			
		}
		scope:mardat = {
			if = {
				limit = {
					OR = {
						has_character_flag = mardat_revolutionary
						has_character_flag = mardat_reactionary						
					}
				}
				trigger_event = ray_story.0209
			}
		}
		set_relation_rival = {
            target = scope:mardat
            reason = rival_claimed_my_title
            involved_character = root
		}			
		add_opinion = {
			modifier = angry_opinion
			target = scope:mardat
			opinion = -300
		}			
		ai_chance = {
			base = 100
		}
	}
	option = { 
		name = ray_story.0211.b
		custom_tooltip = ray_story.0211.b.effects		
		custom_tooltip = opt_out_of_story_content
		scope:mardat = {
			if = {
				limit = {
					OR = {
						has_character_flag = mardat_revolutionary
						has_character_flag = mardat_reactionary					
					}
				}
				trigger_event = ray_story.0209
			}
		}		
		add_stress = 50
		set_character_faith_with_conversion = faith:faith_haruze		
		ai_chance = {
			base = 0
		}
	}	
}

ray_story.0212 = { # Join the invasion of Bellakar
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0212.t
	desc =  ray_story.0212.desc
	theme = war
	override_background = {
		reference = black_ship
	}
	left_portrait = {
		character = scope:attacker
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:defender
		animation = anger
	}

	lower_center_portrait = root

	trigger = {
		scope:attacker = {
			any_character_war = {
				primary_defender = title:e_bellakar.holder
			}
		}
	}

	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
	}

	option = {
		name = ray_story.0212.a
		custom_tooltip = ray_story.0212.a.effects
		scope:war = {
			add_attacker = root
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0213 = { # Win the invasion of Bellakar with the Stormhost
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0213.t
	desc =  ray_story.0213.desc
	theme = war	
	override_background = {
		reference = black_ship
	}
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
	}	
	
	left_portrait = {
		character = root
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:stormhost_emperor
		animation = bribing
	}

	option = {
		name = ray_story.0213.a
		add_gold = 5000
		ai_chance = {
			base = 100
		}
	}
}


ray_story.0214 = { # Mardat loses the invasion of Bellakar
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0214.t
	desc =  ray_story.0214.desc
	theme = war
	override_background = {
		reference = black_ship
	}
	immediate = {
		title:e_bellakar.holder = { save_scope_as = bellakar_emperor }
	}	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:bellakar_emperor
		animation = celebrate_sword
	}

	option = {
		name = ray_story.0214.a
		add_legitimacy = -300
		add_prestige = -1000
		add_piety = -500
		add_dread = -50
		add_character_flag = mardat_failed_bellakar_invasion		
		set_relation_rival = {
            target = scope:bellakar_emperor
            reason = rival_grave_insult
            involved_character = root
		}		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0215 = { # Win the invasion of Bellakar without the Stormhost
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0215.t
	desc =  ray_story.0215.desc
	theme = war	
	override_background = {
		reference = black_ship
	}
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
		if = {
			limit = {
				NOT = {
					title:e_bozisha_miraz = { is_title_created = yes }
				}
			}
			get_title = title:e_bozisha_miraz
			set_primary_title_to = title:e_bozisha_miraz			
		}		
	}	
	
	left_portrait = {
		character = root
		animation = personality_callous
	}

	option = {
		name = ray_story.0215.a
		if = {
			limit = {
				NOR = {
					has_character_flag = has_sun_serpent_nickname
					has_character_flag = mardat_is_plotting
				}
			}
			give_nickname = nick_moon_serpent
		}
		add_character_flag = has_sun_serpent_nickname
		trigger_event = ray_story.0219
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0216 = { # Buy Zizal
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0216.t
	desc =  ray_story.0216.desc
	theme = war	
	override_background = {
		reference = harad_drylands	
	}
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader }
	}	
	
	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:powan_leader
		animation = debating
	}

	option = {
		name = ray_story.0216.a
		pay_short_term_gold = {
			gold = 250
			target = scope:powan_leader
		}	
		scope:powan_leader = {
			trigger_event = ray_story.0217		
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0216.b
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0217 = { # Buy Zizal powan POV
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0217.t
	desc =  ray_story.0217.desc
	theme = war	
	override_background = {
		reference = harad_drylands	
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}	
	
	left_portrait = {
		character = root
		animation = debating
	}

	right_portrait = {
		character = scope:mardat
		animation = bribing
	}

	option = {
		name = ray_story.0217.a #yeah sure
		scope:mardat = {
			add_character_flag = powa_sale_yes
			trigger_event = ray_story.0218
		}
		show_as_tooltip = {
			scope:mardat = {
				pay_short_term_gold = {
					gold = 250
					target = root
				}	
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0217.b #I want my 1.5 barter goods per month (yes I checked)
		scope:mardat = {
			add_character_flag = powa_sale_no
			trigger_event = ray_story.0218
		}
		hidden_effect = {
			pay_short_term_gold = {
				gold = 250
				target = scope:mardat
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0218 = { # Buy Zizal yes/no
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0218.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = powa_sale_yes
					NOT = {
						has_character_flag = powa_sale_no
					}
				}
				desc = ray_story.0218.yes.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = powa_sale_no
					NOT = {
						has_character_flag = powa_sale_yes
					}					
				}
				desc = ray_story.0218.no.desc
			}
		}
	}
	theme = war	
	override_background = {
		reference = harad_drylands	
	}
	immediate = {
		title:d_ne_sargoa.holder = { save_scope_as = powan_leader }
	}	
	
	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:powan_leader
		animation = personality_rational
	}	

	option = {
		name = ray_story.0218.a
		if = {
			limit = {
				has_character_flag = powa_sale_yes
			}
			get_title = title:c_zizal
			get_title = title:c_salibara
		}
		else = {
			add_opinion = {
				modifier = angry_opinion
				target = scope:powan_leader
				opinion = -25
			}
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0219 = { # Decide the Fate of Bellakar
	content_source = realms_dlc
	type = character_event
	title = ray_story.0219.t
	desc =  ray_story.0219.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormhost_emperor }
		debug_log = "Mardat: Bellanarud Candidate"		
		create_character = {
			name = Dairugad
			gender = male
			age = 45
			culture = culture:bellanarud
			faith = root.faith
			trait = zealous
			trait = sadistic
			trait = wrathful
			trait = education_martial_4
			trait = holy_warrior
			location = capital_province
			save_scope_as = bellanarud_candidate
		}		
	}
	
	left_portrait = {
		character = root
		animation = personality_callous
	}

	lower_center_portrait = scope:bellanarud_candidate

	option = { #Destroy Bellakar
		name = ray_story.0219.a		
		custom_tooltip = {
			text = mardat_bellakar_destruction_effect
			every_sub_realm_county = {
				limit = {
					empire = title:e_bellakar
				}
				add_county_modifier = {
					modifier = mardat_purge_county_modifier
					years = 50
				}
				change_development_level = -8
				random = {
					chance = 50
					set_county_faith = faith:faith_haruze
				}
			}
		}
		every_vassal = {
			custom = every_minority_vassal
			vassal_stance = minority
			add_opinion = {
				target = root 
				modifier = scared_opinion
				opinion = -50
			}
		}
		add_piety = 1000
		add_prestige = 1000
		root.dynasty = {
			add_dynasty_prestige = 500
		}			
		stress_impact = {
			wrathful = miniscule_stress_impact_loss
			sadistic = major_stress_impact_loss
			vengeful = minor_stress_impact_loss
			compassionate = major_stress_impact_gain
			forgiving = medium_stress_impact_gain
		}		
		ai_chance = {
			base = 100
		}
	}
	option = { #Keep Bellakar conquered as is
		name = ray_story.0219.b
		stress_impact = {
			sadistic = medium_stress_impact_gain
			vengeful = major_stress_impact_gain
			compassionate = miniscule_stress_impact_loss
			forgiving = minor_stress_impact_loss
		}		
		ai_chance = {
			base = 0
		}
	}
	option = { #Bellanarud tributary
		name = ray_story.0219.c
		add_piety = 2000		
		custom_tooltip = {
			text = mardat_bellakar_tributary_effect
			every_sub_realm_county = {
				limit = {
					empire = title:e_bellakar
				}
				add_county_modifier = {
					modifier = mardat_purge_county_modifier
					years = 50
				}
				change_development_level = -5
				random = {
					chance = 50
					set_county_faith = faith:faith_haruze
					set_county_culture = culture:bellanarud
				}
			}
		}		
		hidden_effect = {			
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = title_change
				add_claim_on_loss = no
			}			
			every_held_title = {
				limit = { empire = title:e_bellakar }
				change_title_holder_include_vassals = {
					holder = scope:bellanarud_candidate
					change = scope:title_change
				}
			}			
			title:e_bellakar = {
				change_title_holder_include_vassals = {
					holder = scope:bellanarud_candidate
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change		
		}		
		custom_tooltip = mardat_bellanarud_tributary
		stress_impact = {
			sadistic = medium_stress_impact_gain
			vengeful = major_stress_impact_gain
			compassionate = miniscule_stress_impact_loss
			forgiving = minor_stress_impact_loss
		}
		reverse_add_opinion = {
			modifier = grateful_opinion
			target = scope:bellanarud_candidate
			opinion = 200
		}
		add_hook = {
			target = scope:bellanarud_candidate
			type = loyalty_hook
		}			
		scope:bellanarud_candidate = {
			trigger_event = ray_story.0220		
		}	
		ai_chance = {
			base = 0
		}
	}		
}

ray_story.0220 = { # Make the Bellanarud Mardat's tributary
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0220.t
	desc =  ray_story.0220.desc
	theme = war
	override_background = {
		reference = black_ship
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = sponsor }
		start_tributary = {
			contract_group = tributary_subjugated
			suzerain = scope:sponsor
		}		
	}
	left_portrait = {
		character = root
		animation = personality_callous
	}
	option = {
		name = ray_story.0220.a	
		ai_chance = {
			base = 100
		}
	}
}

#####################
### Rebels of Rây ###
#####################

ray_story.0301{# Try to consolidate the rebels under your rule
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
		debug_log = "Purge: Rebel Leader"		
		create_character = {
			name = Faijamo_o_r
			gender = male
			age = 27
			culture = culture:bozishnarud
			faith = root.faith
			trait = vengeful
			trait = brave
			trait = gregarious
			trait = education_martial_4
			trait = reckless
			trait = peasant_leader
			location = capital_province
			save_scope_as = rebel_leader
		}
	}
	theme = war
	title =	ray_story.0301.t
	desc = ray_story.0301.desc
	override_background = {
		reference = ep3_military_tent
	}
	
	left_portrait = {
		character = root
		animation = personality_honorable
	}

	right_portrait = {
		character = scope:rebel_leader
		animation = personality_bold
	}
	
	option = { # Convince them
		name = ray_story.0301.a
		duel = {
			skill = martial
			value = high_skill_rating			
			50 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 20
					 min = -29
				}
				desc = ray_story.0301.a.success
				add_character_flag = rebel_consolidate_convince
				add_character_modifier = ray_rebel_leader_modifier
				spawn_army = {
					uses_supply = yes
					inheritable = no
					name = ray_rebels
					men_at_arms = {
						type = bowmen
						stacks = 5
					}
					men_at_arms = {
						type = gaian_stalkers
						stacks = 2
					}
					men_at_arms = {
						type = narudbriyig_hillriders
						stacks = 3
					}
					levies = 1500
					location = capital_province
				}					
				trigger_event = {
					id = ray_story.0302
				}
					
			}
			50 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0
					min = -49
				}
				desc = ray_story.0301.a.failure
				scope:rebel_leader = {
					create_landless_adventurer_title_effect = {
						REASON = flag:wanderer
						FLAVOR_CHAR = scope:rebel_leader
					}
					add_character_flag = ray_rebel_leader_flag
					add_character_modifier = ray_rebel_leader_modifier
					add_gold = 1000
					add_prestige = 1000
					add_prestige_level = 2
				}	
				set_relation_rival = {
           			target = scope:rebel_leader
           			reason = rival_grave_insult
            		involved_character = root
				}
				trigger_event = {
					id = ray_story.0303
				}
			}
		}
		ai_chance = {
			base = 30
		}
	}
	option = { # Pay them
		name = ray_story.0301.b
		duel = {
			skill = diplomacy
			value = high_skill_rating			
			70 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 3
					 min = -29
				}
				desc = ray_story.0301.b.success
				add_character_flag = rebel_consolidate_pay
				remove_short_term_gold = 800
				add_character_modifier = ray_rebel_leader_modifier
				spawn_army = {
					uses_supply = yes
					inheritable = no
					name = ray_rebels
					men_at_arms = {
						type = bowmen
						stacks = 5
					}
					men_at_arms = {
						type = gaian_stalkers
						stacks = 2
					}
					men_at_arms = {
						type = narudbriyig_hillriders
						stacks = 3
					}
					levies = 1500
					location = capital_province
				}				
				trigger_event = ray_story.0302
									
			}
			30 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0
					min = -49
				}
				desc = ray_story.0301.b.failure
				scope:rebel_leader = {
					create_landless_adventurer_title_effect = {
						REASON = flag:wanderer
						FLAVOR_CHAR = scope:rebel_leader
					}
					add_character_flag = ray_rebel_leader_flag
					add_character_modifier = ray_rebel_leader_modifier
					add_gold = 1000
					add_prestige = 1000
					add_prestige_level = 2
				}	
				set_relation_rival = {
           			target = scope:rebel_leader
           			reason = rival_grave_insult
            		involved_character = root
				}				
				trigger_event =  ray_story.0303
			}
		}
		
		ai_chance = {
			base = 30
		}
 	}	

	option = { # Promise autonomy
		name = ray_story.0301.c
		duel = {
			skill = diplomacy
			value = high_skill_rating
			90 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 3
					 min = -29
				}
				desc = ray_story.0301.c.success
				add_character_flag = rebel_consolidate_autonomy
				add_character_modifier = ray_rebel_leader_modifier
				custom_tooltip = {
					text = rebel_county_control_loss
					every_sub_realm_county = {
						change_county_control = -30
					}
				}
				spawn_army = {
					uses_supply = yes
					inheritable = no
					name = ray_rebels
					men_at_arms = {
						type = bowmen
						stacks = 5
					}
					men_at_arms = {
						type = gaian_stalkers
						stacks = 2
					}
					men_at_arms = {
						type = narudbriyig_hillriders
						stacks = 3
					}
					levies = 1500
					location = capital_province
				}													
				scope:rebel_leader = {
					create_landless_adventurer_title_effect = {
						REASON = flag:wanderer
						FLAVOR_CHAR = scope:rebel_leader
					}
					add_gold = 300
					add_prestige = 500
					add_prestige_level = 1
				}					
				trigger_event = {
					id = ray_story.0302
				}
					
			}
			20 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0
					min = -49
				}
				desc = ray_story.0301.c.failure				
				scope:rebel_leader = {
					create_landless_adventurer_title_effect = {
						REASON = flag:wanderer
						FLAVOR_CHAR = scope:rebel_leader
					}
					add_character_modifier = ray_rebel_leader_modifier
					add_character_flag = ray_rebel_leader_flag
					add_gold = 1000
					add_prestige = 1000
					add_prestige_level = 2
				}	
				set_relation_rival = {
           			target = scope:rebel_leader
           			reason = rival_grave_insult
            		involved_character = root
				}				
				trigger_event = {
					id = ray_story.0303
				}
			}
		}
		ai_chance = {
			base = 40
		}
	}	
}

ray_story.0302 = { # Succeed in consolidating the rebels
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0302.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = rebel_consolidate_convince
					NOR = {
						has_character_flag = rebel_consolidate_autonomy
						has_character_flag = rebel_consolidate_pay
					}
				}
				desc = ray_story.0302.c.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = rebel_consolidate_pay
					NOR = {
						has_character_flag = rebel_consolidate_convince
						has_character_flag = rebel_consolidate_pay
					}				
				}
				desc = ray_story.0302.p.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = rebel_consolidate_autonomy
					NOR = {
						has_character_flag = rebel_consolidate_convince
						has_character_flag = rebel_consolidate_pay
					}					
				}
				desc = ray_story.0302.a.desc
			}			
		}
	}
	theme = war	
	override_background = {
		reference = ep3_military_tent
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}	
	
	left_portrait = {
		character = root
		animation = personality_honorable
	}

	right_portrait = {
		character = scope:mardat
		animation = anger
	}	

	option = {
		name = ray_story.0302.a
		if = {
			limit = {
				faith = faith:faith_ray
				NOT = {
					scope:mardat = {
						has_character_flag = rebel_consolidate_kat
					}					
				}
			}
			scope:mardat = {
				add_character_flag = rebel_consolidate_kat
				trigger_event = ray_story.0304
			}
		}
		else_if = {
			limit = {
				faith = faith:faith_vatra
				NOT = {
					scope:mardat = {
						has_character_flag = rebel_consolidate_vatra
					}					
				}
			}
			scope:mardat = {
				add_character_flag = rebel_consolidate_vatra
				trigger_event = ray_story.0305
			}
		}	
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0303 = { # Fail to consolidate the rebels
	content_source = realms_dlc
	type = character_event
	title = ray_story.0303.t
	desc = ray_story.0303.desc
	theme = war	
	override_background = {
		reference = ep3_military_tent
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
		every_ruler = {
			limit = {
				has_character_flag = ray_rebel_leader_flag
			}
			save_scope_as = rebel_leader
		}
	}	
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:mardat
		animation = happiness
	}	

	lower_center_portrait = {
		character = scope:rebel_leader
	}

	option = {
		name = ray_story.0303.a
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0303.b
		trigger = {
			has_dlc_feature = roads_to_power
		}
		set_player_character = scope:rebel_leader
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0304 = { # Rebels consolidate Mardat POV Revolutionaries
	content_source = realms_dlc
	type = character_event
	title =  ray_story.0304.t
	desc = ray_story.0304.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = anger
	}
	
	right_portrait = {
		character = scope:revolutionary
		animation = personality_bold
	}		
	
	immediate = {
		title:d_iunastiy.holder = { save_scope_as = revolutionary }
		title:d_riyeshara.holder = { save_scope_as = reactionary }
		cp:councillor_marshal = {
			save_scope_as = marshal
		}		
	}		
	
	option = {
		name = ray_story.0304.a		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0305 = { # Rebels consolidate Mardat POV Reactionaries
	content_source = realms_dlc
	type = character_event
	title = ray_story.0304.t
	desc = ray_story.0305.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = anger
	}
	
	right_portrait = {
		character = scope:reactionary
		animation = personality_bold
	}		
	
	immediate = {
		title:d_iunastiy.holder = { save_scope_as = revolutionary }
		title:d_riyeshara.holder = { save_scope_as = reactionary }
		cp:councillor_marshal = {
			save_scope_as = marshal
		}		
	}		
	
	option = {
		name = ray_story.0304.a		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0306{# Use the refugees for labor
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
		cp:councillor_steward = {
			save_scope_as = steward
		}
		cp:councillor_marshal = {
			save_scope_as = marshal
		}
	}
	theme = war
	title =	ray_story.0306.t
	desc = ray_story.0306.desc
	override_background = {
		reference = bp1_courtyard_indian
	}
	
	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:steward
		animation = personality_rational
	}

	lower_center_portrait = scope:marshal
	
	option = { # Military development
		name = ray_story.0306.a
		duel = {
			skill = martial
			value = high_skill_rating			
			70 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 3
					 min = -29
				}
				desc = ray_story.0306.a.success
				add_character_flag = ray_mil_haven
				add_character_modifier = ray_refugee_militray_modifier
				spawn_army = {
					uses_supply = yes
					inheritable = no
					name = ray_rebels
					men_at_arms = {
						type = bowmen
						stacks = 5
					}
					levies = 500
					location = capital_province
				}
				trigger_event = {
					id = ray_story.0307
				}
					
			}
			30 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0
					min = -49
				}
				add_character_modifier = ray_refugee_failure_modifier
				custom_tooltip = {
					text = rebel_county_control_loss
					every_sub_realm_county = {
						change_county_control = -30
					}
				}
				desc = ray_story.0306.a.failure				
				trigger_event =  ray_story.0308
			}
		}
		ai_chance = {
			base = 30
		}
	}
	option = { # Economic development
		name = ray_story.0306.b
		duel = {
			skill = stewardship
			value = high_skill_rating			
			70 = { # Succeed
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 3
					 min = -29
				}
				desc = ray_story.0306.b.success
				add_character_flag = ray_econ_haven
				add_character_modifier = ray_refugee_economy_modifier
				custom_tooltip = {
					text = refugee_dev_gain
					every_sub_realm_county = {
						change_development_level = 2
					}
				}
				trigger_event = ray_story.0307						
			}
			30 = { # Fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0
					min = -49
				}
				add_character_modifier = ray_refugee_failure_modifier
				custom_tooltip = {
					text = rebel_county_control_loss
					every_sub_realm_county = {
						change_county_control = -30
					}
				}
				desc = ray_story.0306.a.failure				
				trigger_event =  ray_story.0308
			}
		}		
		ai_chance = {
			base = 30
		}
 	}
	option = {
		name = ray_story.0306.c
		add_legitimacy = -5	
		ai_chance = {
			base = 100
			}
	}		
}

ray_story.0307 = { # Succesful use of the refugees
	content_source = realms_dlc
	type = character_event
	title = ray_story.0307.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = ray_mil_haven
					NOT = {
						has_character_flag = ray_econ_haven
					}
				}
				desc = ray_story.0307.m.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = ray_econ_haven
					NOT = {
						has_character_flag = ray_mil_haven
					}				
				}
				desc = ray_story.0307.e.desc
			}		
		}
	}
	theme = war	
	override_background = {
		reference = bp1_courtyard_indian
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}	
	
	left_portrait = {
		character = root
		animation = personality_bold
	}

	right_portrait = {
		character = scope:mardat
		animation = anger
	}	

	option = {
		name = ray_story.0307.a
		if = {
			limit = {
				faith = faith:faith_ray
				NOT = {
					scope:mardat = {
						has_character_flag = rebel_haven_kat
					}					
				}
			}
			scope:mardat = {
				add_character_flag = rebel_haven_kat
				trigger_event = ray_story.0309
			}
		}
		else_if = {
			limit = {
				faith = faith:faith_vatra
				NOT = {
					scope:mardat = {
						has_character_flag = rebel_haven_vatra
					}					
				}
			}
			scope:mardat = {
				add_character_flag = rebel_haven_vatra
				trigger_event = ray_story.0310
			}
		}	
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0308 = { # Fail to control the refugees
	content_source = realms_dlc
	type = character_event
	title = ray_story.0308.t
	desc = ray_story.0308.desc
	theme = war	
	override_background = {
		reference = bp1_courtyard_indian
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}	
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:mardat
		animation = happiness
	}	

	option = {
		name = ray_story.0308.a
		add_prestige = -300
		add_legitimacy = -10
		if = {
			limit = {
				faith = faith:faith_ray
				NOT = {
					scope:mardat = {
						has_character_flag = rebel_haven_kat
					}					
				}
			}
			scope:mardat = {
				add_character_flag = rebel_haven_kat
				trigger_event = ray_story.0309
			}
		}
		else_if = {
			limit = {
				faith = faith:faith_vatra
				NOT = {
					scope:mardat = {
						has_character_flag = rebel_haven_vatra
					}					
				}
			}
			scope:mardat = {
				add_character_flag = rebel_haven_vatra
				trigger_event = ray_story.0310
			}
		}			
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0309 = { # Rebels found Safe Haven Mardat POV Revolutionaries
	content_source = realms_dlc
	type = character_event
	title = ray_story.0309.t
	desc = ray_story.0309.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = anger
	}
	
	right_portrait = {
		character = scope:revolutionary
		animation = personality_vengeful
	}		
	
	immediate = {
		title:d_iunastiy.holder = { save_scope_as = revolutionary }
		title:d_riyeshara.holder = { save_scope_as = reactionary }
		cp:councillor_marshal = {
			save_scope_as = marshal
		}		
	}		
	
	option = {
		name = ray_story.0309.a		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0310 = { # Rebels found Safe Haven Mardat POV Reactionaries
	content_source = realms_dlc
	type = character_event
	title = ray_story.0309.t
	desc = ray_story.0310.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = anger
	}
	
	right_portrait = {
		character = scope:reactionary
		animation = personality_vengeful
	}		
	
	immediate = {
		title:d_iunastiy.holder = { save_scope_as = revolutionary }
		title:d_riyeshara.holder = { save_scope_as = reactionary }
		cp:councillor_marshal = {
			save_scope_as = marshal
		}		
	}		
	
	option = {
		name = ray_story.0309.a		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0311 = { # Ally Felira intro
	content_source = realms_dlc
	type = character_event
	title = ray_story.0311.t
	desc = ray_story.0311.desc
	theme = war	
	override_background = {
		reference = docks
	}

	left_portrait = {
		character = root
		animation = chancellor
	}
	
	right_portrait = {
		character = scope:felira_duke
		animation = thinking
	}		
	
	immediate = {
		title:d_felira.holder = { save_scope_as = felira_duke }
		title:k_ray.holder = { save_scope_as = mardat }
	}		
	
	option = {
		name = ray_story.0311.a
		custom_tooltip = ray_story.0311.a.effects
		trigger_event = ray_story.0312
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0312 = { # Ally Felira chose offer
	content_source = realms_dlc
	type = character_event
	title = ray_story.0312.t
	desc = ray_story.0312.desc
	theme = war	
	override_background = {
		reference = docks
	}

	left_portrait = {
		character = root
		animation = chancellor
	}
	
	right_portrait = {
		character = scope:felira_duke
		animation = thinking
	}		
	
	immediate = {
		title:d_felira.holder = { save_scope_as = felira_duke }
		title:k_ray.holder = { save_scope_as = mardat }
		add_character_flag = sent_felira_alliance_offer		
	}		
	
	option = {# Give back de jure
		name = ray_story.0312.a
		scope:felira_duke = {
			add_character_flag = ray_alliance_de_jure
		}
		add_character_flag = ray_alliance_de_jure
		custom_tooltip = felira_reply_in_a_month
		add_character_flag = sent_felira_alliance_offer
		if = {
			limit = {
				scope:felira_duke = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:felira_duke
				75 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					add_character_flag = felira_yes
					trigger_event = {
						id = ray_story.0314
						days = 30
					}
					custom_tooltip = ray_story.0312.success
					custom_tooltip = felira_give_land_after_victory
				}
				25 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					add_character_flag = felira_no
					custom_tooltip = ray_story.0312.failure
					trigger_event = {
						id = ray_story.0314
						days = 30
					}
				}
			}
		}
		else = {
			random_list = {
				75 = { #Fake success
					custom_tooltip = ray_story.0312.success
					scope:felira_duke = {
						trigger_event = {
							id = ray_story.0313
						}
					}	
				}
				25 = { #Fake failure
					custom_tooltip = ray_story.0312.failure
					scope:felira_duke = {
						trigger_event = {
							id = ray_story.0313
						}
					}	
				}
			}
		}
		ai_chance = {
			base = 60
		}
	}
	option = {# Give gold
		name = ray_story.0312.b
		scope:felira_duke = {
			add_character_flag = ray_alliance_gold
		}
		add_character_flag = ray_alliance_gold	
		add_character_flag = sent_felira_alliance_offer
		custom_tooltip = felira_reply_in_a_month
		if = {
			limit = {
				scope:felira_duke = {
					is_ai = yes
				}
			}
			duel = {
				skill = stewardship
				target = scope:felira_duke
				60 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					add_character_flag = felira_yes
					trigger_event = {
						id = ray_story.0314
						days = 30
					}
					custom_tooltip = ray_story.0312.success
					pay_short_term_gold = {
						gold = 800
						target = scope:felira_duke
					}
				}
				40 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}						
					add_character_flag = felira_no
					custom_tooltip = ray_story.0312.failure
					trigger_event = {
						id = ray_story.0314
						days = 30
					}
				}
			}
		}
		else = {
			random_list = {
				60 = { #Fake success
					custom_tooltip = ray_story.0312.success
					show_as_tooltip = {
						pay_short_term_gold = {
							gold = 800
							target = scope:felira_duke
						}
					}
					scope:felira_duke = {
						trigger_event = {
							id = ray_story.0313
						}
					}	
				}
				40 = { #Fake failure
					custom_tooltip = ray_story.0312.failure
					scope:felira_duke = {
						trigger_event = {
							id = ray_story.0313
						}
					}	
				}
			}
		}
		ai_chance = {
			base = 30
		}		
	}
	option = {# Give nothing
		name = ray_story.0312.c
		add_character_flag = sent_felira_alliance_offer
		scope:felira_duke = {
			add_character_flag = ray_alliance_nothing
		}		
		custom_tooltip = felira_reply_in_a_month
		if = {
			limit = {
				scope:felira_duke = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:felira_duke
				30 = { # success
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 1
					 min = -29
				}						
					add_character_flag = felira_yes
					trigger_event = {
						id = ray_story.0314
						days = 30
					}
					custom_tooltip = ray_story.0312.success
				}
				70 = { # failure
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = -1
					 min = -29
				}
					add_character_flag = felira_no
					custom_tooltip = ray_story.0312.failure
					trigger_event = {
						id = ray_story.0314
						days = 30
					}
				}
			}
		}
		else = {
			random_list = {
				60 = { #Fake success
					custom_tooltip = ray_story.0312.success
					scope:felira_duke = {
						trigger_event = {
							id = ray_story.0313
						}
					}	
				}
				40 = { #Fake failure
					custom_tooltip = ray_story.0312.failure
					scope:felira_duke = {
						trigger_event = {
							id = ray_story.0313
						}
					}	
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}		
}

ray_story.0313 = { # Felira Alliance Felira POV
	content_source = realms_dlc
	type = character_event
	title = ray_story.0313.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = ray_alliance_de_jure
					NOR = {
						has_character_flag = ray_alliance_gold
						has_character_flag = ray_alliance_nothing
					}
				}
				desc = ray_story.0313.d.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = ray_alliance_gold
					NOR = {
						has_character_flag = ray_alliance_de_jure
						has_character_flag = ray_alliance_nothing
					}				
				}
				desc = ray_story.0313.g.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = ray_alliance_nothing
					NOR = {
						has_character_flag = ray_alliance_de_jure
						has_character_flag = ray_alliance_gold
					}				
				}
				desc = ray_story.0313.n.desc
			}				
		}
	}
	theme = war	
	override_background = {
		reference = docks
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }		
		every_ruler = {
			limit = {
				has_character_flag = sent_felira_alliance_offer
			}
			save_scope_as = reactionary
		}
	}	
	
	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:reactionary
		animation = beg
	}

	lower_center_portrait = {
		character = scope:mardat
	}

	option = {
		name = ray_story.0313.b
		add_piety = -150
		scope:reactionary = {
			add_character_flag = felira_no
			trigger_event = ray_story.0314
			show_as_tooltip = {
				add_opinion = {
					modifier = angry_opinion
					target = root
					opinion = -50
				}
			}
		}				
		ai_chance = {
			base = 100
			modifier = {
				add = -75
				has_character_flag = ray_alliance_de_jure
			}
			modifier = {
				add = -60
				has_character_flag = ray_alliance_gold
			}
			modifier = {
				add = -30
				has_character_flag = ray_alliance_nothing
			}			
		}
	}
	option = {
		name = ray_story.0313.a
		custom_tooltip = does_ally_ray
		scope:reactionary = {
			add_character_flag = felira_yes
		}		
		set_relation_rival = {
            target = scope:mardat
            reason = rival_grave_insult
            involved_character = root
		}
		scope:reactionary = {
			create_alliance = root
			root = {
				add_opinion = {
					target = scope:reactionary
					modifier = event_negotiated_alliance_opinion
				}
			}
			trigger_event = ray_story.0314
		}
		if = {
			limit = {
				has_character_flag = ray_alliance_gold
			}
			scope:reactionary = {
				pay_short_term_gold = {
					gold = 800
					target = root
				}		
			}
		}							
		ai_chance = {
			base = 0
			modifier = {
				add = 75
				has_character_flag = ray_alliance_de_jure
			}
			modifier = {
				add = 60
				has_character_flag = ray_alliance_gold
			}
			modifier = {
				add = 30
				has_character_flag = ray_alliance_nothing
			}			
		}
	
	}
}

ray_story.0314 = { # Felira replies
	content_source = realms_dlc
	type = character_event
	title = ray_story.0314.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = felira_yes
					NOT = {
						has_character_flag = felira_no
					}
				}
				desc = ray_story.0314.y.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = felira_no
					NOT = {
						has_character_flag = felira_yes
					}				
				}
				desc = ray_story.0314.n.desc
			}				
		}
	}
	theme = war	
	override_background = {
		reference = docks
	}
	immediate = {
		title:d_felira.holder = { save_scope_as = felira_duke }
		title:k_ray.holder = { save_scope_as = mardat }
		if = {
			limit = {
				has_character_flag = felira_yes
			}
			show_as_tooltip = {
				scope:felira_duke = {
					create_alliance = root
					root = {
						add_opinion = {
							target = scope:felira_duke
							modifier = event_negotiated_alliance_opinion
						}
					}			
				}
				if = {
					limit = {
						has_character_flag = ray_alliance_gold
					}
					pay_short_term_gold = {
						gold = 800
						target = scope:felira_duke
					}
			
				}								
			}			
		}		
	}

	left_portrait = {
		character = root
		animation = personality_honorable
	}	

	right_portrait = {
		character = scope:felira_duke
		animation = thinking
	}

	lower_center_portrait = {
		character = scope:mardat
	}

	option = {
		name = ray_story.0314.a
		trigger = {
			has_character_flag = felira_yes
		}			
		add_legitimacy = 50
		add_prestige = 800
		scope:mardat = {
			trigger_event = ray_story.0315
		}		
		show_as_tooltip = {
			scope:felira_duke = {
				create_alliance = root
				root = {
					add_opinion = {
						target = scope:felira_duke
						modifier = event_negotiated_alliance_opinion
					}
				}			
			}								
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0314.b			
		trigger = {
			has_character_flag = felira_no
		}
		add_opinion = {
			modifier = angry_opinion
			target = scope:felira_duke
			opinion = -50
		}			
		ai_chance = {
			base = 100
		}
	}		
}

ray_story.0315 = { # Ally Felira Mardat POV
	content_source = realms_dlc
	type = character_event
	title = ray_story.0315.t
	desc = ray_story.0315.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = personality_vengeful
	}
	
	right_portrait = {
		character = scope:reactionary
		animation = personality_honorable
	}

	lower_center_portrait = scope:felira_duke
	
	immediate = {
		title:d_felira.holder = { save_scope_as = felira_duke }
		every_ruler = {
			limit = {
				has_character_flag = sent_felira_alliance_offer
			}
			save_scope_as = reactionary
		}
		show_as_tooltip = {
			set_relation_rival = {
            	target = scope:felira_duke
            	reason = rival_grave_insult
           	 	involved_character = root
			}
		}		
	}		
	option = {
		name = ray_story.0315.a
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0316 = { # Ally Gai intro
	content_source = realms_dlc
	type = character_event
	title = ray_story.0316.t
	desc = ray_story.0316.desc
	theme = war	
	override_background = {
		reference = tgp_hunt_generic_asia
	}

	left_portrait = {
		character = root
		animation = chancellor
	}
	
	right_portrait = {
		character = scope:gai_duke
		animation = thinking
	}		
	
	immediate = {
		title:d_gai.holder = { save_scope_as = gai_duke }
		title:k_ray.holder = { save_scope_as = mardat }
	}		
	
	option = {
		name = ray_story.0316.a
		custom_tooltip = ray_story.0316.a.effects
		trigger_event = ray_story.0317
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0317 = { # Ally Gai chose offer
	content_source = realms_dlc
	type = character_event
	title = ray_story.0317.t
	desc = ray_story.0317.desc
	theme = war	
	override_background = {
		reference = tgp_hunt_generic_asia
	}

	left_portrait = {
		character = root
		animation = chancellor
	}
	
	right_portrait = {
		character = scope:gai_duke
		animation = personality_bold
	}		
	
	immediate = {
		title:d_gai.holder = { save_scope_as = gai_duke }
		title:k_ray.holder = { save_scope_as = mardat }
		add_character_flag = sent_gai_alliance_offer		
	}		
	
	option = {# Give Suza-Riy
		name = ray_story.0317.a
		scope:gai_duke = {
			add_character_flag = gai_alliance_title
		}
		add_character_flag = gai_alliance_title
		custom_tooltip = gai_reply_in_10_days
		if = {
			limit = {
				scope:gai_duke = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:gai_duke
				85 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
					 	min = -29
					}						
					add_character_flag = gai_yes
					trigger_event = {
						id = ray_story.0319
						days = 10
					}
					custom_tooltip = ray_story.0317.success
					custom_tooltip = gai_title_effect
				}
				15 = { # failure
					compare_modifier = {
						 value = scope:duel_value
					 	multiplier = -1
					 	min = -29
					}						
					add_character_flag = gai_no
					custom_tooltip = ray_story.0317.failure
					trigger_event = {
						id = ray_story.0319
						days = 10
					}
				}
			}
		}
		else = {
			random_list = {
				85 = { #Fake success
					custom_tooltip = ray_story.0317.success
					custom_tooltip = gai_title_effect
					scope:gai_duke = {
						trigger_event = {
							id = ray_story.0318
						}
					}	
				}
				15 = { #Fake failure
					custom_tooltip = ray_story.0317.failure
					scope:gai_duke = {
						trigger_event = {
							id = ray_story.0318
						}
					}	
				}
			}
		}		
		ai_chance = {
			base = 60
		}
	}
	option = {# Give independence as protectorate
		name = ray_story.0317.b
		scope:gai_duke = {
			add_character_flag = gai_alliance_independence
		}
		add_character_flag = gai_alliance_independence
		custom_tooltip = gai_reply_in_10_days
		if = {
			limit = {
				scope:gai_duke = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:gai_duke
				90 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
					 	min = -29
					}						
					add_character_flag = gai_yes
					trigger_event = {
						id = ray_story.0319
						days = 10
					}
					custom_tooltip = ray_story.0317.success
					custom_tooltip = gai_independence_effect
				}
				10 = { # failure
					compare_modifier = {
						 value = scope:duel_value
					 	multiplier = -1
					 	min = -29
					}						
					add_character_flag = gai_no
					custom_tooltip = ray_story.0317.failure
					trigger_event = {
						id = ray_story.0319
						days = 10
					}
				}
			}
		}
		else = {
			random_list = {
				90 = { #Fake success
					custom_tooltip = ray_story.0317.success
					custom_tooltip = gai_independence_effect
					scope:gai_duke = {
						trigger_event = {
							id = ray_story.0318
						}
					}	
				}
				10 = { #Fake failure
					custom_tooltip = ray_story.0317.failure
					scope:gai_duke = {
						trigger_event = {
							id = ray_story.0318
						}
					}	
				}
			}
		}		
		ai_chance = {
			base = 30
		}		
	}
	option = {# Give nothing
		name = ray_story.0317.c
		add_character_flag = gai_alliance_nothing
		scope:gai_duke = {
			add_character_flag = gai_alliance_nothing
		}
		custom_tooltip = gai_reply_in_10_days
		if = {
			limit = {
				scope:gai_duke = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:gai_duke
				50 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
					 	min = -29
					}						
					add_character_flag = gai_yes
					trigger_event = {
						id = ray_story.0319
						days = 10
					}
					custom_tooltip = ray_story.0317.success
				}
				50 = { # failure
					compare_modifier = {
						 value = scope:duel_value
					 	multiplier = -1
					 	min = -29
					}						
					add_character_flag = gai_no
					custom_tooltip = ray_story.0317.failure
					trigger_event = {
						id = ray_story.0319
						days = 10
					}
				}
			}
		}
		else = {
			random_list = {
				50 = { #Fake success
					custom_tooltip = ray_story.0317.success
					scope:gai_duke = {
						trigger_event = {
							id = ray_story.0318
						}
					}	
				}
				50 = { #Fake failure
					custom_tooltip = ray_story.0317.failure
					scope:gai_duke = {
						trigger_event = {
							id = ray_story.0318
						}
					}	
				}
			}
		}
		ai_chance = {
			base = 10
		}
	}		
}

ray_story.0318 = { # Gai Alliance Gai POV
	content_source = realms_dlc
	type = character_event
	title = ray_story.0318.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = gai_alliance_independence
					NOR = {
						has_character_flag = gai_alliance_title
						has_character_flag = gai_alliance_nothing
					}
				}
				desc = ray_story.0318.i.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = gai_alliance_title
					NOR = {
						has_character_flag = gai_alliance_independence
						has_character_flag = gai_alliance_nothing
					}				
				}
				desc = ray_story.0318.ti.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = gai_alliance_nothing
					NOR = {
						has_character_flag = gai_alliance_independence
						has_character_flag = gai_alliance_title
					}				
				}
				desc = ray_story.0318.n.desc
			}				
		}
	}
	theme = war	
	override_background = {
		reference = tgp_hunt_generic_asia
	}
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }		
		every_ruler = {
			limit = {
				has_character_flag = sent_gai_alliance_offer
			}
			save_scope_as = revolutionary
		}
	}	
	
	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:revolutionary
		animation = chancellor
	}

	lower_center_portrait = {
		character = scope:mardat
	}

	option = {
		name = ray_story.0318.b
		add_piety = -150
		add_legitimacy = 10
		scope:revolutionary = {
			add_character_flag = gai_no
			trigger_event = ray_story.0319
			show_as_tooltip = {
				add_opinion = {
					modifier = angry_opinion
					target = root
					opinion = -50
				}
			}
		}				
		ai_chance = {
			base = 100
			modifier = {
				add = -95
				has_character_flag = gai_alliance_independence
			}
			modifier = {
				add = -90
				has_character_flag = gai_alliance_independence
			}
			modifier = {
				add = -50
				has_character_flag = gai_alliance_nothing
			}			
		}
	}
	option = {
		name = ray_story.0318.a
		custom_tooltip = does_ally_gai
		scope:revolutionary = {
			add_character_flag = gai_yes
		}		
		set_relation_rival = {
            target = scope:mardat
            reason = rival_grave_insult
            involved_character = root
		}
		scope:revolutionary = {
			create_alliance = root
			root = {
				add_opinion = {
					target = scope:revolutionary
					modifier = event_negotiated_alliance_opinion
				}
			}
			trigger_event = ray_story.0319
		}
		if = {
			limit = {
				has_character_flag = gai_alliance_title
			}
			custom_tooltip = gai_purge_title_effect
		}
		else_if = {
			limit = {
				has_character_flag = gai_alliance_independence
			}
			custom_tooltip = gai_purge_independence_effect
		}											
		ai_chance = {
			base = 0
			modifier = {
				add = 95
				has_character_flag = gai_alliance_independence
			}
			modifier = {
				add = 90
				has_character_flag = gai_alliance_title
			}
			modifier = {
				add = 50
				has_character_flag = gai_alliance_nothing
			}			
		}
	
	}
}

ray_story.0319 = { # Gai replies
	content_source = realms_dlc
	type = character_event
	title = ray_story.0319.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = gai_yes
					NOT = {
						has_character_flag = gai_no
					}
				}
				desc = ray_story.0319.y.desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = gai_no
					NOT = {
						has_character_flag = gai_yes
					}				
				}
				desc = ray_story.0319.n.desc
			}				
		}
	}
	theme = war	
	override_background = {
		reference = tgp_hunt_generic_asia
	}
	immediate = {
		title:d_gai.holder = { save_scope_as = gai_duke }
		title:k_ray.holder = { save_scope_as = mardat }
		if = {
			limit = {
				has_character_flag = gai_yes
			}
			show_as_tooltip = {
				scope:gai_duke = {
					create_alliance = root
					root = {
						add_opinion = {
							target = scope:gai_duke
							modifier = event_negotiated_alliance_opinion
						}
					}			
				}								
			}			
		}		
	}

	left_portrait = {
		character = root
		animation = personality_honorable
	}	

	right_portrait = {
		character = scope:gai_duke
		animation = thinking
	}

	lower_center_portrait = {
		character = scope:mardat
	}

	option = {
		name = ray_story.0319.a
		trigger = {
			has_character_flag = gai_yes
		}			
		add_legitimacy = 20
		add_prestige = 500
		scope:mardat = {
			trigger_event = ray_story.0320
		}		
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0319.b			
		trigger = {
			has_character_flag = gai_no
		}
		add_opinion = {
			modifier = angry_opinion
			target = scope:gai_duke
			opinion = -50
		}			
		ai_chance = {
			base = 100
		}
	}		
}

ray_story.0320 = { # Ally Gai Mardat POV
	content_source = realms_dlc
	type = character_event
	title = ray_story.0320.t
	desc = ray_story.0320.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = personality_vengeful
	}
	
	right_portrait = {
		character = scope:reactionary
		animation = personality_honorable
	}

	lower_center_portrait = scope:gai_duke
	
	immediate = {
		title:d_gai.holder = { save_scope_as = gai_duke }
		every_ruler = {
			limit = {
				has_character_flag = sent_gai_alliance_offer
			}
			save_scope_as = reactionary
		}
		show_as_tooltip = {
			set_relation_rival = {
            	target = scope:gai_duke
            	reason = rival_grave_insult
           	 	involved_character = root
			}
		}		
	}		
	option = {
		name = ray_story.0320.a
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0321{#Leaving for Bellakar
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:k_ray.holder = { save_scope_as = tim } #The loc refused to work with it being called Mardat for some reason
		title:e_bellakar.holder = { save_scope_as = bellakar_emperor }		
		hidden_effect = { #give free caravan master
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				create_character = {
					template = soldier_friend_character
					employer = root
					save_scope_as = caravan_master
				}
				appoint_court_position = {
					recipient = scope:caravan_master
					court_position = travel_leader_court_position
				}
			}
		}
	}
	theme = diplomacy
	title =	ray_story.0321.t
	desc = ray_story.0321.desc
	override_background = {
		reference = docks
	}
	
	left_portrait = {
		character = root
		animation = chancellor
	}

	right_portrait = {
		character = scope:bellakar_emperor
		animation = personality_honorable
	}

	option = {
		name = ray_story.0321.a
		custom_tooltip = ray_story.0321.a.effects
		set_variable = cannot_cancel_travel		
		add_character_flag = { # Make temporarily immune to disease
			flag = immune_to_disease
			years = 1
		}
		start_travel_plan = { #Travel to Nilulonde
			destination = title:c_nilulonde.title_province
			on_arrival_event = ray_story.0322
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0322 = { # Arrive at Nilulonde / Choose what to ask Bellakar
	content_source = realms_dlc
	type = character_event
	title = ray_story.0322.t
	desc = ray_story.0322.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = personality_honorable
	}
	
	right_portrait = {
		character = scope:bellakar_emperor
		animation = personality_bold
	}

	immediate = {
		title:e_bellakar.holder = { save_scope_as = bellakar_emperor }
		title:k_ray.holder = { save_scope_as = tim } # I have to find out why it has to be Tim now		
	}		
	option = { # Full Alliance
		name = ray_story.0322.a
		custom_tooltip = ray_story.0322.a.effects
		add_character_flag = ray_bellakar_alliance
		scope:bellakar_emperor = {
			trigger_event = ray_story.0323
			add_character_flag = ray_bellakar_alliance
		}
		if = {
			limit = {
				scope:bellakar_emperor = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:bellakar_emperor
				70 = { # success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
					 	min = -29
					}						
					modifier = {
						add = -60
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
					add_character_flag = ray_bellakar_yes
					trigger_event = ray_story.0319
					custom_tooltip = ray_bellakar_yes_t
					custom_tooltip = ray_bellakar_alliance_yes
				}
				30 = { # failure
					compare_modifier = {
						 value = scope:duel_value
					 	multiplier = -1
					 	min = -29
					}						
					modifier = {
						add = 60
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}
					add_character_flag = ray_bellakar_no
					custom_tooltip = ray_bellakar_no_t
					trigger_event = ray_story.0324
				}
			}
		}
		else = {
			random_list = {
				70 = { #Fake success
					custom_tooltip = ray_bellakar_yes_t
					modifier = {
						add = -60
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
					scope:bellakar_emperor = {
						trigger_event = {
							id = ray_story.0323
						}
					}	
				}
				30 = { #Fake failure
					custom_tooltip = ray_bellakar_no_t
					modifier = {
						add = 60
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
					scope:bellakar_emperor = {
						trigger_event = {
							id = ray_story.0323
						}
					}	
				}
			}
		}		
		ai_chance = {
			base = 45
		}
	}
	option = { # Special Soldiers
		name = ray_story.0322.b
		custom_tooltip = ray_story.0322.b.effects
		add_character_flag = ray_bellakar_soldiers
		scope:bellakar_emperor = {
			trigger_event = ray_story.0323
			add_character_flag = ray_bellakar_soldiers
		}		
		if = {
			limit = {
				scope:bellakar_emperor = {
					is_ai = yes
				}
			}
			duel = {
				skill = diplomacy
				target = scope:bellakar_emperor
				80 = { # success					
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
					 	min = -29
					}						
					modifier = {
						add = -70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
					spawn_army = {
						inheritable = yes
						levies = 1000
						name = bellakar_volunteers
						men_at_arms = {
							type = bellanarud_auxiliaries
							stacks = 8
						}
						men_at_arms = {
							type = bellakaze_outriders
							stacks = 2
						}
						men_at_arms = {
							type = bellakarani_phalanx
							stacks = 1
						}
						location = capital_province
					}										
					add_character_flag = ray_bellakar_yes
					trigger_event = ray_story.0319
					custom_tooltip = ray_bellakar_yes_t
				}
				20 = { # failure
					compare_modifier = {
						 value = scope:duel_value
					 	multiplier = -1
					 	min = -29
					}						
					modifier = {
						add = 70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}
					add_character_flag = ray_bellakar_no
					custom_tooltip = ray_bellakar_no_t
					trigger_event = ray_story.0324
				}
			}
		}
		else = {
			random_list = {
				70 = { #Fake success
					custom_tooltip = ray_bellakar_yes_t
					modifier = {
						add = -70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
					scope:bellakar_emperor = {
						trigger_event = {
							id = ray_story.0323
						}
					}	
				}
				30 = { #Fake failure
					custom_tooltip = ray_bellakar_no_t
					modifier = {
						add = 70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
					scope:bellakar_emperor = {
						trigger_event = {
							id = ray_story.0323
						}
					}	
				}
			}
		}			
		ai_chance = {
			base = 40
		}
	}
	option = { # Economic support
		name = ray_story.0322.c
		custom_tooltip = ray_story.0322.c.effects
		add_character_flag = ray_bellakar_gold
		scope:bellakar_emperor = {
			trigger_event = ray_story.0323
			add_character_flag = ray_bellakar_gold
		}
		if = {
			limit = {
				scope:bellakar_emperor = {
					is_ai = yes
				}
			}
			duel = {
				skill = stewardship
				target = scope:bellakar_emperor
				90 = { # success					
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
					 	min = -29
					}						
					modifier = {
						add = -70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}			
					scope:bellakar_emperor = {
						pay_short_term_gold = {
							gold = 1500
							target = root
						}
					}														
					add_character_flag = ray_bellakar_yes
					trigger_event = ray_story.0319
					custom_tooltip = ray_bellakar_yes_t
				}
				10 = { # failure
					compare_modifier = {
						 value = scope:duel_value
					 	multiplier = -1
					 	min = -29
					}						
					modifier = {
						add = 70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}
					add_character_flag = ray_bellakar_no
					custom_tooltip = ray_bellakar_no_t
					trigger_event = ray_story.0324
				}
			}
		}
		else = {
			random_list = {
				70 = { #Fake success
					custom_tooltip = ray_bellakar_yes_t
					modifier = {
						add = -70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
				show_as_tooltip = {
					scope:bellakar_emperor = {
						pay_short_term_gold = {
							gold = 1500
							target = root
						}
					}
				}					
					scope:bellakar_emperor = {
						trigger_event = {
							id = ray_story.0323
						}
					}	
				}
				30 = { #Fake failure
					custom_tooltip = ray_bellakar_no_t
					modifier = {
						add = 70
						NOT = {
							title:e_thon_an_kharlokh = { is_title_created = yes }
						}
					}					
					scope:bellakar_emperor = {
						trigger_event = {
							id = ray_story.0323
						}
					}	
				}
			}
		}				
		ai_chance = {
			base = 15
		}
	}
}

ray_story.0323 = { # Bellakar POV
	content_source = realms_dlc
	type = character_event
	title = ray_story.0323.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = ray_bellakar_alliance
					NOT = { has_character_flag = ray_bellakar_soldiers }
					NOT = { has_character_flag = ray_bellakar_gold }
				}
				desc = ray_story.0323.desc.a
			}
			triggered_desc = {
				trigger = {
					has_character_flag = ray_bellakar_soldiers
					NOT = { has_character_flag = ray_bellakar_gold }
					NOT = { has_character_flag = ray_bellakar_alliance }

				}
				desc = ray_story.0323.desc.s
			}
			triggered_desc = {
				trigger = {
					has_character_flag = ray_bellakar_gold
					NOT = { has_character_flag = ray_bellakar_alliance }
					NOT = { has_character_flag = ray_bellakar_soldiers }
				}
				desc = ray_story.0323.desc.g
			}
		}
	}
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = thinking
	}
	
	right_portrait = {
		character = scope:revolutionary
		animation = beg
	}

	immediate = {
		title:k_ray.holder = { save_scope_as = tim } # I have to find out why it has to be Tim now
		every_ruler = {
			limit = {
				has_character_flag = ray_bellakar_support
			}
			save_scope_as = revolutionary
		}		
	}		
	option = { # Yes
		name = ray_story.0323.a
		custom_tooltip = ray_story.0323.a.effects
		scope:revolutionary = {
			add_character_flag = ray_bellakar_yes
			trigger_event = ray_story.0324
		}
		set_relation_rival = {
            target = scope:tim
            reason = rival_grave_insult
            involved_character = root
		}
		if = {
			limit = {
				has_character_flag = ray_bellakar_gold
			}
			pay_short_term_gold = {
				gold = 1500
				target = scope:revolutionary
			}
		}
		if = {
			limit = {
				has_character_flag = ray_bellakar_soldiers
			}
			remove_short_term_gold = 800
			scope:revolutionary = {
				spawn_army = {
					inheritable = yes
					levies = 1000
					name = bellakar_volunteers
					men_at_arms = {
						type = bellanarud_auxiliaries
						stacks = 8
					}
					men_at_arms = {
						type = bellakaze_outriders
						stacks = 2
					}
					men_at_arms = {
						type = bellakarani_phalanx
						stacks = 1
					}
					location = capital_province
				}
			}
		}
		if = {
			limit = {
				has_character_flag = ray_bellakar_alliance
			}
			custom_tooltip = bellakar_ally_ray_bellakar_pov
			scope:revolutionary = {
				create_alliance = root
				root = {
					add_opinion = {
						target = scope:revolutionary
						modifier = event_negotiated_alliance_opinion
					}
				}		
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 70
				has_character_flag = ray_bellakar_alliance
			}
			modifier = {
				add = 85
				has_character_flag = ray_bellakar_soldiers
			}
			modifier = {
				add = 90
				has_character_flag = ray_bellakar_gold
			}
			modifier = {
				add = -50
				title:e_thon_an_kharlokh = { is_title_created = yes }
			}
		}
	}
	option = { # No
		name = ray_story.0323.b
		custom_tooltip = ray_story.0323.b.effects
		scope:revolutionary = {
			add_character_flag = ray_bellakar_no
			trigger_event = ray_story.0324
		}
		ai_chance = {
			base = 100
			modifier = {
				add = -70
				has_character_flag = ray_bellakar_alliance
			}
			modifier = {
				add = -85
				has_character_flag = ray_bellakar_soldiers
			}
			modifier = {
				add = -90
				has_character_flag = ray_bellakar_gold
			}
			modifier = {
				add = 50
				title:e_thon_an_kharlokh = { is_title_created = yes }
			}			
		}
	}
}

ray_story.0324 = { # Bellakar responds
	content_source = realms_dlc
	type = character_event
	title = ray_story.0324.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = ray_bellakar_yes
					NOT = { has_character_flag = ray_bellakar_no }
				}
				desc = ray_story.0324.desc.y
			}
			triggered_desc = {
				trigger = {
					has_character_flag = ray_bellakar_no
					NOT = { has_character_flag = ray_bellakar_yes }

				}
				desc = ray_story.0324.desc.n
			}
		}
	}
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = personality_honorable
	}
	
	right_portrait = {
		character = scope:bellakar_emperor
		animation = personality_bold
	}

	immediate = {
		title:e_bellakar.holder = { save_scope_as = bellakar_emperor }
		title:k_ray.holder = { save_scope_as = tim } # I have to find out why it has to be Tim now
		show_as_tooltip = {
			if = {
				limit = {	
					AND = {
						has_character_flag = ray_bellakar_gold
						has_character_flag = ray_bellakar_yes
					}
				}	
				pay_short_term_gold = {
					gold = 1500
					target = scope:revolutionary
				}
			}
			if = {
				limit = {
					AND = {
						has_character_flag = ray_bellakar_soldiers
						has_character_flag = ray_bellakar_yes
					}
				}
				scope:revolutionary = {
					spawn_army = {
						inheritable = yes
						levies = 1000
						name = bellakar_volunteers
						men_at_arms = {
							type = bellanarud_auxiliaries
							stacks = 8
						}
						men_at_arms = {
							type = bellakaze_outriders
							stacks = 2
						}
						men_at_arms = {
							type = bellakarani_phalanx
							stacks = 1
						}
						location = capital_province
					}
				}
			}
			if = {
				limit = {
					AND = {
						has_character_flag = ray_bellakar_alliance
						has_character_flag = ray_bellakar_yes
					}					
				}
				custom_tooltip = bellakar_ally_ray_ray_pov
				scope:bellakar_emperor= {
					create_alliance = root
					root = {
						add_opinion = {
							target = scope:bellakar_emperor
							modifier = event_negotiated_alliance_opinion
						}
					}		
				}
			}			
		}
	}		
	option = { # Yay
		name = ray_story.0324.a
		trigger = {
			has_character_flag = ray_bellakar_yes
		}
		scope:tim = {
			trigger_event = ray_story.0325
		}
		add_prestige = 500
		add_legitimacy = 100
		ai_chance = {
			base = 100
		}
	}
	option = { # :(
		name = ray_story.0324.b
		trigger = {
			has_character_flag = ray_bellakar_no
		}		
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0325 = { # Bellakar Alliance Mardat POV
	content_source = realms_dlc
	type = character_event
	title = ray_story.0325.t
	desc = ray_story.0325.desc
	theme = war	
	override_background = {
		reference = corridor_day
	}

	left_portrait = {
		character = root
		animation = personality_honorable
	}
	
	right_portrait = {
		character = scope:bellakar_emperor
		animation = personality_bold
	}

	immediate = {
		title:e_bellakar.holder = { save_scope_as = bellakar_emperor }
		every_ruler = {
			limit = {
				has_character_flag = ray_bellakar_support
			}
			save_scope_as = revolutionary
		}
		show_as_tooltip = {
			set_relation_rival = {
           		target = scope:bellakar_emperor
            	reason = rival_grave_insult
            	involved_character = root
			}
		}
	}		
	option = {
		name = ray_story.0325.a
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0326 = { # Chose how to build up Katri
	content_source = realms_dlc
	type = character_event
	title = ray_story.0326.t
	desc = ray_story.0326.desc
	theme = realm
	override_background = {
		reference = bp2_indian_garden
	}

	left_portrait = {
		character = root
		animation = thinking
	}
	
	right_portrait = {
		character = scope:steward
		animation = debating
	}

	immediate = {
		cp:councillor_steward = {
			save_scope_as = steward
		}
	}		
	option = { #Military
		name = ray_story.0326.a
		duel = {
			skill = martial
			value = high_skill_rating
			90 = { # success					
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3
					min = -29
				}																							
				add_character_flag = katri_military
				trigger_event = ray_story.0327
				custom_tooltip = katri_success
				title:c_tresti = {
					change_development_level = 5
				}
				title:b_tresti.title_province = {
					add_building_if_possible = { BUILDING = military_camps_06 }
					add_building_if_possible = { BUILDING = smiths_04 }	
				}
				if = {
					limit = {
						title:b_tresti.title_province = {
							has_building_or_higher = smiths_04
						}
					}
				}
				else = {
					custom_tooltip = lost_building_slots_500_gold
					hidden_effect = {
						add_gold = 500
					}
				}
				if = {
					limit = {
						title:b_tresti.title_province = {
							has_building_or_higher = military_camps_06
						}
					}
				}
				else = {
					hidden_effect = {
						add_gold = 500
					}
				}					
				}
			10 = { # failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3
					min = -29
				}						
				add_character_flag = katri_fail
				custom_tooltip = katri_failure
				trigger_event = ray_story.0327
			}
		}		
		ai_chance = {
			base = 34
		}
	}
	option = { #Economy
		name = ray_story.0326.b
		duel = {
			skill = stewardship
			value = high_skill_rating
			90 = { # success					
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3
					min = -29
				}																							
				add_character_flag = katri_economy
				trigger_event = ray_story.0327
				custom_tooltip = katri_success
				title:c_tresti = {
					change_development_level = 5
				}
				title:b_tresti.title_province = {
					add_building_if_possible = { BUILDING = windmills_04 }					
					add_building_if_possible = { BUILDING = hunting_grounds_04 }	
				}
				if = {
					limit = {
						title:b_tresti.title_province = {
							has_building_or_higher = hunting_grounds_04
						}
					}
				}
				else = {
					custom_tooltip = lost_building_slots_500_gold
					hidden_effect = {
						add_gold = 500
					}
				}
				if = {
					limit = {
						title:b_tresti.title_province = {
							has_building_or_higher = windmills_04
						}
					}
				}
				else = {
					hidden_effect = {
						add_gold = 500
					}
				}																
			}
			10 = { # failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3
					min = -29
				}						
				add_character_flag = katri_fail
				custom_tooltip = katri_failure
				trigger_event = ray_story.0327
			}
		}		
		ai_chance = {
			base = 33
		}
	}
	option = { #Diplomacy
		name = ray_story.0326.c
		duel = {
			skill = diplomacy
			value = high_skill_rating
			90 = { # success					
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3
					min = -29
				}																							
				add_character_flag = katri_diplomacy
				custom_tooltip = katri_success		
				title:c_tresti = {
					change_development_level = 5
				}					
				add_prestige = 1000
				add_piety = 500
				add_legitimacy = 100			
				trigger_event = ray_story.0327
				}
			10 = { # failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3
					min = -29
				}						
				add_character_flag = katri_fail
				custom_tooltip = katri_failure
				trigger_event = ray_story.0327
			}
		}		
		ai_chance = {
			base = 33
		}
	}		
}

ray_story.0327 = { # Investement result
	content_source = realms_dlc
	type = character_event
	title = ray_story.0327.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = katri_military
					NOT = { has_character_flag = katri_economy }
					NOT = { has_character_flag = katri_diplomacy }
					NOT = { has_character_flag = katri_fail }
				}
				desc = ray_story.0327.desc.mil
			}
			triggered_desc = {
				trigger = {
					has_character_flag = katri_economy
					NOT = { has_character_flag = katri_military }
					NOT = { has_character_flag = katri_diplomacy }
					NOT = { has_character_flag = katri_fail }
				}
				desc = ray_story.0327.desc.eco
			}
			triggered_desc = {
				trigger = {
					has_character_flag = katri_diplomacy
					NOT = { has_character_flag = katri_economy }
					NOT = { has_character_flag = katri_military }
					NOT = { has_character_flag = katri_fail }
				}
				desc = ray_story.0327.desc.dip
			}
			triggered_desc = {
				trigger = {
					has_character_flag = katri_fail
					NOT = { has_character_flag = katri_economy }
					NOT = { has_character_flag = katri_diplomacy }
					NOT = { has_character_flag = katri_military }
				}
				desc = ray_story.0327.desc.fail
			}			
		}
	}
	theme = realm
	override_background = {
		reference = bp2_indian_garden
	}

	left_portrait = {
		character = root
		animation = personality_honorable
	}
	
	right_portrait = {
		character = scope:steward
		animation = happiness
	}

	immediate = {
		cp:councillor_steward = {
			save_scope_as = steward
		}
	}			
	option = { #Good
		name = ray_story.0327.a
		trigger = {
			OR = {
				has_character_flag = katri_diplomacy
				has_character_flag = katri_economy
				has_character_flag = katri_military
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = { #Bad
		name = ray_story.0327.b
		trigger = {
			has_character_flag = katri_fail
		}		
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0328 = { # Let the Doom War begin !
	content_source = realms_dlc
	type = character_event
	title = ray_story.0328.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					faith = faith:faith_vatra
					NOT = {faith = faith:faith_ray}
				}
				desc = ray_story.0328.desc.vatra
			}
			triggered_desc = {
				trigger = {
					faith = faith:faith_ray
					NOT = {faith = faith:faith_vatra}
				}
				desc = ray_story.0328.desc.ray
			}		
		}
	}
	theme = war
	override_background = {
		reference = ep3_military_tent
	}

	left_portrait = {
		character = root
		animation = celebrate_sword
	}
	
	right_portrait = {
		character = scope:mardat
		animation = anger
	}

	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
	}			
	option = {
		name = ray_story.0328.a
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0329 = { # Khäz-gramaze vassals join the war
	content_source = realms_dlc
	type = character_event
	title = ray_story.0329.t
	desc =  ray_story.0329.desc
	theme = war
	override_background = {
		reference = ep3_military_tent
	}
	left_portrait = {
		character = scope:attacker
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:defender
		animation = anger
	}

	lower_center_portrait = root

	trigger = {
		scope:attacker = {
			any_character_war = {
				primary_defender = title:k_ray.holder
			}
		}
	}

	option = {
		name = ray_story.0329.a
		custom_tooltip = ray_story.0329.a.effects
		add_piety = 500
		scope:war = {
			add_defender = root
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0329.b
		ai_chance = {
			base = 0
		}
	}	
}

ray_story.0330 = { # Rebels join the war
	content_source = realms_dlc
	type = character_event
	title = ray_story.0330.t
	desc =  ray_story.0330.desc
	theme = war
	override_background = {
		reference = ep3_military_tent
	}
	left_portrait = {
		character = scope:attacker
		animation = celebrate_sword
	}

	right_portrait = {
		character = scope:defender
		animation = anger
	}

	lower_center_portrait = root

	trigger = {
		scope:attacker = {
			any_character_war = {
				primary_defender = title:k_ray.holder
			}
		}
	}

	option = {
		name = ray_story.0330.a
		custom_tooltip = ray_story.0330.a.effects
		add_legitimacy = 50
		scope:war = {
			add_attacker = root
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				OR = {
					scope:attacker.faith = root.faith
					opinion = {
						target = scope:attacker
						value >= 50
					}
				}
			}
		}
	}
	option = {
		name = ray_story.0330.b
		add_legitimacy = -50
		ai_chance = {
			base = 100
			modifier = {
				add = -100
				OR = {
					scope:attacker.faith = root.faith
					opinion = {
						target = scope:attacker
						value >= 0
					}
				}
			}		
		}
	}
}

ray_story.0331 = { # Doom War starts Mardat POV
	content_source = realms_dlc
	type = character_event
	title = ray_story.0331.t
	desc =  ray_story.0331.desc
	theme = war
	override_background = {
		reference = ep3_military_tent
	}
	left_portrait = {
		character = root
		animation = anger
	}

	right_portrait = {
		character = scope:attacker
		animation = celebrate_sword
	}

	option = {
		name = ray_story.0331.a
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0332 = { # Mardat loses Doom War
	content_source = realms_dlc
	type = character_event
	title = ray_story.0332.t
	desc =  ray_story.0332.desc
	theme = war
	override_background = {
		reference = dungeon
	}
	left_portrait = {
		character = root
		animation = prisondungeon
	}

	right_portrait = {
		character = scope:attacker
		animation = personality_bold
	}

	option = {
		name = ray_story.0332.a
		add_stress = 300
		add_prestige_level = -5
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0333 = { # Mardat wins Doom War
	content_source = realms_dlc
	type = character_event
	title = ray_story.0333.t
	desc =  ray_story.0333.desc
	theme = war
	override_background = {
		reference = corridor_day
	}
	left_portrait = {
		character = root
		animation = personality_callous
	}

	right_portrait = {
		character = scope:attacker
		animation = prisondungeon
	}

	option = { # Kill the leader
		name = ray_story.0333.a
		custom_tooltip = sieze_all_rebel_leader_titles
		hidden_effect = {
			scope:attacker = {			
				create_title_and_vassal_change = {
					type = usurped
					save_scope_as = title_change
					add_claim_on_loss = no
				}			
				every_held_title = {
					change_title_holder_include_vassals = {
						holder = scope:defender
						change = scope:title_change
					}
				}
				resolve_title_and_vassal_change = scope:title_change		
			}
		}		
		scope:attacker = {
			death = {
				death_reason = death_torture
				killer = root
			}
		}
		add_piety = 500
		add_prestige = 500		
		stress_impact = {
			wrathful = miniscule_stress_impact_loss
			sadistic = major_stress_impact_loss
			vengeful = medium_stress_impact_loss
			compassionate = major_stress_impact_gain
			forgiving = medium_stress_impact_gain
		}			
		ai_chance = {
			base = 100
		}
	}
	option = { # Spare the leader
		name = ray_story.0333.b
		stress_impact = {
			sadistic = major_stress_impact_gain
			vengeful = major_stress_impact_gain
			compassionate = miniscule_stress_impact_loss
			forgiving = minor_stress_impact_loss
		}	
		add_legitimacy = 5
		ai_chance = {
			base = 0
		}
	}	
}

ray_story.0334 = { # Rebels win Doom War
	content_source = realms_dlc
	type = character_event
	title = ray_story.0334.t
	desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					faith = faith:faith_vatra
					NOT = {faith = faith:faith_ray}
				}
				desc = ray_story.0334.desc.vatra
			}
			triggered_desc = {
				trigger = {
					faith = faith:faith_ray
					NOT = {faith = faith:faith_vatra}
				}
				desc = ray_story.0334.desc.ray
			}		
		}
	}
	theme = war
	override_background = {
		reference = corridor_day
	}
	left_portrait = {
		character = root
		animation = personality_bold
	}

	right_portrait = {
		character = scope:defender
		animation = prisondungeon
	}

	immediate = {
		if = {
			limit = {
				AND = {
					title:d_felira = { is_title_created = yes }
					has_character_flag = ray_alliance_de_jure
				}
			}
			trigger_event = {
				id = ray_story.0337
				days = 1
			}
		}
		else_if = {
			limit = {
				AND = {
					title:d_gai = { is_title_created = yes }
					has_character_flag = gai_alliance_independence
				}
			}
			trigger_event = {
				id = ray_story.0338
				days = 1
			}
		}
		else_if = {
			limit = {
				AND = {
					title:d_gai = { is_title_created = yes }
					title:d_suza_riy.holder = {
						OR = {
							this = root
							faith = faith:faith_haruze
						}
					}
					has_character_flag = gai_alliance_title
				}
			}
			title:d_gai.holder = {
				get_title = title:d_suza_riy
			}
			trigger_event = {
				id = ray_story.0338
				days = 1
			}
		}		
	}

	option = { # Execute Mardat
		name = ray_story.0334.a
		scope:defender = {
			death = {
				death_reason = death_mardat_execution
			}
		}
		add_prestige = 1000	
		stress_impact = {
			wrathful = miniscule_stress_impact_loss
			sadistic = major_stress_impact_loss
			vengeful = medium_stress_impact_loss
			compassionate = major_stress_impact_gain
			forgiving = medium_stress_impact_gain
		}			
		ai_chance = {
			base = 70
		}
	}
	option = { # Spare Mardat
		name = ray_story.0334.b
		stress_impact = {
			sadistic = major_stress_impact_gain
			vengeful = major_stress_impact_gain
			compassionate = miniscule_stress_impact_loss
			forgiving = minor_stress_impact_loss
		}	
		add_legitimacy = 5
		ai_chance = {
			base = 30
		}
	}	
}

ray_story.0335 = { # Rebels lose Doom War
	content_source = realms_dlc
	type = character_event
	title = ray_story.0335.t
	desc =  ray_story.0335.desc
	theme = war
	override_background = {
		reference = dungeon
	}
	left_portrait = {
		character = root
		animation = prisondungeon
	}

	right_portrait = {
		character = scope:defender
		animation = personality_callous
	}

	option = {
		name = ray_story.0335.a
		scope:defender = {trigger_event = ray_story.0333}
		add_stress = 300
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0336 = { # The Khäz-gramaze die out
	content_source = realms_dlc
	type = character_event
	title = ray_story.0336.t
	desc =  ray_story.0336.desc
	theme = realm
	override_background = {
		reference = bp1_courtyard_indian
	}
	left_portrait = {
		character = root
		animation = personality_honorable
	}

	right_portrait = {
		character = scope:chaplain
		animation = prayer
	}

	immediate = {
		cp:councillor_court_chaplain= {
			save_scope_as = chaplain
		}
	}

	option = {
		name = ray_story.0336.a
		custom_tooltip = khaz_gramaze_die_out
		hidden_effect = {
			every_sub_realm_county = {
				limit = {
					faith = faith:faith_haruze
				}
				random = {
					chance = 95
					set_county_faith = root.faith
				}
			}
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0337 = { # Felira asks for their de jure
	content_source = realms_dlc
	type = character_event
	title = ray_story.0337.t
	desc =  ray_story.0337.desc
	theme = realm
	override_background = {
		reference = corridor_day
	}
	left_portrait = {
		character = root
		animation = personality_honorable
	}

	right_portrait = {
		character = scope:felira_duke
		animation = chancellor
	}

	immediate = {
		title:d_felira.holder = { save_scope_as = felira_duke }
	}

	option = {
		name = ray_story.0337.a
		scope:felira_duke = {
			get_title = title:c_dezful
			get_title = title:c_baitu
		}
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0338 = { # Gai gets its reward
	content_source = realms_dlc
	type = character_event
	title = ray_story.0338.t
		desc = {
		random_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = gai_alliance_title
					NOT = {has_character_flag = gai_alliance_independence}
				}
				desc = ray_story.538.desc.t
			}
			triggered_desc = {
				trigger = {
					has_character_flag = gai_alliance_independence
					NOT = {has_character_flag = gai_alliance_title}
				}
				desc = ray_story.538.desc.i
			}
		}
	}
	theme = realm
	override_background = {
		reference = corridor_day
	}
	left_portrait = {
		character = root
		animation = personality_honorable
	}

	right_portrait = {
		character = scope:gai_duke
		animation = chancellor
	}

	immediate = {
		title:d_gai.holder = { save_scope_as = gai_duke }
		if = {
			limit = {
				has_character_flag = gai_alliance_title
			}
			show_as_tooltip = {
				title:d_gai.holder = {
					get_title = title:d_suza_riy
				}				
			}
		}
	}

	option = { # You promised land to Gaì
		name = ray_story.0338.a
		trigger = {
			has_character_flag = gai_alliance_title
		}
		ai_chance = {
			base = 100
		}
	}
	option = { # You promised independence to Gaì
		name = ray_story.0338.b
		trigger = {
			has_character_flag = gai_alliance_independence
		}
		every_vassal = {
			limit = { has_title = title:d_gai }
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = change
				add_claim_on_loss = no
			}
			becomes_independent = {
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}
		scope:gai_duke = {
			start_tributary = {
				contract_group = tributary_protectorate
				suzerain = root
			}
		}			
		ai_chance = {
			base = 100
		}
	}	
}

#############################
###  Vâtalinar Storyline  ###
#############################

ray_story.0401 = {# Kanivatra exiles (Even in his own content, Vâtalinar starts by dying)
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = mardat }
		add_realm_law = camp_purpose_legitimists
		add_pressed_claim = title:k_ray
		set_relation_rival = {
            target = scope:mardat
            reason = rival_claimed_my_title
            involved_character = root
		}		
	}
	title =	ray_story.0401.t
	desc = ray_story.0401.desc
	override_background = { reference = burning_building }
	override_effect_2d = smoke
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:mardat
		animation = personality_callous
	}

	option = { 
		name = ray_story.0401.a
		add_trait = vengeful
		add_prestige_level = 2

		ai_chance = {
			base = 100
		}
	}
	option = { 
		name = ray_story.0401.b
		add_prestige_level = 1

		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0402 = {# Mardat is definitely up to something
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }		
	}
	title =	ray_story.0402.t
	desc = ray_story.0402.desc
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = paranoia
	}

	option = { # Investigate the obvious traitor
		name = ray_story.0402.a
		add_stress = 20
		add_trait = paranoid
		custom_tooltip = ray_begin_investigation
		ai_chance = {
			base = 0
		}
	}
	option = { # Must have been the wind...
		name = ray_story.0402.b
		custom_tooltip = opt_out_of_story_content
		add_character_flag = ray_mardat_trust		
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0403 = {# Chose what to investigate
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		cp:councillor_spymaster= {
			save_scope_as = spymaster
		}
	}
	title =	ray_story.0403.t
	desc = {
		desc = ray_story.0403.desc
		triggered_desc = {
			trigger = {
				NOT = {has_character_flag = vatalinar_criminal_completion}
			}
			desc = ray_story.0403.desc.crime
		}
		triggered_desc = {
			trigger = {
				NOT = {has_character_flag = vatalinar_army_completion}
			}
			desc = ray_story.0403.desc.army
		}
		triggered_desc = {
			trigger = {
				NOT = {has_character_flag = vatalinar_lords_completion}
			}
			desc = ray_story.0403.desc.lords
		}
				
	}
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:spymaster
		animation = spymaster
	}	

	option = { # Investigate the criminals
		name = ray_story.0403.a
		trigger = {
			NOT = {
				has_character_flag = vatalinar_criminal_completion
			}
		}
		custom_tooltip = vatalinar_investigate_criminals
		trigger_event = {
			id = ray_story.0404
		}
		ai_chance = {
			base = 33
		}
	}
	option = { # Investigate the army
		name = ray_story.0403.b	
		trigger = {
			NOT = {has_character_flag = vatalinar_army_completion}
		}		
		custom_tooltip = vatalinar_investigate_army		
		trigger_event = {
			id = ray_story.0410
		}
		ai_chance = {
			base = 33
		}
	}
	option = { # Investigate the lords
		name = ray_story.0403.c	
		trigger = {
			NOT = {has_character_flag = vatalinar_lords_completion}
		}			
		custom_tooltip = vatalinar_investigate_lords	
		trigger_event = {
			id = ray_story.0413
		}		
		ai_chance = {
			base = 33
		}
	}		
}

ray_story.0404 = {# Crime : Capturing the informant
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		debug_log = "Vâtalinar: Informant Leader"
		create_character = {
			name = Vatrak
			gender = male
			age = 32
			culture = culture:bozishnarud
			faith = faith:faith_vatra
			trait = greedy
			trait = deceitful
			trait = callous
			trait = education_intrigue_2
			location = capital_province
			
			save_scope_as = informant
		}			
	}
	title =	ray_story.0404.t
	desc = ray_story.0404.desc
	override_background = { reference = alley_night }
	
	left_portrait = {
		character = root
		animation = spymaster
	}

	right_portrait = {
		character = scope:informant
		animation = scheme
	}

	option = { # Kidnap the guy
		name = ray_story.0404.a
		add_stress = 5
		reverse_add_opinion = {
			modifier = attempted_abduction_opinion
			target = scope:informant
			opinion = -80
		}		
		duel = {
			skill = intrigue
			target = scope:informant	
			75 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 2
				min = -29
			}						
				custom_tooltip = ray_story.crime.success
				imprison = {
					target = scope:informant
					type = dungeon
				}				
				trigger_event = {
					id = ray_story.0406
				}
			}
			25 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}						
				custom_tooltip = ray_story.crime.fail
				trigger_event = {
					id = ray_story.0405
				}
			}
		}		
		ai_chance = {
			base = 100
		}
	}
	option = { # Make a deal
		name = ray_story.0404.b	
		duel = {
			skill = diplomacy
			target = scope:informant	
			75 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 2
				min = -29
			}						
				custom_tooltip = ray_story.crime.success			
				pay_short_term_gold = {
					gold = 500
					target = scope:informant
				}				
				trigger_event = {
					id = ray_story.0407
				}
			}
			25 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}						
				custom_tooltip = ray_story.crime.fail
				trigger_event = {
					id = ray_story.0405
				}
			}
		}		
		ai_chance = {
			base = 100
		}
	}	
	option = { # Pull out
		name = ray_story.0404.c
		custom_tooltip = vatalinar_investigate_pull_out
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0405 = {# Failed the crime path
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }		
	}
	title =	ray_story.0405.t
	desc = ray_story.0405.desc
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = disappointed
	}

	option = {
		name = ray_story.0405.a
		custom_tooltip = vatalinar_failed_criminal_investigation		
		add_stress = 50
		add_character_flag = vatalinar_criminal_completion
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0406 = {# Crime : Interrogation
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }		
	}
	title =	ray_story.0406.t
	desc = ray_story.0406.desc
	override_background = { reference = dungeon }
	
	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:informant
		animation = prisondungeon
	}

	option = { # Standard interrogation
		name = ray_story.0406.a	
		duel = {
			skill = intrigue
			target = scope:informant	
			65 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 3
				min = -29
			}						
				custom_tooltip = ray_story.crime.success				
				trigger_event = {
					id = ray_story.0407
				}
			}
			35 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -3
				min = -29
			}						
				custom_tooltip = ray_story.crime.fail
				trigger_event = ray_story.0405
			}
		}	
		ai_chance = {
			base = 100
		}
	}
	option = { # Torture
		name = ray_story.0406.b
		# Vâtalinar becomes evil trait effects
		if = {
			limit = {
				has_trait = gregarious
			}
			remove_trait = gregarious
			add_trait = callous
		}
		###		
		reverse_add_opinion = {
			modifier = tortured_me
			target = scope:informant
			opinion = -100
		}
		duel = {
			skill = intrigue
			target = scope:informant
			90 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 3
				min = -29
			}						
				custom_tooltip = ray_story.crime.success				
				trigger_event = {
					id = ray_story.0407
				}
			}
			10 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -3
				min = -29
			}						
				custom_tooltip = ray_story.crime.fail
				trigger_event = {
					id = ray_story.0405
				}
			}
		}	
		ai_chance = {
			base = 100
		}
	}
	option = { # Bribe
		name = ray_story.0406.c		
		duel = {
			skill = diplomacy
			target = scope:informant	
			80 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 3
				min = -29
			}						
				pay_short_term_gold = {
					gold = 300
					target = scope:informant
				}					
				custom_tooltip = ray_story.crime.success			
				trigger_event = {
					id = ray_story.0407
				}
			}
			20 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -3
				min = -29
			}						
				custom_tooltip = ray_story.crime.fail
				trigger_event = {
					id = ray_story.0405
				}
			}
		}	
		ai_chance = {
			base = 100
		}
	}	
	option = { # Pull out
		name = ray_story.0406.d
		custom_tooltip = vatalinar_pull_out_end
		add_stress = 10
		add_character_flag = vatalinar_criminal_completion		
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0407 = {# Raid conspiracy spies
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }	
		cp:councillor_spymaster= {
			save_scope_as = spymaster
		}
		add_character_flag = vatalinar_criminal_completion						
	}
	title =	ray_story.0407.t
	desc = ray_story.0407.desc
	override_background = { reference = alley_night }
	
	left_portrait = {
		character = root
		animation = personality_vengeful
	}

	right_portrait = {
		character = scope:spymaster
		animation = spymaster
	}

	option = { # Open raid
		name = ray_story.0407.a	
		duel = {
			skill = martial
			target = scope:mardat	
			40 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 3
				min = -29
			}						
				custom_tooltip = ray_story.crime.success.last			
				trigger_event = {
					id = ray_story.0408
				}
			}
			60 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -3
				min = -29
			}						
				custom_tooltip = ray_story.crime.fail.last
				trigger_event = {
					id = ray_story.0405
				}
			}
		}	
		ai_chance = {
			base = 100
		}
	}
	option = { # Inflitration
		name = ray_story.0407.b	
		duel = {
			skill = intrigue
			target = scope:mardat
			50 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 3
				min = -29
			}						
				custom_tooltip = ray_story.crime.success.last					
				trigger_event = {
					id = ray_story.0408
				}
			}
			50 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -3
				min = -29
			}						
				custom_tooltip = ray_story.crime.fail.last
				trigger_event = {
					id = ray_story.0405
				}
			}
		}	
		ai_chance = {
			base = 100
		}
	}	
	option = { # Pull out
		name = ray_story.0407.c
		custom_tooltip = vatalinar_pull_out_end
		add_stress = 10	
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0408 = {# Discover Mardat
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }		
	}
	title =	ray_story.0408.t
	desc = ray_story.0408.desc
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = spymaster
	}

	right_portrait = {
		character = scope:mardat
		animation = shock
	}

	option = {
		name = ray_story.0408.a
		custom_tooltip = vatalinar_succeeded_criminal_investigation
		scope:mardat = {
			trigger_event = {
				id = ray_story.0409
			}			
		}
		set_relation_rival = {
            target = scope:mardat
            reason = rival_claimed_my_title
            involved_character = root
		}		
		add_stress = -50
		add_character_flag = vatalinar_discovered_mardat
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0409 = {# Mardat is discovered Mardat POV
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }		
	}
	title =	ray_story.0409.t
	desc = ray_story.0409.desc
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = shock
	}

	right_portrait = {
		character = scope:ray_king
		animation = spymaster
	}

	option = {
		name = ray_story.0409.a
		custom_tooltip = vatalinar_may_act
		show_as_tooltip = {
			set_relation_rival = {
            	target = scope:ray_king
           		reason = rival_claimed_my_title
            	involved_character = root
			}
		}
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0410 = {# Army : Investigate the capital guard
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		cp:councillor_marshal = {
			save_scope_as = marshal
		}					
	}
	title =	ray_story.0410.t
	desc = ray_story.0410.desc
	override_background = { reference = ep3_military_tent }
	
	left_portrait = {
		character = root
		animation = spymaster
	}

	right_portrait = {
		character = scope:marshal
		animation = marshal
	}

	option = { # Investigate traitors
		name = ray_story.0410.a
		custom_tooltip = vatalinar_army_mardat_must_have_guard
		duel = {
			skill = intrigue
			target = scope:mardat
			30 = { # success
			compare_modifier = {
				target = scope:mardat
				multiplier = 2
				min = -29
			}						
				custom_tooltip = ray_story.army.success				
				if = {
					limit = {
						scope:mardat = {
							has_character_flag = mardat_guard
						}
					}
					trigger_event = {
						id = ray_story.0408
					}
					add_character_flag = vatalinar_army_completion						
				}
				else = {
					trigger_event = {
						id = ray_story.0412
					}
					add_character_flag = vatalinar_guard_fail							
				}
			}
			70 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}						
				add_character_flag = vatalinar_guard_fail						
				custom_tooltip = ray_story.army.fail
				trigger_event = {
					id = ray_story.0412
				}
			}
		}		
		ai_chance = {
			base = 100
		}
	}
	option = { # Replace the entire guard
		name = ray_story.0410.b	
		custom_tooltip = vatalinar_army_mardat_must_have_guard
		duel = {
			skill = martial
			target = scope:mardat
			65 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 2
				min = -29
			}									
				custom_tooltip = ray_story.army.success
				remove_short_term_gold = 800						
				if = {
					limit = {
						scope:mardat = {
							has_character_flag = mardat_guard
						}
					}
					trigger_event = {
						id = ray_story.0408
					}
					add_character_flag = vatalinar_army_completion						
				}
				else = {
					trigger_event = {
						id = ray_story.0412
					}
					add_character_flag = vatalinar_guard_fail							
				}
			}
			35 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}						
				custom_tooltip = ray_story.army.fail
				add_character_flag = vatalinar_guard_fail				
				trigger_event = {
					id = ray_story.0412
				}
			}
		}		
		ai_chance = {
			base = 100
		}
	}	
	option = { # Other option
		name = ray_story.0410.c
		custom_tooltip = vatalinar_army_other_choice
		trigger = {
			NOT = {has_character_flag = vatalinar_navy_fail}
		}		
		trigger_event = {
			id = ray_story.0411
		}		
		ai_chance = {
			base = 100
		}
	}
	option = { # Pull out
		name = ray_story.0410.d
		custom_tooltip = vatalinar_investigate_army_pull_out
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0411 = {# Army : Investigate the navy
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		cp:councillor_marshal = {
			save_scope_as = marshal
		}
	}
	title =	ray_story.0411.t
	desc = ray_story.0411.desc
	override_background = { reference = docks }
	
	left_portrait = {
		character = root
		animation = spymaster
	}

	right_portrait = {
		character = scope:marshal
		animation = marshal
	}

	option = { # Investigate traitors
		name = ray_story.0411.a
		custom_tooltip = vatalinar_army_mardat_must_have_navy
		duel = {
			skill = intrigue
			target = scope:mardat
			30 = { # success
			compare_modifier = {
				target = scope:mardat
				multiplier = 2
				min = -29
			}									
				custom_tooltip = ray_story.army.success				
				if = {
					limit = {
						scope:mardat = {
							has_character_flag = mardat_navy
						}
					}
					trigger_event = {
						id = ray_story.0408
					}
					add_character_flag = vatalinar_army_completion						
				}
				else = {
					trigger_event = {
						id = ray_story.0412
					}
					add_character_flag = vatalinar_navy_fail					
				}
			}
			70 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}						
				add_character_flag = vatalinar_navy_fail				
				custom_tooltip = ray_story.army.fail
				trigger_event = {
					id = ray_story.0412
				}
			}
		}		
		ai_chance = {
			base = 100
		}
	}
	option = { # Cull navy officials
		name = ray_story.0411.b	
		custom_tooltip = vatalinar_army_mardat_must_have_navy
		duel = {
			skill = martial
			target = scope:mardat
			65 = { # success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 2
				min = -29
			}						
				custom_tooltip = ray_story.army.success
				remove_short_term_gold = 800						
				if = {
					limit = {
						scope:mardat = {
							has_character_flag = mardat_navy
						}
					}
					add_character_flag = vatalinar_army_completion	
					trigger_event = {
						id = ray_story.0408
					}
				}
				else = {
					trigger_event = {
						id = ray_story.0412
					}
					add_character_flag = vatalinar_navy_fail					
				}
			}
			35 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}
				add_character_flag = vatalinar_navy_fail
				custom_tooltip = ray_story.army.fail
				trigger_event = {
					id = ray_story.0412
				}
			}
		}		
		ai_chance = {
			base = 100
		}
	}	
	option = { # Other option
		name = ray_story.0411.c
		trigger = {
			NOT = {has_character_flag = vatalinar_guard_fail}
		}
		custom_tooltip = vatalinar_army_other_choice_2
		trigger_event = {
			id = ray_story.0410
		}		
		ai_chance = {
			base = 100
		}
	}
	option = { # Pull out
		name = ray_story.0410.d
		custom_tooltip = vatalinar_investigate_army_pull_out
		ai_chance = {
			base = 100
		}
	}
}

ray_story.0412 = {# Army : Failure
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		cp:councillor_spymaster= {
			save_scope_as = marshal
		}
	}
	title =	ray_story.0412.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					AND = {
						has_character_flag = vatalinar_navy_fail
						has_character_flag = vatalinar_guard_fail
					}
				}
				desc = ray_story.0412.true_fail
			}
			triggered_desc = {
				trigger = {
					has_character_flag = vatalinar_navy_fail
				}
				desc = ray_story.0412.navy_fail
			}
			triggered_desc = {
				trigger = {
					has_character_flag = vatalinar_guard_fail
				}
				desc = ray_story.0412.guard_fail
			}							
		}				
	}
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:marshal
		animation = disapproval
	}	

	option = { # Go back to the navy
		name = ray_story.0412.a
		trigger = {
			NOT = {
				has_character_flag = vatalinar_navy_fail
			}
		}
		custom_tooltip = vatalinar_navy_choice
		trigger_event = {
			id = ray_story.0411
		}
		ai_chance = {
			base = 33
		}
	}
	option = { # Go back to the guard
		name = ray_story.0412.b	
		trigger = {
			NOT = {
				has_character_flag = vatalinar_guard_fail
			}
		}		
		custom_tooltip = vatalinar_guard_choice	
		trigger_event = {
			id = ray_story.0410
		}
		ai_chance = {
			base = 33
		}
	}
	option = { # Its over
		name = ray_story.0412.c
		custom_tooltip = vatalinar_army_fail_completion
		add_character_flag = vatalinar_army_completion		
		add_stress = 50
		ai_chance = {
			base = 33
		}
	}		
}

ray_story.0413 = {# Lords : Intro
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		cp:councillor_spymaster= {
			save_scope_as = spymaster
		}			
	}
	title =	ray_story.0413.t
	desc = ray_story.0413.desc
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = personality_vengeful
	}

	right_portrait = {
		character = scope:spymaster
		animation = debating
	}

	option = { # Stop at nothing
		name = ray_story.0413.a
		custom_tooltip = vatalinar_lords_tyrant_investigation
		# Vâtalinar becomes evil trait effects
		if = {
			limit = {
				has_trait = gregarious
			}
			remove_trait = gregarious
			add_trait = callous
		}
		###
		trigger_event = {
			id = ray_story.0414
		}				
		ai_chance = {
			base = 100
		}
	}
	option = { # Reasonable investigation
		name = ray_story.0413.b
		custom_tooltip = vatalinar_lords_sneaky_investigation
		trigger_event = {
			id = ray_story.0416
		}				
		add_stress = 25
		ai_chance = {
			base = 100
		}
	}	
	option = { # Make another choice
		name = ray_story.0413.c
		custom_tooltip = vatalinar_lords_go_back_to_choices
		trigger_event = {
			id = ray_story.0403
		}				
		ai_chance = {
			base = 100
		}
	}		
}

ray_story.0414 = {# Lords : tyranny
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
	}
	title =	ray_story.0414.t
	desc = ray_story.0414.desc
	override_background = { reference = corridor_day }
	
	left_portrait = {
		character = root
		animation = personality_vengeful
	}

	option = { # Crackdown on rebels
		name = ray_story.0414.a
		custom_tooltip = vatalinar_lords_last_warning
		add_character_flag = vatalinar_lords_completion		
		add_stress = -10		
		duel = {
			skill = intrigue
			target = scope:mardat
			0 = { # success
			compare_modifier = {
				target = scope:mardat
				multiplier = 2
				min = -29
			}									
				custom_tooltip = ray_story_lords.success				
				add_dread = 50
				trigger_event = {
					id = ray_story.0408
				}
			}
			100 = { # RIP
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}										
				add_tyranny = 100
				add_legitimacy = -100
				custom_tooltip = ray_story_lords.fail
				trigger_event = {
					id = ray_story.0415
				}
			}
		}
		ai_chance = {
			base = 100
		}
	}	
	option = { # Go back
		name = ray_story.0414.b
		trigger_event = {
			id = ray_story.0403
		}		
		custom_tooltip = vatalinar_lords_go_back_to_choices
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0415 = {# GG
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }		
	}
	title =	ray_story.0415.t
	desc = ray_story.0415.desc
	override_background = { reference = corridor_day }
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:mardat
		animation = personality_callous
	}

	option = {
		name = ray_story.0415.a
		scope:mardat = {
			add_character_flag = mardat_chaos_coup
			trigger_event = {
				id = ray_story.0418
			}			
		}
		set_relation_rival = {
            target = scope:mardat
            reason = rival_claimed_my_title
            involved_character = root
		}
		add_stress = 100
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0416 = {# Lords : sneaky
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		cp:councillor_spymaster= {
			save_scope_as = spymaster
		}		
	}
	title =	ray_story.0416.t
	desc = ray_story.0416.desc
	override_background = { reference = corridor_day }
	
	left_portrait = {
		character = root
		animation = personality_dishonorable
	}

	right_portrait = {
		character = scope:spymaster
		animation = spymaster
	}	

	option = { # Crackdown on rebels
		name = ray_story.0416.a
		add_character_flag = vatalinar_lords_completion
		duel = {
			skill = intrigue
			target = scope:mardat
			30 = { # success
			compare_modifier = {
				target = scope:mardat
				multiplier = 2
				min = -29
			}									
				custom_tooltip = ray_story_lords.success
				trigger_event = {
					id = ray_story.0408
				}
			}
			70 = { # failure
			compare_modifier = {
				value = scope:duel_value
				multiplier = -2
				min = -29
			}
				custom_tooltip = ray_story_lords.fail
				trigger_event = {
					id = ray_story.0417
				}
			}
		}
		ai_chance = {
			base = 100
		}
	}	
	option = { # Go back
		name = ray_story.0416.b
		trigger_event = {
			id = ray_story.0403
		}		
		custom_tooltip = vatalinar_lords_go_back_to_choices
		ai_chance = {
			base = 0
		}
	}
}

ray_story.0417 = {# Fail Lord Investigation
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }
		cp:councillor_spymaster= {
			save_scope_as = spymaster
		}				
	}
	title =	ray_story.0417.t
	desc = ray_story.0417.desc
	override_background = { reference = corridor_day }
	
	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:spymaster
		animation = disapproval
	}

	option = {
		name = ray_story.0417.a
		add_stress = 20
		ai_chance = {
			base = 100
		}
	}	
}

ray_story.0418 = {# Fail Lord Investigation
	content_source = realms_dlc
	type = character_event
	theme = intrigue
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }			
	}
	title =	ray_story.0418.t
	desc = ray_story.0418.desc
	override_background = { reference = corridor_night }
	
	left_portrait = {
		character = root
		animation = scheme
	}

	right_portrait = {
		character = scope:ray_king
		animation = disbelief
	}

	option = {
		name = ray_story.0418.a
		custom_tooltip = mardat_chaos_coup_chance
		trigger_event = {
			id = ray_story.0163
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ray_story.0418.b
		ai_chance = {
			base = 0
		}
	}		
}

ray_story.0419 = {# Vatalinar Begins Civil War Mardat POV
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:k_ray.holder = { save_scope_as = ray_king }			
	}
	title =	ray_story.0419.t
	desc = ray_story.0419.desc
	override_background = { reference = ep3_military_tent }
	
	left_portrait = {
		character = root
		animation = personality_callous
	}

	right_portrait = {
		character = scope:ray_king
		animation = personality_vengeful
	}

	option = {
		name = ray_story.0419.a
		ai_chance = {
			base = 100
		}
	}		
}

ray_story.0420 = {# Vatalinar Begins Civil War
	content_source = realms_dlc
	type = character_event
	theme = war
	immediate = {
		title:d_suza_riy.holder = { save_scope_as = mardat }			
	}
	title =	ray_story.0420.t
	desc = ray_story.0420.desc
	override_background = { reference = ep3_military_tent }
	
	left_portrait = {
		character = root
		animation = personality_vengeful
	}

	right_portrait = {
		character = scope:mardat
		animation = anger
	}

	option = {
		name = ray_story.0420.a
		scope:mardat = {
			trigger_event = {
				id = ray_story.0419
			}
			start_war = {
				cb = mardat_ray_claim_cb
				target = root
				claimant = scope:mardat
				target_title = title:k_ray
				target_title = title:c_bozisha_dar
				target_title = title:c_aziya
				target_title = title:c_hartas
			}
			if = {
				limit = {
					title:e_bozisha_miraz = { is_title_created = no }
				}
				add_character_flag = mardat_coup_transition
			}				
		}
		ai_chance = {
			base = 100
		}
	}		
}












