namespace = war_of_the_rohirrim

### Freca/Wulf Events ###
#			Helm's Council
#			war_of_the_rohirrim.0100		Freca is called to Council
#			war_of_the_rohirrim.0101		Proud Freca arrives in Edoras
#			war_of_the_rohirrim.0102		Helm receives proud Freca
#			war_of_the_rohirrim.0103		Freca makes his demands
#			war_of_the_rohirrim.0104		Helm's positive response to Freca
#			war_of_the_rohirrim.0105		Helm's negative response to Freca
#			war_of_the_rohirrim.0106		Helm takes Freca outside
#			war_of_the_rohirrim.0107		Freca's Death
#			war_of_the_rohirrim.0108		Humble Freca arrives in Edoras
#			war_of_the_rohirrim.0109		Helm receives humble Freca
#			war_of_the_rohirrim.0110		Freca makes his requests
#			war_of_the_rohirrim.0111		Freca's Death, Wulf reaction
#--------------------------------------------------------------


# Freca: A Call to Council
war_of_the_rohirrim.0100 = {
	content_source = realms_dlc
	type = character_event
	title =  war_of_the_rohirrim.0100.t
	desc =  war_of_the_rohirrim.0100.desc
	theme = realm
	override_background = {
		reference = edoras
	}
	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:helm
		animation = anger
	}
	lower_left_portrait = scope:wulf
	lower_right_portrait = scope:freawine

	immediate = {
		play_music_cue = lotr_cue_rohan
		character:lineofeorl9 = { save_scope_as = helm }
		character:lineoffreca3 = { save_scope_as = wulf }
		character:linegeanmar9 = { save_scope_as = targg }
		character:lineofeorl5 = { save_scope_as = freawine }
		hidden_effect = {
			create_character = {
				template = foreign_architect_template
				employer = root
				save_scope_as = caravan_master
			}
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				appoint_court_position = {
					recipient = scope:caravan_master
					court_position = travel_leader_court_position
				}
			}
		}
	}

	option = {
		name =  war_of_the_rohirrim.0100.a
		set_variable = cannot_cancel_travel
		custom_tooltip = war_of_the_rohirrim.0100.a.effects
		add_prestige = 150
		stress_impact = {
			arrogant = minor_stress_impact_loss
			ambitious = minor_stress_impact_loss
		}
		custom_tooltip = war_of_the_rohirrim.0100.a.effects2
		save_scope_as = bold_approach
		start_travel_plan = {
			destination = title:c_kingstead.title_province
			companion = scope:wulf
			companion = scope:targg
			on_arrival_event = war_of_the_rohirrim.0101
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = last
		}
		ai_chance = {
			base = 100
		}
	}

	option = {
		name =  war_of_the_rohirrim.0100.b
		set_variable = cannot_cancel_travel
		custom_tooltip = war_of_the_rohirrim.0100.b.effects
		add_prestige = -150
		stress_impact = {
			arrogant = medium_stress_impact_gain
		}
		custom_tooltip = war_of_the_rohirrim.0100.b.effects2
		save_scope_as = calm_approach
		start_travel_plan = {
			destination = title:c_kingstead.title_province
			companion = scope:wulf
			on_arrival_event = war_of_the_rohirrim.0101
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = last
		}
		ai_chance = {
			base = 0
		}
	}

	option = {
		name =  war_of_the_rohirrim.0100.c
		# Trigger refusal event for Helm
		custom_tooltip = freca_helm_opt_out_of_story_content
		add_prestige = 100
		stress_impact = {
			arrogant = minor_stress_impact_loss
		}
		scope:helm = {
			custom_tooltip =  war_of_the_rohirrim.0100.c.effects
			add_opinion = {
				target = root
				modifier = rebellious_vassal_opinion
			}
			set_relation_rival = { reason = rival_age_old_rivalry target = root }
		}
		ai_chance = {
			base = 0
		}
	}
}

# Freca: Freca's Proposal
war_of_the_rohirrim.0101 = {
	type = character_event
	title = war_of_the_rohirrim.0101.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:calm_approach
				}
				desc = war_of_the_rohirrim.0101.desc.calm
			}
			desc = war_of_the_rohirrim.0101.desc.bold
		}
	}
	theme = realm
	
	left_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				exists = scope:calm_approach
			}
			animation = debating
		}
		animation = anger
	}

	right_portrait = {
		character = scope:helm
		animation = disapproval
	}

	lower_left_portrait = scope:wulf
	lower_right_portrait = scope:hera
	
	option = { 
		name = war_of_the_rohirrim.0101.a
		custom_tooltip = war_of_the_rohirrim.0101.a.effect
		character:lineofeorl9 = { 
			trigger_event = {
				id = war_of_the_rohirrim.0102
				days = { 1 2 }
			}
		}
	}
	
}

# Helm: Freca makes his proposal
war_of_the_rohirrim.0102 = {
	type = character_event
	title = war_of_the_rohirrim.0102.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:calm_approach
				}
				desc = war_of_the_rohirrim.0102.desc.calm
			}
			desc = war_of_the_rohirrim.0102.desc.bold
		}
	}
	theme = realm
	
	left_portrait = {
		character = root
		animation = disapproval
	}
	
	right_portrait = {
		character = scope:freca
		triggered_animation = {
			trigger = {
				exists = scope:calm_approach
			}
			animation = debating
		}
		animation = anger
	}

	lower_left_portrait = scope:hera
	lower_center_portrait = scope:frealaf
	lower_right_portrait = scope:wulf

	immediate = {
		character:6000010 = { save_scope_as = frealaf }
	}
	
	option = { 
		name = war_of_the_rohirrim.0102.a
		custom_tooltip = war_of_the_rohirrim.0102.a.effects
		scope:freca = { 
			trigger_event = war_of_the_rohirrim.0103
		}
		ai_chance = {
			base = 100
	   }
	}
	option = { 
		name = war_of_the_rohirrim.0102.b
		custom_tooltip = freca_helm_opt_out_of_story_content
		scope:hera = {
			hidden_effect = {
				remove_trait = cannot_marry
			}
			marry = scope:wulf
		}
		scope:wulf = {
			add_pressed_claim = title:k_rohan
		}
		create_alliance = {			
			target = scope:freca		
			allied_through_owner = scope:wulf
			allied_through_target = scope:hera
		}
		ai_chance = {
			base = 0
	   }
	}
	
}

# Freca: The Fight
war_of_the_rohirrim.0103 = {
	type = character_event
	title = war_of_the_rohirrim.0103.t
	desc = war_of_the_rohirrim.0103.desc
	theme = martial
	
	left_portrait = {
		character = root
		animation = rage
	}
	right_portrait = {
		character = scope:helm
		animation = anger
	}

	lower_center_portrait = scope:frealaf

	override_background = {
		reference = alley_night
	}

	override_effect_2d = {
		reference = rain
	}
	
	option = {
		name = war_of_the_rohirrim.0103.a
		custom_tooltip = war_of_the_rohirrim.0103.a.effects
		scope:helm = {
			trigger_event = war_of_the_rohirrim.0104
		}
		ai_chance = {
 			base = 0
		}
	}
	
}

# Helm: The Punch
war_of_the_rohirrim.0104 = {
	type = character_event
	title = war_of_the_rohirrim.0104.t
	desc = war_of_the_rohirrim.0104.desc
	theme = martial
	
	left_portrait = {
		character = root
		animation = rage
	}
	right_portrait = {
		character = scope:freca
		animation = anger
	}

	override_background = {
		reference = alley_night
	}

	override_effect_2d = {
		reference = rain
	}
	
	option = { 
		name = war_of_the_rohirrim.0104.a
		scope:freca = {
			trigger_event = war_of_the_rohirrim.0105
		}
	}
	
}

# Freca: The Death of Freca
war_of_the_rohirrim.0105 = {
	type = character_event
	title = war_of_the_rohirrim.0105.t
	desc = war_of_the_rohirrim.0105.desc
	theme = death
	
	left_portrait = {
		character = root
		animation = pain
	}
	
	right_portrait = {
		character = scope:wulf
		animation = grief
	}

	override_background = {
		reference = alley_night
	}

	override_effect_2d = {
		reference = rain
	}

	immediate = {
		hidden_effect = {
			add_trait = wounded_3
		}
	}
	
	option = { 
		name = war_of_the_rohirrim.0105.a
		death = {
			killer = scope:helm
			death_reason = death_one_punched
		}
		scope:helm = {
			trigger_event = war_of_the_rohirrim.0106
		}
	}
	
}

# Helm: The Banishment of Wulf
war_of_the_rohirrim.0106 = {
	type = character_event
	title = war_of_the_rohirrim.0106.t
	desc = war_of_the_rohirrim.0106.desc
	theme = martial
	
	left_portrait = {
		character = root
		animation = disgust
	}
	
	right_portrait = {
		character = scope:wulf
		animation = rage
	}

	lower_center_portrait = scope:freca

	override_background = {
		reference = alley_night
	}

	override_effect_2d = {
		reference = rain
	}

	immediate = {
		show_as_tooltip = {
			scope:freca = {
				death = {
					killer = root
					death_reason = death_one_punched
				}
			}
		}
	}
	
	option = { 
		name = war_of_the_rohirrim.0106.a
		scope:wulf = {
			trigger_event = war_of_the_rohirrim.0107
			show_as_tooltip = {
				set_relation_nemesis = { reason = rival_killed_parent target = scope:helm }
				add_pressed_claim = title:k_rohan
				create_title_and_vassal_change = {
					type = granted
					save_scope_as = change
				}
				title:c_tormcaladach = {
					change_title_holder = {
						holder = root
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
				create_title_and_vassal_change = {
					type = revoked
					save_scope_as = change2
					add_claim_on_loss = yes
				}
				every_held_title = {
					limit = {
						tier >= tier_county
						OR = {
							kingdom = title:k_rohan
							duchy = title:d_westmarches
							duchy = title:d_drulad
						}
					}
					change_title_holder = {
						holder = scope:helm
						change = scope:change2
					}
				}
				scope:targg = {
					if = {
						limit = {
							is_ai = yes
						}
						every_held_title = {
							limit = {
								tier >= tier_county
								OR = {
									kingdom = title:k_rohan
									duchy = title:d_westmarches
									duchy = title:d_drulad
								}
							}
							change_title_holder = {
								holder = scope:helm
								change = scope:change2
							}
						}
					}
				}
				resolve_title_and_vassal_change = scope:change2
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = change3
				}
				change_liege = {
					liege = character:lineurthain52
					change = scope:change3
				}
				resolve_title_and_vassal_change = scope:change3
			}
		}
	}
	
}

# Wulf: Banished
war_of_the_rohirrim.0107 = {
	type = character_event
	title = war_of_the_rohirrim.0107.t
	desc = war_of_the_rohirrim.0107.desc
	theme = martial
	
	left_portrait = {
		character = root
		animation = rage
	}
	
	right_portrait = {
		character = scope:helm
		animation = disgust
	}

	lower_left_portrait = scope:freca
	lower_right_portrait = scope:cerith

	override_background = {
		reference = alley_night
	}

	override_effect_2d = {
		reference = rain
	}

	immediate = {
		character:lineurthain52 = { save_scope_as = cerith }
	}
	
	option = { 
		name = war_of_the_rohirrim.0107.a
		scope:helm = { set_relation_nemesis = { reason = rival_killed_parent target = root } }
		add_pressed_claim = title:k_rohan
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
		}
		title:c_tormcaladach = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
		create_title_and_vassal_change = {
			type = revoked
			save_scope_as = change2
			add_claim_on_loss = yes
		}
		every_held_title = {
			limit = {
				tier >= tier_county
				OR = {
					kingdom = title:k_rohan
					duchy = title:d_westmarches
					duchy = title:d_drulad
				}
			}
			change_title_holder = {
				holder = scope:helm
				change = scope:change2
			}
		}
		scope:targg = {
			if = {
				limit = {
					is_ai = yes
				}
				every_held_title = {
					limit = {
						tier >= tier_county
						OR = {
							kingdom = title:k_rohan
							duchy = title:d_westmarches
							duchy = title:d_drulad
						}
					}
					change_title_holder = {
						holder = scope:helm
						change = scope:change2
					}
				}
			}
		}
		resolve_title_and_vassal_change = scope:change2
	}

	after = {
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change3
		}
		change_liege = {
			liege = scope:cerith
			change = scope:change3
		}
		resolve_title_and_vassal_change = scope:change3
		scope:targg = {
			set_employer = root
		}
		scope:helm = {
			trigger_event = {
				id = war_of_the_rohirrim.0108
				days = 6
			}
		}
		trigger_event = {
			id = war_of_the_rohirrim.0109
			days = 7
		}
	}
	
}

# Helm: The Aftermath
war_of_the_rohirrim.0108 = {
	type = character_event
	title = war_of_the_rohirrim.0108.t
	desc = war_of_the_rohirrim.0108.desc
	theme = realm
	
	right_portrait = {
		character = root
		animation = personality_honorable
	}

	immediate = {
		give_nickname = nick_hammerhand
        add_character_flag = {
			flag = had_nickname_event
		}
	}
	
	option = { 
		name = war_of_the_rohirrim.0108.a
	}
	
}

# Wulf: A Life in Exile
war_of_the_rohirrim.0109 = {
	type = character_event
	title = war_of_the_rohirrim.0109.t
	desc = war_of_the_rohirrim.0109.desc
	theme = feast_activity
	
	left_portrait = {
		character = root
		animation = personality_honorable
	}
	
	right_portrait = {
		character = scope:cerith
		animation = debating
	}

	lower_left_portrait = scope:targg
	lower_right_portrait = root.mother
	
	option = { 
		name = war_of_the_rohirrim.0109.a
	}
	
}