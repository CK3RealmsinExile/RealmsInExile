namespace = elven_hope

#######################
## ELVEN HOPE EVENTS ##
#######################

### Entering the Situation ###

elven_hope.0001 = {
	content_source = realms_dlc
	type = character_event
	window = fullscreen_event
	title = elven_hope.0001.t
	desc = elven_hope.0001.desc
	theme = realm
	trigger = { # we need to prevent this from firing for all players when a new player joins in MP
		is_ai = no
		NOT = { has_variable = elven_hope_0001_var }
 	}
	override_background = { reference = elven_situation_fullscreen }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	cooldown = { years = 100 }

	widgets = {
		widget = {
 			gui = "event_window_widget_situation_info_elven_hope"
 			container = "dynamic_content_widget"
 			controller = situation_info
 			setup_scope = { situation:elven_hope_situation = { save_scope_as = situation } }
		}
	}
	immediate = {
		set_variable = elven_hope_0001_var
		save_scope_value_as = {
			name = start
			value = yes
		}
	}
	option = {
		name = elven_hope.0001.a
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
}

### Entering a new phase ###

elven_hope.0010 = { # Fading phase
	type = character_event
	title = elven_hope.0010.t
	desc = elven_hope.0010.desc
	theme = elven
	override_background = { reference = docks_elven }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = crying
	}
	immediate = {
		custom_tooltip = elven_hope.0010.tt
	}
	option = {
		name = elven_hope.0010.a
	}
}

elven_hope.0011 = { # Waning phase
	type = character_event
	title = elven_hope.0011.t
	desc = elven_hope.0011.desc
	theme = elven
	override_background = { reference = grey_havens }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = worry
	}
	immediate = {
		custom_tooltip = elven_hope.0011.tt
	}
	option = {
		name = elven_hope.0011.a
	}
}

elven_hope.0012 = { # Enduring phase
	type = character_event
	title = elven_hope.0012.t
	desc = elven_hope.0012.desc
	theme = elven
	override_background = { reference = amon_lanc }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	immediate = {
		custom_tooltip = elven_hope.0012.tt
	}
	option = {
		name = elven_hope.0012.a
	}
}

elven_hope.0013 = { # Renewing phase
	type = character_event
	title = elven_hope.0013.t
	desc = elven_hope.0013.desc
	theme = elven
	override_background = { reference = imladris }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = personality_compassionate
	}
	immediate = {
		custom_tooltip = elven_hope.0013.tt
	}
	option = {
		name = elven_hope.0013.a
	}
}

elven_hope.0014 = { # Thriving phase
	type = character_event
	title = elven_hope.0014.t
	desc = elven_hope.0014.desc
	theme = elven
	override_background = { reference = gondolin }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = happiness
	}
	immediate = {
		custom_tooltip = elven_hope.0014.tt
	}
	option = {
		name = elven_hope.0014.a
	}
}

### Reduce Development in Low Hope ###

elven_hope.0020 = { # Check phase and reduce dev at random
	hidden = yes 
	immediate = {
		# First, let's check the current situation phase and dish out random development reductions across the realm
		if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_fading
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					20 = {
						change_development_level = -1
					}
					5 = {
						change_development_level = -2
					}
					75 = {
					}
				}
			}
		}
		else_if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_waning
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					15 = {
						change_development_level = -1
					}
					85 = {
					}
				}
			}
		}
		else_if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_enduring
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					10 = {
						change_development_level = -1
					}
					90 = {
					}
				}
			}
		}
		else_if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_renewing
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					5 = {
						change_development_level = -1
					}
					95 = {
					}
				}
			}
		}
		# Then, check if any counties have zero development and no other holdings. Chance to make it wastelands.
		# every_realm_county = { # WIP, doesn't work yet
			# limit = {
				# development_level = 0
				# every_county_province = {
					# OR = {
						# has_holding = no
						# is_county_capital = yes 
					# }
				# }
			# }
			# random = {
				# chance = 35
				# make_settlement_county_wilderness = { COUNTY = this }
			# }
		# }
		
		# Lastly, we check for any county that has zero development and remove its holdings, if it has any.
		every_realm_county = {
			limit = {
				development_level = 0
				any_county_province = {
					has_holding = yes
					is_county_capital = no
				}
			}
			every_county_province = {
				limit = {
					has_holding = yes
					is_county_capital = no
				}
				random = {
					chance = 35
					remove_holding = yes
				}
			}
		}
		
		
	}
}