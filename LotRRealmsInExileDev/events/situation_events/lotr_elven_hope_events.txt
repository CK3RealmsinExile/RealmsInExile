namespace = elven_hope

#######################
## ELVEN HOPE EVENTS ##
#######################

### Entering the Situation ###

elven_hope.0001 = {
	content_source = realms_dlc
	type = character_event
	window = fullscreen_event
	title = elven_hope.0001.t
	desc = elven_hope.0001.desc
	theme = realm
	trigger = { # we need to prevent this from firing for all players when a new player joins in MP
		is_ai = no
		NOT = { has_variable = elven_hope_0001_var }
 	}
	override_background = { reference = elven_situation_fullscreen }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	cooldown = { years = 100 }

	widgets = {
		widget = {
 			gui = "event_window_widget_situation_info_elven_hope"
 			container = "dynamic_content_widget"
 			controller = situation_info
 			setup_scope = { situation:elven_hope_situation = { save_scope_as = situation } }
		}
	}
	immediate = {
		set_variable = elven_hope_0001_var
		save_scope_value_as = {
			name = start
			value = yes
		}
	}
	option = {
		name = elven_hope.0001.a
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
}

### Entering a new phase ###

elven_hope.0010 = { # Fading phase
	type = character_event
	title = elven_hope.0010.t
	desc = elven_hope.0010.desc
	theme = elven
	override_background = { reference = docks_elven }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = crying
	}
	immediate = {
		custom_tooltip = elven_hope.0010.tt
	}
	option = {
		name = elven_hope.0010.a
	}
}

elven_hope.0011 = { # Waning phase
	type = character_event
	title = elven_hope.0011.t
	desc = elven_hope.0011.desc
	theme = elven
	override_background = { reference = grey_havens }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = worry
	}
	immediate = {
		custom_tooltip = elven_hope.0011.tt
	}
	option = {
		name = elven_hope.0011.a
	}
}

elven_hope.0012 = { # Enduring phase
	type = character_event
	title = elven_hope.0012.t
	desc = elven_hope.0012.desc
	theme = elven
	override_background = { reference = amon_lanc }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	immediate = {
		custom_tooltip = elven_hope.0012.tt
	}
	option = {
		name = elven_hope.0012.a
	}
}

elven_hope.0013 = { # Renewing phase
	type = character_event
	title = elven_hope.0013.t
	desc = elven_hope.0013.desc
	theme = elven
	override_background = { reference = imladris }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = personality_compassionate
	}
	immediate = {
		custom_tooltip = elven_hope.0013.tt
	}
	option = {
		name = elven_hope.0013.a
	}
}

elven_hope.0014 = { # Thriving phase
	type = character_event
	title = elven_hope.0014.t
	desc = elven_hope.0014.desc
	theme = elven
	override_background = { reference = gondolin }
	# widgets = { # TO DO: Make phase effects show up here
		# widget = {
 			# gui = "event_window_widget_situation_info_elven_hope"
 			# container = "dynamic_content_widget"
 			# controller = situation_info
 			# setup_scope = { situation:lotr_elven_hope_situation = { save_scope_as = situation } }
		# }
	# }
	cooldown = { days = 31 }
	left_portrait = {
		character = root
		animation = happiness
	}
	immediate = {
		custom_tooltip = elven_hope.0014.tt
	}
	option = {
		name = elven_hope.0014.a
	}
}

### Reduce Development in Low Hope ###

elven_hope.0020 = { # Check phase and reduce dev at random
	hidden = yes 
	immediate = {
		# First, let's check the current situation phase and dish out random development reductions across the realm
		if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_fading
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					20 = {
						change_development_level = -1
					}
					5 = {
						change_development_level = -2
					}
					75 = {
					}
				}
			}
		}
		else_if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_waning
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					15 = {
						change_development_level = -1
					}
					85 = {
					}
				}
			}
		}
		else_if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_enduring
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					10 = {
						change_development_level = -1
					}
					90 = {
					}
				}
			}
		}
		else_if = {
			limit = {
				any_character_situation = {
					any_situation_sub_region = {
						sub_region_current_phase = situation_elven_renewing
						situation_sub_region_has_county = root.capital_county
					}
				}
			}
			every_realm_county = {
				limit = { title_province = { has_holding_type = elven_holding } }
				random_list = {
					5 = {
						change_development_level = -1
					}
					95 = {
					}
				}
			}
		}

		# Then, we check for any county that has zero development and remove its holdings, if it has any.
		every_realm_county = {
			limit = {
				development_level = 0
				any_county_province = {
					has_holding = yes
					is_county_capital = no
				}
			}
			every_county_province = {
				add_to_list = counties_with_secondary_holdings
				limit = {
					has_holding = yes
					is_county_capital = no
				}
				random = {
					chance = 35
					remove_holding = yes
				}
			}
		}
		# Lastly, check if any counties have zero development and no other holdings. Chance to make it wastelands.
		every_realm_county = { 
			limit = {
				development_level = 0
				NOT = { is_in_list = counties_with_secondary_holdings }
			}
			save_scope_as = abandoned_county
			this.holder = {
				send_interface_toast = {
					type = event_toast_effect_bad
					title = elven_hope.0020.tt
				}
				every_liege_or_above = {
					send_interface_toast = {
						type = event_toast_effect_bad
						title = elven_hope.0020.tt
					}
				}
			}
			random = {
				chance = 35
				make_settlement_county_wilderness = { COUNTY = this }
			}
		}
	}
}

### Random Pulse Events ###

elven_hope.0030 = { # Dreams of the Sea
	type = character_event
	title = elven_hope.0030.t
	desc = elven_hope.0030.desc
	theme = elven
	override_background = { reference = grey_havens }

	cooldown = { months = 7 }
	left_portrait = {
		character = root
		animation = worry
	}
	immediate = {
		subtract_elven_hope_effect = { VALUE = 10 }
	}
	option = { # One day, all of us will sail
		name = elven_hope.0030.a
		add_stress = -40
		subtract_elven_hope_effect = { VALUE = 10 }
	}
	option = { # I shall sing a song of hope 
		name = elven_hope.0030.b 
		add_stress = 20 
		add_elven_hope_effect = { VALUE = 10 }
	}
}

elven_hope.0031 = { # The Trees Do Not Sing
	type = character_event
	title = elven_hope.0031.t
	desc = elven_hope.0031.desc
	theme = elven
	override_background = { reference = wilderness_forest_pine }

	cooldown = { months = 7 }
	left_portrait = {
		character = root
		animation = survey_staff
	}
	immediate = {
		
	}
	option = { # Their songs will return with the changing of the season
		name = elven_hope.0031.a
		add_elven_hope_effect = { VALUE = 5 }
	}
	option = { # I shall investigate this matter
		name = elven_hope.0031.b 
		duel = {
			skill = learning 
			value = 14
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					max = 15
				}
				send_interface_toast = {
					title = elven_hope.0031.b.success
					left_icon = root 
					add_elven_hope_effect = { VALUE = 15 }
				}
			}
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -15
				}
				send_interface_toast = {
					title = elven_hope.0031.b.failure
					left_icon = root 
					subtract_elven_hope_effect = { VALUE = 10 }
				}
				add_stress = 20
			}
		}
	}
}

elven_hope.0032 = { # Child of Spring
	type = character_event
	title = elven_hope.0032.t
	desc = elven_hope.0032.desc
	theme = elven
	override_background = { reference = relaxing_room }

	cooldown = { months = 7 }
	trigger = {
		any_courtier = {
			is_female = yes 
			is_married = yes 
		}
	}
	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:new_mother
		animation = newborn 
	}
	immediate = {
		random_courtier = {
			limit = {
				is_female = yes 
				is_married = yes 
			}
			save_scope_as = new_mother 
		}
		create_character = {
			mother = scope:new_mother
			father = scope:new_mother.primary_spouse
			employer = root
			culture = root.culture
			faith = root.faith
			dynasty = scope:new_mother.primary_spouse.dynasty
			gender_female_chance = 50
			age = 0 
			save_scope_as = child_of_spring
		}
		add_elven_hope_effect = { VALUE = 25 }
	}
	option = { # What hopeful news! Praise their union!
		name = elven_hope.0032.a
		add_prestige = minor_prestige_gain
		every_courtier = {
			limit = { NOT = { this = scope:new_mother } }
			add_opinion = {
				target = scope:new_mother
				modifier = friendliness_opinion
				opinion = 15
			}
		}
	}
	option = { # Let mother and child rest.
		name = elven_hope.0032.b
		add_stress = -20 
	}
	option = { # We shall celebrate this 
		name = elven_hope.0032.c
		remove_short_term_gold = medium_gold_value 
		add_elven_hope_effect = { VALUE = 10 }
	}
}

elven_hope.0033 = { # A Nightly Departure
	type = character_event
	title = elven_hope.0033.t
	desc = elven_hope.0033.desc
	theme = elven
	override_background = { reference = docks_elven }

	cooldown = { months = 7 }
	left_portrait = {
		character = root
		animation = lantern
	}
	option = { # They are free to sail
		name = elven_hope.0033.a
		add_piety = medium_piety_gain 
		add_legitimacy = minor_legitimacy_gain
		subtract_elven_hope_effect = { VALUE = 10 }
	}
	option = { # Convince them to say farewell
		name = elven_hope.0033.b 
		remove_short_term_gold = miniscule_gold_value  
		subtract_elven_hope_effect = { VALUE = 5 }
	}
}

elven_hope.0034 = { # The Lay of Kin Long Lost
	type = character_event
	title = elven_hope.0034.t
	desc = elven_hope.0034.desc
	theme = elven
	override_background = { reference = wilderness_forest_deep }

	cooldown = { months = 7 }
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:elder_courtier
		animation = storyteller
	}
	immediate = {
		random_courtier = { save_scope_as = elder_courtier }
		add_elven_hope_effect = { VALUE = 5 }
	}
	option = { # The past is lost to us
		name = elven_hope.0034.a
		add_piety = medium_prestige_gain
		add_legitimacy = minor_legitimacy_gain
		subtract_elven_hope_effect = { VALUE = 5 }
	}
	option = { # Let the memory strengthen our resolve
		name = elven_hope.0034.b 
		add_elven_hope_effect = { VALUE = 5 }
		add_piety = miniscule_piety_gain
	}
	option = { # Commission the lay to be sung often
		name = elven_hope.0034.c
		remove_short_term_gold = minor_gold_value
		add_elven_hope_effect = { VALUE = 5 }
		add_diplomacy_lifestyle_xp = 300
	}
}

elven_hope.0035 = { # A World Marred by Evil
	type = character_event
	title = elven_hope.0035.t
	desc = elven_hope.0035.desc
	theme = elven
	override_background = { reference = wilderness }

	cooldown = { months = 7 }
	left_portrait = {
		character = root
		animation = throne_room_two_handed_passive_shield
	}
	immediate = {
		subtract_elven_hope_effect = { VALUE = 15 }
	}
	option = { # We are an island in the sea of darkness
		name = elven_hope.0035.a
		add_prestige = medium_prestige_gain
		subtract_elven_hope_effect = { VALUE = 5 }
	}
	option = { # Even so, we have endured
		name = elven_hope.0035.b 
		add_elven_hope_effect = { VALUE = 5 }
	}
}

elven_hope.0036 = { # The Waning of Light
	type = character_event
	title = elven_hope.0036.t
	desc = elven_hope.0036.desc
	theme = elven
	override_background = { reference = ep2_forest_managed }

	cooldown = { months = 7 }
	left_portrait = {
		character = root
		animation = disappointed
	}
	immediate = {
		subtract_elven_hope_effect = { VALUE = 10 }
	}
	option = { # All things must fade
		name = elven_hope.0036.a
		add_learning_lifestyle_xp = 500
	}
	option = { # We shall plant new seeds, and tend them with care
		name = elven_hope.0036.b 
		add_elven_hope_effect = { VALUE = 5 }
	}
}
