namespace = druedain

### Beffraen events ###

druedain.0100 = { # The Unification of Eryn Vorn
	content_source = realms_dlc
	type = character_event
	title = druedain.0100.t
	desc = druedain.0100.desc
	
	theme = realm
	override_background = {
		reference = fangorn
	}
	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = {
		character = character:lineofburizighi1
		animation = personality_honourable
	}
	trigger = {
		NOT = {
			is_target_in_global_variable_list = { # Event chain has not yet started (Need this so it only fires once)
				name = unavailable_unique_decisions
				target = flag:heirofzighievent
			}
		}
		
		root ?= { 
			dynasty ?=  dynasty:dynasty_buri_z_i_ghi
		}
	} 
	option = {
		add_to_global_variable_list = { # To stop this event chain from happening again
            name = unavailable_unique_decisions
            target = flag:heirofzighievent
        }
		name = druedain.0100.a
		give_nickname = nick_z_i_ghis_heir
		add_character_flag = had_nickname_event
	}
}

druedain.0200 = { # The Path to the East
	content_source = realms_dlc
	type = character_event
	title = druedain.0200.t
	desc = druedain.0200.desc
	
	theme = migration
	override_background = {
		reference = fangorn
	}
	left_portrait = {
		character = root
		animation = pondering
	}
	option = { # Leave the Suza Sumar behind and gain a tribal/castle holding
		name = druedain.0200.a
		custom_tooltip = druedain.0200.a.tt 
		add_character_flag = honnin_give_up_ray
	}
	option = { # Retain your holdings but set up a colony 
		name = druedain.0200.b 
		custom_tooltip = druedain.0200.b.tt 
		remove_short_term_gold = medium_gold_value
	}
	after = {
		start_travel_plan = {
			destination = title:c_bru_kha.title_province
			players_use_planner = yes
			on_arrival_destinations = last
			on_arrival_event = druedain.0201
			return_trip = no # One way
		}
	}
}

druedain.0201 = { # Arrival in Bru-Kha
	content_source = realms_dlc
	type = character_event
	title = druedain.0201.t
	desc = druedain.0201.desc
	theme = migration
	override_background = { reference = jungle_pyramid_ruins }

	left_portrait = {
		character = root
		animation = survey
	}
	immediate = {
        hidden_effect = {
            current_travel_plan ?= { abort_travel_plan = yes }
        }
		every_held_title = {
			add_to_list = titles_to_shift
		}
		create_character = {
			template = laamp_inheritor_template
			culture = root.capital_county.culture
			faith = root.capital_county.faith
			dynasty = generate
			location = root.capital_province
			after_creation = { save_scope_as = honnin_inheritor }
		}
	}
	option = { # Here we are 
		name = druedain.0201.a
		if = { 
			limit = { has_character_flag = honnin_give_up_ray }
			get_title = title:c_bru_kha
			title:c_bru_kha = {
				set_county_faith = root.faith
				set_county_culture = root.culture
				generate_coa = yes
				every_county_province = {
					barony = { generate_coa = yes }
				}
			}
			if = { 
				limit = { has_government = tribal_government }
				title:c_bru_kha = {
					every_county_province = {
						limit = {
							has_holding = yes
							has_holding_type = wastelands_holding
						}
						set_holding_type = tribal_holding
					}
					title_province = {
						add_building = tribe_02
						add_building = longhouses_01
						add_building = market_villages_01
					}
				}
			}
			else = {
				title:c_bru_kha = {
					every_county_province = {
						limit = {
							has_holding = yes
							has_holding_type = wastelands_holding
						}
						set_holding_type = castle_holding
						add_building = castle_02 
						add_building = logging_camps_01
						add_building = ramparts_01
					}
				}
			}
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = change
				add_claim_on_loss = no
			}
			
			every_in_list = {
				list = titles_to_shift
				change_title_holder = {
					holder = scope:honnin_inheritor
					change = scope:change
					take_baronies = yes
				}
			}
			resolve_title_and_vassal_change = scope:change
		}
		else = {
			ai_colonisation_effect = { WASTELANDS = title:c_bru_kha.title_province ROOT_SCOPE = root }
		}
	}
}