namespace = rangers

# Events about Aragorn
#		rangers.0101	Dunedain Encampments of Eriador
#       rangers.0200	Death of Gilraen

# Long Winter Start Date Events
#		rangers.0300	Growing Orc Activity
#		rangers.0301	Visiting Elrond
#		rangers.0302	Elrond hears rumours of Orcs
#		rangers.0303	Elrond receives Arassuil
#		rangers.0304	Elrond gives his counsel
#		rangers.0305	Return to the Angle of Mitheithel

# Arassuil: Lay a Trap
#		rangers.0306	Setting the Ambush
#		rangers.0316	Springing the trap
#		rangers.0326	The Ambush succeeds
#		rangers.0336	The Ambush fails

# Arassuil: Fight a Duel
#		rangers.0307	Decide to fight
#		rangers.0317	Travelling to Moria
#		rangers.0327	The Challenge
#		rangers.0337	The Duel
#		rangers.0347	(Hidden) Re-enable the initial decision
#		rangers.0357	(Hidden) Process single combat result
#		rangers.0367	Win the Duel
#		rangers.0377 	Duel invalidated
#		rangers.0387	Lose the Duel

# Arassuil: Start a War
#		rangers.0308	To Plan a War
#		rangers.0318	Another Meeting with Elrond
#		rangers.0328	The Men of Bree
#		rangers.0338	Arriving in Mithlond
#		rangers.0348	The Mansions of Stone
#		rangers.0358	Awaiting an Opportune Moment
#		rangers.0368	Declade the War
#		rangers.0378	Lose the War
#		rangers.0388	Win the War

# Eradan, Warden of Sarn Ford
#		rangers.0400	A Chieftain's Summon
#		rangers.0401	Rumours from Fornost
#		rangers.0402	Fornost: Arrival

rangers.0101 = { # Dunedain Encampments - chance to swear fealty
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_northern_dunedain.holder = { save_scope_as = dunedain_chieftain }
	}
	title = rangers.0101.t
	desc = rangers.0101.desc
	theme = stewardship_duty_focus
	left_portrait = {
		character = root
		animation = idle
	}

	right_portrait = {
		character = scope:dunedain_chieftain
		animation = idle
	}

	option = { # Heed the call of the chieftain!
		name = rangers.0101.a
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
		}
		root = {
			change_liege = {
				liege = scope:dunedain_chieftain
				change = scope:change
			}
			add_opinion = {
				modifier = became_vassal
				target = scope:dunedain_chieftain
				opinion = 10
			}
		}
		resolve_title_and_vassal_change = scope:change

		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.

			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}

			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}

			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	option = { # We need to act on our own for now.
		name = rangers.0101.b
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.

			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}

			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 30
			}

			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
}

rangers.0200 = { # Death of Gilraen
	content_source = realms_dlc
	type = character_event
	title = rangers.0200.t
	desc = rangers.0200.desc
	theme = stewardship_duty_focus
	left_portrait = {
		character = character:lineisildur42
		animation = worry
	}
	right_portrait = {
		character = character:linegilraen1
		animation = dead
	}
	
	option = { # Farewell, Mother
		name = rangers.0200.a
		character:linegilraen1 = {
			death = { death_reason = death_natural_causes }
		}
	}
}

### Long Winter Start Date Events ###

rangers.0300 = { # Growing Orc Activity
	content_source = realms_dlc
	type = character_event
	title = rangers.0300.t
	desc = rangers.0300.desc
	theme = dread
	window = visit_settlement_window
	cooldown = { years = 150 }
	override_background = { reference = wilderness_forest }
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:azog
		animation = aggressive_sword
	}
	immediate = {
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog }
		title:c_imladris.holder.top_liege = { trigger_event = rangers.0302 }
	}
	option = { # I shall seek the counsel of Elrond of Rivendell
		name = rangers.0300.a
		custom_tooltip = rangers.0300.a.tt
		add_character_flag = arassuil_seek_elronds_counsel
	}
	option = { # AI only, bypass the decision and go to war directly
		name = rangers.0300.b
		trigger = { is_ai = yes }
		trigger_event = rangers.0318 
		ai_chance = { base = 100 }
	}
}

rangers.0301 = { # Visit Elrond
	content_source = realms_dlc
	type = character_event
	title = rangers.0301.t
	desc = rangers.0301.desc
	theme = friend_relation
	window = visit_settlement_window
	override_background = { reference = throne_room_rivendell }
	left_portrait = {
		character = root
		animation = throne_room_conversation_1
	}
	right_portrait = {
		character = scope:elrond
		animation = personality_rational
	}
	immediate = {
		title:c_imladris.holder.top_liege = { save_scope_as = elrond }
	}
	option = { # 
		name = rangers.0301.a
		add_stress = -10
		title:c_imladris.holder.top_liege = { trigger_event = rangers.0303 }
	}
}

rangers.0302 = { # Elrond hears rumours of Orcs
	content_source = realms_dlc
	type = character_event
	title = rangers.0302.t
	desc = rangers.0302.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = throne_room_rivendell }
	trigger = { is_elf = yes }
	left_portrait = {
		character = root
		animation = reading
	}
	right_portrait = {
		character = scope:son_of_elrond
		animation = marshal
	}
	immediate = {
		root.primary_heir = { save_scope_as = son_of_elrond }
	}
	option = { # I will reach out to the Dúnedain
		name = rangers.0302.a
		custom_tooltip = rangers.0302.a.tt
	}
}

rangers.0303 = { # Elrond gives his counsel 
	content_source = realms_dlc
	type = character_event
	title = rangers.0303.t
	desc = rangers.0303.desc
	theme = friend_relation
	override_background = { reference = throne_room_rivendell }
	left_portrait = {
		character = root
		animation = throne_room_conversation_2
	}
	right_portrait = {
		character = scope:dunedain_chieftain
		animation = throne_room_two_handed_passive_1
	}
	immediate = {
		title:d_northern_dunedain.holder = { save_scope_as = dunedain_chieftain }
	}
	option = { # Set a trap for the Orc's leader
		name = rangers.0303.a
	}
	option = { # Strike at the heart of our enemy
		name = rangers.0303.b
		add_character_flag = elrond_strike_moria
	}
	after = {
		scope:dunedain_chieftain = { trigger_Event = rangers.0304 }
	}
}

rangers.0304 = { # Receive Elrond's counsel 
	content_source = realms_dlc
	type = character_event
	title = rangers.0304.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:elrond = { has_character_flag = elrond_strike_moria }
				}
				desc = rangers.0304.desc.a
			}
			desc = rangers.0304.desc
		}
	}
	theme = friend_relation
	override_background = { reference = throne_room_rivendell }
	window = visit_settlement_window
	left_portrait = {
		character = root
		animation = throne_room_two_handed_passive_1
	}
	right_portrait = {
		character = scope:elrond
		animation = throne_room_conversation_2
	}
	immediate = {
	}
	option = { # I will consider your wisdom
		name = rangers.0304.a
		custom_tooltip = rangers.0304.a.tt 
	}
	after = {
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			on_arrival_event = rangers.0305
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
	}
}

rangers.0305 = { # Returning to the Angle
	content_source = realms_dlc
	type = character_event
	title = rangers.0305.t
	desc = rangers.0305.desc
	theme = martial_chivalry_focus
	window = visit_settlement_window
	override_background = { reference = wilderness_forest_deep }
	left_portrait = {
		character = root
		animation = inspect_weapon
	}
	immediate = { title:c_durins_hall.holder.top_liege = { save_scope_as = azog } }
	option = { # I must end this threat to Eriador. It is my duty.
		name = rangers.0305.a
		custom_tooltip = rangers.0305.a.tt
		add_character_flag = arassuil_dealing_with_azog
	}
}

rangers.0306 = { # Lay a Trap
	content_source = realms_dlc
	type = character_event
	title = rangers.0306.t
	desc = rangers.0306.desc
	theme = intrigue
	window = visit_settlement_window
	override_background = { reference = wilderness_forest_deep }
	left_portrait = {
		character = root
		scripted_animation = bow_drawn
	}
	immediate = { 
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog }
	}
	option = { # I will lay a trap for him
		name = rangers.0306.a
		custom_tooltip = rangers.0306.a.tt
		add_prestige = minor_prestige_gain
		start_travel_plan = { #Travel to the caravan
			destination = title:c_talath_formir.title_province
			on_arrival_event = rangers.0316
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
		}
	}
}

rangers.0316 = { # The Ambush
	content_source = realms_dlc
	type = character_event
	title = rangers.0316.t
	desc = rangers.0316.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = eregion_ruins }
	left_portrait = {
		character = root
		animation = sword_coup_degrace
	}
	right_portrait = {
		character = scope:azog
		animation = rage
	}
	option = { # I'll end this here and now
		name = rangers.0316.a
		duel = {
 			skill = intrigue
 			target = scope:azog
 			50 = {
				# You're successful
 				desc = rangers.0316.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				send_interface_toast = {
 					title = rangers.0316.a.success
 					left_icon = root
 					right_icon = scope:azog
					custom_tooltip = rangers.0316.a.success.tt
 				}
				add_intrigue_lifestyle_xp = medium_lifestyle_xp
				scope:azog = { death = { death_reason = death_assassination killer = root } }
				trigger_event = rangers.0326
 			}
 			50 = {
 				# You failed
 				desc = rangers.0316.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
 				send_interface_toast = {
 					title = rangers.0316.a.failure
 					left_icon = root
 					right_icon = scope:azog
					custom_tooltip = rangers.0316.a.failure.tt
 				}
				increase_wounds_effect = { REASON = fight }
				trigger_event = rangers.0336
 			}
		}
	}
}

rangers.0326 = { # Success
	content_source = realms_dlc
	type = character_event
	title = rangers.0326.t
	desc = rangers.0326.desc
	theme = crown
	window = visit_settlement_window
	override_background = { reference = wilderness_forest_pine }
	left_portrait = {
		character = root
		animation = celebrate_spear
	}
	right_portrait = {
		character = scope:azog
		animation = dead
	}
	immediate = { # Azog's realm splinters
		if = {
			limit = {
				scope:azog = { is_alive = yes }
			}
			scope:azog = {
				death = {
					death_reason = death_assassination
					killer = root 
				}
			}
		}
		else = {
			show_as_tooltip = {
				scope:azog = {
					death = {
						death_reason = death_assassination
						killer = root 
					}
				}
			}
		}
		title:c_durins_hall.holder.top_liege = { save_scope_as = heir_of_azog }
		create_title_and_vassal_change = {
			type = conquest
			save_scope_as = change
			add_claim_on_loss = yes
		}
		scope:heir_of_azog = {
			every_held_title = {
				limit = { tier >= tier_kingdom }
				save_temporary_scope_as = azog_title
				scope:heir_of_azog = { destroy_title = scope:azog_title }
			}
			every_vassal_or_below = {
				limit = { highest_held_title_tier >= tier_county }
				becomes_independent = { change = scope:change }
				trigger_event = orcs.7204
			}
		}
		resolve_title_and_vassal_change = scope:change
	}
	option = { # Good riddance!
		name = rangers.0326.a 
		custom_tooltip = rangers.0326.a.tt 
		add_prestige = massive_prestige_gain
		give_nickname = nick_the_ambusher
		add_character_flag = had_nickname_event
	}
	option = { # Let's go home.
		name = rangers.0326.b 
		custom_tooltip = rangers.0326.b.tt 
		add_prestige = massive_prestige_gain
	}
}

rangers.0336 = { # Ambush fails
	content_source = realms_dlc
	type = character_event
	title = rangers.0336.t
	desc = rangers.0336.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = eregion_ruins }
	left_portrait = {
		character = root
		animation = anger
	}
	right_portrait = {
		character = scope:azog
		animation = schadenfreude
	}
	option = { # We have to get out of here.
		name = rangers.0336.a 
		custom_tooltip = rangers.0336.a.tt 
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0347
		}
	}
}

rangers.0307 = { # Fight a duel
	content_source = realms_dlc
	type = character_event
	title = rangers.0307.t
	desc = rangers.0307.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = wilderness_forest }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	lower_right_portrait = { character = scope:knight1 }
	lower_center_portrait = { character = scope:knight2 }
	lower_left_portrait = { character = scope:knight3 }	
	immediate = { 
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog }
		random_knight = { 
			limit = { is_ai = yes }
			save_scope_as = knight1 
		}
		random_knight = {
			limit = { 
				NOT = { this = scope:knight1 } 
				is_ai = yes
			}
			save_scope_as = knight2
		}
		random_knight = {
			limit = { 
				NOT = { this = scope:knight1 }
				NOT = { this = scope:knight2 }
				is_ai = yes
			}
			save_scope_as = knight3
		}
	}
	option = { # I will end this here and now
		name = rangers.0307.a
		custom_tooltip = rangers.0307.a.tt
		add_prestige = 50
		start_travel_plan = { #Travel to the west gate
			destination = title:c_west_hall.title_province
			on_arrival_event = rangers.0317
			# return_trip = no
			players_use_planner = no
			# on_arrival_destinations = all
		}
	}
	after = {
		current_travel_plan = { 
			add_companion = scope:knight1
			add_companion = scope:knight2
			add_companion = scope:knight3
		}
	}
}

rangers.0317 = { # Travelling to Moria
	content_source = realms_dlc
	type = character_event
	title = rangers.0317.t
	desc = rangers.0317.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = durins_door }
	override_effect_2d = { reference = rain	}
	left_portrait = {
		character = root
		animation = personality_callous
	}
	right_portrait = {
		character = scope:caravan_master
		animation = worry
	}
	immediate = { 
		if = {
			limit = { employs_court_position = travel_leader_court_position }
			current_travel_plan.travel_leader = { save_scope_as = caravan_master }
		}
		else = {
			create_character = {
				template = foreign_architect_template
				employer = root
				save_scope_as = caravan_master
			}
			appoint_court_position = {
				recipient = scope:caravan_master
				court_position = travel_leader_court_position
			}
		}
	}
	option = { # Are you afraid of water now?
		name = rangers.0317.a
		custom_tooltip = rangers.0317.a.tt
		hidden_effect = {
			duel = {
				skill = prowess
				value = high_skill_rating
				60 = { # You beat back the Watcher
					compare_modifier = {
						value = scope:duel_value
						multiplier = 3.5
						min = -49
					}
					min = 10
					send_interface_toast = {
						title = rangers.0317.a.tt.success
						add_prestige = medium_prestige_value
					}
				}
				40 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -3.5
						min = -49
					}
					min = 5
					random_list = {
						85 = {
							send_interface_toast = {
								title = rangers.0317.a.tt.failure
								add_stress = medium_stress_gain
								increase_wounds_effect = { REASON = maimed_by_wild_beast }
							}
						}
						15 = {
							send_interface_toast = {
								title = rangers.0317.a.tt.failure_critical
								death = { death_reason = death_drowned }
							}
						}
					}
				}
			}
		}
	}
	
	option = { # Do not stir up the water.
		name = rangers.0317.b 
		custom_tooltip = rangers.0317.b.tt 
		current_travel_plan = { 
			delay_travel_plan = {
				days = 25
			}
		}
	}
	
	after = {
		trigger_event = rangers.0327 # The Challenge
	}
}

rangers.0327 = { # The Challenge
	content_source = realms_dlc
	type = character_event
	title = rangers.0327.t
	desc = rangers.0327.desc
	theme = intrigue
	window = visit_settlement_window
	override_background = { reference = underground_caverns_02 }
	left_portrait = {
		character = root
		animation = celebrate_spear
	}
	lower_center_portrait = { character = scope:azog }
	option = { # Come forth, Azog! Come forth, and face me!
		name = rangers.0327.a
		custom_tooltip = rangers.0327.a.tt
		scope:azog = { trigger_event = orcs.7202 } #Azog reacts 
	}
}

rangers.0337 = { # The Duel
	content_source = realms_dlc
	type = character_event
	title = rangers.0337.t
	desc = rangers.0337.desc
	theme = battle
	window = visit_settlement_window
	override_background = { reference = throne_room_dwarf }
	left_portrait = {
		character = root
		animation = aggressive_spear
	}
	right_portrait = {
		character = scope:azog
		animation = menacing
	}
	immediate = { 
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog } 
		random_knight = {
			limit = { is_travel_entourage_character = yes }
			save_scope_as = chosen_knight1
		}
		random_knight = {
			limit = { 
				is_travel_entourage_character = yes 
				NOT = { this = scope:chosen_knight1 }
			}
			save_scope_as = chosen_knight2
		}
	}
	option = { # Fight the duel yourself 
		name = rangers.0337.a
		custom_tooltip = rangers.0337.a.tt
		# trigger = {
			# can_start_single_combat_trigger = yes
		# }
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = root
			SC_DEFENDER = scope:azog
			FATALITY = always
			FIXED = no
			LOCALE = wilderness_scope
			OUTPUT_EVENT = rangers.0357
			INVALIDATION_EVENT = rangers.0377
		}
	}
	
	option = { # Send a knight to fight (1)
		name = rangers.0337.b
		trigger = {
			exists = scope:chosen_knight1
			#scope:knight1 = { can_start_single_combat_trigger = yes }
		}
		custom_tooltip = rangers.0337.b.tt
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = scope:chosen_knight1
			SC_DEFENDER = scope:azog
			FATALITY = always
			FIXED = no
			LOCALE = wilderness_scope
			OUTPUT_EVENT = rangers.0357
			INVALIDATION_EVENT = rangers.0377
		}
	}
	
	option = { # Send a knight to fight (2)
		name = rangers.0337.c
		trigger = {
			exists = scope:chosen_knight2
			#scope:knight2 = { can_start_single_combat_trigger = yes }
		}
		custom_tooltip = rangers.0337.c.tt
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = scope:chosen_knight1
			SC_DEFENDER = scope:azog
			FATALITY = always
			FIXED = no
			LOCALE = wilderness_scope
			OUTPUT_EVENT = rangers.0357
			INVALIDATION_EVENT = rangers.0377
		}
	}
}

rangers.0357 = { # Single combat result
	hidden = yes
	immediate = {
		if = {
			limit = { scope:sc_victor = scope:azog }
			scope:azog = { 
				trigger_event = {
					id = orcs.7203
					days = 1
				}
			}
		}
		else_if = {
			limit = { 
				OR = {
					scope:sc_victor = root
					scope:sc_victor = scope:chosen_knight1
					scope:sc_victor = scope:chosen_knight2
				}
			}
			trigger_event = {
				id = rangers.0367
				days = 1 
			}
		}
	}
}

rangers.0367 = { # Win the duel
	content_source = realms_dlc
	type = character_event
	title = rangers.0367.t
	desc = rangers.0367.desc
	theme = crown
	window = visit_settlement_window
	override_background = { reference = wilderness_underground }
	left_portrait = {
		character = scope:sc_victor
		animation = celebrate_sword
	}
	right_portrait = {
		character = scope:azog
		animation = shock
	}
	immediate = {
		if = {
			limit = {
				scope:azog = { is_alive = yes }
			}
			scope:azog = {
				death = {
					death_reason = death_duel
					killer = root 
				}
			}
		}
		else = {
			show_as_tooltip = {
				scope:azog = {
					death = {
						death_reason = death_duel
						killer = root 
					}
				}
			}
		}
		title:c_durins_hall.holder.top_liege = { save_scope_as = heir_of_azog }
		create_title_and_vassal_change = {
			type = conquest
			save_scope_as = change
			add_claim_on_loss = yes
		}
		scope:heir_of_azog = {
			every_held_title = {
				limit = { tier >= tier_kingdom }
				save_temporary_scope_as = azog_title
				scope:heir_of_azog = { destroy_title = scope:azog_title }
			}
			every_vassal_or_below = {
				limit = { highest_held_title_tier >= tier_county }
				becomes_independent = { change = scope:change }
				trigger_event = orcs.7204
			}
		}
		resolve_title_and_vassal_change = scope:change
	}
	option = { # Good riddance!
		name = rangers.0367.a 
		custom_tooltip = rangers.0367.a.tt 
		add_prestige = massive_prestige_gain
		give_nickname = nick_orcslayer
		add_character_flag = had_nickname_event
	}
	option = { # Let's go home.
		name = rangers.0367.b 
		custom_tooltip = rangers.0367.b.tt 
		add_prestige = massive_prestige_gain
	}
	after = {
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
	}
}

rangers.0377 = { # Duel invalidated (Azog flees)
	content_source = realms_dlc
	type = character_event
	title = rangers.0377.t
	desc = rangers.0377.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = wilderness_underground }
	left_portrait = {
		character = scope:sc_victor
		animation = anger
	}
	right_portrait = {
		character = scope:azog
		animation = schadenfreude
	}
	option = { # We have to get out of here.
		name = rangers.0377.a 
		custom_tooltip = rangers.0377.a.tt 
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0347
		}
	}
}

rangers.0387 = { # Lose the Duel
	content_source = realms_dlc
	type = character_event
	title = rangers.0387.t
	desc = rangers.0387.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = throne_room_dwarf }
	left_portrait = {
		character = root
		animation = rage
	}
	right_portrait = {
		character = scope:azog
		animation = schadenfreude
	}
	immediate = { title:c_durins_hall.holder.top_liege = { save_scope_as = azog } }
	option = { # I will avenge my father
		name = rangers.0387.a 
		custom_tooltip = rangers.0387.a.tt 
		set_relation_rival = { target = scope:azog }
		trigger_event = rangers.0347
	}
}

rangers.0347 = { # Re-enable Orc decision
	hidden = yes
	immediate = {
		remove_list_global_variable = {
			name = unavailable_unique_decisions
   			target = flag:arassuil_dealing_with_azog
		}
		add_character_flag = arassuil_dealing_with_azog
		current_travel_plan ?= { abort_travel_plan = yes }
	}
}

rangers.0308 = { # To Plan a War
	content_source = realms_dlc
	type = character_event
	title = rangers.0308.t
	desc = rangers.0308.desc
	theme = war
	window = visit_settlement_window
	override_background = { reference = wilderness_forest_pine }
	left_portrait = {
		character = root
		animation = celebrate_sword
	}
	immediate = { title:c_durins_hall.holder.top_liege = { save_scope_as = azog } }
	option = { # I will end this here and now
		name = rangers.0308.a
		custom_tooltip = rangers.0308.a.tt
		add_prestige = 50
		start_travel_plan = { #Travel to Rivendell
			destination = title:c_imladris.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0318
		}
	}
}

rangers.0318 = { # Meet Elrond again, get dwarven allies
	content_source = realms_dlc
	type = character_event
	title = rangers.0318.t
	desc = rangers.0318.desc
	theme = alliance
	window = visit_settlement_window
	override_background = { reference = throne_room_rivendell }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	center_portrait = {
		character = scope:elrond
		animation = personality_greedy
	}
	right_portrait = {
		character = scope:brogur
		animation = interested
	}
	immediate = { 
		title:c_imladris.holder.top_liege = { save_scope_as = elrond }
		create_character = {
			template = random_dwarf_template
			employer = scope:elrond
			dynasty = generate
			culture = culture:iron_hills
			faith = faith:faith_khazad
			name = Brogur
			age = 100
			save_scope_as = brogur
		}
	}
	option = { # That's wonderful news!
		name = rangers.0318.a 
		custom_tooltip = rangers.0318.a.tt 
		if = {
			limit = {
				scope:elrond = { NOT = { is_allied_to = root } }
			}
			create_alliance = {
				target = scope:elrond
				allied_through_owner = root
				allied_through_target = scope:elrond
			}
			scope:elrond = {
				add_opinion = {
					modifier = perk_negotiated_alliance_opinion
					target = root
				}
			}
		}
		add_courtier = scope:brogur
	}
	after = {
		start_travel_plan = { #Travel to Bree
			destination = title:c_bree.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0328
		}
	}
}

rangers.0328 = { # Go to Bree
	content_source = realms_dlc
	type = character_event
	title = rangers.0328.t
	desc = rangers.0328.desc
	theme = diplomacy_foreign_affairs_focus
	window = visit_settlement_window
	override_background = { reference = market_west }
	left_portrait = {
		character = root
		animation = throne_room_conversation_1
	}
	right_portrait = {
		character = scope:breemayor
		animation = personality_rational
	}
	immediate = { title:c_bree.holder = { save_scope_as = breemayor } }
	option = { # Join me for your own safety!
		name = rangers.0328.a
		duel = {
 			skill = diplomacy
 			target = scope:breemayor
 			50 = {
				# You're successful
 				desc = rangers.0328.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				send_interface_toast = {
 					title = rangers.0328.a.success
 					left_icon = root
 					right_icon = scope:breemayor
					custom_tooltip = rangers.0328.a.success.tt
 				}
				add_diplomacy_lifestyle_xp = medium_lifestyle_xp
				add_gold = 250
 			}
 			50 = {
 				# You failed
 				desc = rangers.0328.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
 				send_interface_toast = {
 					title = rangers.0328.a.failure
 					left_icon = root
 					right_icon = scope:breemayor
					custom_tooltip = rangers.0328.a.failure.tt
 				}
				scope:breemayor = {
					add_opinion = {
						modifier = insulted_opinion
						opinion = -30
						target = root
					}
				}
 			}
		}
	}
	after = {
		start_travel_plan = { #Travel to Mithlond
			destination = title:c_mithrhulond.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0338
		}
	}
}

rangers.0338 = { # Go to Mithlond
	content_source = realms_dlc
	type = character_event
	title = rangers.0338.t
	desc = rangers.0338.desc
	theme = alliance
	window = visit_settlement_window
	override_background = { reference = throne_room_noldor }
	left_portrait = {
		character = root
		animation = throne_room_conversation_1
	}
	right_portrait = {
		character = scope:cirdan
		animation = throne_room_conversation_2
	}
	immediate = { title:c_mithrhulond.holder.top_liege = { save_scope_as = cirdan } } 
	option = { # Return home
		name = rangers.0338.a 
		custom_tooltip = rangers.0338.a.tt 
		ai_chance = { base = 100 } # AI doesn't make the detour
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0358
		}
	}
	option = { # Go to Thorin's Halls
		name = rangers.0338.b 
		custom_tooltip = rangers.0338.b.tt
		start_travel_plan = { #Travel to the Dwarves
			destination = title:c_ursel_zabad.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0348
		}
	}
}

rangers.0348 = { # Go to Thorin's Hall
	content_source = realms_dlc
	type = character_event
	title = rangers.0348.t
	desc = rangers.0348.desc
	theme = realm
	window = visit_settlement_window
	override_background = { reference = throne_room_dwarf }
	left_portrait = {
		character = root
		animation = throne_room_conversation_1
	}
	right_portrait = {
		character = scope:thorinshalldwarf
		animation = personality_greedy
	}
	immediate = { title:c_ursel_zabad.holder.top_liege = { save_scope_as = thorinshalldwarf } } 
	option = { # Secure alliance
		name = rangers.0348.a 
		custom_tooltip = rangers.0348.a.tt 
		create_alliance = {
			target = scope:thorinshalldwarf
			allied_through_owner = root
			allied_through_target = scope:thorinshalldwarf
		}
		scope:thorinshalldwarf = {
			add_opinion = {
				modifier = perk_negotiated_alliance_opinion
				target = root
			}
		}
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
			on_arrival_event = rangers.0358
		}
	}
}

rangers.0358 = { # Arrive back home
	content_source = realms_dlc
	type = character_event
	title = rangers.0358.t
	desc = rangers.0358.desc
	theme = war
	window = visit_settlement_window
	override_background = { reference = wilderness_forest_deep }
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:brogur
		animation = marshal_shield
	}
	immediate = {
		hidden_effect = {
			current_travel_plan ?= { abort_travel_plan = yes }
			if = {
				limit = {
					NOT = { exists = title:k_khazad_dum.holder }
					title:c_durins_hall.holder.top_liege = {
						is_ai = yes 
						NOT = { has_title = title:k_wastelands }
					}
				}
				title:c_durins_hall.holder.top_liege = {
					get_title = title:k_khazad_dum 
				}
			}
		}
	}
	option = { # We will march to war as soon as all is ready
		name = rangers.0358.a 
		custom_tooltip = rangers.0358.a.tt 
		spawn_army = {
			uses_supply = no
			inheritable = yes
			name = elven_volunteers
			men_at_arms = {
				type = high_elven_pikemen
				stacks = 3
			}
			men_at_arms = {
				type = high_elven_archers
				stacks = 3
			}
			men_at_arms = {
				type = high_elven_heavy_cavalry
				stacks = 1
			}
			location = root.location
		}
		spawn_army = {
			uses_supply = no
			inheritable = yes
			name = dwarven_volunteers
			men_at_arms = {
				type = longbeard_heavy_infantry
				stacks = 3
			}
			men_at_arms = {
				type = longbeard_skirmishers
				stacks = 3
			}
			men_at_arms = {
				type = longbeard_pikemen
				stacks = 3
			}
			location = root.location
		}
		add_character_flag = arassuil_purge_moria
	}	
}

rangers.0368 = { # Declare the War
	content_source = realms_dlc
	type = character_event
	title = rangers.0368.t
	desc = rangers.0368.desc
	theme = war
	window = visit_settlement_window
	trigger = { 
		OR = {
			title:c_durins_hall.holder.top_liege = { is_ai = no }
			root = { is_ai = no }
		}
	}
	override_background = { reference = eregion }
	left_portrait = {
		character = root
		animation = throne_room_two_handed_passive_1
	}
	immediate = { title:c_durins_hall.holder.top_liege = { save_scope_as = azog } }
	option = { # The time has come 
		name = rangers.0368.a
		start_war = {
			casus_belli = purge_moria_arassuil_cb
			target = scope:azog
		}
	}
}

rangers.0388 = { # Win the war
	content_source = realms_dlc
	type = character_event
	title = rangers.0388.t
	desc = rangers.0388.desc
	theme = crown
	window = visit_settlement_window
	override_background = { reference = throne_room_dwarf }
	left_portrait = {
		character = root
		animation = celebrate_spear
	}
	right_portrait = {
		character = scope:azog
		animation = shock
	}
	immediate = {
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog }
		hidden_effect = {
			title:d_zirakzigil = { 
				every_in_de_jure_hierarchy = {
					limit = { 
						#this.title_province = { has_holding_type = dwarven_holding } 
						tier = tier_county
						holder = { faith_is_evil = yes } # don't kick out any dwarves
					}
					make_settlement_county_wilderness = { COUNTY = this }
				}
			}
			title:d_barazinbar = { 
				every_in_de_jure_hierarchy = {
					limit = { 
						#this.title_province = { has_holding_type = dwarven_holding } 
						tier = tier_county
						holder = { faith_is_evil = yes } # don't kick out any dwarves
					}
					make_settlement_county_wilderness = { COUNTY = this }
				}
			}
			title:d_bundushathur = { 
				every_in_de_jure_hierarchy = {
					limit = { 
						#this.title_province = { has_holding_type = dwarven_holding } 
						tier = tier_county
						holder = { faith_is_evil = yes } # don't kick out any dwarves
					}
					make_settlement_county_wilderness = { COUNTY = this }
				}
			}
		}
		remove_character_flag = arassuil_purge_moria 
		scope:azog = { death = { death_reason = death_execution killer = root } }
	}
	option = { # We did it!
		name = rangers.0388.a 
		give_nickname = nick_moria_purger
		add_prestige = massive_prestige_gain
		add_character_flag = had_nickname_event
	}
	option = { # We did it!
		name = rangers.0388.b 
		add_prestige = massive_prestige_gain
		add_legitimacy = medium_legitimacy_gain
	}
}

rangers.0378 = { # Lose the war
	content_source = realms_dlc
	type = character_event
	title = rangers.0378.t
	desc = rangers.0378.desc
	theme = mental_break
	window = visit_settlement_window
	override_background = { reference = throne_room_dwarf }
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:azog
		animation = celebrate_sword
	}
	immediate = {
		remove_list_global_variable = {
			name = unavailable_unique_decisions
   			target = flag:arassuil_dealing_with_azog
		}
		remove_character_flag = arassuil_purge_moria
	}
	option = { # How could this happen?
		name = rangers.0378.a 
		custom_tooltip = rangers.0378.a.tt
		add_prestige = massive_prestige_loss
	}
}

### Eradan, Andriel, and Farin events ###

rangers.0400 = { # A Chieftain's Summon
	content_source = realms_dlc
	type = character_event
	title = rangers.0400.t
	desc = rangers.0400.desc
	theme = diplomacy_foreign_affairs_focus
	#window = visit_settlement_window
	override_background = { reference = wilderness_forest }
	left_portrait = {
		character = root
		animation = throne_room_conversation_1
	}
	right_portrait = {
		character = scope:halbarad
		animation = throne_room_one_handed_passive_1
	}
	immediate = { 
		character:linehalbarad9 = { save_scope_as = halbarad } 
		add_character_flag = is_eradan_wotn
	}
	option = { # We leave at once.
		name = rangers.0400.a
		custom_tooltip = rangers.0400.a.tt
		start_travel_plan = { #Travel to Bree
			destination = title:c_bree.title_province
			players_use_planner = no
			on_arrival_event = rangers.0401
		}
	}
	option = { # I still need time to prepare.
		name = rangers.0400.b
		custom_tooltip = rangers.0400.b.tt
		add_character_flag = eradan_delay_bree
	}
	option = { # AI doesn't do the event chain
		name = rangers.0400.c
		trigger = { is_ai = yes }
		add_prestige = miniscule_prestige_gain
		ai_chance = {
			base = 100 
		}
	}
		
}

rangers.0401 = { # Rumours from Fornost
	content_source = realms_dlc
	type = character_event
	title = rangers.0401.t
	desc = rangers.0401.desc
	theme = laamp
	window = visit_settlement_window
	override_background = { reference = daen_tavern }
	center_portrait = {
		character = root
		animation = marshal
	}
	left_portrait = {
		character = scope:andriel
		animation = writing
	}
	right_portrait = {
		character = scope:aragorn
		animation = debating
	}
	lower_left_portrait = {
		character = scope:farin
	}
	immediate = { 
		character:lineisildur42 = { save_scope_as = aragorn } 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		hidden_effect = { add_contact = scope:aragorn }
		domicile ?= { 
			change_provisions = miniscule_provisions_gain 
			move_domicile = title:c_bree.title_province
		}
		hidden_effect = {
			current_travel_plan ?= { abort_travel_plan = yes }
		}
	}
	option = { # Acknowledge & create the custom contract
		name = rangers.0401.a
		custom_tooltip = rangers.0401.a.tt
		hidden_effect = {
			root = {
				create_task_contract = {
					task_contract_type = lotr_eradan_contract_fornost
					task_contract_employer = scope:aragorn
					location = title:c_fornost.title_province
					task_contract_tier = 4
					save_scope_as = created_contract
				}
			}
		}
		
	}
}

rangers.0402 = { # Fornost: Arrival
	content_source = realms_dlc
	type = character_event
	title = rangers.0402.t
	desc = rangers.0402.desc
	theme = hunt_activity
	window = visit_settlement_window
	override_background = { reference = fornost }
	left_portrait = {
		character = scope:andriel
		animation = survey_staff
	}
	center_portrait = {
		character = root
		animation = marshal
	}
	right_portrait = {
		character = scope:farin
		animation = aggressive_axe
		camera = camera_event_left
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		domicile ?= { 
			change_provisions = miniscule_provisions_gain 
			move_domicile = title:c_fornost.title_province
		}
		hidden_effect = {
			current_travel_plan ?= { abort_travel_plan = yes }
		}
	}
	option = { # We're here, let's explore ...
		name = rangers.0402.a 
		add_prestige = miniscule_prestige_gain
		trigger_event = rangers.0403
	}
}

rangers.0403 = { # Fornost: Goblins!
	content_source = realms_dlc
	type = character_event
	title = rangers.0403.t
	desc = rangers.0403.desc
	theme = hunt_activity
	#window = visit_settlement_window
	override_background = { reference = fornost }
	left_portrait = {
		character = root
		scripted_animation = bow_drawn
	}
	right_portrait = {
		character = scope:fornost_goblin
		animation = aggressive_mace
	}
	lower_left_portrait = {
		character = scope:andriel
	}
	lower_right_portrait = {
		character = scope:farin
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		create_character = {
			template = new_warrior_character
			dynasty = generate
			location = root.location
			gender_female_chance = 0
			save_scope_as = fornost_goblin
			prowess = 14
			culture = culture:generic_goblin
			faith = faith:way_of_strength
			after_creation = {
				scope:fornost_goblin = {
					random_list = {
						1 = { give_nickname = nick_the_dreamer }
						1 = { give_nickname = nick_the_literate_one }
						1 = { give_nickname = nick_the_flogger }
						1 = { give_nickname = nick_the_disgusting }
						1 = { give_nickname = nick_the_angry }
						1 = { give_nickname = nick_the_stalker }
						1 = { give_nickname = nick_the_crafty }
						1 = { give_nickname = nick_the_funny_one }
						1 = { give_nickname = nick_the_filthy }
						1 = { give_nickname = nick_the_screamer }
						1 = { give_nickname = nick_the_bloated }
						1 = { give_nickname = nick_the_whiner }
					}
				}
			}
		}
	}
	option = { # Charge!
		name = rangers.0403.a 
		duel = {
 			skill = prowess
			value = high_skill_rating 
 			50 = {
				# You're successful
 				desc = rangers.0403.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				hidden_effect = { 
					send_interface_toast = {
						title = rangers.0403.a.success
						left_icon = root
						right_icon = scope:fornost_goblin
						custom_tooltip = rangers.0403.a.success
					}
				}
				add_prestige = minor_prestige_gain
				scope:fornost_goblin = { death = { death_reason = death_fight killer = root } }
 			}
 			50 = {
 				# You failed
 				desc = rangers.0403.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
				hidden_effect = {
					send_interface_toast = {
						title = rangers.0403.a.failure
						left_icon = root
						right_icon = scope:fornost_goblin
						custom_tooltip = rangers.0403.a.failure
					}
				}
				increase_wounds_effect = { REASON = fight }
				hidden_effect = { scope:fornost_goblin = { silent_disappearance_effect = yes } }
 			}
		}
	}
	option = { # Shoot them!
		name = rangers.0403.b 
		custom_tooltip = rangers.0403.b.tt
		domicile = {
			change_provisions = minor_provisions_loss
		}
	}
	after = {
		trigger_event = rangers.0404 
	}
}

rangers.0404 = { # Fornost: The Sewers
	content_source = realms_dlc
	type = character_event
	title = rangers.0404.t
	desc = rangers.0404.desc
	theme = dread
	#window = visit_settlement_window
	override_background = { reference = ce1_catacombs }
	left_portrait = {
		character = root
		animation = survey
	}
	right_portrait = {
		character = scope:andriel
		animation = throne_room_one_handed_passive_1
		camera = camera_event_left
	}
	lower_center_portrait = {
		character = scope:farin
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
	}
	option = { # Let Andriel find a way out
		name = rangers.0404.a
		scope:andriel = {
			duel = {
				skill = learning
				value = high_skill_rating 
				50 = {
					# You're successful
					desc = rangers.0404.a.success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 3.5
						min = -49
					}
					hidden_effect = { 
						root = {
							send_interface_toast = {
								title = rangers.0404.a.success
								left_icon = root
								right_icon = scope:andriel
								custom_tooltip = rangers.0404.a.success
							}
						}
					}
					add_prestige = minor_prestige_gain
					root = { trigger_event = rangers.0405 }
				}
				50 = {
					# You failed
					desc = rangers.0404.a.failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -3.5
						min = -49
					}
					hidden_effect = {
						root = {
							send_interface_toast = {
								title = rangers.0404.a.failure
								left_icon = root
								right_icon = scope:andriel
								custom_tooltip = rangers.0404.a.failure
							}
						}
					}
					add_prestige = minor_prestige_loss
					root = { trigger_event = { id = rangers.0405 days = 10 } }
				}
			}
		}
	}
	option = { # Let Farin find a way out
		name = rangers.0404.b
		scope:farin = {
			duel = {
				skill = martial
				value = high_skill_rating 
				50 = {
					# You're successful
					desc = rangers.0404.b.success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 3.5
						min = -49
					}
					hidden_effect = { 
						root = {
							send_interface_toast = {
								title = rangers.0404.b.success
								left_icon = root
								right_icon = scope:farin
								custom_tooltip = rangers.0404.b.success
							}
						}
					}
					add_prestige = minor_prestige_gain
					root = { trigger_event = rangers.0405 }
				}
				50 = {
					# You failed
					desc = rangers.0404.b.failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -3.5
						min = -49
					}
					hidden_effect = {
						root = {
							send_interface_toast = {
								title = rangers.0404.b.failure
								left_icon = root
								right_icon = scope:farin
								custom_tooltip = rangers.0404.b.failure
							}
						}
					}
					add_prestige = minor_prestige_loss
					root = { trigger_event = { id = rangers.0405 days = 10 } }
				}
			}
		}
	}
}

rangers.0405 = { # Fornost: The Eagle
	content_source = realms_dlc
	type = character_event
	title = rangers.0405.t
	desc = rangers.0405.desc
	theme = hunt_activity
	#window = visit_settlement_window
	override_background = { reference = market_dunedain }
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:farin
		animation = personality_rational
		camera = camera_event_left
	}
	lower_center_portrait = {
		character = scope:andriel
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
	}
	option = { # Well met, Belaram.
		name = rangers.0405.a
		add_stress = -10
	}
	after = {
		trigger_event = rangers.0406
	}
}

rangers.0406 = { # Fornost: The Troll
	content_source = realms_dlc
	type = character_event
	title = rangers.0406.t
	desc = rangers.0406.desc
	theme = martial
	#window = visit_settlement_window
	override_background = { reference = eagles }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	right_portrait = {
		character = scope:fornost_troll
		animation = menacing
		camera = camera_body_left
	}
	lower_left_portrait = {
		character = scope:andriel
	}
	lower_right_portrait = {
		character = scope:farin
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		create_character = { # Create a new troll
			culture = culture:hill_troll
			faith = faith:way_of_strength
			prowess = 25
			gender_female_chance = 0
			location = root.location
			save_scope_as = fornost_troll
		}
	}
	option = { # We fight the troll!
		name = rangers.0406.a
		add_stress = 10
		duel = {
 			skill = prowess
			target = scope:fornost_troll
 			50 = {
				# You're successful
 				desc = rangers.0406.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				hidden_effect = { 
					send_interface_toast = {
						title = rangers.0406.a.success
						left_icon = root
						right_icon = scope:fornost_troll
						custom_tooltip = rangers.0406.a.success
					}
				}
				add_prestige = medium_prestige_gain
				scope:fornost_troll = { death = { death_reason = death_fight killer = root } }
 			}
 			50 = {
 				# You failed
 				desc = rangers.0406.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
				hidden_effect = {
					send_interface_toast = {
						title = rangers.0406.a.failure
						left_icon = root
						right_icon = scope:fornost_troll
						custom_tooltip = rangers.0406.a.failure
					}
				}
				increase_wounds_effect = { REASON = fight }
				hidden_effect = { scope:fornost_troll = { silent_disappearance_effect = yes } }
 			}
		}
	}
	option = { # Distract it so Belaram can kill it
		name = rangers.0406.b
		duel = {
 			skill = intrigue
			target = scope:fornost_troll
 			50 = {
				# You're successful
 				desc = rangers.0406.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				hidden_effect = { 
					send_interface_toast = {
						title = rangers.0406.a.success
						left_icon = root
						right_icon = scope:fornost_troll
						custom_tooltip = rangers.0406.a.success
					}
				}
				add_intrigue_lifestyle_xp = 100
				scope:fornost_troll = { death = { death_reason = death_fight } }
 			}
 			50 = {
 				# You failed
 				desc = rangers.0406.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
				hidden_effect = {
					send_interface_toast = {
						title = rangers.0406.a.failure
						left_icon = root
						right_icon = scope:fornost_troll
						custom_tooltip = rangers.0406.a.failure
					}
				}
				increase_wounds_effect = { REASON = fight }
				hidden_effect = { scope:fornost_troll = { silent_disappearance_effect = yes } }
 			}
		}
	}
	after = {
		trigger_event = rangers.0407
	}
}

rangers.0407 = { # Fornost: The Sons of Elrond
	content_source = realms_dlc
	type = character_event
	title = rangers.0407.t
	desc = rangers.0407.desc
	theme = crown
	window = visit_settlement_window
	override_background = { reference = fornost }
	left_portrait = {
		character = root
		animation = happiness
		camera = camera_event_left
	}
	center_portrait = {
		character = scope:elladan
		animation = marshal
		camera = camera_event_right
		triggered_outfit = {
			outfit_tags = { elven_war_noldor no-headgear }
		}
	}
	right_portrait = {
		character = scope:elrohir
		animation = bow_idle
		camera = camera_event_right
		triggered_outfit = {
			outfit_tags = { elven_war_noldor no-headgear }
		}
	}
	lower_left_portrait = {
		character = scope:andriel
	}
	lower_center_portrait = {
		character = scope:farin
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		character:linefinwe28 = { save_scope_as = elladan }
		character:linefinwe29 = { save_scope_as = elrohir }
	}
	option = { # It is good to see you, friends.
		name = rangers.0407.a
		add_stress = -20
	}
	option = { # Let us bandage your wounds
		name = rangers.0407.b
		trigger = {
			OR = {
				has_trait = wounded_1
				has_trait = wounded_2
				has_trait = wounded_3
			}
		}
		if = {
			limit = { has_trait = wounded_1 }
			remove_trait = wounded_1
		}
		else_if = {
			limit = { has_trait = wounded_2 }
			remove_trait = wounded_2 
			add_trait = wounded_1
		}
		else_if = {
			limit = { has_trait = wounded_3 }
			remove_trait = wounded_3
			add_trait = wounded_2
		}	
	}
	after = {
		trigger_event = rangers.0408
	}
}

rangers.0408 = { # Fornost: Leader of the Orcs
	content_source = realms_dlc
	type = character_event
	title = rangers.0408.t
	desc = rangers.0408.desc
	theme = war
	#window = visit_settlement_window
	override_background = { reference = fornost }
	left_portrait = {
		character = root
		scripted_animation = bow_drawn
	}
	right_portrait = {
		character = scope:tharzog
		animation = random_weapon_coup_degrace
	}
	lower_left_portrait = {
		character = scope:andriel
	}
	lower_right_portrait = {
		character = scope:farin
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		character:linefinwe28 = { save_scope_as = elladan }
		character:linefinwe29 = { save_scope_as = elrohir }
		character:lineoftharzog1 = { save_scope_as = tharzog }
	}
	option = { # We must strike down this foe
		name = rangers.0408.a
		duel = {
 			skill = martial
			target = scope:tharzog
 			50 = {
				# You're successful
 				desc = rangers.0408.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				hidden_effect = { 
					send_interface_toast = {
						title = rangers.0408.a.success
						left_icon = root
						right_icon = scope:tharzog
						custom_tooltip = rangers.0408.a.success
					}
				}
				add_prestige = major_prestige_gain
				scope:tharzog = { death = { death_reason = death_fight killer = root } }
 			}
 			50 = {
 				# You failed
 				desc = rangers.0408.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
				hidden_effect = {
					send_interface_toast = {
						title = rangers.0408.a.failure
						left_icon = root
						right_icon = scope:tharzog
						custom_tooltip = rangers.0408.a.failure
					}
				}
				increase_wounds_effect = { REASON = fight }
 			}
		}	
	}
	after = {
		trigger_event = rangers.0409
	}
}

rangers.0409 = { # Fornost: The Dark Figure
	content_source = realms_dlc
	type = character_event
	title = rangers.0409.t
	desc = rangers.0409.desc
	theme = skull
	window = visit_settlement_window
	override_background = { reference = fornost }
	override_effect_2d = {
		reference = rain
	}
	widgets = {
		widget = {
			gui = "event_window_widget_vfx_lightning_storm"
			container = "foreground_shader_vfx_container"
		}
	}
	left_portrait = {
		character = scope:elladan
		scripted_animation = bow_drawn
		triggered_outfit = {
			outfit_tags = { elven_war_noldor no-headgear }
		}
	}
	center_portrait = {
		character = scope:elrohir
		animation = aggressive_sword
		triggered_outfit = {
			outfit_tags = { elven_war_noldor no-headgear }
		}
	}
	right_portrait = {
		character = scope:agandaur
		animation = throne_room_two_handed_passive_1
		triggered_outfit = {
			outfit_tags = { western_stealth_hood }
			outfit_tags = { military_outfit }
		}
	}
	lower_left_portrait = {
		character = scope:andriel
	}
	lower_right_portrait = {
		character = root
	}
	lower_center_portrait = {
		character = scope:farin
	}
	immediate = { 
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		character:linefinwe28 = { save_scope_as = elladan }
		character:linefinwe29 = { save_scope_as = elrohir }
		create_character = {
			#template = new_warrior_character
			dynasty = generate
			name = Agandaur
			age = 45
			prowess = 14
			martial = 10
			diplomacy = 8 
			intrigue = 12 
			learning = 8 
			trait = arrogant
			trait = patient
			trait = deceitful
			trait = shrewd
			random_traits = no
			location = root.location
			gender_female_chance = 0
			trait = sorcerer_1
			trait = cannot_marry
			save_scope_as = agandaur
			culture = culture:anbalukkhori
			faith = faith:lidless_eye
		}
	}
	option = { # A dark power is rising
		name = rangers.0409.a
		add_stress = 30
		hidden_effect = {
			province:5038 = {
				set_holding_type = castle_holding	
				add_building = castle_02
				add_building = cereal_fields_02
				add_building = barracks_02
			}
			province:5040 = {
				set_holding_type = church_holding
				add_building = scriptorium_01
			}
			province:5039 = {
				set_holding_type = castle_holding	
				add_building = barracks_01
			}
			title:c_vale_of_drakes = {
				set_county_faith = scope:agandaur.faith
				set_county_culture = scope:agandaur.culture
				change_development_level = 10
				change_county_control = 100
			}
			create_title_and_vassal_change = {
				type = conquest
				save_scope_as = title_change
				add_claim_on_loss = yes
			}
			title:c_vale_of_drakes = {
				change_title_holder = {
					holder = scope:agandaur
					change = scope:title_change
					take_baronies = yes
				}
			}
			scope:agandaur = { becomes_independent = { change = scope:title_change } }
			resolve_title_and_vassal_change = scope:title_change
				
			scope:agandaur = {
				change_government = feudal_government
				get_title = title:d_withered_heath
				add_gold = 600
				spawn_army = {
					uses_supply = no
					inheritable = yes
					name = ar_ardunaim_event_settlers
					levies = 1000
					men_at_arms = {
						type = adunaim_armsmen
						stacks = 2
					}
					men_at_arms = {
						type = abrazanim_warbows
						stacks = 2
					}
					location = province:5038
				}
			}
			
			title:c_vale_of_drakes = { generate_coa = yes }
			title:b_irak_adash = { generate_coa = yes }
			title:b_canyons_end = { generate_coa = yes }
		}
	}

	after = {
		trigger_event = rangers.0410
	}
}

rangers.0410 = { # Fornost: End of the Mission
	content_source = realms_dlc
	type = character_event
	title = rangers.0410.t
	desc = rangers.0410.desc
	theme = hunt_activity
	#window = visit_settlement_window
	override_background = { reference = fornost }
	left_portrait = {
		character = scope:elladan
		animation = worry
		triggered_outfit = {
			outfit_tags = { elven_war_noldor no-headgear }
		}
	}
	right_portrait = {
		character = root
		animation = personality_rational
	}
	lower_left_portrait = {
		character = scope:andriel
	}
	lower_center_portrait = {
		character = scope:farin
	}
	lower_right_portrait = {
		character = scope:elrohir 
	}
	option = { # We must return to Sarn Ford 
		name = rangers.0410.a
		set_relation_friend = {
			reason = friend_upgrade_generic
			target = scope:elladan
		}
		set_relation_friend = {
			reason = friend_upgrade_generic
			target = scope:elrohir
		}
		start_travel_plan = { #Travel to Sarn Ford
			destination = title:c_iach_sarn.title_province
			on_arrival_event = rangers.0411
			#return_trip = no
			players_use_planner = no
			#on_arrival_destinations = all
		}
	}
}

rangers.0411 = { # Sarn Ford: The Return
	content_source = realms_dlc
	type = character_event
	title = rangers.0411.t
	desc = rangers.0411.desc
	theme = diplomacy
	#window = visit_settlement_window
	override_background = { reference = carrock }
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:halbarad
		animation = personality_rational
	}
	lower_left_portrait = {
		character = scope:andriel
	}
	lower_center_portrait = {
		character = scope:farin
	}
	immediate = {
		character:lineofandriel = { save_scope_as = andriel } 
		character:lineofnorin2 = { save_scope_as = farin }
		character:linehalbarad9 = { save_scope_as = halbarad }
		custom_tooltip = eradan_end_of_content		
		domicile ?= { 
			change_provisions = minor_provisions_gain 
			move_domicile = title:c_iach_sarn.title_province
		}
		hidden_effect = {
			current_travel_plan ?= { abort_travel_plan = yes }
		}
	}
	option = { # We're back
		name = rangers.0411.a
		add_prestige = minor_prestige_gain
		custom_tooltip = rangers.0411.a.tt # You complete your contract
		random_character_active_contract = {
			limit = { has_task_contract_type = lotr_eradan_contract_fornost }
			complete_task_contract = success_standard
		} 
	}
}	

### Management Events ###

rangers.9001 = {
	hidden = yes 
	immediate = {
		title:d_northern_dunedain.holder = {
			trigger_event = rangers.0300 
		}
	}
}