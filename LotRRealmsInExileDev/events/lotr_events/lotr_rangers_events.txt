namespace = rangers

# Events about Aragorn
#		rangers.0101	Dunedain Encampments of Eriador
#       rangers.0200	Death of Gilraen
# Long Winter Start Date Events
#		rangers.0300	Growing Orc Activity
#		rangers.0301	Visiting Elrond
#		rangers.0302	Elrond hears rumours of Orcs
#		rangers.0303	Elrond receives Arassuil
#		rangers.0304	Elrond gives his counsel

rangers.0101 = { # Dunedain Encampments - chance to swear fealty
	content_source = realms_dlc
	type = character_event
	immediate = {
		title:d_northern_dunedain.holder = { save_scope_as = dunedain_chieftain }
	}
	title = rangers.0101.t
	desc = rangers.0101.desc
	theme = stewardship_duty_focus
	left_portrait = {
		character = root
		animation = idle
	}

	right_portrait = {
		character = scope:dunedain_chieftain
		animation = idle
	}

	option = { # Heed the call of the chieftain!
		name = rangers.0101.a
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
		}
		root = {
			change_liege = {
				liege = scope:dunedain_chieftain
				change = scope:change
			}
			add_opinion = {
				modifier = became_vassal
				target = scope:dunedain_chieftain
				opinion = 10
			}
		}
		resolve_title_and_vassal_change = scope:change

		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.

			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}

			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}

			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	option = { # We need to act on our own for now.
		name = rangers.0101.b
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.

			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}

			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 30
			}

			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
}

rangers.0200 = { # Death of Gilraen
	content_source = realms_dlc
	type = character_event
	title = rangers.0200.t
	desc = rangers.0200.desc
	theme = stewardship_duty_focus
	left_portrait = {
		character = character:lineisildur42
		animation = worry
	}
	right_portrait = {
		character = character:linegilraen1
		animation = dead
	}
	
	option = { # Farewell, Mother
		name = rangers.0200.a
		character:linegilraen1 = {
			death = { death_reason = death_natural_causes }
		}
	}
}

### Long Winter Start Date Events ###

rangers.0300 = { # Growing Orc Activity
	content_source = realms_dlc
	type = character_event
	title = rangers.0300.t
	desc = rangers.0300.desc
	theme = dread
	window = visit_settlement_window
	cooldown = { years = 150 }
	override_background = { reference = wilderness_forest }
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:azog
		animation = aggressive_sword
	}
	immediate = {
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog }
		title:c_imladris.holder.top_liege = { trigger_event = rangers.0302 }
	}
	option = { # I shall seek the counsel of Elrond of Rivendell
		name = rangers.0300.a
		custom_tooltip = rangers.0300.a.tt
		add_character_flag = arassuil_seek_elronds_counsel
	}
}

rangers.0301 = { # Visit Elrond
	content_source = realms_dlc
	type = character_event
	title = rangers.0301.t
	desc = rangers.0301.desc
	theme = friend_relation
	window = visit_settlement_window
	override_background = { reference = throne_room_rivendell }
	left_portrait = {
		character = root
		animation = throne_room_conversation_1
	}
	right_portrait = {
		character = scope:elrond
		animation = personality_rational
	}
	immediate = {
		title:c_imladris.holder.top_liege = { save_scope_as = elrond }
	}
	option = { # 
		name = rangers.0301.a
		add_stress = -10
		title:c_imladris.holder.top_liege = { trigger_event = rangers.0303 }
	}
}

rangers.0302 = { # Elrond hears rumours of Orcs
	content_source = realms_dlc
	type = character_event
	title = rangers.0302.t
	desc = rangers.0302.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = throne_room_rivendell }
	left_portrait = {
		character = root
		animation = reading
	}
	right_portrait = {
		character = scope:son_of_elrond
		animation = marshal
	}
	immediate = {
		root.primary_heir = { save_scope_as = son_of_elrond }
	}
	option = { # I will reach out to the Dúnedain
		name = rangers.0302.a
		custom_tooltip = rangers.0302.a.tt
	}
}

rangers.0303 = { # Elrond gives his counsel 
	content_source = realms_dlc
	type = character_event
	title = rangers.0303.t
	desc = rangers.0303.desc
	theme = friend_relation
	override_background = { reference = throne_room_rivendell }
	left_portrait = {
		character = root
		animation = throne_room_conversation_2
	}
	right_portrait = {
		character = scope:dunedain_chieftain
		animation = throne_room_two_handed_passive_1
	}
	immediate = {
		title:d_northern_dunedain.holder = { save_scope_as = dunedain_chieftain }
	}
	option = { # Set a trap for the Orc's leader
		name = rangers.0303.a
	}
	option = { # Strike at the heart of our enemy
		name = rangers.0303.b
		add_character_flag = elrond_strike_moria
	}
	after = {
		scope:dunedain_chieftain = { trigger_Event = rangers.0304 }
	}
}

rangers.0304 = { # Receive Elrond's counsel 
	content_source = realms_dlc
	type = character_event
	title = rangers.0304.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:elrond = { has_character_flag = elrond_strike_moria }
				}
				desc = rangers.0304.desc.a
			}
			desc = rangers.0304.desc
		}
	}
	theme = friend_relation
	override_background = { reference = throne_room_rivendell }
	window = visit_settlement_window
	left_portrait = {
		character = root
		animation = throne_room_two_handed_passive_1
	}
	right_portrait = {
		character = scope:elrond
		animation = throne_room_conversation_2
	}
	immediate = {
	}
	option = { # I will consider your wisdom
		name = rangers.0304.a
		custom_tooltip = rangers.0304.a.tt 
	}
	after = {
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			on_arrival_event = rangers.0305
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
	}
}

rangers.0305 = { # Returning to the Angle
	content_source = realms_dlc
	type = character_event
	title = rangers.0305.t
	desc = rangers.0305.desc
	theme = martial_chivalry_focus
	window = visit_settlement_window
	override_background = { reference = wilderness_forest_deep }
	left_portrait = {
		character = root
		animation = inspect_weapon
	}
	immediate = { title:c_durins_hall.holder.top_liege = { save_scope_as = azog } }
	option = { # I must end this threat to Eriador. It is my duty.
		name = rangers.0305.a
		custom_tooltip = rangers.0305.a.tt
		add_character_flag = arassuil_dealing_with_azog
	}
}

rangers.0306 = { # Lay a Trap
	content_source = realms_dlc
	type = character_event
	title = rangers.0306.t
	desc = rangers.0306.desc
	theme = intrigue
	window = visit_settlement_window
	override_background = { reference = wilderness_forest_deep }
	left_portrait = {
		character = root
		scripted_animation = bow_drawn
	}
	immediate = { title:c_durins_hall.holder.top_liege = { save_scope_as = azog } }
	option = { # I will end this here and now
		name = rangers.0306.a
		custom_tooltip = rangers.0306.a.tt
		add_prestige = 50
	}
}

rangers.0307 = { # Fight a duel
	content_source = realms_dlc
	type = character_event
	title = rangers.0307.t
	desc = rangers.0307.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = wilderness_forest }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	lower_right_portrait = { character = scope:knight1 }
	lower_center_portrait = { character = scope:knight2 }
	lower_left_portrait = { character = scope:knight3 }	
	immediate = { 
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog }
		random_knight = { 
			limit = { is_ai = yes }
			save_scope_as = knight1 }
		}
		random_knight = {
			limit = { 
				NOT = { this = scope:knight1 } 
				is_ai = yes
			}
			save_scope_as = knight2
		}
		random_knight = {
			limit = { 
				NOT = { this = scope:knight1 }
				NOT = { this = scope:knight2 }
				is_ai = yes
			}
			save_scope_as = knight3
		}
	}
	option = { # I will end this here and now
		name = rangers.0307.a
		custom_tooltip = rangers.0307.a.tt
		add_prestige = 50
		start_travel_plan = { #Travel to the west gate
			destination = title:c_west_hall.title_province
			on_arrival_event = rangers.0317
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
	}
	after = {
		current_travel_plan = { 
			add_companion = scope:knight1
			add_companion = scope:knight2
			add_companion = scope:knight3
		}
	}
}

rangers.0308 = { # Start a war
	content_source = realms_dlc
	type = character_event
	title = rangers.0308.t
	desc = rangers.0308.desc
	theme = war
	window = visit_settlement_window
	override_background = { reference = eregion_ruins }
	left_portrait = {
		character = root
		animation = celebrate_sword
	}
	immediate = { title:c_durins_hall.holder.top_liege = { save_scope_as = azog } }
	option = { # I will end this here and now
		name = rangers.0308.a
		custom_tooltip = rangers.0308.a.tt
		add_prestige = 50
	}
}

rangers.0317 = { # Travelling to Moria
	content_source = realms_dlc
	type = character_event
	title = rangers.0317.t
	desc = rangers.0317.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = durins_door }
	override_effect_2d = { reference = rain	}
	left_portrait = {
		character = root
		animation = personality_callous
	}
	right_portrait = {
		character = scope:caravan_master
		animation = worry
	}
	immediate = { 
		if = {
			limit = { employs_court_position = travel_leader_court_position }
			current_travel_plan.travel_leader = { save_scope_as = caravan_master }
		}
		else = {
			create_character = {
				template = foreign_architect_template
				employer = root
				save_scope_as = caravan_master
			}
			appoint_court_position = {
				recipient = scope:caravan_master
				court_position = travel_leader_court_position
			}
		}
	}
	option = { # Are you afraid of water now?
		name = rangers.0317.a
		custom_tooltip = rangers.0317.a.tt
		hidden_effect = {
			duel = {
				skill = prowess
				value = high_skill_rating
				60 = { # You beat back the Watcher
					compare_modifier = {
						value = scope:duel_value
						multiplier = 3.5
						min = -49
					}
					min = 10
					send_interface_toast = {
						title = rangers.0317.a.tt.success
						add_prestige = medium_prestige_value
					}
				}
				40 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -3.5
						min = -49
					}
					min = 5
					random_list = {
						85 = {
							send_interface_toast = {
								title = rangers.0317.a.tt.failure
								add_stress = medium_stress_gain
								increase_wounds_effect = { REASON = maimed_by_wild_beast }
							}
						}
						15 = {
							send_interface_toast = {
								title = rangers.0317.a.tt.failure_critical
								death = { death_reason = death_drowned }
							}
						}
					}
				}
			}
		}
	}
	
	option = { # Do not stir up the water.
		name = rangers.0317.b 
		custom_tooltip = rangers.0317.b.tt 
		current_travel_plan = { 
			delay_travel_plan = {
				days = 25
			}
		}
	}
	
	after = {
		trigger_event = rangers.0327 # The Challenge
	}
}

rangers.0327 = { # The Challenge
	content_source = realms_dlc
	type = character_event
	title = rangers.0327.t
	desc = rangers.0327.desc
	theme = intrigue
	window = visit_settlement_window
	override_background = { reference = underground_caverns_02 }
	left_portrait = {
		character = root
		animation = celebrate_spear
	}
	lower_center_portrait = { character = scope:azog }
	option = { # Come forth, Azog! Come forth, and face me!
		name = rangers.0327.a
		custom_tooltip = rangers.0327.a.tt
		scope:azog = { trigger_event = orcs.7202 } #Azog reacts 
	}
}

rangers.0337 = { # The Duel
	content_source = realms_dlc
	type = character_event
	title = rangers.0337.t
	desc = rangers.0337.desc
	theme = battle
	window = visit_settlement_window
	override_background = { reference = throne_room_dwarf }
	left_portrait = {
		character = root
		animation = aggressive_spear
	}
	right_portrait = {
		character = scope:azog
		animation = menacing
	}
	immediate = { 
		title:c_durins_hall.holder.top_liege = { save_scope_as = azog } 
		random_knight = {
			limit = { is_travel_entourage_character = yes }
			save_scope_as = chosen_knight1
		}
		random_knight = {
			limit = { 
				is_travel_entourage_character = yes 
				NOT = { this = scope:chosen_knight1 }
			}
			save_scope_as = chosen_knight2
		}
	}
	option = { # Fight the duel yourself 
		name = rangers.0337.a
		custom_tooltip = rangers.0337.a.tt
		# trigger = {
			# can_start_single_combat_trigger = yes
		# }
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = root
			SC_DEFENDER = scope:azog
			FATALITY = always
			FIXED = no
			LOCALE = wilderness_scope
			OUTPUT_EVENT = rangers.0357
			INVALIDATION_EVENT = rangers.0377
		}
	}
	
	option = { # Send a knight to fight (1)
		name = rangers.0337.b
		trigger = {
			exists = scope:chosen_knight1
			#scope:knight1 = { can_start_single_combat_trigger = yes }
		}
		custom_tooltip = rangers.0337.b.tt
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = scope:chosen_knight1
			SC_DEFENDER = scope:azog
			FATALITY = always
			FIXED = no
			LOCALE = wilderness_scope
			OUTPUT_EVENT = rangers.0357
			INVALIDATION_EVENT = rangers.0377
		}
	}
	
	option = { # Send a knight to fight (2)
		name = rangers.0337.c
		trigger = {
			exists = scope:chosen_knight2
			#scope:knight2 = { can_start_single_combat_trigger = yes }
		}
		custom_tooltip = rangers.0337.c.tt
		configure_start_single_combat_effect = {
			SC_INITIATOR = root
			SC_ATTACKER = scope:chosen_knight1
			SC_DEFENDER = scope:azog
			FATALITY = always
			FIXED = no
			LOCALE = wilderness_scope
			OUTPUT_EVENT = rangers.0357
			INVALIDATION_EVENT = rangers.0377
		}
	}
}

rangers.0357 = { # Single combat result
	hidden = yes
	immediate = {
		if = {
			limit = { scope:sc_victor = scope:azog }
			scope:azog = { 
				trigger_event = {
					id = orcs.7203
					days = 1
				}
			}
		}
		else_if = {
			limit = { 
				OR = {
					scope:sc_victor = root
					scope:sc_victor = scope:chosen_knight1
					scope:sc_victor = scope:chosen_knight2
				}
			}
			trigger_event = {
				id = rangers.0367
				days = 1 
			}
		}
	}
}

rangers.0367 = { # Win the duel
	content_source = realms_dlc
	type = character_event
	title = rangers.0367.t
	desc = rangers.0367.desc
	theme = crown
	window = visit_settlement_window
	override_background = { reference = wilderness_underground }
	left_portrait = {
		character = scope:sc_victor
		animation = celebrate_sword
	}
	right_portrait = {
		character = scope:azog
		animation = shock
	}
	immediate = {
		if = {
			limit = {
				scope:azog = { is_alive = yes }
			}
			scope:azog = {
				death = {
					death_reason = death_duel
					killer = root 
				}
			}
		}
		else = {
			show_as_tooltip = {
				scope:azog = {
					death = {
						death_reason = death_duel
						killer = root 
					}
				}
			}
		}
		# TO DO: Make Azog's realm break apart
	}
	option = { # Good riddance!
		name = rangers.0367.a 
		custom_tooltip = rangers.0367.a.tt 
		add_prestige = massive_prestige_gain
		give_nickname = nick_orcslayer
		add_character_flag = had_nickname_event
	}
	option = { # Let's go home.
		name = rangers.0367.b 
		custom_tooltip = rangers.0367.b.tt 
		add_prestige = massive_prestige_gain
	}
	after = {
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
	}
}

rangers.0377 = { # Duel invalidated (Azog flees)
	content_source = realms_dlc
	type = character_event
	title = rangers.0377.t
	desc = rangers.0377.desc
	theme = dread
	window = visit_settlement_window
	override_background = { reference = wilderness_underground }
	left_portrait = {
		character = scope:sc_victor
		animation = anger
	}
	right_portrait = {
		character = scope:azog
		animation = schadenfreude
	}
	option = { # We have to get out of here.
		name = rangers.0377.a 
		custom_tooltip = rangers.0377.a.tt 
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
			on_arrival_event = rangers.0347
		}
	}
}

rangers.0347 = { # Re-enable Orc decision
	hidden = yes
	immediate = {
		remove_list_global_variable = {
			name = unavailable_unique_decisions
   			target = flag:arassuil_dealing_with_azog
		}
	}
}