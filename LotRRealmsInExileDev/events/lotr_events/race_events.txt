namespace = race

# Maintenance event for various races, converting culture, adding traits, etc.
#	race.0001	conversion for chaplains

scripted_trigger not_nazgul = {
	culture = culture:ringwraith
	NOT = { has_trait = nazgul }
}

scripted_trigger not_istari = {
	culture = culture:istari
	NOT = { has_trait = istari }
}

scripted_trigger not_istari_evil = {
	culture = culture:istari_evil
	NOT = { has_trait = istari }
}

scripted_trigger not_maiar = {
	culture = culture:maiar
	NOT = { has_trait = maiar }
}

scripted_trigger not_maiar_fallen = {
	culture = culture:maiar_fallen
	NOT = { has_trait = maiar }
}

scripted_trigger not_valar = {
	culture = culture:valar
	NOT = { has_trait = valar }
}

race.0001 = {
	hidden = yes

	trigger = {
		is_from_ruler_designer = no
		OR = {
			not_valar = yes
			not_nazgul = yes
			not_istari = yes
			not_istari_evil = yes
			not_maiar = yes
			not_maiar_fallen = yes
		}
	}


	immediate = {
		#if = {
		#	limit = {
		#		not_valar = yes
		#	}
		#	death = natural
		#}
		if = {
			limit = {
				not_nazgul = yes
			}
			set_culture = culture:ungurhai
		}
		else_if = {
			limit = {
				not_istari = yes
			}
			if = {
				limit = { is_landed = yes }
				set_culture = root.capital_province.culture
				set_character_faith = root.capital_province.faith
			}
		}
		else_if = {
			limit = {
				not_istari_evil = yes
			}
			set_culture = culture:isengard_urukhai
		}
		else_if = {
			limit = {
				not_maiar = yes
			}
			if = {
				limit = { is_landed = yes }
				set_culture = root.capital_province.culture
				set_character_faith = root.capital_province.faith
			}
		}
		else_if = {
			limit = {
				not_maiar_fallen = yes
			}
			set_culture = culture:morlughai
		}
		if = {
			limit = {
				has_dynasty = yes
			}
			dynasty = { generate_coa = yes }
		}
	}

}

race.0002 = {
	hidden = yes
	
	trigger = {
		nubile_age > 16
		is_a_minor = yes
		age < majority_age
		NOT = { exists = father }
		NOT = { exists = mother }
		NOT = { exists = dynasty }
	}

	immediate = {
		if = {
			limit = { is_elf = no }
			change_age = { years_to_nubility age_equivalent_20 }
		}
		else = { change_age = { 50 2000 } }
	}
}

race.0003 = { #Removal of health bonus for elderly characters
	hidden = yes
	
	trigger = {
		OR = {
			has_character_modifier = youthful_vigor_1_modifier
			has_character_modifier = youthful_vigor_1_5_modifier
			has_character_modifier = youthful_vigor_2_modifier
		}
	}
	
	immediate = {
		if = { #Youthful vigor 1
			limit = { has_character_modifier = youthful_vigor_1_modifier }
			remove_character_modifier = youthful_vigor_1_modifier
		}
		else_if = { #Youthful vigor 1.5
			limit = { has_character_modifier = youthful_vigor_1_5_modifier }
			remove_character_modifier = youthful_vigor_1_5_modifier
		}
		else_if = { #Youthful vigor 2
			limit = { has_character_modifier = youthful_vigor_2_modifier }
			remove_character_modifier = youthful_vigor_2_modifier
		}
	}
}

race.0004 = { #Triggering marriage for betrothed nubiles if AI doesn't manage it
	hidden = yes
	
	trigger = {
		is_betrothed = yes
		OR = { #Checks that the custom betrothal has been used
			nubile_age > 16
			betrothed.nubile_age >16
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_ai = yes
				is_nubile = yes
				betrothed = { 
					is_ai = yes
					is_nubile = yes
				}
				NOT = { has_variable = promised_grand_wedding_marriage_countdown }
			}
			marry = root.betrothed
		}
	}
}