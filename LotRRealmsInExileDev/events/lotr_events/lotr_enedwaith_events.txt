namespace = enedwaith

# enedwaith.0200-1 - Claiming the mantle of Saralain

enedwaith.0200 = { # Someone has claimed the title of 'King of Saralain' - Dukes
	content_source = realms_dlc
	type = character_event
	title = enedwaith.0200.t
	desc = enedwaith.0200.desc
	theme = diplomacy_foreign_affairs_focus
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	right_portrait = {
		character = scope:saralain_claimer
		animation = personality_bold
	}

	option = { # At last, a king has arrived! (Swear Fealty)
		name = enedwaith.0200.a
		create_title_and_vassal_change = {
            type = created
            save_scope_as = change
            add_claim_on_loss = no
        }
		root = {
            change_liege = {
                liege = scope:saralain_claimer
                change = scope:change 
            }
        }
		resolve_title_and_vassal_change = scope:change
	}
	
	option = { # Bah, just another pretentious claimant...
		name = enedwaith.0200.b
		#add_opinion = { modifier = opinion = -40 character = scope:saralain_claimer }
	}
	
	option = { # I should be king instead!
		name = enedwaith.0200.c
		start_war = { # Starts a claim war
			cb = claim_cb
			target = scope:saralain_claimer
			claimant = root
			target_title = title:k_saralain
		}
	}
}

enedwaith.0201 = { # Someone has claimed the title of 'King of Saralain' - Counts
	content_source = realms_dlc
	type = character_event
	title = enedwaith.0200.t
	desc = enedwaith.0200.desc
	theme = diplomacy_foreign_affairs_focus
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	right_portrait = {
		character = scope:saralain_claimer
		animation = personality_bold
	}

	option = { # At last, a king has arrived! (Swear Fealty)
		name = enedwaith.0200.a
		create_title_and_vassal_change = {
            type = created
            save_scope_as = change
            add_claim_on_loss = no
        }
		root = {
            change_liege = {
                liege = scope:saralain_claimer
                change = scope:change 
            }
        }
		resolve_title_and_vassal_change = scope:change
	}
	
	option = { # Bah, just another pretentious claimant...
		name = enedwaith.0200.b
		#add_opinion = { modifier = opinion = -40 character = scope:saralain_claimer }
	}
}

enedwaith.0300 = { # Assassination attempt on Madogh
	content_source = realms_dlc
	type = character_event
	title = enedwaith.0300.t
	desc = enedwaith.0300.desc
	theme = intrigue_skulduggery_focus
	left_portrait = {
		character = root
		animation = fear
	}

	option = { # Avoid being assassinated
		name = enedwaith.0300.a
		
		duel = {
			skill = intrigue
			value = 0
			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
				}
				trigger_event = enedwaith.301
			}

			20 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				death = {
					death_reason = death_assassination
				}
			}
		}
	}
}

enedwaith.0301 = { # Madogh's Rage
	content_source = realms_dlc
	type = character_event
	title = enedwaith.0301.t
	desc = enedwaith.0301.desc
	theme = war
	left_portrait = {
		character = root
		animation = rage
	}
	
	immediate = {
		add_character_flag = angry_madogh
	}

	option = { # Attack the suspects
		name = enedwaith.0301.a
		
		start_war = {
			casus_belli = county_conquest_cb
			target = title:c_amrelor.holder
			target_title = title:c_amrelor
		}
		
		start_war = {
			casus_belli = county_conquest_cb
			target = title:c_ildrin.holder
			target_title = title:c_ildrin
		}
		ai_chance = {
 			base = 100
 		}
	}
	
	option = {
		name = enedwaith.0301.b
		
		stress_impact = {
 			wrathful = major_stress_impact_gain
 		}
		add_pressed_claim = title:c_amrelor
		add_pressed_claim = title:c_ildrin
		ai_chance = {
 			base = 0
 		}
	}
}

enedwaith.0302 = { # True Culprit Found
	content_source = realms_dlc
	type = character_event
	title = enedwaith.0302.t
	desc = enedwaith.0302.desc
	theme = war
	left_portrait = {
		character = root
		animation = rage
	}
	
	trigger = {
		is_independent_ruler = yes
		has_character_flag = angry_madogh
		has_title = title:k_saralain
		has_title = title:c_ildrin
		has_title = title:c_amrelor
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:madogh_found_true_culprit
			}
		}
	}
	
	immediate = { 
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:madogh_found_true_culprit
		}
	}

	option = { # Demand Fealty To Assist in Revenge
		name = enedwaith.0302.a
		
		trigger = { 
			character:lineofferchar10 = {
				is_alive = yes
			}
		}
		every_living_character = { # All independent Saralain counts will have their vassalization requested
			limit = {
				is_independent_ruler = yes
				has_culture = culture:saralain
				highest_held_title_tier = tier_county
				any_sub_realm_county = {
					title_province = { geographical_region = middleearth_west_arnor_cardolan }
				}
			}
			trigger_event = {
				id = enedwaith.0303
				days = { 10 30 }
			}
		}
		add_pressed_claim = title:c_angrast
	
	}
	
	option = { # Threaten the other Saralain to fall in line
		name = enedwaith.0302.b
		
		trigger = { 
			character:lineofferchar10 = {
				is_alive = no
			}
		}
		
		every_living_character = { # All independent Saralain counts will have their vassalization requested
			limit = {
				is_independent_ruler = yes
				has_culture = culture:saralain
				highest_held_title_tier = tier_county
			}
			trigger_event = {
				id = enedwaith.0303
				days = { 10 30 }
			}
		}
		
		stress_impact = {
 			wrathful = medium_stress_impact_gain
 		}
	}
}

enedwaith.0303 = { # Madogh demands fealty
	content_source = realms_dlc
	type = character_event
	title = enedwaith.0303.t
	desc = enedwaith.0303.desc
	theme = diplomacy_foreign_affairs_focus
	
	immediate = {
		title:k_saralain.holder = {
			save_scope_as = sender
		}
	}
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	right_portrait = {
		character = scope:sender
		animation = personality_bold
	}

	option = { # We shall submit to the Mad Dog, lest he turn his rage upon us (Swear Fealty)
		name = enedwaith.0303.a
		create_title_and_vassal_change = {
            type = created
            save_scope_as = change
            add_claim_on_loss = no
        }
		root = {
            change_liege = {
                liege = scope:sender
                change = scope:change 
            }
        }
		resolve_title_and_vassal_change = scope:change
		ai_chance = {
 			base = 100
			modifier = {
 				add = 50
 				OR = {
 					has_trait = craven
 					has_trait = content
 				}
 			}
 		}
	}
	
	option = { # We would never bow to a Mad Dog
		name = enedwaith.0303.b
		ai_chance = {
 			base = 0
 		}
	}
}

enedwaith.1000 = { # Migration cycle start
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1000.t
	desc = enedwaith.1000.desc
	theme = corruption
	
	
	
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		set_global_variable = {
			name = saralain_dev_pool
			value = 0
		}
		add_character_flag = migration_leader
	}

	option = { # bring 1 dev with you
		name = enedwaith.1000.a
		
		random_sub_realm_county = {
			limit = {
				development_level > 0
			}
			change_development_level = -1
		}
		custom_tooltip = {
			text = saralain_dev_pool_1
			change_global_variable = {
				name = saralain_dev_pool
				add = 1
			}
		}
		
		ai_chance = {
 			base = 100
			modifier = {
 				add = 50
 				OR = {
 					has_trait = craven
 					has_trait = content
 				}
 			}
 		}
	}
	
	option = { # bring it all with you
		name = enedwaith.1000.b
		
		
		custom_tooltip = {
			text = saralain_dev_pool_2
			while = {
				limit = {
					any_sub_realm_county = {
						development_level > 0
					}
				}
				random_sub_realm_county = {
					limit = {
						development_level > 0
						}
					change_development_level = -1
				}
			
			}
		}
		
		ai_chance = {
 			base = 100
			modifier = {
 				add = 50
 				OR = {
 					has_trait = craven
 					has_trait = content
 				}
 			}
 		}
	}
	
	after = {
		custom_tooltip = {
			text = call_for_migration
			every_ruler = {
				limit = { 
					culture = culture:enedhwaithrim 
					NOT = {
						has_character_flag = migration_leader
						this = character:linedilwun10
					}
				}
				trigger_event = enedwaith.1002
			}
		}
	}
	
	
}

#enedwaith.1001 = { # Migration cycle dev debug check
#	content_source = realms_dlc
#	type = character_event
#	title = enedwaith.1000.t
#	desc = enedwaith.1000.desc
#	theme = corruption
#	
#	
#	left_portrait = {
#		character = root
#		animation = personality_cynical
#	}
#	
#	
#	override_background = {
#		reference = army_camp
#	}
#	
#	immediate = {
#		
#	}
#
#	option = { # bring 1 dev with you
#		name = enedwaith.1000.a
#		
#		
#	}
#	
#	
#}

enedwaith.1002 = { # Migration cycle notification
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1002.t
	desc = enedwaith.1002.desc
	theme = corruption
	
	right_portrait = {
		character = scope:migration_leader
		animation = marshal
	}
	
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		every_ruler = {
			limit = {
				has_character_flag = migration_leader
			}
			save_scope_as = migration_leader
		}
	}

	option = { # come with
		name = enedwaith.1002.a
		
		custom_tooltip = {
			text = join_migration
			add_character_flag = migration_participant
			save_scope_as = sender
			scope:migration_leader = {
				trigger_event = enedwaith.1003
			}
		}
		
		ai_chance = {
 			base = 50
			
 		}
	}
	
	option = { # come with and commit men
		name = enedwaith.1002.b
		
		trigger = {
			any_sub_realm_county = {
				development_level > 0
			}
		}
		
		custom_tooltip = {
			text = join_migration
			add_character_flag = migration_participant
			save_scope_as = sender
			scope:migration_leader = {
				trigger_event = enedwaith.1003
			}
		}
		
		random_sub_realm_county = {
			limit = {
				development_level > 0
			}
			change_development_level = -1
		}
		custom_tooltip = {
			text = saralain_dev_pool_1
			change_global_variable = {
				name = saralain_dev_pool
				add = 1
			}
		}
		
		
		
		ai_chance = {
 			base = 70
			
 		}
	}
	
	option = { # come with and commit all dev
		name = enedwaith.1002.c
		
		trigger = {
			any_sub_realm_county = {
				development_level > 0
			}
		}
		
		custom_tooltip = {
			text = join_migration
			add_character_flag = migration_participant
			save_scope_as = sender
			scope:migration_leader = {
				trigger_event = enedwaith.1003
			}
		}
		
		
		custom_tooltip = {
			text = saralain_dev_pool_2
			while = {
				limit = {
					any_sub_realm_county = {
						development_level > 0
					}
				}
				random_sub_realm_county = {
					limit = {
						development_level > 0
						}
					change_development_level = -1
				}
				custom_tooltip = {
					text = saralain_dev_pool_1
					change_global_variable = {
						name = saralain_dev_pool
						add = 1
					}
				}
			}
		}
		
		
		ai_chance = {
 			base = 100
			
 		}
	}
	
	option = { # don't join
		name = enedwaith.1002.d
		
		
		
		ai_chance = {
 			base = 100
			
 		}
	}
	
	
	
	
}

enedwaith.1003 = { # Confirm event
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1003.t
	desc = enedwaith.1003.desc
	theme = corruption
	
	
	left_portrait = {
		character = root
		animation = marshal
	}
	right_portrait = {
		character = scope:sender
		animation = marshal
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		
	}

	option = { # bring 1 dev with you
		name = enedwaith.1003.a
		
		
	}
	
	
}

enedwaith.1004 = { # set up camp
	
	type = character_event
	hidden = yes
	
	immediate = {
		primary_title = {
			set_title_name = saralain_migration_name
			set_coa = k_saralain
		}
		
		change_global_variable = {
			name = saralain_dev_pool
			multiply = 4
		}
		hidden_effect = {
			spawn_army = {
				levies = 500
				men_at_arms = { # optional, multiple can be specified. Need either levies or MAA
					type = clan_axemen
					stacks = global_var:saralain_dev_pool
				}
				location = root.location
				name = saralain_migration_name
			}
		}
		
		change_global_variable = {
			name = saralain_dev_pool
			divide = 4
		}
		
		
		domicile = { 
			add_domicile_building = settlement_supplies_01 
			add_domicile_building = settlement_supplies_02 
			add_domicile_building = settlement_supplies_03 
			add_domicile_building = settlement_supplies_04 
			add_domicile_building = settlement_supplies_05 
			add_domicile_building = settlement_supplies_06 
			
			add_domicile_building = camp_main_02 
			add_domicile_building = camp_main_03 
			add_domicile_building = camp_main_04
			
			add_domicile_building = proving_grounds_01 
			add_domicile_building = proving_grounds_02 
			add_domicile_building = proving_grounds_03 
			add_domicile_building = proving_grounds_04 
			
			add_domicile_building = supply_tent_01 
			add_domicile_building = supply_tent_02 
			add_domicile_building = supply_tent_03 
			add_domicile_building = supply_tent_04 
			add_domicile_building = supply_tent_05 
			
		}
			
	}

	
	
	
}

enedwaith.1005 = { # Confirm event
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1005.t
	desc = enedwaith.1005.desc
	theme = corruption
	
	
	left_portrait = {
		character = root
		animation = marshal
	}
	right_portrait = {
		character = scope:migration_leader
		animation = marshal
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		every_ruler = {
			limit = {
				has_character_flag = migration_leader
			}
			save_scope_as = migration_leader
		}
	}

	option = { # bring 1 dev with you
		name = enedwaith.1005.a
		
		depose = yes
		
		scope:migration_leader = {
			add_courtier = root
		}
	}
	
	option = { # bring 1 dev with you
		name = enedwaith.1005.b
		
		remove_character_flag = migration_participant
	}
	
	
}


enedwaith.1100 = { # Arrival in Cardolan
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1100.t
	desc = enedwaith.1100.desc
	theme = corruption
	
	
	left_portrait = {
		character = root
		animation = marshal
	}
	right_portrait = {
		character = scope:sender
		animation = marshal
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		
	}

	option = { # pettion the lord
		name = enedwaith.1100.a
		
		title:k_cardolan.holder = {
			trigger_event = enedwaith.1101
		}
	}
	
	
}

enedwaith.1101 = { # Cardolan Decision
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1101.t
	desc = enedwaith.1101.desc
	theme = corruption
	
	
	left_portrait = {
		character = root
		animation = marshal
	}
	right_portrait = {
		character = scope:sender
		animation = marshal
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		
	}

	option = { # Offer Ethir Gwathlo
		name = enedwaith.1101.a
		
		title:d_ethir_gwathlo = {
			save_scope_as = target_duchy
		}
		
		every_ruler = {
			limit = {
				has_character_flag = migration_leader
			}
			trigger_event = enedwaith.1102
		}
	}
	
	option = { # Offer Tyrn Hodhath
		name = enedwaith.1101.b
		
		title:d_tyrn_hodhath = {
			save_scope_as = target_duchy
		}
		
		every_ruler = {
			limit = {
				has_character_flag = migration_leader
			}
			trigger_event = enedwaith.1102
		}
	}
	
	option = { # Deny
		name = enedwaith.1101.c
		
		every_ruler = {
			limit = {
				has_character_flag = migration_leader
			}
			trigger_event = enedwaith.1103
		}
	}
	
	
}

enedwaith.1102 = { # Saralain Acceptiance
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1102.t
	desc = enedwaith.1102.desc
	theme = corruption
	
	
	left_portrait = {
		character = root
		animation = marshal
	}
	right_portrait = {
		character = scope:sender
		animation = marshal
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		
	}

	option = { # accept
		name = enedwaith.1102.a
		
		
		scope:target_duchy = {
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change_saralain
				add_claim_on_loss = yes
			}
			every_de_jure_county = {
				limit = {
					NOT = { 
						any_county_province = {
							scope:target_duchy.title_province = this
						}
					}
				}
				change_title_holder = {
					holder = root
					change = scope:title_change_saralain
					take_baronies = yes
				}
			}
			
		}
		root = {
            change_liege = {
                liege = scope:target_duchy.holder
                change = scope:title_change_saralain 
            }
        }
		resolve_title_and_vassal_change = scope:title_change_saralain
		
		
		while = {
			count = global_var:saralain_dev_pool
			random_sub_realm_county = {
				change_development_level = 1
				set_county_culture = root.culture
				set_county_faith = root.faith
			}
		}
		
		while = {
			limit = {
				any_ruler = {
					has_character_flag = migration_participant
				}
				domain_size > 2
			}
			random_ruler = {
				limit = {
					has_character_flag = migration_participant
				}
				depose = yes
				root = {
					random_sub_realm_county = {
						save_scope_as = target_county
					}
				}
				get_title = scope:target_county
				remove_character_flag = migration_participant
			}
		}
		
		add_pressed_claim = scope:target_duchy
		
	}
	
	option = { # we won't serve you!
		name = enedwaith.1102.b
		
		add_pressed_claim = scope:target_duchy
		
		start_war = {
			casus_belli = duchy_conquest_cb 
			target = title:k_cardolan.holder 
			target_title = scope:target_duchy
			
			
		}
		
	}
	
	option = { # we leave!
		name = enedwaith.1102.c
		
		add_pressed_claim = scope:target_duchy
		
	}
	
	
}

enedwaith.1103 = { # Saralain War Prompt
	content_source = realms_dlc
	type = character_event
	title = enedwaith.1103.t
	desc = enedwaith.1103.desc
	theme = corruption
	
	
	left_portrait = {
		character = root
		animation = marshal
	}
	right_portrait = {
		character = scope:sender
		animation = marshal
	}
	
	override_background = {
		reference = army_camp
	}
	
	immediate = {
		
	}

	option = { # we fight!
		name = enedwaith.1103.a
		
		add_pressed_claim = title:k_cardolan
		start_war = {
			casus_belli = duchy_conquest_cb 
			target = title:k_cardolan.holder 
			target_title = title:d_ethir_gwathlo
			target_title = title:d_girithlin
			target_title = title:d_dol_caladir
			
		}
		
		
	}
	
	option = { # we leave!
		name = enedwaith.1103.b
		
		add_pressed_claim = title:k_cardolan
		
	}
	

	
	
}