namespace = istari

#######################################
# Istari.0001 Istari guest management #
#######################################

istari.0001 = { # If the host isn't of a good faith, move to one. Otherwise move after 5 years
	hidden = yes
	trigger = {
		is_istari = yes
		faith_is_good = yes
	}
	immediate = {
		if = {
			limit = {
				scope:host = {
					NOT = {
						faith_is_good = yes
						highest_held_title_tier >= tier_duchy
					}
				}
			}
			random_independent_ruler = {
				limit = {
					faith_is_good = yes
					highest_held_title_tier >= tier_duchy
					in_diplomatic_range = root
				}
				save_scope_as = new_host
			}
			move_to_pool_at = scope:new_host.location
		}
		else = {
			trigger_event = {
				id = istari.0002
				years = 5
			}
		}
	}
}

istari.0002 = { # Find the appropriate target for istari.0003
	hidden = yes
	immediate = {
		root = { save_scope_as = departing_istar }
		if = {
			limit = { exists = root.employer }
			root.employer = {
				trigger_event = {
					id = istari.0003
					days = 1
				}
			}
		}
		else_if = { 
			limit = { exists = root.host }
			root.host = {
				trigger_event = {
					id = istari.0003
					days = 1
				}
			}
		}
		else_if = { 
			limit = { exists = root.liege }
			root.liege = {
				trigger_event = {
					id = istari.0003
					days = 1
				}
			}
		} 
	}
}

## Istar moves to another court

istari.0003 = {
	type = character_event
	title = istari.0003.t
	desc = istari.0003.desc
	theme = travel
	override_background = { reference = throne_room }
	left_portrait = {
		character = root
		animation = beg
	}
	right_portrait = {
		character = scope:departing_istar
		animation = dismissal
	}
	
	immediate = {
		if = {
			limit = {
				any_independent_ruler = {
					faith_is_good = yes
					highest_held_title_tier >= tier_duchy
					in_diplomatic_range = root
				}
			}
			random_independent_ruler = {
				limit = {
					faith_is_good = yes
					highest_held_title_tier >= tier_duchy
					in_diplomatic_range = root
				}
				save_scope_as = new_host
			}
		}
		else = {
			random_independent_ruler = {
				limit = {
					faith_is_good = yes
					highest_held_title_tier >= tier_duchy
				}
				save_scope_as = new_host
			}
		}
	}
	
	option = {
		name = istari.0003.a
		move_to_pool_at = scope:new_host.location
	}
}

