namespace = purge_of_ray

#⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀
#⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣀⣀⣤⣴⡞⠀⠀⣀⣴⣿⠀⠀
#⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⠿⣿⣿⢿⣿⣷⣶⣿⣿⣿⡟⠀⠀
#⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡏⠀⠈⠁⠘⠿⠟⠛⢉⣽⣿⠃⠀⠀
#⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡘⠃⠀⠀⠀⠀⠀⠀⢰⣿⣿⣋⣀⡄⠀
#⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣦⠀⠀⠀⠀⠀⣀⣬⣿⣿⡿⠋⠀⠀
#⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣷⣄⠀⣀⣀⣻⣿⣏⣉⠀⠀⠀⠀
#⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣦⡙⢿⣿⣿⣿⣿⣿⡷⠈⠙⠛⠛⠋⠁⠀⠀⠀⠀
#⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣄⠙⢿⠿⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
#⠀⠀⠀⠀⠀⠀⣠⣿⣿⣿⣿⣿⡿⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
#⠀⠀⠀⠀⢠⣾⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
#⠀⠀⢀⣴⣿⣿⣿⠿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
#⠀⠠⣿⣿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
#⠀⠀⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀

### Maintenance events
## 0001-0999
# NOT by Nick Meredith but by Zeltron (not the cool torch though)

# Purge ends - The rebels are no more
purge_of_ray.0001 = {
	type = character_event
	title = purge_of_ray.0001.t
	desc = {
		desc = purge_of_ray.0001.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					this = scope:ruler_ray
				}
				desc = purge_of_ray.0001.desc.mardat
			}
			desc = purge_of_ray.0001.desc.therest
		}
	}

	theme = harrying #make (harying) again
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		trigger = { root != this }
		character = scope:ruler_ray
		animation = personality_honorable
	}

	immediate = {
		title:k_ray.holder = {
			save_scope_as = ruler_ray
		}
		title:k_ray = {
			save_scope_as = ray
		}
		custom_tooltip = purge_of_ray_end
	}

	option = { # Hereward
		name = purge_of_ray.0001.a

		stress_impact = {
			base = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
		}
	}

	option = { #William
		name = purge_of_ray.0001.b

		trigger = {
			this = scope:ruler_ray
		}

		stress_impact = {
			base = major_stress_impact_loss
		}

		ai_chance = {
			base = 100
		}
	}

	option = { #All others
		name = purge_of_ray.0001.b

		trigger = {
			NOT = {
				this = scope:ruler_ray
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

# Purge ends - a Rebel rules (bla bla split later etc)
purge_of_ray.0002 = {
	type = character_event
	title = purge_of_ray.0002.t
	desc = {
		desc = purge_of_ray.0002.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					this = scope:ruler_ray
				}
				desc = purge_of_ray.0002.desc.ruler
			}
			desc = purge_of_ray.0002.desc.therest
		}
	}
	theme = harrying #make (harying) again
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		trigger = { root != this }
		character = scope:ruler_ray
		animation = personality_honorable
	}

	immediate = {
		title:k_ray.holder = {
			save_scope_as = ruler_ray
		}
		title:k_ray = {
			save_scope_as = ray
		}
		custom_tooltip = purge_of_ray_end
	}

	option = { # Hereward
		name = purge_of_ray.0002.a

		stress_impact = {
			base = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
		}
	}

	option = { # Ruler
		name = purge_of_ray.0002.b

		trigger = {
			this = scope:ruler_ray
		}

		stress_impact = {
			base = major_stress_impact_loss
		}

		ai_chance = {
			base = 100
		}
	}

	option = { #All others
		name = purge_of_ray.0002.b

		trigger = {
			NOT = {
				this = scope:ruler_ray
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

# Purge ends - foreing rule
purge_of_ray.0003 = {
	type = character_event
	title = purge_of_ray.0003.t
	desc = purge_of_ray.0003.desc
	theme = harrying #make (harying) again
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		trigger = { root != this }
		character = scope:ruler_ray
		animation = personality_honorable
	}

	immediate = {
		title:k_ray.holder = {
			save_scope_as = ruler_ray
		}
		title:k_ray = {
			save_scope_as = ray
		}
		custom_tooltip = purge_of_ray_end
	}

	option = { # Hereward
		name = purge_of_ray.0003.a

		stress_impact = {
			base = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
		}
	}

	option = { # Ruler
		name = purge_of_ray.0003.b

		trigger = {
			this = scope:ruler_ray
		}

		stress_impact = {
			base = major_stress_impact_loss
		}

		ai_chance = {
			base = 100
		}
	}

	option = { #All others
		name = purge_of_ray.0003.b

		trigger = {
			NOT = {
				this = scope:ruler_ray
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

##################################################
# William Events
# by Nick Meredith
# 1000-1999
##################################################

#Burn crops
#Burn down villages
#Construct castles
#Improve infrastructure North/South
#Revoke titles
#Slaughter supposed conspirators
#Build spy network
#Rebuild villages in grids
#Decide the fate of a captive Aetheling
#Receive a desperate northerner
#Mutilate a captive

# Burn crops
purge_of_ray.1000 = {
	type = character_event
	title = purge_of_ray.1000.t
	desc = purge_of_ray.1000.desc
	theme = harrying #make (harying) again
	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:aetheling
		animation = anger
	}
	cooldown = { years = 10 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		any_vassal = {
			NOT = {
				faith = faith:faith_haruze
			}
		}
	}

	immediate = {
		random_vassal = {
			limit = {
				NOT = {
					faith = faith:faith_haruze
				}
			}
			save_scope_as = aetheling
		}
		scope:aetheling.primary_title = {
			save_scope_as = crop_duchy
		}
		ep3_harrying_widget_setup_effect = yes

		save_scope_as = root_scope
	}

	option = { #Burn all the crops
		name = purge_of_ray.1000.a

		add_dread = medium_dread_gain

		add_tyranny = minor_tyranny_gain

		ep3_increase_pacification_effect = { AMOUNT = harrying_medium_increase_value }

		scope:crop_duchy = {
			change_county_control = 15
			every_direct_de_jure_vassal_title = {
				custom = every_county_in_duchy_aetheling
				add_county_modifier = {
					modifier = all_crops_burned
					years = 5
				}
			}
		}

		culture = {
			change_cultural_acceptance = {
				target = scope:aetheling.culture
				value = minor_cultural_acceptance_loss
				desc = purge_of_ray_tt
			}
		}

		stress_impact = {
			wrathful = miniscule_stress_impact_loss
			sadistic = miniscule_stress_impact_loss
			vengeful = minor_stress_impact_loss
			compassionate = major_stress_impact_gain
			forgiving = medium_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = 1
				ai_compassion = -1
			}
		}
	}

	option = { #Burn most of them, leaving enough for subsistence
		name = purge_of_ray.1000.b

		add_dread = minor_dread_gain

		scope:crop_duchy = {
			change_county_control = 5
			every_direct_de_jure_vassal_title = {
				custom = every_county_in_duchy_aetheling
				add_county_modifier = {
					modifier = crops_burned
					years = 5
				}
			}
		}

		culture = {
			change_cultural_acceptance = {
				target = scope:aetheling.culture
				value = miniscule_cultural_acceptance_loss
				desc = purge_of_ray_tt
			}
		}

		stress_impact = {
			calm = miniscule_stress_impact_loss
			vengeful = miniscule_stress_impact_loss
			wrathful = minor_stress_impact_gain
			forgiving = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = 0.5
				ai_compassion = -0.5
			}
		}
	}

	option = { #Exact a levy of crops
		name = purge_of_ray.1000.c

		add_treasury_or_gold = medium_treasury_or_gold_value

		scope:crop_duchy = {
			change_county_control = -10
			every_direct_de_jure_vassal_title = {
				custom = every_county_in_duchy_aetheling
				add_county_modifier = {
					modifier = crop_levy
					years = 5
				}
			}
		}

		every_vassal = {
			custom = every_minority_vassal
			vassal_stance = minority
			add_opinion = {
				target = root 
				modifier = annoyed_opinion
				opinion = -15
			}
		}	

		stress_impact = {
			sadistic = medium_stress_impact_gain
			vengeful = major_stress_impact_gain
			compassionate = miniscule_stress_impact_loss
			forgiving = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = -1
				ai_compassion = 1
			}
		}
	}
	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}

# Build on the Great North Road
purge_of_ray.1005 = {
	type = character_event
	title = purge_of_ray.1005.t
	desc = purge_of_ray.1005.desc
	theme = harrying #make (harying) again
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:marshal
		animation = chancellor
	}
	cooldown = { years = 10 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		any_vassal = {
			NOT = {
				faith = faith:faith_haruze
			}
		}
		OR = { #Ensure owns at least one county on the river
			has_title = title:c_bozisha_dar
			has_title = title:c_sanma
			has_title = title:c_baisa
			has_title = title:c_ramadi
			has_title = title:c_simza
			has_title = title:c_nariyar
			has_title = title:c_felhan
		}
		exists = cp:councillor_marshal
	}

	immediate = {
		every_county_in_region = {
			region = middleearth_harad_far_tulwang
			limit = { # All counties along the Rîyeshara
				OR = {
					this = title:c_bozisha_dar
					this = title:c_sanma
					this = title:c_baisa
					this = title:c_ramadi
					this = title:c_simza
					this = title:c_nariyar
					this = title:c_felhan
				}
				OR = {
					holder = root
					holder.top_liege = root
				}
			}
			add_to_list = great_north_road
		}
		cp:councillor_marshal = {
			save_scope_as = marshal
		}
		ep3_harrying_widget_setup_effect = yes
	}

	option = { #Rebuild and stock the river with armed guards
		name = purge_of_ray.1005.a

		remove_treasury_or_gold = major_treasury_or_gold_value

		every_in_list = {
			list = great_north_road
			custom = purge_of_ray.1005.a.tt
			add_county_modifier = {
				modifier = ep3_gnr_guards_modifier
				years = 15
			}
		}

		stress_impact = {
			craven = miniscule_stress_impact_loss
			diligent = miniscule_stress_impact_loss
			lazy = minor_stress_impact_gain
			greedy = medium_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_rationality = 1
				ai_greed = -1
			}
		}
	}

	option = { #Rebuild the road
		name = purge_of_ray.1005.b

		remove_treasury_or_gold = major_treasury_or_gold_value

		every_in_list = {
			list = great_north_road
			custom = purge_of_ray.1005.a.tt
			add_county_modifier = {
				modifier = ep3_gnr_modifier
				years = 10
			}
		}

		stress_impact = {
			diligent = miniscule_stress_impact_loss
			lazy = miniscule_stress_impact_gain
			greedy = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = -0.5
			}
		}
	}

	option = { #Destroy the northern parts of the road; deny them the passage
		name = purge_of_ray.1005.c

		ep3_increase_pacification_effect = { AMOUNT = harrying_medium_increase_value }

		every_in_list = {
			list = great_north_road
			custom = purge_of_ray.1005.c.tt1
			limit = {
				NOT = {
					faith = faith:faith_haruze
				}
			}
			add_county_modifier = {
				modifier = ep3_gnr_negative_modifier
				years = 10
			}
		}

		stress_impact = {
			callous = miniscule_stress_impact_loss
			sadistic = miniscule_stress_impact_loss
			greedy = miniscule_stress_impact_loss
			vengeful = minor_stress_impact_loss
			compassionate = medium_stress_impact_gain
			just = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = 1
				ai_compassion = -1
			}
		}
	}
	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}

# Decide the fate of a captive Aetheling
purge_of_ray.1010 = {
	type = character_event
	title = purge_of_ray.1010.t
	desc = purge_of_ray.1010.desc
	theme = harrying #make (harying) again
	override_background = { reference = dungeon }
	left_portrait = {
		character = root
		animation = spymaster
	}
	right_portrait = {
		character = scope:captured
		animation = prisondungeon
	}
	cooldown = { years = 10 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		any_prisoner = {
			is_ai = yes
			is_adult = yes
			NOT = {
				faith = faith:faith_haruze
			}
			is_lowborn = no
		}
	}

	immediate = {
		save_scope_as = actor
		random_prisoner = {
			limit = {
				is_ai = yes
				is_adult = yes
				NOT = {
					faith = faith:faith_haruze
				}
				is_lowborn = no
			}
			save_scope_as = captured
			save_scope_as = recipient
		}
		save_scope_as = root_scope #for tooltip
		ep3_harrying_widget_setup_effect = yes
	}

	option = { #Kill him
		name = purge_of_ray.1010.a

		execute_prisoner_effect = {
			VICTIM = scope:captured
			EXECUTIONER = root
		}

		ep3_increase_resistance_effect = { AMOUNT = harrying_medium_increase_value }
		ep3_increase_pacification_effect = { AMOUNT = harrying_medium_increase_value }

		stress_impact = {
			callous = miniscule_stress_impact_loss
			sadistic = miniscule_stress_impact_loss
			vengeful = miniscule_stress_impact_loss
			compassionate = major_stress_impact_gain
			just = major_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = 1
				ai_honor = -1
			}
		}
	}

	option = { #Mutilate and release him
		name = purge_of_ray.1010.b

		add_dread = miniscule_dread_gain

		disfigure_recipient_effect = yes
		torture_blind_castrate_disfigure_opinion_effect = { VERB = disfigured }

		stress_impact = {
			sadistic = minor_stress_impact_loss
			compassionate = medium_stress_impact_gain
			just = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = 0.5
				ai_honor = -0.5
			}
		}
	}

	option = { #You will be Khäz-gramaze, now
		name = purge_of_ray.1010.c

		duel = {
			skills = { diplomacy intrigue }
			target = scope:captured
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = purge_of_ray.1010.c.success

				show_as_tooltip = { #To resolve in follow-up, due to learn language scheme
					scope:captured = {
						set_character_faith_with_conversion = faith:faith_haruze
					}
				}

				trigger_event = {
					id = purge_of_ray.1011
					days = { 1 2 }
				}
			}
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = purge_of_ray.1010.c.failure

				send_interface_toast = {
					title = purge_of_ray.1010.c.failure
	
					add_prestige = medium_prestige_loss
					every_vassal = { 
						vassal_stance = glory_hound
						custom = every_glory_hound_vassal
						add_opinion = {
							modifier = tournament_mocked_opinion #Re-using
							target = root
							opinion = -15
						}
					}
				}
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = -1
				ai_compassion = 1
			}
		}
	}

	option = { #Let them rot
		name = purge_of_ray.1010.d

		add_character_modifier = {
			modifier = ep3_honourable_jailor_modifier
			years = 15
		}

		stress_impact = {
			base = miniscule_stress_impact_loss
			sadistic = major_stress_impact_gain
			compassionate = miniscule_stress_impact_loss
			just = miniscule_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = -1
				ai_compassion = 1
			}
		}
	}
	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}

#Follow-up on acceptance
purge_of_ray.1011 = {
	type = character_event
	title = purge_of_ray.1011.t
	desc = {
		desc = purge_of_ray.1011.desc
		triggered_desc = {
			trigger = {
				scope:spouse_courtier = {
					exists = this 
				}			
			}
			desc = purge_of_ray.1011.desc.spouse
		}
	}
	theme = harrying #make (harying) again
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:captured
		animation = happiness
	}
	lower_center_portrait = {
		trigger = {
			scope:spouse_courtier = {
				exists = this
			}
		}
		character = scope:spouse_courtier
	}
	cooldown = { years = 10 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	immediate = {
		if = { #Ugly if/else block starts here!
			limit = {
				scope:captured = {
					is_married = no
					is_betrothed = no
				}
			}
			if = { #Grab a courtier
				limit = {
					AND = {
						scope:captured = { is_female = yes }
						any_courtier = {
							is_female = no
							is_married = no
							is_betrothed = no
							is_adult = yes
							faith = faith:faith_haruze
							age > scope:captured.age_plus_10
							age < scope:captured.age_minus_10
						}
					}
				}
				random_courtier = {
					limit = {
						is_female = no
						is_married = no
						is_betrothed = no
						is_adult = yes
						faith = faith:faith_haruze
						age > scope:captured.age_plus_10
						age < scope:captured.age_minus_10
					}
					weight = {
						base = 1
						modifier = {
							factor = 10
							is_lowborn = no #Always good to do noble marriages where possible
						}
						modifier = {
							factor = 5
							is_close_or_extended_family_of = root #And what nobler than the king?
						}
					}
					save_scope_as = spouse_courtier
				}
			}
			else_if = { #Gender reverse
				limit = {
					AND = {
						scope:captured = { is_female = no }
						any_courtier = {
							is_female = yes
							is_married = no
							is_betrothed = no
							is_adult = yes
							faith = faith:faith_haruze
							age > scope:captured.age_plus_10
							age < scope:captured.age_minus_10
						}
					}
				}
				random_courtier = {
					limit = {
						is_female = yes
						is_married = no
						is_betrothed = no
						is_adult = yes
						faith = faith:faith_haruze
						age > scope:captured.age_plus_10
						age < scope:captured.age_minus_10
					}
					weight = {
						base = 1
						modifier = {
							factor = 10
							is_lowborn = no
						}
						modifier = {
							factor = 5
							is_close_or_extended_family_of = root
						}
					}
					save_scope_as = spouse_courtier
				}
			}
			else = { #Just in case
				hidden_effect = {
					create_character = {
						location = root.location
						random_traits = yes
						faith = root.faith
						faith = faith:faith_haruze
						age = scope:captured.age
						gender_female_chance = {
							if = {
								limit = { scope:captured = { is_female = yes } }
								add = 0
							}
							else = { add = 100 }
						}
						save_scope_as = spouse_courtier
					}
				}
			}
		}

		if = { #Just to ensure she's actually part of your court, if generated
			limit = {
				scope:spouse_courtier = {
					exists = this
					NOT = {
						is_courtier_of = root
					}
				}
			}
			hidden_effect = {
				add_courtier = scope:spouse_courtier
			}
		}

		ep3_harrying_widget_setup_effect = yes

		ep3_increase_pacification_effect = { AMOUNT = harrying_medium_increase_value }
	}

	option = { #You'll get married to a nice Khäz-gramaze lad/lass! (learning the language will be removed, obviously)
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { 
							scope:spouse_courtier = {
								exists = this 
							}
						}
						desc = purge_of_ray.1011.a.spouselanguage
					}
					desc = purge_of_ray.1011.a.language
				}
			}
		}

		scope:captured = {
			if = {
				limit = {
					scope:spouse_courtier = {
						exists = this
					}
				}
				marry = scope:spouse_courtier
			}
			if = {
				limit = {
					can_start_scheme = {
						type = learn_language
						target_character = root
					}
				}
				start_scheme = {
					type = learn_language
					target_character = root
				}
			}
			release_from_prison = yes
			if = {
				limit = {
					highest_held_title_tier = tier_unlanded
				}
				change_liege = {
					liege = root
					change = scope:change
				}
				add_courtier = scope:captured
			}
		}

		reverse_add_opinion = {
			modifier = grateful_opinion
			target = scope:captured
			opinion = 35
		}

		stress_impact = {
			diligent = miniscule_stress_impact_loss
			patient = miniscule_stress_impact_loss
			lazy = miniscule_stress_impact_gain
			impatient = miniscule_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = -1
				ai_compassion = 1
			}
		}
	}

	option = { #Go now, and be free
		name = purge_of_ray.1011.b

		scope:captured = {
			release_from_prison = yes
			if = {
				limit = {
					highest_held_title_tier = tier_unlanded
				}
				change_liege = {
					liege = root
					change = scope:change
				}
			}
		}

		stress_impact = {
			diligent = miniscule_stress_impact_loss
			patient = miniscule_stress_impact_loss
			lazy = miniscule_stress_impact_gain
			impatient = miniscule_stress_impact_gain
		}

		reverse_add_opinion = {
			modifier = grateful_opinion
			target = scope:captured
			opinion = 50
		}

		ai_chance = {
			base = 75
			ai_value_modifier = {
				ai_compassion = 0.5
				ai_honor = 1
			}
		}
	}

	after = {
		hidden_effect = {
			scope:captured = {
				set_character_faith_with_conversion = faith:faith_haruze
			}
		}
		ep3_harrying_widget_clear_effect = yes
	}
}

# Punish a village
purge_of_ray.1015 = {
	type = character_event
	title = purge_of_ray.1015.t
	desc = purge_of_ray.1015.desc
	theme = harrying #make (harying) again
	override_background = { reference = burning_building }
	override_effect_2d = smoke
	left_portrait = {
		character = root
		animation = rage
	}
	cooldown = { years = 10 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		any_vassal = {
			NOT = {
				faith = faith:faith_haruze
			}
			highest_held_title_tier > tier_county	
			any_county = {
				any_province = {
					has_holding = yes
					num_buildings > 0
				}
			}		
		}
	}

	immediate = {
		random_vassal = {
			limit = { NOT = {faith = faith:faith_haruze} }
			save_scope_as = vassal
			random_realm_province = {
				limit = {
					has_holding = yes
					num_buildings >= 1
				}
				save_scope_as = offending_village	
				every_neighboring_province = { add_to_list = resettlement_villages }
				hidden_effect = { destroy_random_building_variable_effect = yes }
			}
		}
		save_scope_as = root_scope #for tooltip
		ep3_harrying_widget_setup_effect = yes
	}

	option = { #Burn it to cinders
		name = purge_of_ray.1015.a

		ep3_increase_pacification_effect = { AMOUNT = harrying_medium_increase_value }

		scope:offending_village = {
			destroy_random_building_effect = yes
			add_province_modifier = {
				modifier = ep3_smouldering_village
				years = 15
			}
		}

		stress_impact = {
			callous = minor_stress_impact_loss
			sadistic = minor_stress_impact_loss
			vengeful = minor_stress_impact_loss
			compassionate = major_stress_impact_gain
			just = major_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = 1
				ai_honor = -1
			}
		}
	}

	option = { #Resettle the residents
		name = purge_of_ray.1015.b

		scope:offending_village = {
			add_province_modifier = {
				modifier = ep3_resettled_village
				years = 15
			}
		}

		every_in_list = {
			list = resettlement_villages
			custom = all_neighbouring_villages
			add_province_modifier = {
				modifier = ep3_population_boost
				years = 15
			}
		}

		stress_impact = {
			sadistic = minor_stress_impact_loss
			compassionate = medium_stress_impact_gain
			just = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = 0.5
				ai_honor = -0.5
			}
		}
	}

	option = { #Leave it be
		name = purge_of_ray.1015.c

		ep3_increase_resistance_effect = { AMOUNT = harrying_medium_increase_value }

		add_tyranny = minor_tyranny_loss

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = -1
				ai_compassion = 1
			}
		}
	}

	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}

##################################################
# Aetheling Events
# by Nick Meredith
# 2000-2999
##################################################

#Appeal for Scottish help
#Bleddyn allies with Anglo-Saxons
#Welsh raids into Herefordshire
#Send messages to Europe for knights
#Stoke flames across the country

# Recruit levies from starving men
purge_of_ray.2000 = {
	type = character_event
	title = purge_of_ray.2000.t
	desc = {
		desc = purge_of_ray.2000.desc
		triggered_desc = {
			trigger = {
				NOR = {
					has_trait = callous
					has_trait = sadistic
				}
			}
			desc = purge_of_ray.2000.notcallous
		}
	}
	theme = harrying #make (harying) again
	override_background = { reference = alley_day }
	left_portrait = {
		character = root
		animation = sadness
	}
	right_portrait = {
		character = scope:starving_man
		animation = beg
	}
	cooldown = { years = 10 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		has_ep3_dlc_trigger = yes
		is_available = yes
		location = root.capital_province
		exists = root.cp:councillor_marshal
	}

	immediate = {
		location = {
			save_scope_as = location
		}
		top_liege = {
			save_scope_as = mardat
		}
		hidden_effect = {
			random_dummy_gender_effect = yes
			create_character = {
				template = new_warrior_character
				location = root.location
				culture = culture:bozishnarud
				faith = root.location.faith
				gender_female_chance = root_soldier_female_chance
				save_scope_as = starving_man
			}
			scope:starving_man = {
				change_current_weight = -50
			}
		}
		root.cp:councillor_marshal = {
			save_scope_as = marshal
		}
		ep3_harrying_widget_setup_effect = yes
	}

	option = { #All of you; you're all hired.
		name = purge_of_ray.2000.a

		remove_short_term_gold = major_gold_value

		ep3_increase_resistance_effect = { AMOUNT = harrying_medium_increase_value }

		add_prestige = medium_prestige_gain

		scope:location.county = {
			add_county_modifier = {
				modifier = ep3_paid_grains
				years = 10
			}
		}

		trigger_event = {
			id = purge_of_ray.2001
			days = { 3 6 }
		}

		stress_impact = {
			greedy = medium_stress_impact_gain
			callous = minor_stress_impact_gain
			compassionate = minor_stress_impact_loss
			generous = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = -1
				ai_compassion = 1
			}
		}
	}

	option = { #I'll hire you, fine gentleman
		name = purge_of_ray.2000.b

		remove_short_term_gold = minor_gold_value

		add_courtier = scope:starving_man

		stress_impact = {
			greedy = minor_stress_impact_gain
			callous = minor_stress_impact_gain
			compassionate = minor_stress_impact_loss
			generous = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = -0.5
				ai_compassion = 1
			}
		}
	}

	option = { #Maybe I can try intervening myself?
		name = purge_of_ray.2000.c

		duel = {
			skill = stewardship
			value = decent_skill_rating
			60 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = purge_of_ray.2000.c.success

				send_interface_toast = {
					title = purge_of_ray.2000.c.success
	
					ep3_decrease_pacification_effect = yes

					scope:location.county = {
						add_county_modifier = {
							modifier = ep3_innovative_farming_techniques
							years = 10
						}
					}
				}
			}
			40 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = purge_of_ray.2000.c.failure

				send_interface_toast = {
					title = purge_of_ray.2000.c.failure
	
					add_prestige = minor_prestige_loss
					ep3_decrease_resistance_effect = yes
				}
			}
		}

		stress_impact = {
			greedy = minor_stress_impact_loss
			generous = minor_stress_impact_gain
			lazy = minor_stress_impact_gain
			diligent = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 1
				ai_compassion = -0.5
			}
		}
	}

	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}

#You gain event troops!
purge_of_ray.2001 = {
	type = letter_event
	opening = purge_of_ray.2001.opening
	desc = purge_of_ray.2001.desc
	sender = scope:marshal

	trigger = {
		has_ep3_dlc_trigger = yes
	}

	immediate = {
		add_stress = minor_stress_loss
	}

	option = { # Wooo!
		name = purge_of_ray.2001.a

		spawn_army = {
			name = event_troop_default_name
			levies = 1000
			location = scope:location
			origin = scope:location
		}

		ai_chance = {
			base = 100
		}		
	}

	option = { # Reject them for now
		name = purge_of_ray.2001.b

		flavor = purge_of_ray.2001.b.tt

		scope:location.county = {
			add_county_modifier = {
				modifier = ep3_surplus_manpower
				years = 10
			}
		}

		ai_chance = {
			base = 100
		}		
	}
}

# Recruit murderers to kill Khäz-gramaze cultists
purge_of_ray.2005 = {
	type = character_event
	title = purge_of_ray.2005.t
	desc = purge_of_ray.2005.desc
	theme = harrying #make (harying) again
	override_background = { reference = armory }
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:murderer
		animation = spymaster
	}
	lower_center_portrait = {
		character = scope:spymaster
	}
	cooldown = { years = 20 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		has_ep3_dlc_trigger = yes
		is_available = yes
		exists = root.cp:councillor_spymaster
		title:k_ray.holder = {
			faith = faith:faith_haruze
			any_vassal = {
				faith = faith:faith_haruze
				capital_province = {
					geographical_region = middleearth_harad_far_tulwang
				}
			}
		}
	}

	immediate = {
		location = {
			save_scope_as = location
		}
		top_liege = {
			save_scope_as = mardat
		}
		scope:mardat = {
			random_vassal = {
				limit = {
					faith = faith:faith_haruze
					capital_province = {
						geographical_region = middleearth_harad_far_tulwang
					}
				}
				capital_province.county = {
					save_scope_as = mardat_vassal
				}
			}
		}
		hidden_effect = {
			create_character = {
				template = ep3_murderer_template
				location = root.location
				culture = culture:bozishnarud
				faith = root.location.faith
				gender_female_chance = root_soldier_female_chance
				save_scope_as = murderer
			}
		}
		root.cp:councillor_spymaster = {
			save_scope_as = spymaster
		}
		scope:mardat = {
			random_close_family_member = {
				limit = {
					location = { geographical_region = middleearth_harad_far_tulwang } 
				}
				save_scope_as = mardat_family
			}
		}
		ep3_harrying_widget_setup_effect = yes
	}

	option = { #Perhaps we need to aim higher...
		name = purge_of_ray.2005.a

		trigger = {
			scope:mardat = {
				any_close_family_member = {
					location = { geographical_region = middleearth_harad_far_tulwang } 
				}
			}
		}

		add_internal_flag = special

		pay_short_term_gold = {
			target = scope:murderer
			gold = medium_gold_value
		}

		start_scheme = { type = murder target_character = scope:mardat_family }

		custom_tooltip = diplomacy_family.2250.b.tt
		hidden_effect = {
			random_scheme = {
				type = murder
				limit = {
					scheme_target_character = scope:mardat_family
				}
				add_scheme_modifier = {
					type = extra_success_chance_modifier
				}
			}
		}

		hidden_effect = {
			scope:murderer = {
				silent_disappearance_effect = yes
			}
		}

		stress_impact = {
			vengeful = medium_stress_impact_loss
			sadistic = minor_stress_impact_loss
			forgiving = medium_stress_impact_gain
			greedy = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_compassion = -1
			}
		}
	}

	option = { #Go off and murder some Khäz-gramaze cultists, will you please?
		name = purge_of_ray.2005.b

		flavor = purge_of_ray.2005.b.tt

		pay_short_term_gold = {
			target = scope:murderer
			gold = medium_gold_value
		}

		ep3_increase_resistance_effect = { AMOUNT = harrying_medium_increase_value }

		scope:mardat_vassal = {
			add_county_modifier = {
				modifier = ep3_murderers_loose
				years = 20
			}
		}

		hidden_effect = {
			scope:murderer = {
				silent_disappearance_effect = yes
			}
		}

		stress_impact = {
			greedy = minor_stress_impact_gain
			callous = minor_stress_impact_loss
			compassionate = minor_stress_impact_gain
			generous = miniscule_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = -0.5
			}
		}
	}

	option = { #Well, you might be handy to have around...
		name = purge_of_ray.2005.c

		add_courtier = scope:murderer

		stress_impact = {
			lazy = minor_stress_impact_loss
			diligent = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_sociability = 1
			}
		}
	}

	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}

# Gather support amongst the minor nobles
purge_of_ray.2010 = {
	type = character_event
	title = purge_of_ray.2010.t
	desc = purge_of_ray.2010.desc
	theme = harrying #make (harying) again
	override_background = { reference = throne_room }
	left_portrait = {
		character = root
		animation = chancellor
	}
	cooldown = { years = 15 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		has_ep3_dlc_trigger = yes
		is_available = yes
		title:k_ray.holder = {
			faith = faith:faith_haruze
			any_duchy = {
				count > 1
			}
		}		
	}

	immediate = {
		top_liege = {
			save_scope_as = mardat
		}
		scope:mardat = {
			every_sub_realm_county = { #Choose first one of two random counties
				limit = {
					holder = {
						faith = faith:faith_haruze
					}
				}
				add_to_list = county_list
			}
		}
		ep3_harrying_widget_setup_effect = yes
	}

	option = { #Rally general support
		name = purge_of_ray.2010.a

		duel = {
			skill = diplomacy
			value = decent_skill_rating

			10 = { #It really works
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = purge_of_ray.2010.a.critsuccess
				send_interface_toast = {
					type = event_toast_effect_good
					title = purge_of_ray.2010.a.critsuccess
					left_icon = root

					ep3_increase_resistance_large_effect = yes
				}
			}

			50 = { #It works
				compare_modifier = {
					 value = scope:duel_value
					 multiplier = 3.5
					 min = -49
				}

				desc = purge_of_ray.2010.a.success
				send_interface_toast = {
					type = event_toast_effect_good
					title = purge_of_ray.2010.a.success
					left_icon = root  
				
					ep3_increase_resistance_effect = { AMOUNT = harrying_medium_increase_value }
				}
			}

			50 = { #It doesn't work
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}

				desc = purge_of_ray.2010.a.failure
				send_interface_toast = {
					type = event_toast_effect_bad
					title = purge_of_ray.2010.a.failure
					left_icon = root  
				
					add_prestige = medium_prestige_loss
				}
			}

			10 = { #Message is intercepted and more troops sent
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = purge_of_ray.2010.a.critfailure
				send_interface_toast = {
					type = event_toast_effect_bad
					title = purge_of_ray.2010.a.critfailure
					left_icon = root  
				
					ep3_increase_pacification_effect = { AMOUNT = harrying_medium_increase_value }
					add_prestige = medium_prestige_loss
				}
			}
		}

		stress_impact = {
			ambitious = minor_stress_impact_loss
			content = medium_stress_impact_gain
			greedy = miniscule_stress_impact_gain
			brave = miniscule_stress_impact_loss
			craven = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = 1
			}
		}
	}

	option = { #Appeal for extra tax revenue
		name = purge_of_ray.2010.b

		duel = {
			skills = { stewardship diplomacy }
			value = decent_skill_rating
			
			50 = { #Yes!
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = purge_of_ray.2010.b.success

				send_interface_toast = {
					title = purge_of_ray.2010.b.success
					left_icon = root
	
					add_gold = medium_gold_value
				}
			}
			50 = { #...no
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = purge_of_ray.2010.b.failure

				send_interface_toast = {
					title = purge_of_ray.2010.b.failure
					left_icon = root
	
					add_prestige = minor_prestige_loss
					ep3_decrease_resistance_effect = yes
				}
			}
		}

		stress_impact = {
			greedy = minor_stress_impact_loss
			generous = medium_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 1
			}
		}
	}

	option = { #Tell them to save their strength
		name = purge_of_ray.2010.c


		scope:mardat = {
			every_sub_realm_county = {
				limit = {
					is_in_list = county_list
				}
				custom = county_list_tt
				random = {
					chance = 5
					add_county_modifier = {
						modifier = ep3_counties_restless_modifier
						years = 15
					}
				}
			}
		}

		stress_impact = {
			lazy = minor_stress_impact_loss
			diligent = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_sociability = 1
			}
		}
	}

	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}

#Forge documents strengthening Aetheling positions
purge_of_ray.2015 = {
	type = character_event
	title = purge_of_ray.2015.t
	desc = purge_of_ray.2015.desc
	theme = harrying #make (harying) again
	override_background = { reference = study }
	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:chancellor
		animation = chancellor
	}
	lower_center_portrait = {
		trigger = {
			scope:other_vassal = {
				is_alive = yes
			}
		}
		character = scope:other_vassal
	}
	cooldown = { years = 15 }
	widget = {
		gui = "event_window_widget_purge_of_ray"
		container = "custom_widgets_container"
	}

	trigger = {
		has_ep3_dlc_trigger = yes
		is_available = yes
		primary_title.tier >= tier_duchy
	}

	immediate = {
		top_liege = {
			save_scope_as = mardat
		}
		primary_title = {
			save_scope_as = primary_title
		}
		if = {
			limit = {
				scope:mardat = {
					any_vassal = {
						this != root
						NOT = {
							faith = faith:faith_haruze
						}
					}
				}
			}
			scope:mardat = {
				random_vassal = {
					limit = {
						this != root
						NOT = {
							faith = faith:faith_haruze
						}
					}
					save_scope_as = other_vassal
					primary_title = {
						save_scope_as = other_vassal_primary_title
					}
				}
			}
		}
		ep3_harrying_widget_setup_effect = yes
	}

	option = { #Ensure your titles cannot be revoked
		name = purge_of_ray.2015.a

		duel = {
			skills = { diplomacy intrigue }
			target = scope:mardat
			
			60 = { #Yes!
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = purge_of_ray.2015.a.success

				send_interface_toast = {
					title = purge_of_ray.2015.a.success
					left_icon = root
					right_icon = scope:mardat
	
					if = {
						limit = {
							vassal_contract_obligation_level_can_be_decreased = title_revocation_rights
						}
						vassal_contract_set_obligation_level = {
							type = title_revocation_rights
							level = 1
						}
					}
					else = {
						if = {
							limit = {
								can_add_hook = {
									target = scope:mardat
									type = fabrication_hook
								}
							}
							add_hook = {
								target = scope:mardat
								type = fabrication_hook
							}
						}						
					}

					if = {
						limit = {
							scope:other_vassal = {
								is_alive = yes
								vassal_contract_obligation_level_can_be_decreased = title_revocation_rights
							}
						}
						scope:other_vassal = {
							vassal_contract_set_obligation_level = {
								type = title_revocation_rights
								level = 1
							}
						}
					}
				}
			}
			40 = { #...no
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = purge_of_ray.2015.a.failure

				send_interface_toast = {
					title = purge_of_ray.2015.a.failure
					left_icon = root
					right_icon = scope:mardat
	
					if = {
						limit = {
							can_add_hook = {
								target = scope:mardat
								type = favor_hook
							}
						}
						add_hook = {
							target = scope:mardat
							type = favor_hook
						}
					}
					if = {
						limit = {
							scope:other_vassal = {
								is_alive = yes
							}
						}
						scope:other_vassal = {
							add_hook = {
								target = scope:mardat
								type = favor_hook
							}
						}
					}
				}
			}
		}

		stress_impact = {
			ambitious = minor_stress_impact_loss
			content = medium_stress_impact_gain
			deceitful = miniscule_stress_impact_loss
			brave = miniscule_stress_impact_loss
			craven = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = 1
			}
		}
	}

	option = { #Reduce Feudal Levies/Taxes
		name = purge_of_ray.2015.b

		if = {
			limit = {
				vassal_contract_obligation_level_can_be_decreased = feudal_government_taxes
			}
			vassal_contract_decrease_obligation_level = feudal_government_taxes
		}
		if = {
			limit = {
				vassal_contract_obligation_level_can_be_decreased = feudal_government_levies
			}
			vassal_contract_decrease_obligation_level = feudal_government_levies
		}
		if = {
			limit = {
				scope:other_vassal = {
					is_alive = yes
				}
			}
			scope:other_vassal = {
				if = {
					limit = {
						vassal_contract_obligation_level_can_be_decreased = feudal_government_taxes
					}
					vassal_contract_decrease_obligation_level = feudal_government_taxes
				}
				if = {
					limit = {
						vassal_contract_obligation_level_can_be_decreased = feudal_government_levies
					}
					vassal_contract_decrease_obligation_level = feudal_government_levies
				}
			}
		}

		stress_impact = {
			greedy = minor_stress_impact_loss
			generous = medium_stress_impact_gain
			just = miniscule_stress_impact_gain
			arbitrary = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 1
			}
		}
	}

	option = { #Gain Marcher Lord status
		name = purge_of_ray.2015.c

		vassal_contract_set_obligation_level = {
			type = special_contract
			level = 2
		}

		scope:other_vassal = {
			vassal_contract_set_obligation_level = {
				type = special_contract
				level = 2
			}
		}

		stress_impact = {
			lazy = minor_stress_impact_loss
			diligent = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_sociability = 1
			}
		}
	}

	after = {
		ep3_harrying_widget_clear_effect = yes
	}
}