namespace = adunaim

# Ar-Adunaim Events
#			adunaim.0001 #Ar-Adûnâim introduction

adunaim.0001 = {
	type = character_event
	title = adunaim.0001.t
	desc = adunaim.0001.desc
	theme = sailing_activity
	override_background = {
		reference = docks
	}
	left_portrait = {
		character = root
		animation = personality_bold
	}

	# trigger = {
	# 	is_ai = no
	# }

	option = {
		name = adunaim.0001.a # Make the preperations to depart Anagzayan
		trigger = { is_ai = no } #AI A-A is a passive islander faction
		trigger_event = {
			id = adunaim.0002
			days = 14
		}
	}
	option = {
		name = adunaim.0001.b # Stay on Anagzayan
	}
}

adunaim.0002 = { # Depart Anagzayan for Tharbad
	type = character_event
	title = adunaim.0002.t
	desc = adunaim.0002.desc
	theme = sailing_activity
	override_background = {
		reference = docks
	}
	left_portrait = {
		character = root
		animation = personality_bold
	}
	immediate = {
		play_music_cue = lotr_cue_aduna
	}

	option = {
		name = adunaim.0002.a # Set sail 
		trigger_event = {
			id = adunaim.0003
			days = 30
		}
	}
}

adunaim.0003 = { # At sea
	type = character_event
	title = adunaim.0003.t
	desc = adunaim.0003.desc
	theme = sailing_activity
	override_background = {
		reference = ocean
	}
	left_portrait = {
		character = root
		animation = personality_bold
	}

	option = {
		name = adunaim.0003.a # A storm!
		trigger_event = {
			id = adunaim.0004
			days = 5
		}
	}
}

adunaim.0004 = { # A storm!
	type = character_event
	title = adunaim.0004.t
	desc = adunaim.0004.desc
	theme = sailing_activity
	override_background = {
		reference = ocean
	}
	left_portrait = {
		character = root
		animation = fear 
	}

	option = {
		name = adunaim.0004.a 
		hidden_effect = {
			random_list = {
				40 = {
					trigger_event = { # Moderate damage 
						id = adunaim.0005
						days = 5
					}
				}
				40 = {
					trigger_event = { # Severe damage 
						id = adunaim.0006
						days = 5
					}
				}
				20 = {
					trigger_event = { # Catastrophic damage/Ulmo intervention 
						id = adunaim.0007
						days = 5
					}
				}
			}
		}
	}
}

adunaim.0005 = { #  Moderate storm damage 
	type = character_event
	title = adunaim.0005.t
	desc = adunaim.0005.desc
	theme = sailing_activity
	override_background = {
		reference = ocean
	}
	left_portrait = {
		character = root
		animation = worry
	}
	immediate = {
		every_courtier_or_guest = {
			random_list = {
				25 = { 				
					if = {
						limit = {
							NOR = { 
								this = character:linepharazon8
								this = root
							 }
						}
						death = {
							death_reason = death_drowned
						}
					}			
				}
				75 = { }
			}
		}
	}

	option = {
		name = adunaim.0005.a # Land ahead!
		add_character_flag = moderate_storm_damage
		trigger_event = { 
			id = adunaim.0008
			days = 5
		}
	}
}

adunaim.0006 = { #  Severe storm damage 
	type = character_event
	title = adunaim.0006.t
	desc = adunaim.0006.desc
	theme = sailing_activity
	override_background = {
		reference = ocean
	}
	left_portrait = {
		character = root
		animation = worry
	}
	immediate = {
		every_courtier_or_guest = {
			random_list = {
				40 = { 				
					if = {
						limit = {
							NOR = { 
								this = character:linepharazon8
								this = root
							 }
						}
						death = {
							death_reason = death_drowned
						}
					}			
				}
				60 = { }
			}
		}
	}

	option = {
		name = adunaim.0006.a # Land ahead!
		add_character_flag = severe_storm_damage
		trigger_event = { 
			id = adunaim.0008
			days = 5
		}
	}
}

adunaim.0007 = { #  Catastrophic storm damage 
	type = character_event
	title = adunaim.0007.t
	desc = adunaim.0007.desc
	theme = sailing_activity
	override_background = {
		reference = ocean
	}
	left_portrait = {
		character = root
		animation = worry
	}
	immediate = {
		every_courtier_or_guest = {	
			if = {
				limit = {
					NOR = { 
						this = character:linepharazon8
						this = root
					}
				}
				death = {
					death_reason = death_drowned
				}
			}			
		}
	}

	option = {
		name = adunaim.0007.a # Land ahead!
		character:linepharazon8 = {
			save_scope_as = adunaim_witch
		}
		root = {
			save_scope_as = gimilkhad
		}	
		scope:adunaim_witch = { 
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = change
				add_claim_on_loss = no
			}
			scope:gimilkhad = { 
				every_held_title = {
					change_title_holder = {
						holder = scope:adunaim_witch
						change = scope:change
					}
				}
			}
			resolve_title_and_vassal_change = scope:change
			add_character_flag = catastrophic_storm_damage
			trigger_event = { 
				id = adunaim.0008
				days = 5
			}
		}
		set_player_character = scope:adunaim_witch
		death = {
			death_reason = death_drowned
		}
	}
}


adunaim.0008 = { # Arrives at Tharbad - Complete
	type = character_event
	title = adunaim.0008.t
	desc = adunaim.0008.desc
	theme = sailing_activity
	override_background = {
		reference = docks
	}
	left_portrait = {
		character = root
		animation = anger
	}
	immediate = {
		play_music_cue = "mx_cue_combat_2"
		title:c_tol_uialgaer = {
			save_scope_as = targeted_county
		}
		get_title = title:c_tharbad 
		title:c_tharbad = {
			set_county_faith = root.faith
			set_county_culture = root.culture
			change_development_level = 7
		}
		destroy_title = title:d_tol_uialgaer
		make_settlement_county_wilderness = { COUNTY = scope:targeted_county }
	}

	option = {
		name = adunaim.0008.a 
		if = {
			limit = {
				has_character_flag = moderate_storm_damage
			}
			add_gold = 600
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = ar_ardunaim_event_settlers
				levies = 2000
				men_at_arms = {
					type = adunaim_armsmen
					stacks = 2
				}
				men_at_arms = {
					type = abrazanim_warbows
					stacks = 2
				}
				location = province:4537
			}
			province:4537 = {
				set_holding_type = castle_holding	
				add_building = castle_02
				add_building = windmills_02
				add_building = common_tradeport_01
			}
		}
		else_if = {
			limit = {
				has_character_flag = severe_storm_damage
			}
			add_gold = 400
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = ar_ardunaim_event_settlers
				levies = 1000
				men_at_arms = {
					type = adunaim_armsmen
					stacks = 1
				}
				men_at_arms = {
					type = abrazanim_warbows
					stacks = 1
				}
				location = province:4537
			}
			province:4537 = {
				set_holding_type = castle_holding	
				add_building = castle_02
				add_building = windmills_01
				add_building = common_tradeport_01
			}
		}
		else_if = {
			limit = {
				has_character_flag = catastrophic_storm_damage
			}
			add_gold = 200
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = ar_ardunaim_event_settlers
				levies = 250
				men_at_arms = {
					type = adunaim_armsmen
					stacks = 1
				}
				location = province:4537
			}
			province:4537 = {
				set_holding_type = castle_holding	
				add_building = castle_02
				add_building = common_tradeport_01
			}
			hidden_effect = {
				add_stress = -300
			}
		}
	}
}
