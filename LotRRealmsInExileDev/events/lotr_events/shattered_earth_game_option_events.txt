namespace = shattered_earth

shattered_earth.1 = {
	hidden = yes
	type = empty
	
	trigger = {
			NOT = { has_game_rule = shattered_earth_false }
	}
	
	immediate = {
		every_living_character = {
			remove_trait = cannot_marry
			remove_trait = widowed
		}
		every_ruler = { trigger_event = shattered_earth.2 }
		title:e_gondor_steward = {
			every_in_de_jure_hierarchy = {
				limit = { tier = tier_kingdom }
				set_de_jure_liege_title = title:e_gondor
			}
		}
	}
}

shattered_earth.2 = {
	hidden = no
	type = character_event

	title = shattered_earth.t
	desc = shattered_earth.desc
	theme = diplomacy_majesty_focus
	left_portrait = {
		character = root
		animation = fear
	}
	
	immediate = {
		every_held_title = { # Destroy all titles above county level
		
			limit = { # For every title with a tier higher than county
				tier > tier_county
			}
			
			holder = { # Destroy that title
				destroy_title = prev
			}
			
		}

		every_held_title = { # Distribute excess non-capital counties to new characters
		
			limit = { # For every non-capital county
				tier = tier_county
				NOT = {
					this = root.capital_county
				}
			}

			save_temporary_scope_as = excess_title

			create_character = { # Create a new character to hold the title
				employer = root
				gender = male
				after_creation = {
					save_temporary_scope_as = new_holder
					if = {
						limit = { scope:new_holder.culture = culture:maiar_fallen }
						set_culture = culture:morlughai
					}
					else_if = {
						limit = { scope:new_holder.culture = culture:istari }
						set_culture = culture:isengard_dunlending
					}
					else_if = {
						limit = { scope:new_holder.culture = culture:istari_evil }
						set_culture = culture:isengard_urukhai
					}
					else_if = {
						limit = { scope:new_holder.culture = culture:ringwraith }
						set_culture = culture:ungurhai
					}
				}
			}
			
			create_title_and_vassal_change = { # Define type of title change as a granting of the title
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			
			scope:excess_title = { # Set the new character to be the new holder of the title
				change_title_holder = {
					holder = scope:new_holder
					change = scope:title_change
				}
			}
			
			resolve_title_and_vassal_change = scope:title_change # Take a look at yourself, and then make that... change!

			game_rule_create_spouse_and_children = { CHARACTER = scope:new_holder } # Create a family for the new holder
			
		}
	}
	
	option = { # The world is broken
		name = shattered_earth.a 
		#trigger_event = {
		#	id = shattered_earth.3
		#	days = 1
		#}
	}
}

#shattered_earth.3 = {
#	hidden = yes
#	
#	trigger = {
#		OR = {
#			has_game_rule = shattered_earth_duchies
#			has_game_rule = shattered_earth_kingdoms
#			has_game_rule = shattered_earth_empires
#		}
#	}
#	
#	immediate = {
#		every_duchy = { # Create and distribute Duchies
#
#			save_temporary_scope_as = new_duchy
#					
#			create_title_and_vassal_change = { # Define type of title change as a creation of the title
#				type = created
#				save_scope_as = duchy_change
#				add_claim_on_loss = no
#			}
#		
#			scope:new_duchy = { # Set the capital county holder to be the new duke
#				change_title_holder = {
#					holder = scope:new_duchy.title_capital_county.holder
#					change = scope:duchy_change
#				}
#			}
#			
#			resolve_title_and_vassal_change = scope:duchy_change # Take a look at yourself, and then make that... change!
#			
#		}
#		
#		every_independent_ruler = {
#			
#			limit = {
#				highest_held_title_tier = tier_county
#			}
#
#			create_title_and_vassal_change = {
#				type = swear_fealty
#				save_scope_as = change
#				add_claim_on_loss = no
#			}
#			
#			change_liege = { 
#				liege = primary_title.duchy.holder
#				change = scope:change
#			}
#			
#			resolve_title_and_vassal_change = scope:change
#						
#		}
#		
#	}
#	
#	option = { # The world is broken
#		name = shattered_earth.a 
#		trigger_event = {
#			id = shattered_earth.4
#			days = 1
#		}
#	}
#}
#
#shattered_earth.4 = {
#	hidden = yes
#	
#	trigger = {
#		OR = {
#			has_game_rule = shattered_earth_kingdoms
#			has_game_rule = shattered_earth_empires
#		}
#	}
#	
#	immediate = {
#		every_kingdom = { # Create and distribute Kingdoms
#
#			limit = {
#				NOR = {
#					kingdom = title:k_mirlond
#					kingdom = title:k_lossarnach
#				}
#			}
#
#			save_temporary_scope_as = new_kingdom
#					
#			create_title_and_vassal_change = { # Define type of title change as a creation of the title
#				type = created
#				save_scope_as = kingdom_change
#				add_claim_on_loss = no
#			}
#		
#			scope:new_kingdom = { # Set the capital county holder to be the new king
#				change_title_holder = {
#					holder = scope:new_kingdom.title_capital_county.holder
#					change = scope:kingdom_change
#				}
#			}
#			
#			resolve_title_and_vassal_change = scope:kingdom_change # Take a look at yourself, and then make that... change!
#			
#		}
#		
#		every_independent_ruler = {
#			
#			limit = {
#				highest_held_title_tier = tier_duchy
#			}
#
#			create_title_and_vassal_change = {
#				type = swear_fealty
#				save_scope_as = change
#				add_claim_on_loss = no
#			}
#			
#			change_liege = { 
#				liege = primary_title.kingdom.holder
#				change = scope:change
#			}
#			
#			resolve_title_and_vassal_change = scope:change
#						
#		}
#		
#	}
#	
#	option = { # The world is broken
#		name = shattered_earth.a 
#		trigger_event = {
#			id = shattered_earth.5
#			days = 1
#		}
#	}
#}
#
#shattered_earth.5 = {
#	hidden = yes
#	
#	trigger = {
#		has_game_rule = shattered_earth_empires
#	}
#	
#	immediate = {
#	
#		create_title_and_vassal_change = { # Define type of title change as a creation of the title
#			type = created
#			save_scope_as = empire_change
#			add_claim_on_loss = no
#		}
#		
#		title:e_gondor = { # Set the capital county holder to be the new empire
#			change_title_holder = {
#				holder = title:k_anorien.holder
#				change = scope:empire_change
#			}
#		}
#		
#		resolve_title_and_vassal_change = scope:empire_change # Take a look at yourself, and then make that... change!
#	
#		every_empire = { # Create and distribute Empires
#
#			limit = {
#				NOR = {
#					empire = title:e_numenor_colonies
#					empire = title:e_gondor_steward
#					empire = title:e_castamir
#				}
#			}
#
#			save_temporary_scope_as = new_empire
#					
#			create_title_and_vassal_change = { # Define type of title change as a creation of the title
#				type = created
#				save_scope_as = empire_change
#				add_claim_on_loss = no
#			}
#		
#			scope:new_empire = { # Set the capital county holder to be the new empire
#				change_title_holder = {
#					holder = scope:new_empire.title_capital_county.holder
#					change = scope:empire_change
#				}
#			}
#			
#			resolve_title_and_vassal_change = scope:empire_change # Take a look at yourself, and then make that... change!
#			
#		}
#		
#		every_independent_ruler = {
#			
#			limit = {
#				highest_held_title_tier = tier_kingdom
#			}
#
#			create_title_and_vassal_change = {
#				type = swear_fealty
#				save_scope_as = change
#				add_claim_on_loss = no
#			}
#			
#			change_liege = { 
#				liege = primary_title.empire.holder
#				change = scope:change
#			}
#			
#			resolve_title_and_vassal_change = scope:change
#						
#		}
#		
#	}
#	
#	option = { # The world is broken
#		name = shattered_earth.a 
#	}
#}