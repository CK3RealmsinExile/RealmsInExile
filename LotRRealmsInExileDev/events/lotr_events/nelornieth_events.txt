
namespace = nelornieth

##################################################
### Nelornieth by Esthiel and Brice Underhill ###
##################################################

### Diplomatic missions
# 0001 -> 0009 / Initial event
# 0010 -> 0019 / Banquet events
# 0020 -> 0029 / Hunting events
# 0030 -> 0039 / Meditation events
# 0040 -> 0049 / Singing events
# 0100 - > 0109 / Final events

### Initial events

nelornieth.0001 = { # Embassy destination
	content_source = realms_dlc
	type = character_event
    title = nelornieth.0001.t
	desc = {
		desc = nelornieth.0001.desc.intro
		triggered_desc = {
			trigger = { exists = scope:lasgalenking }
			desc = nelornieth.0001.desc.lasgalen
		}
		triggered_desc = {
			trigger = { exists = scope:lorienking }
			desc = nelornieth.0001.desc.lorien
		}
		triggered_desc = {
			trigger = { exists = scope:extraking }
			desc = nelornieth.0001.desc.random
		}
		desc = nelornieth.0001.desc.end
	}

    theme = diplomacy
    left_portrait = {
		character = root
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:chancellor
		animation = chancellor
	}

    immediate = {
		root = {
			save_scope_as = nelorniethking
		}
		if = {
			limit = {
				exists = title:k_lasgalen.holder
				title:k_lasgalen.holder = { is_elf = yes }
				NOT = { title:k_lasgalen.holder = root }
			}
			title:k_lasgalen.holder = { save_scope_as = lasgalenking }
		}
		if = {
			limit = {
				exists = title:k_lothlorien.holder
				title:k_lothlorien.holder = { is_elf = yes }
				NOT = { title:k_lothlorien.holder = root }
			}
			title:k_lothlorien.holder = { save_scope_as = lorienking }
		}
		random_kingdom = {
			limit = {
				exists = holder
				NOT = {
					holder = root 
					holder = scope:lasgalenking
					holder = scope:lorienking		
				}
				holder = {
					is_elf = yes
					capital_province = { NOT = { geographical_region = middleearth_valinor } }
				}
			}
			save_scope_as = extrakingdom
			holder = { save_scope_as = extraking }
		}
		cp:councillor_chancellor = { save_scope_as = chancellor }
	}

    option = { # I will send an embassy to Lasgalen
        name = nelornieth.0001.a
		custom_tooltip = nelornieth.0001.a.tt
		trigger = {
			exists = scope:lasgalenking
		}
		
		save_scope_value_as = {
			name = embassy
			value = flag:lasgalen
		}
		scope:lasgalenking = { save_scope_as = embassy_target }
        trigger_event = {
            id = nelornieth.0002
            days = 3
        }
		
		remove_short_term_gold = 700
		add_prestige = -1000
		
		ai_chance = {
			base = 100
			modifier = {
				add = -40
				is_allied_to = scope:lasgalenking
			}
		}
    }
	
	option = { # I will send an embassy to Lorien
        name = nelornieth.0001.b
		custom_tooltip = nelornieth.0001.b.tt
		trigger = {
			exists = scope:lorienking
		}
		
		save_scope_value_as = {
			name = embassy
			value = flag:lorien
		}
		scope:lorienking = { save_scope_as = embassy_target }
        trigger_event = {
            id = nelornieth.0002
            days = 3
        }
		
		remove_short_term_gold = 700
		add_prestige = -1000
		
		ai_chance = {
			base = 70
			modifier = {
				add = -40
				is_allied_to = scope:lorienking
			}
		}
    }
	
	option = { # I will send an embassy to a random Elvenking
        name = nelornieth.0001.c
		custom_tooltip = nelornieth.0001.c.tt
		trigger = {
			exists = scope:extraking
		}
		
		scope:extraking = { save_scope_as = embassy_target }
		save_scope_value_as = {
			name = embassy
			value = flag:random
		}
	
        trigger_event = {
            id = nelornieth.0002
            days = 3
        }
		
		remove_short_term_gold = 1000
		add_prestige = -1000
		
		ai_chance = {
			base = 50
			modifier = {
				add = -40
				is_allied_to = scope:extraking
			}
		}
    }
	
	option = { # Maybe some other day
        name = nelornieth.0001.d
		custom_tooltip = nelornieth.0001.d.tt
		hidden_effect = {
			remove_decision_cooldown = decision_nelornieth_diplo
		}
    }
}

nelornieth.0002 = { # Choice of the ambassador
	content_source = realms_dlc
    type = character_event
	title = nelornieth.0002.t
    desc = nelornieth.0002.desc

    
    theme = diplomacy
    left_portrait = {
		character = root
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:chancellor
		animation = personality_content
	}

    immediate = {
		root = { save_scope_as = nelorniethking }
		cp:councillor_chancellor = { save_scope_as = chancellor }
        cp:councillor_steward = { save_scope_as = steward }
        cp:councillor_spymaster = { save_scope_as = spymaster }
        cp:councillor_marshal = { save_scope_as = marshal }
	}

    option = { # Send the chancellor
        name = nelornieth.0002.a
        custom_tooltip = nelornieth.0002.a.tt
		
        trigger = { exists = scope:chancellor }
        scope:chancellor = { save_scope_as = ambassador }
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:chancellor = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = 10
				scope:chancellor = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = 10
				scope:chancellor = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = 15
				scope:chancellor = {
					has_trait = poet
				}
			}
			modifier = {
				add = scope:chancellor.prowess
			}
			modifier = {
				add = scope:chancellor.diplomacy
			}
			modifier = {
				add = scope:chancellor.learning
			}
		}
    }
	
    option = { # Send the steward
        name = nelornieth.0002.b
        custom_tooltip = nelornieth.0002.a.tt
		
        trigger = { exists = scope:steward }
        scope:steward = { save_scope_as = ambassador }
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:steward = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = 10
				scope:steward = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = 10
				scope:steward = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = 15
				scope:steward = {
					has_trait = poet
				}
			}
			modifier = {
				add = scope:steward.prowess
			}
			modifier = {
				add = scope:steward.diplomacy
			}
			modifier = {
				add = scope:steward.learning
			}
		}
    }
	
    option = { # Send the marshal
        name = nelornieth.0002.c
        custom_tooltip = nelornieth.0002.a.tt
		
        trigger = { exists = scope:marshal }
        scope:marshal = { save_scope_as = ambassador }
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:marshal = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = 10
				scope:marshal = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = 10
				scope:marshal = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = 15
				scope:marshal = {
					has_trait = poet
				}
			}
			modifier = {
				add = scope:marshal.prowess
			}
			modifier = {
				add = scope:marshal.diplomacy
			}
			modifier = {
				add = scope:marshal.learning
			}
		}
    }
	
    option = { # Send the spymaster
        name = nelornieth.0002.d
        custom_tooltip = nelornieth.0002.a.tt
		
        trigger = { exists = scope:spymaster }
        scope:spymaster = { save_scope_as = ambassador }
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:spymaster = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = 10
				scope:spymaster = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = 10
				scope:spymaster = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = 15
				scope:spymaster = {
					has_trait = poet
				}
			}
			modifier = {
				add = scope:spymaster.prowess
			}
			modifier = {
				add = scope:spymaster.diplomacy
			}
			modifier = {
				add = scope:spymaster.learning
			}
		}
    }
	
	after = {
		scope:embassy_target = {
			trigger_event = {
				id = nelornieth.0003
				days = 15
			}
		}
		set_variable = {
			name = mission_success
			value = 0
		}
	}
}


nelornieth.0003 = { # Ruler receives the ambassador
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0003.t
    desc = nelornieth.0003.desc

    theme = diplomacy
    left_portrait = {
		character = root
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:ambassador
		animation = personality_content
	}
	
    option = { #Let them in at once
        name = nelornieth.0003.a
    }
	
	option = { #Make the Avari wait
        name = nelornieth.0003.b
		trigger = { is_ai = no }
		scope:nelorniethking = { 
			add_opinion = {
				modifier = kept_embassy_waiting_opinion
				target = root
				opinion = -10
			}
		}
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0004
				days = 15
			}
		}
	}
}

nelornieth.0004 = { # Choose an activity - Step 1
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0004.t
    desc =  nelornieth.0004.desc
    theme = diplomacy
	override_background = { 
		reference = army_camp
	}
	left_portrait = {
		character = scope:ambassador
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:embassy_target
		animation = personality_content
	}
	
	option = { #Organise a banquet
		name = nelornieth.0004.a
        custom_tooltip = nelornieth.0004.a.tt
		
		add_character_flag = chose_banquet
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0010
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = scope:ambassador.diplomacy
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = gregarious
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = shy
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = gluttonous
				}
			}
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = comfort_eater
				}
			}
			modifier = {
				add = -15
				scope:ambassador = {
					has_trait = inappetetic
				}
			}
			modifier = {
				add = -15
				scope:ambassador = {
					has_trait = reclusive
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = scope:embassy_target.diplomacy
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = gregarious
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = shy
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = gluttonous
				}
			}
			modifier = {
				add = 15
				scope:embassy_target = {
					has_trait = comfort_eater
				}
			}
			modifier = {
				add = -15
				scope:embassy_target = {
					has_trait = inappetetic
				}
			}
			modifier = {
				add = -15
				scope:embassy_target = {
					has_trait = reclusive
				}
			}
		}
	}
	
	option = { #Organise a hunt
		name = nelornieth.0004.b
        custom_tooltip = nelornieth.0004.b.tt
		
		add_character_flag = chose_hunt
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0020
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = scope:ambassador.prowess
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = brave
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = craven
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = athletic
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = sadistic
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = compassionate
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = brave
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = craven
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = athletic
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = sadistic
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = compassionate
				}
			}
		}
	}
	
	option = { #Organise a meditation
		name = nelornieth.0004.c
        custom_tooltip = nelornieth.0004.c.tt
		
		add_character_flag = chose_meditation
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0030
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = scope:ambassador.learning
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = patient
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = impatient
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = patient
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = impatient
				}
			}
		}
	}
	
	option = { #Organise a singing recitation
		name = nelornieth.0004.d
        custom_tooltip = nelornieth.0004.d.tt
		
		add_character_flag = chose_song
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0040
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = scope:ambassador.learning
			}
			modifier = {
				add = scope:ambassador.diplomacy
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = diligent
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = lazy
				}
			}
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = diligent
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = lazy
				}
			}
		}
	}
}

nelornieth.0005 = { # Choose an activity - Step 2
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0005.t
    desc =  nelornieth.0005.desc
    theme = diplomacy
	override_background = { 
		reference = army_camp
	}
	left_portrait = {
		character = scope:ambassador
		animation = personality_honorable
	}
    right_portrait = {
		character = scope:embassy_target
		animation = personality_content
	}
	
	option = { #Organise a banquet
		name = nelornieth.0004.a
        custom_tooltip = nelornieth.0004.a.tt
		
		trigger = {
			NOT = {
				has_character_flag = chose_banquet
			}
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0010
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 5
				scope:ambassador = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = scope:ambassador.diplomacy
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = gregarious
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = shy
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = gluttonous
				}
			}
			modifier = {
				add = 5
				scope:embassy_target = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = gregarious
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = shy
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = gluttonous
				}
			}
		}
	}
	
	option = { #Organise a hunt
		name = nelornieth.0004.b
        custom_tooltip = nelornieth.0004.b.tt
		
		trigger = {
			NOT = {
				has_character_flag = chose_hunt
			}
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0020
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 5
				scope:ambassador = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = scope:ambassador.prowess
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = brave
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = craven
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = athletic
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = sadistic
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = compassionate
				}
			}
			modifier = {
				add = 5
				scope:embassy_target = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = brave
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = craven
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = athletic
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = sadistic
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = compassionate
				}
			}
		}
	}
	
	option = { #Organise a meditation
		name = nelornieth.0004.c
        custom_tooltip = nelornieth.0004.c.tt
		
		trigger = {
			NOT = {
				has_character_flag = chose_meditation
			}
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0030
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 5
				scope:ambassador = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = scope:ambassador.learning
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = patient
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = impatient
				}
			}
			modifier = {
				add = 5
				scope:embassy_target = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = patient
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = impatient
				}
			}
		}
	}
	
	option = { #Organise a singing recitation
		name = nelornieth.0004.d
        custom_tooltip = nelornieth.0004.d.tt
		
		trigger = {
			NOT = {
				has_character_flag = chose_song
			}
		}
		scope:embassy_target = {
			trigger_event = {
				id =  nelornieth.0040
				days = 15
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = scope:ambassador.learning
			}
			modifier = {
				add = scope:ambassador.diplomacy
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = diligent
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = lazy
				}
			}
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:embassy_target = {
					has_trait = diligent
				}
			}
			modifier = {
				add = -10
				scope:embassy_target = {
					has_trait = lazy
				}
			}
		}
	}
	
	after = {
		remove_character_flag = chose_banquet
		remove_character_flag = chose_hunt
		remove_character_flag = chose_meditation
		remove_character_flag = chose_song
		add_character_flag = second_activity
	}
}

### Banquet events

nelornieth.0010 = { # Banquet event for target
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0010.t
    desc = nelornieth.0010.desc

    theme = party
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = toast_goblet
	}

    option = { #How exotic !
        name = nelornieth.0010.a
		
		scope:nelorniethking = {
			add_character_flag = banquet_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}

		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = scope:ambassador.diplomacy
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = gregarious
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = shy
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = gluttonous
				}
			}
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = comfort_eater
				}
			}
			modifier = {
				add = -15
				scope:ambassador = {
					has_trait = inappetetic
				}
			}
			modifier = {
				add = -15
				scope:ambassador = {
					has_trait = reclusive
				}
			}
			modifier = {
				add = 10
				has_trait = lifestyle_reveler
			}
			modifier = {
				add = root.diplomacy
			}
			modifier = {
				add = 10
				has_trait = gregarious
			}
			modifier = {
				add = -10
				has_trait = shy
			}
			modifier = {
				add = 10
				has_trait = gluttonous
			}
			modifier = {
				add = 15
				has_trait = comfort_eater
			}
			modifier = {
				add = -15
				has_trait = inappetetic
			}
			modifier = {
				add = -15
				has_trait = reclusive
			}
		}
    }
	
	option = { #Meh
        name = nelornieth.0010.b

		ai_chance = {
			base = 50
		}
    }
	
	option = { #I hate it
        name = nelornieth.0010.c
		
		scope:nelorniethking = {
			add_character_flag = banquet_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = lifestyle_reveler
				}
			}
			modifier = {
				add = {
					value = scope:ambassador.diplomacy
					multiply = -1
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = gregarious
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = shy
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = gluttonous
				}
			}
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = comfort_eater
				}
			}
			modifier = {
				add = -15
				scope:ambassador = {
					has_trait = inappetetic
				}
			}
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = reclusive
				}
			}
			modifier = {
				add = -10
				has_trait = lifestyle_reveler
			}
			modifier = {
				add = -10
				has_trait = gregarious
			}
			modifier = {
				add = 10
				has_trait = shy
			}
			modifier = {
				add = -10
				has_trait = gluttonous
			}
			modifier = {
				add = -15
				has_trait = comfort_eater
			}
			modifier = {
				add = 15
				has_trait = inappetetic
			}
			modifier = {
				add = 15
				has_trait = reclusive
			}
		}
	}
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0011
				days = 15
			}
		}
	}
}


nelornieth.0011 = { # Banquet result event for liege
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0011.t
    desc = {
		desc = nelornieth.0011.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = banquet_failure
				}
				desc = nelornieth.0011.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = banquet_success
				}
				desc = nelornieth.0011.desc.success
			}
			desc = nelornieth.0011.desc.boredom
		}
	}
    theme = party
    left_portrait = {
		character = scope:ambassador
		animation = toast_goblet
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = banquet_failure }
			}
			animation = disapproval
		}
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = banquet_success }
			}
			animation = toast_goblet
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0011.a
		trigger = { has_character_flag = banquet_success }
		remove_character_flag = banquet_success
    }
	
	option = { #What a mess !
        name = nelornieth.0011.b
		trigger = { has_character_flag = banquet_failure }
		remove_character_flag = banquet_failure
    }
	
	option = { #Meh
        name = nelornieth.0011.c
		trigger = {
			NOR = {
				has_character_flag = banquet_success 
				has_character_flag = banquet_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 15
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 15
			}
		}
	}
}

### Hunting events

nelornieth.0020 = { # Hunting event for target
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0020.t
    desc = nelornieth.0020.desc
    theme = hunting
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = personality_bold
	}
	
	immediate = {
		capital_province = { save_scope_as = background_wilderness_scope }
	}

    option = { #What an exciting experience !
        name = nelornieth.0020.a
		
		scope:nelorniethking = {
			add_character_flag = hunt_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = scope:ambassador.prowess
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = brave
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = craven
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = athletic
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = sadistic
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = compassionate
				}
			}
			modifier = {
				add = 10
				has_trait = lifestyle_hunter
			}
			modifier = {
				add = 10
				has_trait = brave
			}
			modifier = {
				add = -10
				has_trait = craven
			}
			modifier = {
				add = 10
				has_trait = athletic
			}
			modifier = {
				add = 10
				has_trait = sadistic
			}
			modifier = {
				add = -10
				has_trait = compassionate
			}
		}
    }
	
	option = { #Meh
        name = nelornieth.0020.b	
		
		ai_chance = {
			base = 50
		}
    }
	
	option = { #These savages can't hunt properly
        name = nelornieth.0020.c
		scope:nelorniethking = {
			add_character_flag = hunt_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = lifestyle_hunter
				}
			}
			modifier = {
				add = {
					value = scope:ambassador.prowess
					multiply = -1
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = brave
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = craven
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = athletic
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = sadistic
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = compassionate
				}
			}
			modifier = {
				add = -10
				has_trait = lifestyle_hunter
			}
			modifier = {
				add = -10
				has_trait = brave
			}
			modifier = {
				add = 10
				has_trait = craven
			}
			modifier = {
				add = -10
				has_trait = athletic
			}
			modifier = {
				add = -10
				has_trait = sadistic
			}
			modifier = {
				add = 10
				has_trait = compassionate
			}
		}
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0021
				days = 15
			}
		}
	}
}

nelornieth.0021 = { # Hunt result event for liege
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0021.t
    desc = {
		desc = nelornieth.0021.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = hunt_failure
				}
				desc = nelornieth.0021.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = hunt_success
				}
				desc = nelornieth.0021.desc.success
			}
			desc = nelornieth.0021.desc.boredom
		}
	}
    theme = hunting
	override_background = {
		reference = wilderness_scope
	}
    left_portrait = {
		character = scope:ambassador
		animation = personality_bold
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = hunt_failure }
			}
			animation = dismissal
		}
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = hunt_success }
			}
			animation = personality_compassionate
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0021.a
		trigger = { has_character_flag = hunt_success }
		remove_character_flag = hunt_success
    }
	
	option = { #What a mess !
        name = nelornieth.0021.b
		trigger = { has_character_flag = hunt_failure }
		remove_character_flag = hunt_failure
    }
	
	option = { #Meh
        name = nelornieth.0021.c
		trigger = {
			NOR = {
				has_character_flag = hunt_success 
				has_character_flag = hunt_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 15
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 15
			}
		}
	}
}

### Meditation events

nelornieth.0030 = { # Meditation event for target
    type = character_event
	title = nelornieth.0030.t
    desc = nelornieth.0030.desc
    theme = faith
	override_background = {
		reference = wilderness_scope
	}
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = personality_zealous
	}

	immediate = {
		capital_province = { save_scope_as = background_wilderness_scope }
	}

    option = { #This is fascinating
        name = nelornieth.0030.a
		
		scope:nelorniethking = {
			add_character_flag = meditation_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = scope:ambassador.learning
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = patient
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = impatient
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = reclusive
				}
			}
			modifier = {
				add = 10
				has_trait = lifestyle_mystic
			}
			modifier = {
				add = 10
				has_trait = zealous
			}
			modifier = {
				add = -10
				has_trait = cynical
			}
			modifier = {
				add = 10
				has_trait = patient
			}
			modifier = {
				add = -10
				has_trait = impatient
			}
			modifier = {
				add = 10
				has_trait = reclusive
			}
		}
    }
	
	option = { #Meh
        name = nelornieth.0030.b	
		
		ai_chance = {
			base = 50
		}
    }
	
	option = { #Pah, what gibberish !
        name = nelornieth.0030.c
		
		scope:nelorniethking = {
			add_character_flag = meditation_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = lifestyle_mystic
				}
			}
			modifier = {
				add = {
					value = scope:ambassador.learning
					multiply = -1
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = patient
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = impatient
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = reclusive
				}
			}
			modifier = {
				add = -10
				has_trait = lifestyle_mystic
			}
			modifier = {
				add = -10
				has_trait = zealous
			}
			modifier = {
				add = 10
				has_trait = cynical
			}
			modifier = {
				add = -10
				has_trait = patient
			}
			modifier = {
				add = 10
				has_trait = impatient
			}
			modifier = {
				add = -10
				has_trait = reclusive
			}
		}
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0031
				days = 15
			}
		}
	}
}

nelornieth.0031 = { # Meditation result event for liege
	content_source = realms_dlc
	type = character_event
	title = nelornieth.0031.t
    desc = {
		desc = nelornieth.0031.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = meditation_failure
				}
				desc = nelornieth.0031.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = meditation_success
				}
				desc = nelornieth.0031.desc.success
			}
			desc = nelornieth.0031.desc.boredom
		}
	}
    theme = faith
	override_background = {
		reference = wilderness_scope
	}
    left_portrait = {
		character = scope:ambassador
		animation = personality_zealous
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = meditation_failure }
			}
			animation = personality_cynical
		}
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = meditation_success }
			}
			animation = personality_zealous
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0031.a
		trigger = { has_character_flag = meditation_success }
		remove_character_flag = meditation_success
    }
	
	option = { #What a mess !
        name = nelornieth.0031.b
		trigger = { has_character_flag = meditation_failure }
		remove_character_flag = meditation_failure
    }
	
	option = { #Meh
        name = nelornieth.0031.c
		trigger = {
			NOR = {
				has_character_flag = meditation_success 
				has_character_flag = meditation_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 15
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 15
			}
		}
	}
}


### Song events

nelornieth.0040 = { # Song event for target
	content_source = realms_dlc
	type = character_event
    title = nelornieth.0040.t
    desc = nelornieth.0040.desc
    theme = party
    left_portrait = {
		character = root
		animation = personality_rational
	}
    right_portrait = {
		character = scope:ambassador
		animation = chancellor
	}

    option = { #This is fascinating
        name = nelornieth.0040.a
		scope:nelorniethking = {
			add_character_flag = song_success
			change_variable = {
				name = mission_success
				add = 2
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = scope:ambassador.learning
			}
			modifier = {
				add = scope:ambassador.diplomacy
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = diligent
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = lazy
				}
			}
			modifier = {
				add = 15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = 10
				has_trait = zealous
			}
			modifier = {
				add = -10
				has_trait = cynical
			}
			modifier = {
				add = 10
				has_trait = diligent
			}
			modifier = {
				add = -10
				has_trait = lazy
			}
			modifier = {
				add = 15
				has_trait = poet
			}
		}
    }
	
	option = { #Meh
        name = nelornieth.0040.b

		ai_chance = {
			base = 50
		}
    }
	
	option = { #Pah, what gibberish !
        name = nelornieth.0040.c
		
		scope:nelorniethking = {
			add_character_flag = song_failure
			change_variable = {
				name = mission_success
				add = -1
			}
		}
		
		ai_chance = {
			base = 50
			modifier = {
				add = -15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = {
					value = scope:ambassador.learning
					multiply = -1
				}
			}
			modifier = {
				add = {
					value = scope:ambassador.diplomacy
					multiply = -1
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = zealous
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = cynical
				}
			}
			modifier = {
				add = -10
				scope:ambassador = {
					has_trait = diligent
				}
			}
			modifier = {
				add = 10
				scope:ambassador = {
					has_trait = lazy
				}
			}
			modifier = {
				add = -15
				scope:ambassador = {
					has_trait = poet
				}
			}
			modifier = {
				add = -10
				has_trait = zealous
			}
			modifier = {
				add = 10
				has_trait = cynical
			}
			modifier = {
				add = -10
				has_trait = diligent
			}
			modifier = {
				add = 10
				has_trait = lazy
			}
		}
    }
	
	after = {
		scope:nelorniethking = {
			trigger_event = {
				id = nelornieth.0041
				days = 15
			}
		}
	}
}

nelornieth.0041 = { # Song result event for liege
	content_source = realms_dlc
	type = character_event
    title = nelornieth.0041.t
    desc = {
		desc = nelornieth.0041.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = song_failure
				}
				desc = nelornieth.0041.desc.failure
			}
			triggered_desc = {
				trigger = {
					has_character_flag = song_success
				}
				desc = nelornieth.0041.desc.success
			}
			desc = nelornieth.0041.desc.boredom
		}
	}
    theme = party
    left_portrait = {
		character = scope:ambassador
		animation = chancellor
	}
    right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = song_failure }
			}
			animation = dismissal
		}
		triggered_animation = {
			trigger = { 
				root = { has_character_flag = song_success }
			}
			animation = chancellor
		}
		animation = boredom
	}

    option = { #Great Success !
        name = nelornieth.0041.a
		trigger = { has_character_flag = song_success }
		remove_character_flag = song_success
    }
	
	option = { #What a mess !
        name = nelornieth.0041.b
		trigger = { has_character_flag = song_failure }
		remove_character_flag = song_failure
    }
	
	option = { #Meh
        name = nelornieth.0041.c
		trigger = {
			NOR = {
				has_character_flag = song_success 
				has_character_flag = song_failure
			}
		}
    }
	
	after = {
		if = {
			limit = { has_character_flag = second_activity }
			remove_character_flag = second_activity
			trigger_event = {
				id = nelornieth.0100
				days = 15
			}
		}
		else = {
			trigger_event = {
				id = nelornieth.0005
				days = 15
			}
		}
	}
}

### Conclusion

nelornieth.0100 = { # Conclusion
	content_source = realms_dlc
	type = character_event
    title = nelornieth.0100.t
    desc = {
		desc = nelornieth.0100.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = { var:mission_success < 0  }
				desc = nelornieth.0100.desc.failure
			}
			desc = nelornieth.0100.desc.success
		}
	}

    theme = diplomacy
	override_background = {
		reference = throne_room_scope
	}
    left_portrait = {
		character = scope:ambassador
		animation = personality_content
	}
	right_portrait = {
		character = scope:embassy_target
		triggered_animation = {
			trigger = { var:mission_success < 0 }
			animation = boredom
		}
		animation = personality_honorable
	}
	
	immediate = {
		scope:embassy_target = {
			save_scope_as = background_throne_room_scope
		}
	}
	
    option = { #Alliance
        name = nelornieth.0100.a
		custom_tooltip = nelornieth.0100.a.tt
		trigger = {
			var:mission_success >=3
			NOT = { is_allied_to = scope:embassy_target }
		}
		
		scope:embassy_target = {
			trigger_event = {
				id = nelornieth.0101
				days = 15
			}
		}
		
		ai_chance = {
			base = 100
		}
    }
	
	option = { #A weapon
        name = nelornieth.0100.b
		custom_tooltip = nelornieth.0100.b.tt
		trigger = {
			var:mission_success >=2
		}
		
		hidden_effect = {
			if = {
				limit = { 
					scope:embassy_target = scope:lasgalenking
				}
				create_lasgalendrim_spear_effect = {
					OWNER = root
					CREATOR = scope:embassy_target
				}
			}
			else_if = {
				limit = { 
					scope:embassy_target = scope:lorienking
				}
				create_galadhrim_bow_effect = {
					OWNER = root
					CREATOR = scope:embassy_target
				}
			}
			else = { #For swords, but also as fallback
				create_artifact_weapon_effect = {
					OWNER = root
					CREATOR = scope:embassy_target
					SET_WEAPON_TYPE = flag:artifact_weapon_type_sword
				}
			}
			if = {
				limit = {
					exists = scope:newly_created_artifact
				}
				scope:newly_created_artifact = {
					add_artifact_history = {
						type = given
						actor = scope:embassy_target
						recipient = root
					}
				}
				send_interface_toast = {
					title = nelornieth.0100.b.toast
					left_icon = scope:newly_created_artifact
					show_as_tooltip = {
						scope:newly_created_artifact = {
							set_owner = root
						}
					}
				}
			}
		}
		
		ai_chance = {
			base = 70
		}	
    }
	
	option = { #A warrior
		name = nelornieth.0100.c
		custom_tooltip = nelornieth.0100.c.tt
		trigger = {
			var:mission_success >=0
		}
		hidden_effect = {
			create_character = {
				employer = root
				template = frontier_hero_template
				faith = scope:embassy_target.faith
				culture = scope:embassy_target.culture
				gender_female_chance = {
					if = {
						limit = { scope:embassy_target.culture = { has_cultural_parameter = martial_custom_male_only_combatant } }
						add = 0
					}
					else_if = {
						limit = { scope:embassy_target.culture = { has_cultural_parameter = martial_custom_female_only_combatant } }
						add = 100
					}
					else = {
						add = 50
					}
				}
				trait = forest_fighter
				save_scope_as = new_commander
			}
			send_interface_toast = {
				title = nelornieth.0100.c.toast
				left_icon = scope:new_commander
				custom_tooltip = commander_recruited.desc
			}
		}
		
		ai_chance = {
			base = 50
		}
    }
	
	option = { #Nothing
		name = nelornieth.0100.c
		trigger = {
			var:mission_success < 0
		}
		scope:embassy_target = {
			add_opinion = {
				target = root
				modifier = disappointed_opinion
				opinion = -10
			}
		}
    }
	
	after = {
		remove_variable = mission_success
	}
}

nelornieth.0101 = { # Alliance proposal
    title = nelornieth.0101.t
    desc = nelornieth.0101.desc
	
	content_source = realms_dlc
	type = character_event
    theme = diplomacy
    right_portrait = {
		character = scope:ambassador
		animation = throne_room_messenger_3
	}
	left_portrait = {
		character = root
		animation = personality_honorable
	}
	
	option = { #Yes of course !
		name = nelornieth.0101.a
		
		create_alliance = {
			target = scope:nelorniethking
			allied_through_owner = root
			allied_through_target = scope:nelorniethking
		}
		scope:nelorniethking = {
			add_opinion = {
				modifier = perk_negotiated_alliance_opinion
				target = root
			}
		}
		
		culture = { 
			add_innovation = innovation_formalized_emissaries
		}
		scope:nelorniethking.culture = { 
			add_innovation = innovation_formalized_emissaries
		}
	}
	
	option = { #Not interested
		trigger = { is_ai = no }
		name = nelornieth.0101.b
		scope:nelorniethking = {
			add_opinion = {
				modifier = elf_refused_alliance_opinion
				target = root
				opinion = -50
			}
		}
	}
}
