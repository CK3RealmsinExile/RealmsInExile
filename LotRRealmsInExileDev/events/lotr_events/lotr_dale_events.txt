namespace = dale

###############
# DALE EVENTS #
###############

### 	dale.0001 - 0500 ~~ Dale WotR event chain 
###		dale.0500 - 1000 ~~ management events
###		dale.1000 - 1100 ~~ Enter/Leave realm events (Dale)

###########################################################

### Dale trade vs. warfare event chain ###
 #triggered after King Bain's intro event
 #works for custom characters as well

dale.0001 = { # The royal council
	content_source = realms_dlc
	type = character_event
	title = dale.0001.t
	desc = dale.0001.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:chancellor
		animation = chancellor
	}
	override_background = {
		reference = council_chamber
	}
	immediate = {
		if = {
    		limit = { 
				NOT = {
					exists = root.cp:councillor_chancellor
				}
			}
			create_character = {
				template = beautiful_peasant_character
				employer = root
				gender_female_chance = 25
				save_scope_as = new_chancellor
			}
			hidden_effect = {
				assign_councillor_type = {
					type = councillor_chancellor
					target = scope:new_chancellor
					remove_existing_councillor = no
				}
			}
		}
		root.cp:councillor_chancellor = { save_scope_as = chancellor }
	}
	
	option = { # We'll focus on our trade
		name = dale.0001.a 
		dynasty = { add_dynasty_modifier = dale_trade_focus }
		title:c_aradhrynd.holder = {
			trigger_event = {
				id = dale.0502
				days = { 60 120 }
			}
		}
	}
	
	option = { # We should invest in our military
		name = dale.0001.b 
		dynasty = { add_dynasty_modifier = dale_military_focus }
		title:c_aradhrynd.holder = {
			trigger_event = {
				id = dale.0502
				days = { 60 120 }
			}
		}
	}
}

dale.0002 = { # A question of alliance
	content_source = realms_dlc
	type = character_event
	title = dale.0002.t
	desc = dale.0002.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:marshal
		animation = marshal
	}
	override_background = {
		reference = throne_room
	}
	immediate = {
		if = {
    		limit = { 
				NOT = {
					exists = root.cp:councillor_marshal
				}
			}
			create_character = {
				template = beautiful_peasant_character
				employer = root
				gender_female_chance = 25
				save_scope_as = new_marshal
			}
			hidden_effect = {
				assign_councillor_type = {
					type = councillor_marshal
					target = scope:new_marshal
					remove_existing_councillor = no
				}
			}
		}
		root.cp:councillor_marshal = { save_scope_as = marshal }
		
		if = {
			limit = {
				exists = title:k_erebor.holder
			}
			title:k_erebor.holder = { save_scope_as = ereborholder }
		}
		
		if = { 
			limit = {
				exists = title:k_lasgalen.holder 
			}
			title:k_lasgalen.holder = { save_scope_as = lasgalenholder }
		}
		
		if = { 
			limit = {
				exists = title:d_carrock_vale.holder 
			}
			title:d_carrock_vale.holder = { save_scope_as = beorningholder }
		}
		
		if = { 
			limit = {
				exists = title:d_ronen_in_anduin.holder 
			}
			title:d_ronen_in_anduin.holder = { save_scope_as = framlingholder }
		}
	}
	
	option = { # We'll renew our old alliance with the dwarves
		name = dale.0002.a 
		trigger = { 
			exists = title:k_erebor.holder
			title:k_erebor.holder = { 
				is_dwarf = yes 
				faith_is_good = yes
			}
		}
		custom_tooltip = dale.0002.a.tt
		create_alliance = {
			target = scope:ereborholder
			allied_through_owner = root
			allied_through_target = scope:ereborholder
		}
		scope:ereborholder = {
			add_opinion = {
				modifier = perk_negotiated_alliance_opinion
				target = root
			}
		}
		hidden_effect = {
			culture = { 
				add_innovation = innovation_formalized_emissaries
			}
			scope:ereborholder.culture = { 
				add_innovation = innovation_formalized_emissaries
			}
		}
		if = {
			limit = { has_variable_list = defensive_allies }
			every_in_list = {
				variable = defensive_allies
				save_scope_as = defensive_ally
			}
			clear_variable_list = defensive_allies
			scope:defensive_ally = { clear_variable_list = defensive_allies }
		}
		title:c_aradhrynd.holder = {
			trigger_event = {
				id = dale.0503
				days = { 180 240 }
			}
		}
	}
	
	option = { # Let us approach the elves of the Woodland realm
		name = dale.0002.b
		trigger = { 
			exists = title:k_lasgalen.holder
			title:k_lasgalen.holder = { 
				is_elf = yes 
				faith_is_good = yes
			}
		}
		custom_tooltip = dale.0002.b.tt
		create_alliance = {
			target = scope:lasgalenholder
			allied_through_owner = root
			allied_through_target = scope:lasgalenholder
		}
		scope:lasgalenholder = {
			add_opinion = {
				modifier = perk_negotiated_alliance_opinion
				target = root
			}
		}
		hidden_effect = {
			culture = { 
				add_innovation = innovation_formalized_emissaries
			}
			scope:lasgalenholder.culture = { 
				add_innovation = innovation_formalized_emissaries
			}
		}
		title:c_aradhrynd.holder = {
			trigger_event = {
				id = dale.0503
				days = { 180 240 }
			}
		}
	}
	
	option = { # Let us reach out to the Framlings beyond Mirkwood
		name = dale.0002.c
		trigger = { 
			exists = title:d_ronen_in_anduin.holder
			title:d_ronen_in_anduin.holder = { 
				faith_is_good = yes
			}
		}
		custom_tooltip = dale.0002.c.tt
		create_alliance = {
			target = title:d_ronen_in_anduin.holder
			allied_through_owner = root
			allied_through_target = title:d_ronen_in_anduin.holder
		}
		scope:framlingholder = {
			add_opinion = {
				modifier = perk_negotiated_alliance_opinion
				target = root
			}
		}
		hidden_effect = {
			culture = { 
				add_innovation = innovation_formalized_emissaries
			}
			title:d_ronen_in_anduin.holder.culture = { 
				add_innovation = innovation_formalized_emissaries
			}
		}
		title:c_aradhrynd.holder = {
			trigger_event = {
				id = dale.0503
				days = { 180 240 }
			}
		}
	}
	
	option = { # The Beornings will make for stalwart allies
		name = dale.0002.d
		trigger = { 
			exists = title:d_carrock_vale.holder
			title:d_carrock_vale.holder = { 
				faith_is_good = yes
				has_trait = skinchanger
			}
		}
		custom_tooltip = dale.0002.d.tt
		create_alliance = {
			target = title:d_carrock_vale.holder
			allied_through_owner = root
			allied_through_target = title:d_carrock_vale.holder
		}
		scope:beorningholder = {
			add_opinion = {
				modifier = perk_negotiated_alliance_opinion
				target = root
			}
		}
		hidden_effect = {
			culture = { 
				add_innovation = innovation_formalized_emissaries
			}
			title:d_carrock_vale.holder.culture = { 
				add_innovation = innovation_formalized_emissaries
			}
		}
		title:c_aradhrynd.holder = {
			trigger_event = {
				id = dale.0503
				days = { 180 240 }
			}
		}
	}
	
	option = { # We will rely on our own strength
		name = dale.0002.e 
		add_prestige = major_prestige_gain
		root.dynasty = { add_dynasty_prestige = medium_dynasty_prestige_value }
		title:c_aradhrynd.holder = {
			trigger_event = {
				id = dale.0503
				days = { 180 240 }
			}
		}
	}
}

dale.0003 = { # Messenger of Mordor
	content_source = realms_dlc
	type = character_event
	title = dale.0003.t
	desc = dale.0003.desc
	theme = dread
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:nazgul
		animation = personality_irrational
	}
	override_background = {
		reference = alley_night
	}
	immediate = {
		character:nazgul5 = { save_scope_as = nazgul }
	}
	
	option = { # I ask for time to consider the offer (ask the dwarves for counsel )
		name = dale.0003.a
		custom_tooltip = dale.0003.a.tt
		hidden_effect = { #give free caravan master
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				create_character = {
					template = foreign_architect_template
					employer = root
					save_scope_as = caravan_master
				}
				appoint_court_position = {
					recipient = scope:caravan_master
					court_position = travel_leader_court_position
				}
			}
		}
		start_travel_plan = {
			destination = title:c_throne_of_erebor.title_province
			on_arrival_event  = dale.0004
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
	}

	option = { # Outright refuse
		name = dale.0003.b
		custom_tooltip = dale.0003.b.tt
		dynasty = { add_dynasty_modifier = dale_refused_mordor }
		# title:c_aradhrynd.holder = {
			# trigger_event = {
				# id = dale.0504
				# days = { 120 180 }
			# }
		# }
	}
	
	option = { # Yeah OK we'll look for your dumb ring
		name = dale.0003.c
		custom_tooltip = dale.0003.c.tt
		dynasty = { add_dynasty_modifier = dale_accepted_mordor }
		# title:c_aradhrynd.holder = {
			# trigger_event = {
				# id = dale.0504
				# days = { 120 180 }
			# }
		# }
	}
}

dale.0004 = { # Ask the Dwarves for their counsel
	content_source = realms_dlc
	type = character_event
	title = dale.0004.t
	desc = dale.0004.desc
	theme = alliance
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:ereborking
		animation = personality_compassionate
	}
	override_background = {
		reference = throne_room_dwarf
	}
	immediate = {
		title:k_erebor.holder = { save_scope_as = ereborking }
	}
	option = { # Send a messenger to Elrond of Rivendell
		name = dale.0004.a
		custom_tooltip = dale.0004.a.tt 
		# title:k_imladris.holder = {
			# trigger_event = {
				# id = dale.0006
				# days = 240
			# }
		# }
	}
	option = { # Thank them and return home
		name = dale.0004.b
		custom_tooltip = dale.0004.b.tt 
	}
	after = {
		start_travel_plan = { #Travel home
			destination = root.capital_county.title_province
			return_trip = no
			players_use_planner = no
			on_arrival_destinations = all
		}
		# title:c_aradhrynd.holder = {
			# trigger_event = {
				# id = dale.0504
				# days = { 120 180 }
			# }
		# }
	}
}

### Dale management events (hidden) ###
#Making sure the event chain isn't broken by the death of Dale's ruler

dale.0502 = {
	hidden = yes 
	immediate = {
		title:k_dale.holder = { trigger_event = dale.0002 }
	}
}

dale.0503 = {
	hidden = yes 
	immediate = {
		title:k_dale.holder = { trigger_event = dale.0003 }
	}
}

# dale.0504 = {
	# hidden = yes 
	# immediate = {
		# title:k_dale.holder = { trigger_event = dale.0005 }
	# }
# }

### Enter/Leave realm events ###

dale.1000 = { # The Fall of Dale
	content_source = realms_dlc
	type = character_event
	title = dale.1000.t
	desc = dale.1000.desc
	theme = battle
	trigger = { 
		culture = { has_cultural_pillar = heritage_northron } #Should only trigger for Northrons
	} 
	cooldown = { days = 3 }
	left_portrait = {
		character = root
		animation = rage
	}
	
	option = { #This can't be happening...
		name = dale.1000.a
		add_prestige = minor_prestige_loss
	}
}

dale.1001 = { # Dale reclaimed
	content_source = realms_dlc
	type = character_event
	title = dale.1001.t
	desc = dale.1001.desc
	theme = war
	trigger = { culture = { has_cultural_pillar = heritage_northron } } #Should only trigger for Northrons
	cooldown = { days = 3 }
	left_portrait = {
		character = root
		animation = marshal_shield
	}
	
	option = { #We did it!
		name = dale.1001.a
		add_prestige = medium_prestige_gain
	}
}