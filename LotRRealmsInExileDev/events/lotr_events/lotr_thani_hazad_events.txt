namespace = lotr_thani_hazad

############################
#	lotr_thani_hazad.0000 - 500  ==> Storm-Host/An-Balkumagan Events
#	lotr_thani_hazad.1000 - 1200 ==> Stormhost spy at Balan-lai court event chain
#	lotr_thani_hazad.2000 - 2200 ==> Tandi Rebellion event chain
#
#
#
#
#
#
#
############################

lotr_thani_hazad.0001 = { # Order to attack Bellakar
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.0001.t
	desc = lotr_thani_hazad.0001.desc
	theme = war
	override_background = { reference = docks_adunai }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	right_portrait = {
		character = character:nazgul5
		animation = personality_dishonorable
	}
	option = {
		name = lotr_thani_hazad.0001.a

		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:recieved_murder_bellakar_order
		}
	}
}

lotr_thani_hazad.0002 = { # Pel is conquered by the mag special military operation
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.0002.t
	desc = lotr_thani_hazad.0002.desc
	theme = war
	override_background = { reference = docks_adunai }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	# right_portrait = {
	# 	character = character:nazgul5
	# 	animation = personality_dishonorable
	# }
	option = {
		name = lotr_thani_hazad.0002.a
	}
}

### "Stormhost spy at Balan-lai court" event chain ~~ Aerien ##

lotr_thani_hazad.1000 = { # Set-up event for "Spy at Court" event chain
	hidden = yes
	immediate = {
		create_character = { # 
			age = { 55 65 }
			gender = male
			culture = culture:kharadunaim
			faith = faith:faith_thani_hazad
			dynasty = none
			employer = title:e_thon_an_kharlokh.holder
			save_scope_as = spy_father
		}

		create_character = { # 
			age = { 55 65 }
			gender = female
			culture = culture:kharadunaim
			faith = faith:faith_thani_hazad
			dynasty = none
			employer = title:e_thon_an_kharlokh.holder
			save_scope_as = spy_mother
		}
		create_character = { # Create a new character to become the spy
			employer = root
			age = { 20 35 }
			culture = culture:kharadunaim
			faith = faith:faith_thani_hazad
			dynasty = none
			gender_female_chance = 50
			father = scope:spy_father
			mother = scope:spy_mother
			intrigue = 11
			trait = shrewd
			trait = intellect_good_1
			save_scope_as = stormhost_spy
			#after_creation = {
			#	save_temporary_scope_as = 
			#}
		}	
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1001
			days = { 60 120 } 
		}
	}
}

lotr_thani_hazad.1001 = { # The spy attempts to gain your trust
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1001.t
	desc = lotr_thani_hazad.1001.desc
	theme = party
	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = admiration
	}
	option = { # Show me what you wanted to show me.
		name = lotr_thani_hazad.1001.a
		hidden_effect =  {
			random_list = {
				34 = { trigger_event = lotr_thani_hazad.1020 } #Wine tasting
				33 = { trigger_event = lotr_thani_hazad.1030 } #Portrait painting
				33 = { trigger_event = lotr_thani_hazad.1040 } #Exotic bird
			}
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 10
				target = root
			}
		}
	}
	option = { # Can't you see I'm busy?
		name = lotr_thani_hazad.1001.b
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
	option = { # I don't trust you!
		name = lotr_thani_hazad.1001.c
		trigger = {
			OR = {
				has_trait = paranoid
				has_trait = shrewd
				has_trait = deceitful
				has_trait = irritable
			}
		}
		imprison = {
			target = scope:stormhost_spy
			type = dungeon
		}
		add_character_flag = imprisoned_stormhost_spy
		stress_impact = {
			base = minor_stress_impact_loss
		}
		trigger_event = { # You find out they were a spy
			id = lotr_thani_hazad.1200
			days = 15
		}
	}
	
	option = { # Dance with me instead!
		name = lotr_thani_hazad.1001.d
		trigger = {
			OR = {
				has_trait = gregarious
				has_trait = trusting
				has_trait = honest
				has_trait = rakish
			}
		}
		stress_impact = {
			base = major_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
}

lotr_thani_hazad.1020 = { # Wine tasting
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1020.t
	desc = lotr_thani_hazad.1020.desc
	theme = party
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = happy
	}
	option = { # Let's drink!
		name = lotr_thani_hazad.1020.a
		stress_impact = {
			base = major_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		random_list = {
			95 = {
				add_prestige = 25
			}
			5 = { 
				add_prestige = 25
				add_trait = drunkard
			}
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # Just a small dignified taste.
		name = lotr_thani_hazad.1020.b
		trigger = {
			NOR = {
				has_trait = drunkard
				has_trait = gluttonous
			}
		}
		add_prestige = 50
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # No, this isn't my style
		name = lotr_thani_hazad.1020.c
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
}

lotr_thani_hazad.1030 = { # Portrait painting
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1030.t
	desc = lotr_thani_hazad.1030.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = happy
	}
	option = { # Let's do it!
		name = lotr_thani_hazad.1030.a
		stress_impact = {
			base = minor_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		remove_short_term_gold = 30
		add_prestige = 150
		add_legitimacy = 20
		root.dynasty = { add_dynasty_prestige = 50 }
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # What about I pay you with, uh, exposure?
		name = lotr_thani_hazad.1030.b
		trigger = {
			OR = {
				has_trait = greedy
				has_trait = poet
			}
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		add_prestige = 50
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # No, this isn't my style
		name = lotr_thani_hazad.1030.c
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
}

lotr_thani_hazad.1040 = { # Exotic Bird demonstration
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1040.t
	desc = lotr_thani_hazad.1040.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = happy
	}
	option = { # How marvellous!
		name = lotr_thani_hazad.1040.a
		stress_impact = {
			base = minor_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # I must have it!
		name = lotr_thani_hazad.1040.b
		trigger = {
			OR = {
				has_trait = arrogant
				has_trait = eccentric
			}
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		add_prestige = 300
		remove_short_term_gold = 25
		root.dynasty = { add_dynasty_prestige = 50 }
		stress_impact = {
			base = medium_stress_impact_loss
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # No, this isn't my style
		name = lotr_thani_hazad.1040.c
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
}

lotr_thani_hazad.1100 = { # Quick check if the spy was already made spymaster
	hidden = yes
	immediate = {
		if = {
			limit = {
				scope:stormhost_spy = {
					exists = root.cp:councillor_spymaster
					has_council_position = councillor_spymaster
				}
			}
			trigger_event = lotr_thani_hazad.1150
		}
		else = {
			trigger_event = lotr_thani_hazad.1101
		}
	}
}

lotr_thani_hazad.1101 = { # Spy attempts to make their move
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1101.t
	desc = lotr_thani_hazad.1101.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = personality_content 
	}
	#immediate = {
	#}
	option = { # Sure, I'll make you my spymaster. What could go wrong?
		name = lotr_thani_hazad.1101.a
		assign_councillor_type = {
			type = councillor_spymaster
			target = scope:stormhost_spy
			remove_existing_councillor = yes
		}
		trigger_event = { # The spy will try to fulfill his mission
			id = lotr_thani_hazad.1150
			days = { 60 180 }
		}
	}
	option = { # What? No!
		name = lotr_thani_hazad.1101.b
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
	
	option = { # I don't trust you!
		name = lotr_thani_hazad.1101.c
		trigger = {
			OR = {
				has_trait = paranoid
				has_trait = shrewd
				has_trait = deceitful
				has_trait = schemer
			}
		}
		imprison = {
			target = scope:stormhost_spy
			type = dungeon
		}
		add_character_flag = imprisoned_stormhost_spy
		stress_impact = {
			base = minor_stress_impact_loss
		}
		trigger_event = { # You find out they were a spy
			id = lotr_thani_hazad.1200
			days = 15
		}
	}
}

lotr_thani_hazad.1150 = { # The spy tries to fulfill his mission
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1150.t
	theme = intrigue
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = { has_character_flag = spy_made_their_move }
				}
				desc = lotr_thani_hazad.1150.desc.new
			}
			desc = lotr_thani_hazad.1150.desc
		}
	}
	left_portrait = {
		character = root
		animation = personality_content
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = spymaster 
	}
	lower_center_portrait = { 
		character = scope:stormking
	}
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormking }
	}
	option = { # Become the stormking's tributary? Sounds great!
		name = lotr_thani_hazad.1150.a
		ai_chance = {
            base = 0 # AI should not choose to do this
        }
		custom_tooltip = event_thani_hazad_1155_a
        make_tributary = {
			TYPE = tributary_permanent
			TRIBUTARY = root
			SUZERAIN = scope:stormking
		}	
	}
	option = { # No! What a terrible idea!
		name = lotr_thani_hazad.1150.b
		scope:stormhost_spy = {
			add_opinion = {
				modifier = annoyed_opinion
				opinion = -10
				target = root
			}
		}
		trigger_event = { # The spy will try again
			id = lotr_thani_hazad.1150
			days = { 60 180 }
		}
		add_character_flag = spy_made_their_move
	}
	
	option = { # It's treason, then...
		name = lotr_thani_hazad.1150.c
		imprison = {
			target = scope:stormhost_spy
			type = dungeon
		}
		add_character_flag = imprisoned_stormhost_spy
		stress_impact = {
			base = minor_stress_impact_loss
		}
		trigger_event = { # You find out they were a spy
			id = lotr_thani_hazad.1200
			days = 15
		}
	}
	
	option = { # Don't suggest this again, you fool!
		name = lotr_thani_hazad.1150.d
		trigger = {
			has_character_flag = spy_made_their_move
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = insulted_opinion
				opinion = -40
				target = root
			}
		}
		fire_councillor = cp:councillor_spymaster
		trigger_event = { # You find out they were a spy
			id = lotr_thani_hazad.1200
			days = { 30 60 }
		}
	}
}

lotr_thani_hazad.1200 = { # You find out the truth
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1200.t
	theme = intrigue
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = { has_character_flag = imprisoned_stormhost_spy }
				}
				desc = lotr_thani_hazad.1200.desc.new
			}
			desc = lotr_thani_hazad.1200.desc
		}
	}
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:spymaster
		animation = spymaster
	}
	lower_center_portrait = {
		character = scope:stormhost_spy
	}
	immediate = {
		if = {
    		limit = { 
				NOT = {
					exists = root.cp:councillor_spymaster 
				}
			}
			create_character = { # 
				age = { 55 65 }
				gender = male
				culture = culture:kharadunaim
				faith = faith:faith_thani_hazad
				dynasty = none
				location = root.location
				save_scope_as = spymaster_father
			}

			create_character = { # 
				age = { 55 65 }
				gender = female
				culture = culture:kharadunaim
				faith = faith:faith_thani_hazad
				dynasty = none
				location = root.location
				save_scope_as = spymaster_mother
			}
			
			create_character = { # Create a replacement spymaster
				employer = root
				age = { 20 35 }
				culture = culture:kharadunaim
				faith = faith:faith_thani_hazad
				dynasty = none
				gender_female_chance = 50
				father = scope:spymaster_father
				mother = scope:spymaster_mother
				intrigue = 12
				trait = intellect_good_1
				trait = education_intrigue_3
				save_scope_as = spymaster
				
			}
			hidden_effect = {
				assign_councillor_type = {
					type = councillor_spymaster
					target = scope:spymaster
					remove_existing_councillor = no
				}
			}
		}
		root.cp:councillor_spymaster = { save_scope_as = spymaster }
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormking }
	}
	option = { #execute them
		name = lotr_thani_hazad.1200.a
		scope:stormhost_spy = {
			death = {
				killer = root
				death_reason = death_execution
			}
		}
		add_prestige = 250
		add_legitimacy = 10
	}
	option = { # Show mercy, banish them
		name = lotr_thani_hazad.1200.b
		trigger = {
			OR = {
				has_trait = compassionate
				has_trait = forgiving
				has_trait = trusting
			}
		}
		scope:stormhost_spy = {
			release_from_prison = yes
		}
		scope:stormhost_spy = {
			banish = yes	
			hidden_effect = {
				add_opinion = {
					modifier = banished_me
					target = root
				}
			}			
		}
		add_piety = 200
		add_prestige = 100
		stress_impact = {
			base = major_stress_impact_loss
		}
	}
	option = { # Turn them into double agent
		name = lotr_thani_hazad.1200.c
		trigger = {
			OR = {
				has_trait = shrewd
				has_trait = deceitful
				has_trait = schemer
			}
		}
		add_intrigue_lifestyle_xp = 500
		add_legitimacy = 10
		scope:stormhost_spy = {
			release_from_prison = yes
		}
		hidden_effect = {
			scope:stormhost_spy = {
				set_employer = root
			}
		}
	}
}


######## Stormhost: Tandi Rebellion Events ########
# ( vanilla Zanj rebellion adaptation by Aerien ) #
###################################################

### Tandi Rebellion Setup ###
lotr_thani_hazad.2000 = {
 	scope = none
	hidden = yes
 	immediate = {
 		spawn_tandi_leader_character_effect = yes
 		scope:tandi_leader = {
 			save_scope_as = story_owner
 			create_story = story_tandi_rebellion
 			give_nickname = nick_storm_queller
 		}

 		title:c_trulsa.holder = {
 			add_visiting_courtier = scope:tandi_leader
 		}
 		title:c_trulsa.holder.top_liege = {
 			trigger_event = {
 				id = lotr_thani_hazad.2001
 			}
 			trigger_event = {
 				id = lotr_thani_hazad.2005
				days = { 60 120 }
 			}
		}
 	}
}

### Tandi leader is riling up locals in Trulsa ###
lotr_thani_hazad.2001 = {
	content_source = realms_dlc
 	type = character_event
 	theme = intrigue
 	override_background = { reference = wilderness_wetlands }
 	title = lotr_thani_hazad.2001.t
 	desc = lotr_thani_hazad.2001.desc

 	left_portrait = {
 		character = root
 		animation = marshal
 	}
 	right_portrait = {
 		character = scope:tandi_leader
 		animation = scheme
 	}

 	immediate = {
 		scope:tandi_leader = {
 			save_scope_as = outspoken_rebel
 		}
 	}

 	#Try to arrest the upstart
 	option = {
 		name = lotr_thani_hazad.2001.a
 		duel = {
 			skill = intrigue
 			target = scope:outspoken_rebel
 			50 = {
				# You arrest him
 				desc = lotr_thani_hazad.2001.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				send_interface_toast = {
 					title = lotr_thani_hazad.2001.a.success
 					left_icon = root
 					right_icon = scope:outspoken_rebel
 					rightfully_imprison_character_effect = {
 						TARGET = scope:outspoken_rebel
 						IMPRISONER = root
 					}
 				}
 				inherit_tandi_rebellion_effect = yes
 			}
 			50 = {
 				# The upstart escapes
 				desc = lotr_thani_hazad.2001.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
 				send_interface_toast = {
 					title = lotr_thani_hazad.2001.a.failure
 					custom_tooltip = lotr_tandi_rebellion_events_cause_greatly_strengthened_tt
 					custom_tooltip = lotr_tandi_rebellion_leaves_for_tayalima
 					left_icon = root
 					right_icon = scope:outspoken_rebel
 				}
 				hidden_effect = {
 					scope:tandi_leader = {
 						change_variable = {
 							name =  tandi_rebellion_strength_score
 							add = 4
 						}
 					}
 					title:c_tayalima.holder = {
 						hidden_effect = {
 							title:c_tayalima.holder = {
 								add_visiting_courtier = scope:outspoken_rebel
 							}
 						}
 					}
 					title:c_trulsa.holder.top_liege = {
 						trigger_event = {
 							id = lotr_thani_hazad.2002
 							days = { 30 60 }
 						}
 					}
 				}
 			}
 		}
 		root = {
 			progress_towards_rival_effect = {
 				REASON = lotr_tandi_rebellion_opressed_me
 				CHARACTER = scope:outspoken_rebel
 				OPINION = default_rival_opinion
 			}
 		}
 		stress_impact = {
 			paranoid = medium_stress_impact_loss
 			just = minor_stress_impact_loss
 			callous = minor_stress_impact_loss
 			sadistic = minor_stress_impact_loss
 			trusting = medium_stress_impact_gain
 			forgiving = medium_stress_impact_gain
 			compassionate = medium_stress_impact_gain
 		}
 		ai_chance = {
 			base = 100
 			modifier = {
 				factor = 0.5
 				OR = {
 					has_trait = trusting
 					has_trait = forgiving
 					has_trait = compassionate
 				}
 			}
 		}
 	}

 	#Ignore the upstart
 	option = {
 		name = lotr_thani_hazad.2001.c
 		custom_tooltip = lotr_tandi_rebellion_events_cause_greatly_strengthened_tt
 		scope:tandi_leader = {
 			change_variable = {
 				name =  tandi_rebellion_strength_score
 				add = 2
 			}
 		}
 		custom_tooltip = lotr_tandi_rebellion_leaves_for_tayalima
 		hidden_effect = {
 			title:c_tayalima.holder = {
 				add_visiting_courtier = scope:outspoken_rebel
 			}
 		}
 		title:c_trulsa.holder.top_liege = {
 			trigger_event = {
 				id = lotr_thani_hazad.2002
 				days = { 30 60 }
 			}
 		}
 		stress_impact = {
 			paranoid = medium_stress_impact_gain
 			just = minor_stress_impact_gain
 			callous = minor_stress_impact_gain
 			sadistic = medium_stress_impact_gain
 			trusting = medium_stress_impact_loss
 			forgiving = medium_stress_impact_loss
 			compassionate = medium_stress_impact_loss
 		}
 		ai_chance = {
 			base = 100
 			modifier = {
 				factor = 0.5
 				OR = {
 					has_trait = paranoid
 					has_trait = just
 					has_trait = callous
 					has_trait = sadistic
 				}
 			}
 		}
 	}
}

### Setup to find correct scope for lotr_thani_hazad.2003 and check if the rebel leader is dead or imprisoned
lotr_thani_hazad.2002 = {
 	scope = none
 	hidden = yes
 	immediate = {
 		if ={
 			#check if he is still alive and not in prison and is not an inheritor of the rebellion
 			limit = {
 				scope:tandi_leader = {
 					AND = {
 						is_alive = yes
 						is_imprisoned = no
 						NOT = { has_character_flag = new_tandi_leader }
 					}
 				}
 			}
 			title:c_trulsa.holder.top_liege = {
 				trigger_event = {
 					id = lotr_thani_hazad.2003
				}
			}
 		}
 	}
}

### The rebel leader rouses his followers
lotr_thani_hazad.2003 = {
	content_source = realms_dlc
 	type = character_event
 	theme = faith
 	title = lotr_thani_hazad.2003.t
 	desc = lotr_thani_hazad.2003.desc
 	left_portrait = {
 		character = root
 		animation = dismissal
 	}
 	right_portrait = {
 		character = scope:tandi_leader
 		animation = personality_zealous
 	}

 	#Attempt to quell the revolt
 	option = {
 		name = lotr_thani_hazad.2003.a
 		duel = {
 			skill = martial
 			target = scope:tandi_leader
 			50 = {
 				# You dissuade people from joining the rebels
 				desc = lotr_thani_hazad.2003.a.success
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = 3.5
 					min = -49
 				}
 				send_interface_toast = {
 					title = lotr_thani_hazad.2003.a.success
 					add_legitimacy = 10
 					add_prestige = minor_prestige_gain
 					left_icon = root
 					right_icon = scope:tandi_leader
 				}
 			}
 			50 = {
 				# The rebels are not intimidated
 				desc = lotr_thani_hazad.2003.a.failure
 				compare_modifier = {
 					value = scope:duel_value
 					multiplier = -3.5
 					min = -49
 				}
 				custom_tooltip = lotr_tandi_rebellion_events_cause_greatly_strengthened_tt
 				send_interface_toast = {
 					title = lotr_thani_hazad.2003.a.failure
 					left_icon = root
 					right_icon = scope:tandi_leader
					
 					scope:tandi_leader = {
 						add_prestige = medium_prestige_gain
 						add_pressed_claim = title:k_an_balkumagan
 						change_variable = {
 							name =  tandi_rebellion_strength_score
 							add = 4
 						}
 					}
 				}
 			}
 		}
 		root = {
 			progress_towards_rival_effect = {
 				REASON = lotr_tandi_rebellion_opressed_me
 				CHARACTER = scope:tandi_leader
 				OPINION = default_rival_opinion
 			}
 		}
 		stress_impact = {
 			paranoid = minor_stress_impact_loss
 			just = minor_stress_impact_loss
 			zealous = medium_stress_impact_loss
 			trusting = medium_stress_impact_gain
 			forgiving = medium_stress_impact_gain
 			cynical = medium_stress_impact_gain
 		}
 		ai_chance = {
 			base = 100
 			modifier = {
 				factor = 0.5
 				OR = {
 					has_trait = cynical
 					has_trait = trusting
 					has_trait = forgiving
 				}
 			}
 		}
 	}

 	#Ignore the rebels
 	option = {
 		name = lotr_thani_hazad.2003.b
 		custom_tooltip = lotr_tandi_rebellion_events_cause_strengthened_tt

 		scope:tandi_leader = {
 			add_prestige = medium_prestige_gain
 			add_pressed_claim = title:k_an_balkumagan
 			change_variable = {
 				name =  tandi_rebellion_strength_score
 				add = 2
 			}
 		}
 		stress_impact = {
 			paranoid = minor_stress_impact_gain
 			just = minor_stress_impact_gain
 			zealous = medium_stress_impact_gain
 			trusting = minor_stress_impact_loss
 			forgiving = medium_stress_impact_loss
 			cynical = medium_stress_impact_loss
 		}
 		ai_chance = {
 			base = 100
 			modifier = {
 				factor = 0.5
 				OR = {
 					has_trait = paranoid
 					has_trait = just
 					has_trait = zealous
 				}
 			}
 		}
 	}
}

### Setup event to find the correct scope and check if the original upstart or the current tandi Leader is dead or imprisoned
lotr_thani_hazad.2005 = {
 	scope = none
 	hidden = yes
 	immediate = {
 		if = {
 			limit = {
 				scope:tandi_leader = {
 					OR = {
 						is_imprisoned = yes
 						is_alive = no
 						is_landed = yes
 					}
 				}
 			}
 			inherit_tandi_rebellion_effect = yes
 		}
 		title:c_trulsa.holder.top_liege = {
 			trigger_event = {
 				id = lotr_thani_hazad.2006
 			}
 		}
 	}
}

### The local workers make demands ###
lotr_thani_hazad.2006 = {
	content_source = realms_dlc
 	type = character_event
 	theme = corruption
 	title = lotr_thani_hazad.2006.t
 	desc = {
 		desc = lotr_thani_hazad.2006.desc.a
 		triggered_desc = {
 			trigger = { scope:tandi_leader = { NOT =  { has_character_flag = new_tandi_leader } } }
 			desc = lotr_thani_hazad.2006.desc.b
 		}
 		desc = lotr_thani_hazad.2006.desc.c
 	}
 	left_portrait = {
 		character = root
 		animation = eyeroll
 	}
 	right_portrait = {
 		character = scope:outspoken_rebel
 		animation = worry
 	}
 	lower_left_portrait = {
 		trigger = { scope:tandi_leader = { NOT =  { has_character_flag = new_tandi_leader } } }
 		character = scope:tandi_leader
 	}

 	immediate = {
 		if = {
 			limit = { scope:tandi_leader = { NOT =  { has_character_flag = new_tandi_leader } } }
 			spawn_tandi_representative_character_effect = yes
 			scope:tandi_representative = { save_scope_as = outspoken_rebel }
 		}
 		else = {
 			scope:tandi_leader = { save_scope_as = outspoken_rebel }
 		}
 	}
 	#Give Trulsa to the Tandi natives
 	option = {
 		name = lotr_thani_hazad.2006.a

 		create_title_and_vassal_change = {
 			type = independency
 			save_scope_as = change
 			add_claim_on_loss = no
 		}

 		title:c_trulsa = {
 			set_county_culture = culture:tandi
 			set_county_faith = faith:faith_tulwang
 		}

 		show_as_tooltip = { # UI/UX
 			title:c_trulsa = {
 				change_title_holder = {
 					holder = scope:outspoken_rebel
 					change = scope:change
 				}
 			}
 		}
 		scope:outspoken_rebel = {
 			becomes_independent = {
 				change = scope:change
 			}
 			add_truce_both_ways = {
 				character = root
 				years = 10
 				name = lotr_landed_tandi_reason
 			}
 		}

 		if = {
 			limit = {
 				NOT = { title:c_trulsa.holder = root  }
 			}
 			add_tyranny = 30
 			set_relation_rival = {
 				reason = lotr_rival_gave_title_away
 				target = title:c_trulsa.holder
 			}
 		}

 		hidden_effect = {
 			title:c_trulsa = {
 				change_title_holder = {
 					holder = scope:outspoken_rebel
 					change = scope:change
 				}
 				every_de_jure_county = {
 					change_title_holder = {
 						holder = scope:outspoken_rebel
 						change = scope:change
 					}
 				}
 			}
 			scope:tandi_leader = {
 				random_owned_story = {
 					limit = {
 						story_type = story_tandi_rebellion
 					}
 					end_story = yes
 				}
 			}
 		}
 		resolve_title_and_vassal_change = scope:change

 		stress_impact = {
 			compassionate = medium_stress_impact_loss
 			just = minor_stress_impact_loss
 			forgiving = minor_stress_impact_loss
 			generous = medium_stress_impact_loss
 			content = medium_stress_impact_loss
 			callous = medium_stress_impact_gain
 			sadistic = major_stress_impact_gain
 			ambitious = medium_stress_impact_gain
 			greedy = medium_stress_impact_gain
 		}
 		ai_chance = {
 			base = 100
 			modifier = {
 				factor = 0.5
 				OR = {
 					has_trait = callous
 					has_trait = sadistic
 					has_trait = ambitious
 					has_trait = greedy
 				}
 			}
 		}
 	}

 	#Make minor concessions to the Tandi rebels
 	option = {
 		name = lotr_thani_hazad.2006.b

 		scope:tandi_leader = {
 			change_variable = {
 				name =  tandi_rebellion_strength_score
 				add = 3
 			}
 		}
 		custom_tooltip = lotr_tandi_rebellion_events_cause_strengthened_tt
 		hidden_effect = {
 			title:c_trulsa.holder = {
 				if = {
 					limit = { NOT = { scope:tandi_leader = scope:outspoken_rebel }}
 					add_visiting_courtier = scope:tandi_leader
 				}
 				add_visiting_courtier = scope:outspoken_rebel
 			}
 		}

 		if = {
 			limit = {
 				NOT = { title:c_trulsa.holder = root  }
 			}
 			progress_towards_rival_effect = {
 				REASON = lotr_tandi_rebellion_interfered_with_my_workers
 				CHARACTER = title:c_trulsa.holder
 				OPINION = default_rival_opinion
 			}
 		}

 		title:c_trulsa = {
 			add_county_modifier = {
 				modifier = lotr_tandi_rebellion_work_concessions_modifier
 				years = 5
 			}
 		}

 		trigger_event = {
 			id = lotr_thani_hazad.2007
			days = { 30 60 }
 		}
 		stress_impact = {
 			compassionate = minor_stress_impact_loss
 			just = minor_stress_impact_loss
			forgiving = minor_stress_impact_loss
 			generous = minor_stress_impact_loss
 			content = minor_stress_impact_loss
 			callous = minor_stress_impact_gain
 			sadistic = medium_stress_impact_gain
 			ambitious = minor_stress_impact_gain
 			greedy = minor_stress_impact_gain
 		}
 		ai_chance = {
 			base = 100
 			modifier = {
 				factor = 0.5
				OR = {
 					has_trait = callous
 					has_trait = sadistic
 					has_trait = ambitious
 					has_trait = greedy
 				}
 			}
 		}
 	}

# 	#Ignore the rebels
 	option = {
 		name = lotr_thani_hazad.2006.c

 		scope:tandi_leader = {
 			change_variable = {
 				name =  tandi_rebellion_strength_score
 				add = 5
 			}
 		}
 		custom_tooltip = lotr_tandi_rebellion_events_cause_greatly_strengthened_tt
 		hidden_effect = {
 			title:c_trulsa.holder = {
 				add_visiting_courtier = scope:tandi_leader
 				add_visiting_courtier = scope:tandi_representative
 			}
 		}
 		if = {
 			limit = {
 				NOT = { title:c_trulsa.holder = root  }
 			}
 			progress_towards_friend_effect = {
 				REASON = lotr_rival_stayed_out_of_my_business
 				CHARACTER = title:c_trulsa.holder
 				OPINION = default_friend_opinion
 			}
 		}
 		trigger_event = {
 			id = lotr_thani_hazad.2007
 			days = { 30 60 }
 		}

 		stress_impact = {
 			compassionate = minor_stress_impact_gain
 			just = minor_stress_impact_gain
 			forgiving = minor_stress_impact_gain
 			generous = minor_stress_impact_gain
 			content = minor_stress_impact_gain
 			callous = minor_stress_impact_loss
 			sadistic = medium_stress_impact_loss
 			ambitious = minor_stress_impact_loss
 			greedy = minor_stress_impact_loss
 		}
 		ai_chance = {
 			base = 100
 			modifier = {
 				factor = 0.5
 				OR = {
 					has_trait = compassionate
 					has_trait = just
 					has_trait = forgiving
 					has_trait = generous
 				}
 			}
 		}
 	}
}

# Check if rebel leader is dead or imprisoned
lotr_thani_hazad.2007 = {
 	scope = none
 	hidden = yes
 	immediate = {
 		if = {
 			limit = {
 				scope:tandi_leader = {
 					OR = {
 						is_imprisoned = yes
 						is_alive = no
 						is_landed = yes
 					}
 				}
 			}
 			inherit_tandi_rebellion_effect = yes
 		}
 		title:c_trulsa.holder.top_liege = {
 			trigger_event = {
 				id = lotr_thani_hazad.2008

 			}
 		}
 	}
}

### The uprising begins
lotr_thani_hazad.2008 = {
	content_source = realms_dlc
 	type = character_event
 	theme = battle
 	override_background = { reference = wilderness_wetlands }
 	title = lotr_thani_hazad.2008.t
 	desc = {
 		desc = lotr_thani_hazad.2008.desc.a
 		triggered_desc = {
 			trigger = {
 				scope:tandi_leader = { NOT = { has_character_flag = new_tandi_leader}}
 			}
 			desc = lotr_thani_hazad.2008.desc.b
 		}
 		triggered_desc = {
 			trigger = {
 				scope:tandi_leader = { has_character_flag = new_tandi_leader }
 			}
 			desc = lotr_thani_hazad.2008.desc.c
 		}
 		desc = lotr_thani_hazad.2008.desc.d
 	}
 	left_portrait = {
 		character = root
 		animation = shock
 	}
 	right_portrait = {
 		character = scope:tandi_leader
 		animation = celebrate_sword
 	}
 	immediate = {
 		scope:tandi_leader = {
# 			give_nickname = nick_chief_of_the_tandi ~~ Aerien note: not needed
 			hidden_effect = {
 				random_owned_story = {
 					limit = {
 						story_type = story_tandi_rebellion
 					}
 					end_story = yes
 				}
 			}
 		}
		hidden_effect = {
 			lotr_start_tandi_rebellion_effect = {
 				TARGET_COUNTY = title:c_trulsa
 				REBEL_LEADER = scope:tandi_leader
 			}
 			create_tandi_courtier_effect = {
 				EMPLOYER = scope:tandi_leader
 				LOCATION = scope:tandi_leader.location
 			}
 			create_tandi_courtier_effect = {
 				EMPLOYER = scope:tandi_leader
 				LOCATION = scope:tandi_leader.location
 			}
 			create_tandi_courtier_effect = {
 				EMPLOYER = scope:tandi_leader
 				LOCATION = scope:tandi_leader.location
 			}
 			create_tandi_courtier_effect = {
 				EMPLOYER = scope:tandi_leader
 				LOCATION = scope:tandi_leader.location
 			}
 		}
 	}

 	option = {
		name = lotr_thani_hazad.2008.a
 	}
}