namespace = lotr_thani_hazad

############################
#	lotr_thani_hazad.0000 - 500  ==> Storm-Host/An-Balkumagan Events
#	lotr_thani_hazad.1000 - 1050 ==> Stormhost spy at Balan-lai court event chain
#
#
#
#
#
#
#
#
############################

lotr_thani_hazad.0001 = { # Order to attack Bellakar
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.0001.t
	desc = lotr_thani_hazad.0001.desc
	theme = war
	override_background = { reference = docks_adunai }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	right_portrait = {
		character = character:nazgul5
		animation = personality_dishonorable
	}
	option = {
		name = lotr_thani_hazad.0001.a

		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:recieved_murder_bellakar_order
		}
	}
}

lotr_thani_hazad.0002 = { # Pel is conquered by the mag special military operation
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.0002.t
	desc = lotr_thani_hazad.0002.desc
	theme = war
	override_background = { reference = docks_adunai }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	# right_portrait = {
	# 	character = character:nazgul5
	# 	animation = personality_dishonorable
	# }
	option = {
		name = lotr_thani_hazad.0002.a
	}
}

### "Stormhost spy at Balan-lai court" event chain ~~ Aerien ##

lotr_thani_hazad.1000 = { # Set-up event for "Spy at Court" event chain
	hidden = yes
	immediate = {
		create_character = { # Create a new character to become the spy
			employer = root
			age = { 20 35 }
			culture = culture:kharadunaim
			faith = faith:faith_thani_hazad
			dynasty = none
			gender_female_chance = 50
			#location = root.capital_province
			intrigue = 11
			trait = shrewd
			trait = intellect_good_1
			save_scope_as = stormhost_spy
			#after_creation = {
			#	save_temporary_scope_as = 
			#}
		}	
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1001
			days = { 60 120 } 
		}
	}
}

lotr_thani_hazad.1001 = { # The spy attempts to gain your trust
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1001.t
	desc = lotr_thani_hazad.1001.desc
	theme = party
	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = admiration
	}
	option = { # Show me what you wanted to show me.
		name = lotr_thani_hazad.1001.a
		hidden_effect =  {
			random_list = {
				33 = { trigger_event = lotr_thani_hazad.1020 } #Wine tasting
				33 = { trigger_event = lotr_thani_hazad.1030 } #Portrait painting
				33 = { trigger_event = lotr_thani_hazad.1040 } #Exotic bird
			}
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 10
				target = root
			}
		}
	}
	option = { # Can't you see I'm busy?
		name = lotr_thani_hazad.1001.b
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
	option = { # I don't trust you!
		name = lotr_thani_hazad.1001.c
		trigger = {
			OR = {
				has_trait = paranoid
				has_trait = shrewd
				has_trait = deceitful
				has_trait = irritable
			}
		}
		imprison = {
			target = scope:stormhost_spy
			type = dungeon
		}
		add_character_flag = imprisoned_stomhost_spy
		stress_impact = {
			base = minor_stress_impact_loss
		}
		trigger_event = { # You find out they were a spy
			id = lotr_thani_hazad.1200
			days = 15
		}
	}
	
	option = { # Dance with me instead!
		name = lotr_thani_hazad.1001.d
		trigger = {
			OR = {
				has_trait = gregarious
				has_trait = trusting
				has_trait = honest
				has_trait = rakish
			}
		}
		stress_impact = {
			base = major_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
}

lotr_thani_hazad.1020 = { # Wine tasting
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1020.t
	desc = lotr_thani_hazad.1020.desc
	theme = party
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = happy
	}
	option = { # Let's drink!
		name = lotr_thani_hazad.1020.a
		stress_impact = {
			base = major_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		random_list = {
			95 = {
				add_prestige = 25
			}
			5 = { 
				add_prestige = 25
				add_trait = drunkard
			}
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # Just a small dignified taste.
		name = lotr_thani_hazad.1020.b
		trigger = {
			NOR = {
				has_trait = drunkard
				has_trait = gluttonous
			}
		}
		add_prestige = 50
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # No, this isn't my style
		name = lotr_thani_hazad.1020.c
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
}

lotr_thani_hazad.1030 = { # Portrait painting
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1030.t
	desc = lotr_thani_hazad.1030.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = happy
	}
	option = { # Let's do it!
		name = lotr_thani_hazad.1030.a
		stress_impact = {
			base = minor_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		remove_short_term_gold = 30
		add_prestige = 150
		add_legitimacy = 20
		root.dynasty = { add_dynasty_prestige = 50 }
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # What about I pay you with, uh, exposure?
		name = lotr_thani_hazad.1030.b
		trigger = {
			OR = {
				has_trait = greedy
				has_trait = poet
			}
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		add_prestige = 50
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # No, this isn't my style
		name = lotr_thani_hazad.1030.c
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
}

lotr_thani_hazad.1040 = { # Exotic Bird demonstration
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1040.t
	desc = lotr_thani_hazad.1040.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = happy
	}
	option = { # How marvellous!
		name = lotr_thani_hazad.1040.a
		stress_impact = {
			base = minor_stress_impact_loss
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # I must have it!
		name = lotr_thani_hazad.1040.b
		trigger = {
			OR = {
				has_trait = arrogant
				has_trait = eccentric
			}
		}
		scope:stormhost_spy = {
			add_opinion = {
				modifier = pleased_opinion
				opinion = 50
				target = root
			}
		}
		add_prestige = 300
		remove_short_term_gold = 25
		root.dynasty = { add_dynasty_prestige = 50 }
		stress_impact = {
			base = medium_stress_impact_loss
		}
		trigger_event = { # Spy gained a bit of your trust
			id = lotr_thani_hazad.1100
			days = { 60 120 }
		} 
	}
	option = { # No, this isn't my style
		name = lotr_thani_hazad.1040.c
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
}

lotr_thani_hazad.1100 = { # Spy attempts to make their move
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1100.t
	desc = lotr_thani_hazad.1100.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = personality_content 
	}
	#immediate = {
	#}
	option = { # Sure, I'll make you my spymaster. What could go wrong?
		name = lotr_thani_hazad.1100.a
		assign_councillor_type = {
			type = councillor_spymaster
			target = scope:stormhost_spy
			remove_existing_councillor = yes
		}
		trigger_event = { # The spy will try to fulfill his mission
			id = lotr_thani_hazad.1150
			days = { 60 180 }
		}
	}
	option = { # What? No!
		name = lotr_thani_hazad.1100.b
		trigger_event = { # Time passes...
			id = lotr_thani_hazad.1200
			days = { 60 180 }
		}
	}
	
	option = { # I don't trust you!
		name = lotr_thani_hazad.1001.c
		trigger = {
			OR = {
				has_trait = paranoid
				has_trait = shrewd
				has_trait = deceitful
				has_trait = schemer
			}
		}
		imprison = {
			target = scope:stormhost_spy
			type = dungeon
		}
		add_character_flag = imprisoned_stomhost_spy
		stress_impact = {
			base = minor_stress_impact_loss
		}
		trigger_event = { # You find out they were a spy
			id = lotr_thani_hazad.1200
			days = 15
		}
	}
}

lotr_thani_hazad.1150 = { # The spy tries to fulfill his mission
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1150.t
	theme = intrigue
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = { has_character_flag = spy_made_their_move }
				}
				desc = lotr_thani_hazad.1150.desc.new
			}
			desc = lotr_thani_hazad.1150.desc
		}
	}
	left_portrait = {
		character = root
		animation = personality_content
	}
	right_portrait = {
		character = scope:stormhost_spy
		animation = spymaster 
	}
	lower_center_portrait = { 
		character = scope:stormking
	}
	immediate = {
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormking }
	}
	option = { # Become the stormking's tributary? Sounds great!
		name = lotr_thani_hazad.1150.a
		custom_tooltip = event_thani_hazad_1155_a
        make_tributary = {
			TYPE = tributary_permanent
			TRIBUTARY = root
			SUZERAIN = scope:stormking
		}	
	}
	option = { # No! What a terrible idea!
		name = lotr_thani_hazad.1150.b
		scope:stormhost_spy = {
			add_opinion = {
				modifier = annoyed_opinion
				opinion = -10
				target = root
			}
		}
		trigger_event = { # The spy will try again
			id = lotr_thani_hazad.1150
			days = { 60 180 }
		}
		add_character_flag = spy_made_their_move
	}
	
	option = { # It's treason, then...
		name = lotr_thani_hazad.1150.c
		imprison = {
			target = scope:stormhost_spy
			type = dungeon
		}
		add_character_flag = imprisoned_stomhost_spy
		stress_impact = {
			base = minor_stress_impact_loss
		}
		trigger_event = { # You find out they were a spy
			id = lotr_thani_hazad.1200
			days = 15
		}
	}
}

lotr_thani_hazad.1200 = { # You find out the truth
	content_source = realms_dlc
	type = character_event
	title = lotr_thani_hazad.1200.t
	theme = intrigue
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = { has_character_flag = imprisoned_stomhost_spy }
				}
				desc = lotr_thani_hazad.1200.desc.new
			}
			desc = lotr_thani_hazad.1200.desc
		}
	}
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:spymaster
		animation = spymaster
	}
	lower_center_portrait = {
		character = scope:stormhost_spy
	}
	immediate = {
		root.cp:councillor_spymaster = { save_scope_as = spymaster }
		title:e_thon_an_kharlokh.holder = { save_scope_as = stormking }
	}
	option = { #execute them
		name = lotr_thani_hazad.1200.a
		scope:stormhost_spy = {
			death = {
				killer = root
				death_reason = death_execution
			}
		}
		add_prestige = 250
		add_legitimacy = 10
	}
	option = { # Show mercy, banish them
		name = lotr_thani_hazad.1200.b
		trigger = {
			OR = {
				has_trait = compassionate
				has_trait = forgiving
				has_trait = trusting
			}
		}
		release_from_prison = scope:stormhost_spy
		banish = scope:stormhost_spy
		add_piety = 200
		add_prestige = 100
		stress_impact = {
			base = major_stress_impact_loss
		}
	}
	option = { # Turn them into double agent
		name = lotr_thani_hazad.1200.c
		trigger = {
			OR = {
				has_trait = shrewd
				has_trait = deceitful
				has_trait = schemer
			}
		}
		add_intrigue_lifestyle_xp = 500
		add_legitimacy = 10
		release_from_prison = scope:stormhost_spy
		scope:stormhost_spy = {
			set_employer = root
		}
	}
}
