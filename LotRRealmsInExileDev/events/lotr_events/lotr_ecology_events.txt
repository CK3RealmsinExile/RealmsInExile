namespace = ecology

# ecology.0001-0099 - Lynx
# ecology.0100-0199 - Wolf
# ecology.0200-0299 - Spider
# ecology.0300-0399 - Drake

############################
########### Lynx ###########
############################

ecology.0001 = { ## Banshie in the Night
	content_source = realms_dlc
	type = character_event
	title = ecology.0001.t
	desc = ecology.0001.desc
	theme = witchcraft

	right_portrait = {
		character = root
		animation = paranoia
	}
	
	
	trigger = {
		
			capital_province = {
				
				geographical_region = ecology_lynx
			}
				
		
		
	}
	
	override_background = {
		reference = wilderness_forest_pine
	}
	
	immediate = { 
		
		

		
	}

	option = { 
		name = ecology.0001.a
		
		trigger = {
			NOT = { has_character_flag = knows_lynx }
		}
		
		duel = {
				skill = learning
				value = 10
				40 = {
					custom_tooltip = { text = no_explaination }
					add_stress = 10
				}
				
				20 = {
					custom_tooltip = { text = found_lynx }
					compare_modifier = {
						value = scope:duel_value
						multiplier = 3.5
						min = -49
					}
					add_stress = -10
					add_character_flag = knows_lynx
				}
			}
		
		
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	
	option = { 
		name = ecology.0001.b
		
		trigger = {
			has_character_flag = knows_lynx
		}
		
		add_stress = -10
		
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	
	
	
	after = {
		
	}

	
}

############################
########### Wolf ###########
############################

ecology.0110 = { ## Wolf killing peasants
	content_source = realms_dlc
	type = character_event
	title = ecology.0110.t
	desc = ecology.0110.desc
	theme = death
	
	

	right_portrait = {
		character = root
		animation = shock
	}
	lower_left_portrait = {
		character = scope:marshal
		animation = marshal
	}
	
	
	
	trigger = {
		any_sub_realm_county = {
			any_county_province = {
				
				geographical_region = ecology_wolf
			}
			holder = root
		}
		NOT = {
			any_sub_realm_county = { 
				has_county_modifier = beast_attack_modifier 
				holder = root
			}	
			has_character_flag = recent_big_wolf_attack
		}
		
	}
	
	override_background = {
		reference = wilderness_forest_deep
	}
	
	immediate = { 
		
		random_sub_realm_county = {
			limit = {
				any_county_province = {
					geographical_region = ecology_wolf
					
				}
				holder = root
			}
			save_scope_as = disaster_county
			add_county_modifier = beast_attack_modifier
		}
		
		if = {
			limit = {
				exists = root.cp:councillor_marshal
			}
			root.cp:councillor_marshal = { save_scope_as = marshal }
		}
		
	}


	
	option = { ### Personally travel to deal with it
		name = ecology.0110.a 
		
		start_travel_plan = {
			destination = scope:disaster_county.title_province
			on_arrival_event  = ecology.0111
			return_trip = yes
			players_use_planner = no
			on_arrival_destinations = all_but_last
		}
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	option = { ### Send Marshal
		name = ecology.0110.b
		trigger = {
			exists = root.cp:councillor_marshal
			root.cp:councillor_marshal = {
				is_imprisoned = no
				is_available_adult = yes
			}
		}
		
		root.cp:councillor_marshal = {
			start_travel_plan = {
				destination = scope:disaster_county.title_province
				on_arrival_event  = ecology.0111
				return_trip = yes
				players_use_planner = no
				on_arrival_destinations = all_but_last
			}	
		}
		
		
		
		
		ai_chance = {
			base = 100
			
		}
	}
	
	option = { ### Do Nothing
		name = ecology.0110.c 
		
		
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	after = {
		
		add_character_flag = { flag = recent_big_wolf_attack years = 25 }
	}

	
}

ecology.0111 = { ## Arrival and Investigation
	content_source = realms_dlc
	type = character_event
	title = ecology.0111.t
	desc = ecology.0111.desc
	theme = death
	
	

	right_portrait = {
		character = root
		animation = marshal
	}
	
	
	
	override_background = {
		reference = wilderness_forest_deep
	}
	
	immediate = { 
		
		location.county = {
			save_scope_as = disaster_county
		}
		if = {
			limit = {
				has_council_position = councillor_marshal
			}
		
			liege = {
				trigger_event = ecology.0112
			}
		}
		
	}


	
	option = { ### Personally travel to deal with it
		name = ecology.0111.a 
		
		random_list = {
			95 = {
				trigger_event = ecology.0113
			}
		}
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	
	
	after = {
		
		
	}

	
}

ecology.0112 = { ## Liege Notice
	content_source = realms_dlc
	type = character_event
	title = ecology.0112.t
	desc = ecology.0112.desc
	theme = death
	
	

	right_portrait = {
		character = scope:marshal
		animation = marshal
	}
	
	
	
	override_background = {
		reference = wilderness_forest_deep
	}
	
	immediate = { 
		
		root.cp:councillor_marshal = { save_scope_as = marshal }
		
		
	}


	
	option = { ### Personally travel to deal with it
		name = ecology.0112.a 
		
		
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	
	
	after = {
		
		
	}

	
}

ecology.0113 = { ## Wolf found
	content_source = realms_dlc
	type = character_event
	title = ecology.0113.t
	desc = ecology.0113.desc
	theme = death
	
	

	right_portrait = {
		character = root
		animation = marshal
	}
	
	
	
	override_background = {
		reference = wilderness_forest_deep
	}
	
	immediate = { 
		every_realm_county = {
			limit = {
				has_county_modifier = beast_attack_modifier
			}
			remove_county_modifier = beast_attack_modifier
			add_county_modifier = wolf_attack_modifier
		}
		
		
	}


	
	option = { ### Fight!
		name = ecology.0113.a 
		
		duel = {
			skill = prowess
			value = high_skill_rating
			20 = {
				desc = ecology.0113.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
				root = {
					send_interface_toast = {
						title = ecology.0113.success
						left_icon = root
						root = { add_prestige = medium_prestige_gain }
					}
				
					
					
					trigger_event = ecology.0115
						
					
					
					
					
					
				}
				min = 1
			}
			15 = {
				desc = ecology.0113.wound
				trigger = {
					NOT = {
						has_trait_rank = {
							trait = wounded
							rank > 1
						}
					}
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				root = {
					send_interface_toast = {
						title = ecology.0113.wound
						left_icon = root
						root = {
							hunt_animal_wound_effect = { VARIABLE = flag:wolf }
						}
					}
					
					trigger_event = ecology.0115
					
				}
				min = 3
			}
			5 = {
				desc = ecology.0113.failure
				trigger = {
					cannot_be_killed = no #lotr
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				root = {
					send_interface_toast = {
						title = ecology.0113.failure
						left_icon = root
						root = {
							death = { death_reason = death_slain_by_fell_beast }
						}
					}
					
					root.primary_title.holder = {
						trigger_event = ecology.0116
					}
					
					
				}
				min = 2
				modifier = {
					add = -30
					is_elf = yes
				}
			}
		}
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	
	
	after = {
		
		
	}

	
}

ecology.0115 = { ## Sucess! 
	content_source = realms_dlc
	type = character_event
	title = ecology.0115.t
	desc = ecology.0115.desc
	theme = death
	
	

	right_portrait = {
		character = root
		animation = happiness
	}
	
	
	
	override_background = {
		reference = wilderness_forest_deep
	}
	
	immediate = { 
		
		
		
		
	}


	
	option = { ### Personally travel to deal with it
		name = ecology.0115.a 
		
		if = {
			limit = {
				any_sub_realm_county = {
					has_county_modifier = werewolf_attack_modifier
				}
			}
			add_prestige = major_prestige_value
			give_nickname = nick_werewolf_slayer
		}
		add_prestige = minor_prestige_value
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	
	
	after = {
		every_realm_county = {
			limit = {
				OR = {
					has_county_modifier = beast_attack_modifier
					has_county_modifier = wolf_attack_modifier
					has_county_modifier = werewolf_attack_modifier
				}
			}
			remove_county_modifier = beast_attack_modifier
			remove_county_modifier = wolf_attack_modifier
			remove_county_modifier = werewolf_attack_modifier
		}
		
	}

	
}

ecology.0116 = { ## Failure! 
	content_source = realms_dlc
	type = character_event
	title = ecology.0116.t
	desc = ecology.0116.desc
	theme = death
	
	

	right_portrait = {
		character = root
		animation = happiness
	}
	
	
	
	override_background = {
		reference = wilderness_forest_deep
	}
	
	immediate = { 
		
		root.cp:councillor_marshal = { save_scope_as = marshal }
		
		
	}


	
	option = { ### Personally travel to deal with it
		name = ecology.0116.a 
		
		
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	
	
	after = {
		
		
	}

	
}

############################
########## Spider ##########
############################

############################
########## Dragon ##########
############################

ecology.0300 = { ## Dragon Takes Livestock
	content_source = realms_dlc
	type = character_event
	title = ecology.0300.t
	desc = ecology.0300.desc
	theme = realm

	right_portrait = {
		character = root
		animation = anger
	}
	
	
	trigger = {
		any_sub_realm_county = {
			any_county_province = {
				NOT = { terrain = halls }
				geographical_region = ecology_drake
			}
				
		}
		
	}
	
	override_background = {
		reference = burning_building
	}
	
	immediate = { 
		
		random_sub_realm_county = {
			limit = {
				any_county_province = {
					geographical_region = ecology_drake
					NOT = { terrain = halls }
				}
			}
			save_scope_as = disaster_county
		}
		

		
	}

	option = { 
		name = ecology.0300.a
		
		
		
		scope:disaster_county = {
			add_county_modifier = { modifier = recently_looted_modifier years = 1 }
		}
		
		
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	
	option = { 
		name = ecology.0300.b
		
		remove_short_term_gold = major_gold_value
		scope:disaster_county = {
			add_county_modifier = { modifier = recently_looted_modifier months = 3 }
		}
		
		
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	
	
	
	after = {
		
	}

	
}

ecology.0301 = { ## Abandoned Hoard
	content_source = realms_dlc
	type = character_event
	title = ecology.0301.t
	desc = ecology.0301.desc
	theme = realm

	right_portrait = {
		character = root
		animation = shock
	}
	
	
	trigger = {
		any_sub_realm_county = {
			any_county_province = {
				
				geographical_region = ecology_drake
			}
				
		}
		
	}
	
	override_background = {
		reference = wilderness_underground
	}
	
	immediate = { 
		
		random_sub_realm_county = {
			limit = {
				any_county_province = {
					geographical_region = ecology_drake
					
				}
			}
			save_scope_as = disaster_county
		}
		

		
	}


	
	option = { 
		name = ecology.0301.a
		
		add_gold = major_gold_value
		
		
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	option = { 
		name = ecology.0301.b
		
		scope:disaster_county = {
			random_county_province = {
				limit = {
					free_building_slots >= 1
				}
				add_random_economic_building_effect = yes
			}
		}
		
		
		
		ai_chance = {
			base = 100
			
		}
	}
	
	
	
	after = {
		
	}

	
}

ecology.0302 = { ## Dragon Sighted
	content_source = realms_dlc
	type = character_event
	title = ecology.0302.t
	desc = ecology.0302.desc
	theme = realm

	right_portrait = {
		character = root
		animation = shock
	}
	
	
	trigger = {
		any_sub_realm_county = {
			any_county_province = {
				
				geographical_region = ecology_drake
			}
				
		}
		
	}
	
	override_background = {
		reference = smaug_arrive
	}
	
	immediate = { 
		
		
		

		
	}


	
	option = { 
		name = ecology.0302.a
		
		
		
		add_stress = 50
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	option = { 
		name = ecology.0302.b
		
		trigger = {
			OR = {
				has_faith = faith:dragon_cult
				has_faith = faith:faith_kerkassk
				has_faith = faith:faith_easterling_war
				has_faith = faith:faith_nlkum_kadir
				
			}
		}
		
		add_piety = major_piety_value
		
		ai_chance = {
			base = 100
			
		}
	}
	
	
	
	after = {
		random_list = {
			95 = {
			
			}
			5 = {
				trigger_event = {
					id = ecology.0300
					days = { 10 20 }
				}
			}
		}
	}

	
}

ecology.0303 = { ## Dragon Child
	content_source = realms_dlc
	type = character_event
	title = ecology.0303.t
	desc = ecology.0303.desc
	theme = realm
	
	orphan = yes

	right_portrait = {
		character = root
		animation = shock
	}
	left_portrait = {
		character = scope:cavechild
		animation = beg
	}
	
	
	
	trigger = {
		any_sub_realm_county = {
			any_county_province = {
				
				geographical_region = ecology_drake
			}
				
		}
		NOT = {
			has_character_flag = had_dragon_child
		}
	}
	
	override_background = {
		reference = wilderness_underground
	}
	
	immediate = { 
		
		random_sub_realm_county = {
			limit = {
				any_county_province = {
					geographical_region = ecology_drake
					
				}
			}
			save_scope_as = disaster_county
		}
		create_character = {
			location = root.location
			dynasty = none
			culture = root.culture
			faith = root.faith
			
			gender_female_chance = 50
			age = { 8 12 }
			random_traits = yes
			after_creation = {
				#set_to_lowborn = yes
				#give_nickname = nick_dragon_child 
				add_trait = intellect_good_1
				remove_trait = peasant_leader
			}
			save_scope_as = cavechild
		}

		
	}


	
	option = { 
		name = ecology.0303.a
		
		
		
		stress_impact = {
			compassionate = medium_stress_impact_gain
			sadistic = medium_stress_impact_loss
		}
		
		ai_chance = {
			base = 100 
			
		}
	}
	
	option = { 
		name = ecology.0303.b
		
		stress_impact = {
			compassionate = medium_stress_impact_loss
			sadistic = medium_stress_impact_gain
		}
		add_courtier = scope:cavechild
		
		
		
		
		
		ai_chance = {
			base = 100
			
		}
	}
	
	
	
	after = {
		add_character_flag = had_dragon_child
	}

	
}