namespace = lotr_khy

lotr_khy.0001 = { #Vision Under the Noon Sun - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0001.t
	desc = lotr_khy.0001.desc
	theme = court

    left_portrait = {
		character = root
		animation = steward
	}
    right_portrait = {
		character = scope:random_mystic
		animation = zealous
	}

    trigger = {
        any_courtier = {
            learning > 10
        }
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        random_courtier = {
            limit = { learning > 10 }
            save_scope_as = random_mystic
        }
    }

    option = { #Proclaim the vision as truth to the faithful
        name = lotr_khy.0001.a

        add_piety = minor_piety_gain

        cp:councillor_court_chaplain = {
            add_opinion = {
                target = scope:random_mystic
                modifier = lotr_proclaimed_truthful_vision_lore_master_pov
            }
        }
        reverse_add_opinion = {
            target = scope:random_mystic
            modifier = lotr_proclaimed_truthful_vision
        }
    }

    option = { #Order the mystic quietly returned to obscurity
        name = lotr_khy.0001.b
        cp:councillor_court_chaplain = {
            add_opinion = {
                target = scope:random_mystic
                modifier = lotr_lore_master_pov
            }
        }
    }
}

lotr_khy.0002 = { #The Quiet Heretic - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0002.t
	desc = lotr_khy.0002.desc
	theme = court

    override_background = { reference = market }

    left_portrait = {
		character = root
		animation = callous
	}
    right_portrait = {
		character = scope:random_preacher
		animation = zealous
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        faith.religion = {
            random_faith = { 
                limit = { NOT = { this = root.faith } }
                save_scope_as = random_faith
            }
        }
        create_character = {
            template = default_mystic_character
            faith = scope:random_faith
            culture = root.culture
            location = root.location
            save_scope_as = random_preacher
        }
        root.location.county.title_province = { save_scope_as = location_county }
    }

    option = { #Dispatch agents to arrest the heretic immediately
        name = lotr_khy.0002.a

        scope:location_county.county = {
            add_county_modifier = {
                modifier = lotr_removed_preaching_preacher
                years = 5
            }
        }
        add_piety = minor_piety_gain
    }

    option = { #Invite Random Preacher to debate at my court, publicly.
        name = lotr_khy.0002.b

        duel = {
			skill = learning
			value = average_skill_rating
			50 = {		
				compare_modifier = {					
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = lotr_khy.0002.b.success
				send_interface_toast = {
					left_icon = ROOT
					title = lotr_khy.0002.toast.b.success
					add_piety = major_piety_gain
				}	
			}
			50 = {		
				compare_modifier = {					
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = lotr_khy.0002.b.failure
				send_interface_toast = {
					left_icon = ROOT
					title = lotr_khy.0002.toast.b.failure
					add_piety = minor_piety_loss
				}	
			}
		}
    }
}

lotr_khy.0003 = { #The Forgotten Scroll - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0003.t
	desc = lotr_khy.0003.desc
	theme = court

    left_portrait = {
		character = root
		animation = reading
	}
    right_portrait = {
		character = cp:councillor_court_chaplain
		animation = personality_rational
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    option = { #Seal the scroll once more in the archives
        name = lotr_khy.0003.a
    }

    option = { #Allow scholars to copy and study its contents
        name = lotr_khy.0003.b

        add_piety = minor_piety_gain

        cp:councillor_court_chaplain = {
            add_opinion = {
                target = root
				modifier = annoyed_opinion
				opinion = -25
            }
        }
    }

    option = { #Declare the text forbidden and destroy it
        name = lotr_khy.0003.c

        add_piety = minor_piety_loss

        cp:councillor_court_chaplain = {
            add_opinion = {
                target = root
				modifier = relieved_opinion
				opinion = 25
            }
        }
    }
}

lotr_khy.0004 = { #Rider’s Rite of the Mountain Paths - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0004.t
	desc = lotr_khy.0004.desc
	theme = court

    left_portrait = {
		character = root
		animation = interested
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        random_sub_realm_county = {
            limit = { 
                title_province = {
                    OR = {
                        terrain = hills
                        terrain = mountains
                        terrain = desert_mountains
                    }
                }
            }
            save_scope_as = random_mountainous_county
        }
    }

    option = {
        name = lotr_khy.0004.a
        scope:random_mountainous_county = {
            add_county_modifier = {
                modifier = lotr_riders_rite_attended
                years = 5
            }
        }
        add_prestige = minor_prestige_gain
        scope:random_mountainous_county.holder = {
            add_opinion = {
                target = root
                modifier = disappointed_opinion
                opinion = -15
            }
        }
    }

    option = {
        name = lotr_khy.0004.b
        # Reduced cost for tradition: TODO
    }

    option = {
        name = lotr_khy.0004.c
        add_prestige = medium_prestige_gain
        scope:random_mountainous_county = {
            add_county_modifier = {
                modifier = lotr_riders_rite_refused
                years = 5
            }
        }
    }
}

lotr_khy.0005 = { #The Painted Mare - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0005.t
	desc = lotr_khy.0005.desc
	theme = court

    left_portrait = {
		character = root
		animation = reading
	}
    right_portrait = {
		character = scope:merchant
		animation = personality_rational
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        create_character = {
            template = merchant_template
            culture = root.culture
            faith = root.faith
            location = root.location
            save_scope_as = merchant
        }
    }

    option = {
        name = lotr_khy.0005.a
        remove_short_term_gold = medium_gold_value
        add_character_modifier = {
            years = 10
            modifier = lotr_bought_painted_horses
        }
    }

    option = {
        name = lotr_khy.0005.b
        add_gold = minor_gold_value
    }

    option = {
        name = lotr_khy.0005.c
        duel = {
			skill = stewardship 
			value = 12
			80 = { #win
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					max = 15
				}
				
                send_interface_toast = {
					left_icon = ROOT
					title = lotr_khy.0005.toast.c.success
					remove_short_term_gold = major_gold_value
                    add_character_modifier = {
                        years = 10
                        modifier = lotr_bought_painted_horses
                    }
				}
			}
			20 = { #fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -15
				}
				
                send_interface_toast = {
					left_icon = ROOT
					title = lotr_khy.0005.toast.c.failure
                    remove_short_term_gold = minor_gold_value
                    add_character_modifier = {
                        years = 10
                        modifier = lotr_bought_painted_horses
                    }
				}
			}
		}
    }
}

lotr_khy.0006 = { #The Lost Studbook - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0006.t
	desc = lotr_khy.0006.desc
	theme = court

    left_portrait = {
		character = root
		animation = interested
	}
	artifact = {
		position = lower_right_portrait
		target = scope:newly_created_artifact
		trigger = { exists = scope:newly_created_artifact }
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        create_artifact = {
            name = lotr_khy.0006.studbook_name
            description = lotr_khy.0006.studbook_desc
            type = journal
            visuals = indian_book
            wealth = 25
			quality = 50
            modifier = lotr_finer_horse_breeds_stud_book
            save_scope_as = newly_created_artifact
        }
    }

    option = {
        name = lotr_khy.0006.a
        remove_short_term_gold = major_gold_value
        add_character_modifier = {
            modifier = lotr_finer_horse_breeds
            years = 15
        }
        show_as_tooltip = {
            create_artifact = {
                name = lotr_khy.0006.studbook_name
                description = lotr_khy.0006.studbook_desc
                type = journal
                visuals = indian_book
                wealth = 25
                quality = 50
                modifier = lotr_finer_horse_breeds_stud_book
            }
        }
    }

    option = {
        name = lotr_khy.0006.b
        remove_short_term_gold = medium_gold_value
        show_as_tooltip = {
            create_artifact = {
                name = lotr_khy.0006.studbook_name
                description = lotr_khy.0006.studbook_desc
                type = journal
                visuals = indian_book
                wealth = 25
                quality = 50
                modifier = lotr_finer_horse_breeds_stud_book
            }
        }
    }

    option = {
        name = lotr_khy.0006.c
        destroy_artifact = scope:newly_created_artifact
    }
}

lotr_khy.0007 = { #Council of Shadows - TBD
    orphan = yes
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0007.t
	desc = lotr_khy.0007.desc
	theme = court

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    option = {
        name = lotr_khy.0007.a
        # 
        # 
        # 
    }
}

lotr_khy.0008 = { #The Warden’s Penance - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0008.t
	desc = lotr_khy.0008.desc
	theme = court

    left_portrait = {
		character = root
		animation = thinking
	}
    right_portrait = {
		character = scope:province_ruler
		animation = personality_rational
        trigger = { exists = scope:province_ruler }
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        random_sub_realm_county = {
            limit = { NOT = { has_county_modifier = lotr_administrator_working_as_peasant } }
            save_scope_as = province_scope
            holder = { save_scope_as = province_ruler }
        }
    }

    option = {
        name = lotr_khy.0008.a
        add_prestige = medium_prestige_gain
        scope:province_scope = {
            add_county_modifier = {
                modifier = lotr_administrator_working_as_peasant
                years = 5
            }
        }
    }

    option = {
        name = lotr_khy.0008.b
        scope:province_ruler = {
            add_opinion = {
				target = root
				modifier = disappointed_opinion
				opinion = -20
            }
        }
        scope:province_scope = {
            add_county_modifier = {
                modifier = lotr_administrator_working_returned_to_work
                years = 5
            }
        }
    }

    option = {
        name = lotr_khy.0008.c
        add_prestige = minor_prestige_gain
        scope:province_scope = {
            add_county_modifier = {
                modifier = lotr_administrator_private_counsel
                years = 5
            }
        }
    }
}

lotr_khy.0009 = { #Sackcloth and Statues - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0009.t
	desc = lotr_khy.0009.desc
	theme = court

    left_portrait = {
		character = root
		animation = callous
	}
    right_portrait = {
		character = scope:random_city_holder
		animation = personality_rational
        trigger = { exists = scope:random_city_holder }
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        random_sub_realm_county = {
            limit = { is_coastal_county = no }
            save_scope_as = random_city
            holder = { save_scope_as = random_city_holder }
        }
    }

    option = {
        name = lotr_khy.0009.a
        scope:random_city.county = {
            add_county_modifier = {
                modifier = lotr_embrace_county_humility
                years = 5
            }
        }
        add_piety = minor_piety_gain
    }

    option = {
        name = lotr_khy.0009.b
        scope:random_city.county = {
            add_county_modifier = {
                modifier = lotr_sackcloth_and_statues_county
                years = 5
            }
        }
    }

    option = {
        name = lotr_khy.0009.c
        scope:random_city_holder ?= {
            add_opinion = {
                target = root
				modifier = annoyed_opinion
				opinion = -15
            }
        }
    }
}

lotr_khy.0010 = { #The Stone Court - TBD
    orphan = yes
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0010.t
	desc = lotr_khy.0010.desc
	theme = court

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    option = {
        name = lotr_khy.0010.a
        # 
        # 
        # 
    }
}

lotr_khy.0011 = { #Tide of Foreigners - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0011.t
	desc = lotr_khy.0011.desc
	theme = court

    left_portrait = {
		character = root
		animation = personality_rational
	}

    lower_left_portrait = {
		character = scope:vassal_1
		trigger = { exists = scope:vassal_1 }
	}
    lower_center_portrait = {
		character = scope:vassal_2
		trigger = { exists = scope:vassal_2 }
	}
    lower_right_portrait = {
		character = scope:vassal_3
		trigger = { exists = scope:vassal_3 }
	}

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        random_sub_realm_county = {
            limit = { is_coastal_county = yes }
            title_province = { save_scope_as = coastal_city }
        }
        random_vassal = {
            limit = { 
                highest_held_title_tier > tier_barony
                NOT = { any_sub_realm_county = { is_coastal_county = yes } }
            }
            save_scope_as = vassal_1
        }
        random_vassal = {
            limit = { 
                highest_held_title_tier > tier_barony
                NOT = { any_sub_realm_county = { is_coastal_county = yes } }
                NOT = { this = scope:vassal_1 }
            }
            save_scope_as = vassal_2
        }
        random_vassal = {
            limit = { 
                highest_held_title_tier > tier_barony 
                NOT = { any_sub_realm_county = { is_coastal_county = yes } }
                NOR = {
                    this = scope:vassal_1
                    this = scope:vassal_2
                }
            }
            save_scope_as = vassal_3
        }
    }

    option = {
        name = lotr_khy.0011.a
        add_piety = medium_piety_gain
        add_character_modifier = {
            years = 5
            modifier = lotr_expelled_foreigners_from_khy
        }
        scope:vassal_1 ?= {
            add_opinion = {
                target = root
                modifier = respect_opinion
                opinion = 20
            }
        }
        scope:vassal_2 ?= {
            add_opinion = {
                target = root
                modifier = respect_opinion
                opinion = 20
            }
        }
        scope:vassal_3 ?= {
            add_opinion = {
                target = root
                modifier = respect_opinion
                opinion = 20
            }
        }
    }

    option = {
        name = lotr_khy.0011.b
        add_character_modifier = {
            modifier = lotr_foreigners_permitted
            years = 10
        }
        add_piety = minor_piety_gain
    }

    option = {
        name = lotr_khy.0011.c
        add_character_modifier = {
            modifier = lotr_foreigners_embraced
            years = 10
        }
        add_piety = minor_piety_loss
    }
}

lotr_khy.0012 = { #Salt in the Citadel - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0012.t
	desc = lotr_khy.0012.desc
	theme = court

    left_portrait = {
		character = root
		animation = personality_rational
	}

    lower_left_portrait = {
        character = scope:coastal_vassal
        trigger = { exists = scope:coastal_vassal }
    }

    lower_right_portrait = {
        character = scope:landlocked_vassal
        trigger = { exists = scope:landlocked_vassal }
    }

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        random_vassal_or_below = {
            limit = { any_held_county = { is_coastal_county = yes } }
            save_scope_as = coastal_vassal
        }
        random_vassal_or_below = {
            limit = { 
                any_held_county = { is_coastal_county = no } 
                NOT = { this = scope:coastal_vassal } 
            }
            save_scope_as = landlocked_vassal
        }
    }

    option = {
        name = lotr_khy.0012.a
        scope:coastal_vassal = {
            add_opinion = {
                target = root
				modifier = annoyed_opinion
				opinion = -25
            }
        }
        scope:landlocked_vassal = {
            add_opinion = {
                target = root
				modifier = relieved_opinion
				opinion = 25
            }
        }
        add_character_modifier = {
            modifier = lotr_salt_market_settles_naturally
            years = 5 
        }
    }

    option = {
        name = lotr_khy.0012.b
        scope:coastal_vassal = {
            add_opinion = {
                target = root
				modifier = relieved_opinion
				opinion = 25
            }
        }
        scope:landlocked_vassal = {
            add_opinion = {
                target = root
				modifier = annoyed_opinion
				opinion = -25
            }
        }
    }

    option = {
        name = lotr_khy.0012.c
        duel = {
			skill = diplomacy 
			value = 12
			50 = { #Win
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					max = 15
				}
                send_interface_toast = {
					left_icon = ROOT
					title = lotr_khy.0012.toast.c.success
					scope:coastal_vassal = {
                        add_opinion = {
                            target = root
                            modifier = relieved_opinion
                            opinion = 25
                        }
                    }
                    scope:landlocked_vassal = {
                        add_opinion = {
                            target = root
                            modifier = relieved_opinion
                            opinion = 25
                        }
                    }
                    add_character_modifier = {
                        modifier = lotr_salt_market_settles_naturally
                        years = 5 
                    }
				}
			}
			50 = { #fail
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -15
				}
                send_interface_toast = {
					left_icon = ROOT
					title = lotr_khy.0012.toast.c.failure
					scope:coastal_vassal = {
                        add_opinion = {
                            target = root
                            modifier = annoyed_opinion
                            opinion = -25
                        }
                    }
                    scope:landlocked_vassal = {
                        add_opinion = {
                            target = root
                            modifier = annoyed_opinion
                            opinion = -25
                        }
                    }
                    add_character_modifier = {
                        modifier = lotr_salt_market_out_of_control
                        years = 5 
                    }
				}
			}
		}
    }
}

lotr_khy.0013 = { #The Widow’s Ascension - TBD
    orphan = yes
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0013.t
	desc = lotr_khy.0013.desc
	theme = court

    trigger = {
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    option = {
        name = lotr_khy.0013.a
        # 
        # 
        # 
    }
}

lotr_khy.0014 = { #The Sun’s Reflection - Done
	content_source = realms_dlc
	type = character_event
	title = lotr_khy.0014.t
	desc = lotr_khy.0014.desc
	theme = court

    trigger = {
        any_spouse = {
            count > 0
            OR = {
                has_trait = lunatic
                has_trait = possessed
            }
        }
        any_held_county = {
            any_county_province = {
				geographical_region = middleearth_harad_bayoformal_khy
			}
        }
        culture = { has_cultural_pillar = heritage_north_khailuza }
    }

    immediate = {
        random_spouse = {
            limit = {
                OR = {
                    has_trait = lunatic
                    has_trait = possessed
                }
            }
            save_scope_as = possessed_consort
        }
        faith.religion = {
            random_faith = {
                limit = { NOT = { this = root.faith } }
                save_scope_as = possessed_consort_faith
            }
        }
    }

    option = {
        name = lotr_khy.0014.a
        divorce_effect = {
            DIVORCER = root
            DIVORCEE = scope:possessed_consort
        }
        add_piety = minor_piety_gain
        
        every_spouse = {
            add_opinion = {
                target = root
				modifier = relieved_opinion
				opinion = 25
            }
        }
    }

    option = {
        name = lotr_khy.0014.b
        every_spouse = {
            limit = { NOT = { this = scope:possessed_consort } }
            add_opinion = {
                target = root
                modifier = disrespect_opinion
                opinion = -30
            }
        }
        scope:possessed_consort = {
            add_opinion = {
                target = root
				modifier = impressed_opinion
				opinion = 25
            }
            make_character_crypto_religionist_effect = { CRYPTO_RELIGION = scope:possessed_consort_faith }
        }
    }
}