namespace = elven

### Elven Events ###
##	Introduction Events
#			elven.0101-0103	Galadriel , Aragorn, and the Elessar
#			elven.0150-0152	Parth Celebrant/Lorien Events
#			elven.0300-0350	Enter/Leave Realm Events
#			elven.0700-0899	Decision Events     

### Galadriel's Gift to Aragorn Events ###

elven.0101 = { #Elessar as a Grand Wedding present - Actor
	content_source = realms_dlc
	type = character_event
	type = activity_event
	title = elven.0101.t
	desc = elven.0101.desc
	theme = marriage
	override_background = {
		reference = ep2_wedding_ceremony_western
	}
	left_portrait = {
		character = root
		animation = personality_forgiving
	}
	right_portrait = {
		character = character:lineisildur42
		animation = happiness
	}
	
	cooldown = { years = 10 }
	
	trigger = {
		root = character:linefinwe36
		scope:activity.special_guest:spouse_1 = character:lineisildur42
		scope:activity.special_guest:spouse_2 = character:linefinwe30
		any_character_artifact = { has_variable = elessar }
	}
	
	immediate = {
		character:linefinwe36 = {
			save_scope_as = galadriel
		}
		character:lineisildur42 = {
			save_scope_as = aragorn
		}
		character:linefinwe30 = {
			save_scope_as = arwen
		}
	}
	
	option = {
		name = elven.0101.a
		character:lineisildur42 = {	
			trigger_event = {
				id = elven.0102
			}
		}
	}
	
	option = {
		name = elven.0101.b
		trigger = { is_ai = no }
		add_piety_level = -1
	}
}

elven.0102 = { #Elessar as a wedding present - Recipient
	type = activity_event
	title = elven.0102.t
	desc = elven.0102.desc
	theme = marriage
	override_background = {
		reference = ep2_wedding_ceremony_western
	}
	right_portrait = {
		character = root
		animation = happiness
	}
	left_portrait = {
		character = character:linefinwe36
		animation = personality_forgiving
	}

	cooldown = { years = 1 }
	
	option = {
		name = elven.0102.a
		character:linefinwe36 = {
			every_character_artifact = {
				limit = { has_variable = elessar }
				set_owner = {
					target = root
					history = {
						type = inherited
						recipient = root
					}
				}
			}
		}
	}
}

elven.0103 = { #Elessar as a normal wedding present - Actor
	title = elven.0101.t
	desc = elven.0101.desc
	theme = marriage
	override_background = {
		reference = ep2_wedding_ceremony_western
	}
	left_portrait = {
		character = root
		animation = personality_forgiving
	}
	right_portrait = {
		character = character:lineisildur42
		animation = happiness
	}

	trigger = { any_character_artifact = { has_variable = elessar } }
	
	option = {
		name = elven.0101.a
		character:lineisildur42 = {
			trigger_event = {
				id = elven.0102
			}
		}
	}
	
	option = {
		name = elven.0101.b
		trigger = { is_ai = no }
		add_piety_level = -1
	}
}

### Parth Celebrant Events ###

elven.0150 = { # Parth Celebrant receives elven envoy
	content_source = realms_dlc
	type = character_event
	title = elven.0150.t
	desc = elven.0150.desc
	theme = stewardship_duty_focus
	#trigger = { is_ai = yes }
	left_portrait = {
		character = root
		animation = personality_proud
	}
	right_portrait = {
		character = character:linefinwe36
		animation = personality_honorable
	}
	
	option = { 		#We submit, thank you. This will rekindle our claim to Drownholt!
		name = elven.0150.a
		trigger = { NOT = { has_title = title:d_drownholt } }
		custom_tooltip = elven.0150.att
			character:linefinwe36 = {
				if = {
					limit = {
						is_alive = yes
						is_landed = yes
						has_royal_court = yes
					}
					trigger_event = {
						id = elven.0153
						days = 10
					}
					save_scope_as = parthliege
				}
				if = {
					limit = {
						is_alive = yes
						is_landed = yes
						has_royal_court = no	#fallback if no RC
					}
					trigger_event = {
						id = elven.0151
						days = 10
					}
					save_scope_as = parthliege
				}
			}
			add_piety = 150
			
			add_pressed_claim = title:d_drownholt
			add_pressed_claim = title:c_thorlorien
			root.primary_heir = {
				add_pressed_claim = title:d_drownholt
				add_pressed_claim = title:c_thorlorien
			}
			save_scope_as = parthruler
			# create_title_and_vassal_change = {
				# type = swear_fealty
				# save_scope_as = change
			# }
			# scope:parthruler = {
				# change_liege = {
					# liege = scope:parthliege
					# change = scope:change
				# }
				# add_opinion = {
					# modifier = became_vassal
					# target = scope:parthliege
					# opinion = 10
				# }
			# }
			# resolve_title_and_vassal_change = scope:change
			hidden_effect = {
				scope:parthruler = {
					start_tributary = {
						contract_group = tributary_protectorate
						suzerain = title:k_lothlorien.holder
					}
				}
			}	
		
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 100
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 70
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
	
	option = { 		#We submit, thank you. We will gladly settle your southern borders.
		name = elven.0150.c
		trigger = { has_title = title:d_drownholt }
		custom_tooltip = elven.0150.c.tt
			character:linefinwe36 = {
				if = {
					limit = {
						is_alive = yes
						is_landed = yes
						has_royal_court = yes
					}
					trigger_event = {
						id = elven.0153
						days = 10
					}
					save_scope_as = parthliege
				}
				if = {
					limit = {
						is_alive = yes
						is_landed = yes
						has_royal_court = no	#fallback if no RC
					}
					trigger_event = {
						id = elven.0151
						days = 10
					}
					save_scope_as = parthliege
				}
			}
			add_piety = 150
			
			save_scope_as = parthruler
			# create_title_and_vassal_change = {
				# type = swear_fealty
				# save_scope_as = change
			# }
			# scope:parthruler = {
				# change_liege = {
					# liege = scope:parthliege
					# change = scope:change
				# }
				# add_opinion = {
					# modifier = became_vassal
					# target = scope:parthliege
					# opinion = 10
				# }
			# }
			# resolve_title_and_vassal_change = scope:change
			
			scope:parthruler = {
				start_tributary = {
					contract_group = tributary_protectorate
					suzerain = title:k_lothlorien.holder
				}
			}
			ai_colonisation_effect = { WASTELANDS = title:b_byre_tor ROOT_SCOPE = root }
			title:c_byre_tor.title_province = {
				set_holding_type = tribal_holding
			}
			
			ai_colonisation_effect = { WASTELANDS = title:b_glandagol ROOT_SCOPE = root }
			title:c_athraduin.title_province = {
				if = {
					limit = { NOT = { has_holding_type = tribal_holding } }
					set_holding_type = tribal_holding
				}
			}
		
			ai_chance = {
				base = 0 # LotR: This should be tied to WotR mode.
				modifier = { # Game Rule
					has_game_rule = default_ai_behavior
					add = 100
				}
				modifier = { # Game Rule
					has_game_rule = weighted_ai_behavior
					add = 70
				}
				modifier = { # Game Rule
					has_game_rule = random_ai_behavior
					add = 50
				}
			}
	}
	
	option = { 		#We won't bow to some fae lady! She was our neighbour for 100 years and never came by to say hi!
		name = elven.0150.b
		custom_tooltip = elven.0150.btt
			character:linefinwe36 = {
				if = {
					limit = {
						is_alive = yes
						is_landed = yes
					}
					trigger_event = {
						id = elven.0152
						days = 5
					}
				}
			}
			add_prestige = 250
			add_piety = -100
		
		ai_chance = {
			base = 0 # LotR: This should be tied to WotR mode.
			modifier = { # Game Rule
				has_game_rule = default_ai_behavior
				add = 0
			}
			modifier = { # Game Rule
				has_game_rule = weighted_ai_behavior
				add = 30
			}
			modifier = { # Game Rule
				has_game_rule = random_ai_behavior
				add = 50
			}
		}
	}
}

elven.0151 = { # Parth Celebrant submits, Galadriel informed about claim FALLBACK VAR
	content_source = realms_dlc
	type = character_event
	title = elven.0151.t
	desc = elven.0151.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = lorien_day
	}
	left_portrait = {
		character = root
		animation = personality_honorable
	}
	right_portrait = {
		character = title:d_parth_celebrant.holder
		animation = personality_proud
	}
	
	option = { 		#Well thats nice.
		name = elven.0151.a
		
		show_as_tooltip = {
			character:linefinwe36 = {
				save_scope_as = actor
			}
			title:d_parth_celebrant.holder	= {
				add_pressed_claim = title:d_drownholt
				add_pressed_claim = title:c_thorlorien
				root.primary_heir = {
					add_pressed_claim = title:d_drownholt
					add_pressed_claim = title:c_thorlorien
				}
				custom_tooltip = elven.0151.a.tt
				# create_title_and_vassal_change = {
					# type = swear_fealty
					# save_scope_as = change
				# }
				# scope:recipient = {
					# change_liege = {
						# liege = scope:actor
						# change = scope:change
					# }
					# add_opinion = {
						# modifier = became_vassal
						# target = scope:actor
						# opinion = 10
					# }
				# }
				# resolve_title_and_vassal_change = scope:change
				
			}
		}
	}
}

elven.0152 = { # Parth Celebrant doesnt submit, Galadriel informed
	content_source = realms_dlc
	type = character_event
	title = elven.0152.t
	desc = elven.0152.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = lorien_day
	}
	left_portrait = {
		character = root
		animation = personality_honorable
	}
	right_portrait = {
		character = title:d_parth_celebrant.holder
		animation = personality_proud
	}
	
	option = { 		#Well thats rude.
		name = elven.0152.a
	}
}

elven.0153 = { # Parth Celebrant submits, Galadriel informed about claim RC VAR
	content_source = realms_dlc
	type = character_event
	title = elven.0153.t
	desc = elven.0153.desc
	type = court_event
	theme = realm
	override_sound = { reference = event:/SFX/Events/Themes/sfx_event_theme_type_generic }
	court_scene = {
		button_position_character = scope:parthruler
		court_event_force_open = yes
		show_timeout_info = no
		should_pause_time = yes
		roles = {
			scope:parthruler = {
				group = petitioners_group
				animation = happiness
			}
		}
	}
	immediate = {
		if = { 	
			limit = {
				exists = title:d_drownholt.holder
				title:d_drownholt.holder = { faith_is_good = yes }
			}
			title:d_drownholt.holder = { save_scope_as = parthruler }
		}
		else = {
			title:d_parth_celebrant.holder = { save_scope_as = parthruler }
		}
	}
	option = { 		#Well thats nice.
		name = elven.0153.a
		if = {
			limit = { exists = title:d_parth_celebrant.holder }
			show_as_tooltip = {
				character:linefinwe36 = {
					save_scope_as = actor
				}
				title:d_parth_celebrant.holder	= {
					add_pressed_claim = title:d_drownholt
					add_pressed_claim = title:c_thorlorien
					root.primary_heir = {
						add_pressed_claim = title:d_drownholt
						add_pressed_claim = title:c_thorlorien
					}
					custom_tooltip = elven.0153.a.tt
					# create_title_and_vassal_change = {
						# type = swear_fealty
						# save_scope_as = change
					# }
					# scope:recipient ?= {
						# change_liege = {
							# liege = scope:actor
							# change = scope:change
						# }
						# add_opinion = {
							# modifier = became_vassal
							# target = scope:actor
							# opinion = 10
						# }
					# }
					# resolve_title_and_vassal_change = scope:change
				}
			}
		}
		else = {
			show_as_tooltip = {
				scope:parthruler = { 
					add_piety = 150 
				}
				custom_tooltip = elven.0153.a.tt
				# create_title_and_vassal_change = {
					# type = swear_fealty
					# save_scope_as = change
				# }
				# scope:parthruler = {
					# change_liege = {
						# liege = root
						# change = scope:change
					# }
					# add_opinion = {
						# modifier = became_vassal
						# target = root
						# opinion = 10
					# }
				# }
				# resolve_title_and_vassal_change = scope:change
			
				ai_colonisation_effect = { WASTELANDS = title:b_byre_tor ROOT_SCOPE = scope:parthruler }
				title:c_byre_tor.title_province = {
					set_holding_type = tribal_holding
				}
				
				ai_colonisation_effect = { WASTELANDS = title:b_glandagol ROOT_SCOPE = scope:parthruler }
				title:c_athraduin.title_province = {
					set_holding_type = tribal_holding
				}
			}
		}
	}
}

### Enter/Leave Realm Events ###

elven.0300 = { #Fall of Caras Caladhon
	content_source = realms_dlc
	type = character_event
	title = elven.0300.t
	desc = elven.0300.desc
	theme = battle
	trigger = { is_elf = yes }
	cooldown = { days = 3 }
	override_background = {
		reference = lorien_night
	}
	right_portrait = {
		character = root
		animation = shock
	}
	option = { #What a catastrophe
		name = elven.0300.a
		add_prestige = major_prestige_loss
	}
}

elven.0301 = { #Reclamation of Caras Caladhon
	content_source = realms_dlc
	type = character_event
	title = elven.0501.t
	desc = elven.0501.desc
	theme = battle
	trigger = { is_elf = yes }
	cooldown = { days = 3 }
	override_background = {
		reference = lorien_day
	}
	right_portrait = {
		character = root
		animation = happiness
	}
	option = { #We are so back
		name = elven.0301.a
		add_prestige = medium_prestige_gain
	}
}

### Decision Events ###

elven.0501 = { # Sirgala Decision Event
	content_source = realms_dlc
	type = character_event
	title = elven.0501.t
	desc = elven.0501.desc
	theme = stewardship_duty_focus
	right_portrait = {
		character = root
		animation = personality_proud
	}
	
	option = { # Become vassal of Elendil
		name = elven.0501.a
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
		}
		change_liege = {
			liege = title:e_arnor.holder
			change = scope:change
		}
		
		if = {
			limit = {
				title:k_sirgala.holder = {
					any_held_title = {
						NOT = { de_jure_liege = title:d_hyarromenya }
					}
				}
				any_vassal = {
					any_held_title = { this = title:d_hyarromenya }
				}
			}
			title:d_hyarromenya = { set_de_jure_liege_title = title:k_arthedain } 
		}

		resolve_title_and_vassal_change = scope:change
	}
	
	option = { # Stay vassal of Merethorn
		name = elven.0501.b
	}
} 

elven.0700 = { # Proclaim East Lórien
	content_source = realms_dlc
	type = character_event
	title = elven.0700.t
	desc = elven.0700.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = lorien_day
	}
	right_portrait = {
		character = root
		animation = personality_honorable
	}
	
	immediate = {
		play_music_cue = lotr_cue_elves
	}
	
	option = { 		
		name = elven.0700.a
		
		get_title = title:e_laurelindorenan
		title:k_amon_lanc = { set_de_jure_liege_title = title:e_laurelindorenan }
		title:d_drownholt = { set_de_jure_liege_title = title:k_lothlorien }
		custom_tooltip = claim_amon_lanc_for_laurelindorenan.amon_lanc_renamed_east_lorien
		title:k_amon_lanc = { set_title_name = cn_east_lorien }
		dynasty_light_of_the_forest = yes
		
		give_nickname = nick_lordlady_of_light

		if = {
			limit = {
				has_character_modifier = valar_ban_modifier
			}
			remove_character_modifier = valar_ban_modifier
		}

		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:claim_amon_lanc_for_laurelindorenan
		}

	}
}

elven.0701 = { # Destroy Dol Guldur
	content_source = realms_dlc
	type = character_event
	title = elven.0701.t
	desc = elven.0701.desc
	theme = war
	override_background = {
		reference = lorien_day
	}
	right_portrait = {
		character = root
		animation = marshal
	}
	
	immediate = {
		play_music_cue = lotr_cue_elves
		show_as_tooltip = {
			start_war = {
				casus_belli = destroy_dol_guldur_cb
				target = character:nazgul2
				target_title = title:d_amon_lanc
			}
		}
	}
	
	option = { 		
		name = elven.0701.a
	}
}

elven.0800 = {	# Ost in Edhil Reborn
	content_source = realms_dlc
	type = character_event
	title = elven.0800.t
	desc = elven.0800.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = eregion
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {
		name = elven.0800.a
	}
}

elven.0801 = {	# Reclaim Sîrgala Kingdom
	content_source = realms_dlc
	type = character_event
	title = elven.0801.t
	desc = elven.0801.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = eregion
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {
		name = elven.0801.a
	}
}

elven.0802 = {	# A New High-King
	content_source = realms_dlc
	type = character_event
	title = elven.0802.t
	desc = elven.0802.desc
	theme = crown
	override_background = {
		reference = eregion
	}

	left_portrait = {
		character = root
		animation = personality_honorable
	}

	option = {
		name = elven.0802.a
	}
}

elven.0803 = {	# Reclaim Sarn Athrad
	content_source = realms_dlc
	type = character_event
	title = elven.0803.t
	desc = elven.0803.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = eregion
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {
		name = elven.0803.a
	}
}

elven.0804 = {	# Halls of Edhelas
	content_source = realms_dlc
	type = character_event
	title = elven.0804.t
	desc = elven.0804.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = eregion
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {
		name = elven.0804.a
	}
}

elven.0805 = {	# Reclaim Eriador
	content_source = realms_dlc
	type = character_event
	title = elven.0805.t
	desc = elven.0805.desc
	theme = stewardship_duty_focus
	override_background = {
		reference = eregion
	}

	left_portrait = {
		character = root
		animation = marshal
	}

	option = {
		name = elven.0805.a
	}
}

elven.2100 = { # Letter sent by Eonwe to vassalize all FP in a triggered distance around him
	content_source = realms_dlc
	type = character_event
	window = fullscreen_event
	title = elven.2100.t
	desc = elven.2100.desc
	theme = realm

	on_trigger_fail = { #Trigger invitation again if it was blocked because the character was handling another invitation
		trigger_event = {
			id = elven.2100
			days = 1
		}	
	}

	override_background = { reference = flying_eagles }
	
	trigger = {
		faith_is_good = yes
		NOT = { is_orc = yes }
		is_nazgul = no
		is_sauron = no
	}

	option = { # Become vassal of Eonwe
		name = elven.2100.a

		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
		}
		change_liege = {
			liege = title:e_eonwe_host.holder
			change = scope:change
		}
		resolve_title_and_vassal_change = scope:change

		ai_chance = {
			base = 1 
		}
	}

	option = { # Refuse to become vassal of Eonwe
		name = elven.2100.b

		ai_chance = {
			base = 0
		}
	}
}